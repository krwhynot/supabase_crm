import{d as J,r as f,c as M,o as X,E as Z,y as ee,a as u,b as s,h as y,f as n,l as S,u as p,v as te,n as C,e as x,t as c,T as se,w as ae,B as le,j as d,G as oe,F as D,i as I,s as P}from"./index-Br7bM97V.js";import{E as O,A as F,p as z,r as re}from"./EngagementScoreRing-DT1wV0O8.js";import{r as ne}from"./MagnifyingGlassIcon-BepCswCi.js";import{r as B}from"./XMarkIcon-Bq58FYA6.js";import{r as ie}from"./ExclamationTriangleIcon-3AUMR-W2.js";import{r as ce}from"./UserGroupIcon-Bll1C4SH.js";import{r as ue}from"./CalendarIcon-CBoVSP04.js";import{r as de}from"./BuildingOfficeIcon-CE9ZCi7A.js";import{r as ve}from"./CheckIcon-0UoNe-IG.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const me={class:"principal-selector"},fe={class:"relative"},ge={class:"relative"},he={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},_e=["disabled"],ye={key:0,class:"absolute inset-y-0 right-0 pr-3 flex items-center"},xe={key:0,class:"mt-2 text-sm text-red-600 flex items-center"},be={class:"absolute z-10 mt-1 w-full bg-white shadow-lg max-h-96 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm"},we={class:"px-3 py-2 border-b border-gray-100"},ke={class:"flex items-center space-x-4"},Ce={class:"flex space-x-2"},Ae=["onClick"],Te={class:"max-h-72 overflow-y-auto"},Ee={key:0,class:"px-3 py-4 text-sm text-gray-500 text-center"},Ve=["onClick","onMouseenter"],$e={class:"flex items-center justify-between"},Le={class:"flex-1 min-w-0"},Me={class:"flex items-center space-x-2"},Se={class:"font-medium text-gray-900 truncate"},De={class:"text-sm text-gray-500 truncate"},Ie={class:"flex items-center space-x-4 mt-1 text-xs text-gray-600"},Pe={class:"flex items-center"},Oe={class:"flex items-center"},Fe={class:"flex items-center"},ze={class:"ml-3 flex-shrink-0"},Be={key:0,class:"absolute inset-y-0 right-0 flex items-center pr-4"},Ne={key:0,class:"border-t border-gray-100 px-3 py-2"},je={class:"flex items-center justify-between text-xs text-gray-600"},We={class:"flex space-x-2"},Re={key:0,class:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"},Ue={class:"flex items-center justify-between"},Ke={class:"flex items-center space-x-3"},Ye={class:"flex-shrink-0"},Ge={class:"text-sm font-medium text-gray-900"},Qe={class:"text-sm text-gray-600"},qe={class:"flex items-center space-x-3 mt-1"},He={class:"text-xs text-gray-500"},Je=J({__name:"PrincipalSelector",props:{modelValue:{default:""},loading:{type:Boolean,default:!1},error:{default:null},placeholder:{default:"Search principals..."},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","change","search","create-opportunity","log-interaction"],setup(N,{emit:j}){const b=N,m=j,A=f(),l=f(""),v=f(!1),i=f(-1),g=f([]),k=f(!1),h=f(["ACTIVE","MODERATE"]),W=[{value:"ACTIVE",label:"Active",colorClass:"bg-green-400"},{value:"MODERATE",label:"Moderate",colorClass:"bg-yellow-400"},{value:"LOW",label:"Low",colorClass:"bg-orange-400"},{value:"NO_ACTIVITY",label:"Inactive",colorClass:"bg-gray-400"}],o=M(()=>b.modelValue&&g.value.find(e=>e.principal_id===b.modelValue)||null),_=M(()=>{let e=g.value;if(h.value.length>0&&(e=e.filter(t=>h.value.includes(t.activity_status))),l.value){const t=l.value.toLowerCase();e=e.filter(a=>a.principal_name.toLowerCase().includes(t)||(a.organization_type||"").toLowerCase().includes(t))}return e.sort((t,a)=>{const r=t.engagement_score||0,w=a.engagement_score||0;return r!==w?w-r:t.principal_name.localeCompare(a.principal_name)})}),R=async e=>{const t=e.target;l.value=t.value,m("search",l.value),l.value.length>=2?await Q(l.value):l.value.length===0&&await V()},U=e=>{if(!(!v.value||_.value.length===0))switch(e.key){case"ArrowDown":e.preventDefault(),i.value=Math.min(i.value+1,_.value.length-1);break;case"ArrowUp":e.preventDefault(),i.value=Math.max(i.value-1,-1);break;case"Enter":e.preventDefault(),i.value>=0&&T(_.value[i.value]);break;case"Escape":e.preventDefault(),v.value=!1,i.value=-1;break}},T=e=>{m("update:modelValue",e.principal_id),m("change",e),l.value=e.principal_name,v.value=!1,i.value=-1},E=()=>{m("update:modelValue",""),m("change",null),l.value="",v.value=!1,i.value=-1,le(()=>{var e;(e=A.value)==null||e.focus()})},K=e=>{const t=h.value.indexOf(e);t>=0?h.value.splice(t,1):h.value.push(e)},Y=e=>{e.stopPropagation(),o.value&&m("create-opportunity",o.value),v.value=!1},G=e=>{e.stopPropagation(),o.value&&m("log-interaction",o.value),v.value=!1},V=async()=>{k.value=!0;try{const e=await z.getPrincipalActivitySummary();e.success&&(g.value=e.data||[])}catch(e){console.error("Failed to load principals:",e)}finally{k.value=!1}},Q=async e=>{k.value=!0;try{const t=await z.searchPrincipalsWithActivity(e,!1);t.success&&(g.value=t.data||[])}catch(t){console.error("Failed to search principals:",t)}finally{k.value=!1}},q=e=>{if(!e)return"No activity";const t=new Date(e),r=Math.floor((new Date().getTime()-t.getTime())/(1e3*60*60*24));return r===0?"Today":r===1?"Yesterday":r<7?`${r} days ago`:r<30?`${Math.floor(r/7)} weeks ago`:r<365?`${Math.floor(r/30)} months ago`:`${Math.floor(r/365)} years ago`},$=e=>{e.target.closest(".principal-selector")||(v.value=!1,i.value=-1)};return X(async()=>{if(document.addEventListener("click",$),await V(),b.modelValue){const e=g.value.find(t=>t.principal_id===b.modelValue);e&&(l.value=e.principal_name)}}),Z(()=>{document.removeEventListener("click",$)}),ee(()=>b.modelValue,e=>{if(e){const t=g.value.find(a=>a.principal_id===e);t&&(l.value=t.principal_name)}else l.value=""}),(e,t)=>(d(),u("div",me,[s("div",fe,[s("div",ge,[s("div",he,[n(p(ne),{class:"h-5 w-5 text-gray-400"})]),S(s("input",{ref_key:"searchInput",ref:A,"onUpdate:modelValue":t[0]||(t[0]=a=>l.value=a),type:"text",class:C(["block w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",[e.error?"border-red-300 focus:ring-red-500 focus:border-red-500":"",e.loading?"bg-gray-50":"bg-white"]]),placeholder:"Search principals by name or organization...",disabled:e.loading,onFocus:t[1]||(t[1]=a=>v.value=!0),onInput:R,onKeydown:U},null,42,_e),[[te,l.value]]),e.loading?(d(),u("div",ye,t[2]||(t[2]=[s("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"},null,-1)]))):l.value||o.value?(d(),u("button",{key:1,onClick:E,class:"absolute inset-y-0 right-0 pr-3 flex items-center hover:text-gray-700"},[n(p(B),{class:"h-4 w-4 text-gray-400"})])):y("",!0)]),e.error?(d(),u("div",xe,[n(p(ie),{class:"h-4 w-4 mr-1"}),x(" "+c(e.error),1)])):y("",!0),n(se,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:ae(()=>[S(s("div",be,[s("div",we,[s("div",ke,[t[3]||(t[3]=s("label",{class:"text-xs font-medium text-gray-700"},"Filter:",-1)),s("div",Ce,[(d(),u(D,null,I(W,a=>s("button",{key:a.value,onClick:r=>K(a.value),class:C(["inline-flex items-center px-2 py-1 rounded text-xs font-medium transition-colors",[h.value.includes(a.value)?"bg-blue-100 text-blue-800 border border-blue-200":"bg-gray-100 text-gray-700 border border-gray-200 hover:bg-gray-200"]])},[s("span",{class:C(["w-2 h-2 rounded-full mr-1",a.colorClass])},null,2),x(" "+c(a.label),1)],10,Ae)),64))])])]),s("div",Te,[_.value.length===0&&l.value?(d(),u("div",Ee,[n(p(ce),{class:"mx-auto h-8 w-8 text-gray-300 mb-2"}),x(' No principals found matching "'+c(l.value)+'" ',1)])):y("",!0),(d(!0),u(D,null,I(_.value,(a,r)=>{var w,L;return d(),u("div",{key:a.principal_id,onClick:H=>T(a),onMouseenter:H=>i.value=r,class:C(["relative cursor-pointer select-none py-3 px-3 hover:bg-gray-50 transition-colors",[i.value===r?"bg-blue-50":"",((w=o.value)==null?void 0:w.principal_id)===a.principal_id?"bg-blue-100":""]])},[s("div",$e,[s("div",Le,[s("div",Me,[s("span",Se,c(a.principal_name),1),n(F,{status:a.activity_status==="STALE"?"LOW":a.activity_status},null,8,["status"])]),s("div",De,c(a.organization_type),1),s("div",Ie,[s("span",Pe,[n(p(re),{class:"h-3 w-3 mr-1"}),x(" Score: "+c(a.engagement_score||0),1)]),s("span",Oe,[n(p(ue),{class:"h-3 w-3 mr-1"}),x(" "+c(q(a.last_activity_date)),1)]),s("span",Fe,[n(p(de),{class:"h-3 w-3 mr-1"}),x(" "+c(a.total_opportunities||0)+" ops ",1)])])]),s("div",ze,[n(O,{score:a.engagement_score||0,size:"sm"},null,8,["score"])])]),((L=o.value)==null?void 0:L.principal_id)===a.principal_id?(d(),u("div",Be,[n(p(ve),{class:"h-4 w-4 text-blue-600"})])):y("",!0)],42,Ve)}),128))]),o.value?(d(),u("div",Ne,[s("div",je,[t[5]||(t[5]=s("span",null,"Quick Actions:",-1)),s("div",We,[s("button",{onClick:P(Y,["stop"]),class:"text-blue-600 hover:text-blue-800 font-medium"}," Create Opportunity "),t[4]||(t[4]=s("span",{class:"text-gray-300"},"•",-1)),s("button",{onClick:P(G,["stop"]),class:"text-green-600 hover:text-green-800 font-medium"}," Log Interaction ")])])])):y("",!0)],512),[[oe,v.value&&(_.value.length>0||l.value)]])]),_:1})]),o.value&&!v.value?(d(),u("div",Re,[s("div",Ue,[s("div",Ke,[s("div",Ye,[n(O,{score:o.value.engagement_score||0,size:"md"},null,8,["score"])]),s("div",null,[s("h3",Ge,c(o.value.principal_name),1),s("p",Qe,c(o.value.organization_type),1),s("div",qe,[n(F,{status:o.value.activity_status==="STALE"?"LOW":o.value.activity_status},null,8,["status"]),s("span",He,c(o.value.total_opportunities||0)+" opportunities • "+c(o.value.total_interactions||0)+" interactions ",1)])])]),s("button",{onClick:E,class:"text-gray-400 hover:text-gray-600"},[n(p(B),{class:"h-5 w-5"})])])])):y("",!0)]))}}),it=pe(Je,[["__scopeId","data-v-4b5cbcc8"]]);export{it as P};
//# sourceMappingURL=PrincipalSelector-BnLK-7If.js.map
