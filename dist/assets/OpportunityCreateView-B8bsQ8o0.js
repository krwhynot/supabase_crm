import{d as w,r as p,c as C,C as O,a as l,b as t,h as c,p as b,f as i,w as u,g as N,t as m,j as d,e as x,k as B}from"./index-CtjJHjR0.js";import{O as E}from"./OpportunityFormWrapper-BavdCTUU.js";import{O as f}from"./opportunityStore-B1hLuFtx.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./principalStore-DHqEcCuF.js";import"./organizationsApi-DotikQjO.js";import"./supabaseClient-Dum322BS.js";import"./productStore-9Dx38iZU.js";import"./index.esm-Do0MT1Iq.js";const V={class:"opportunity-create-view"},z={class:"mb-8"},I={class:"flex mb-4","aria-label":"Breadcrumb"},R={class:"inline-flex items-center space-x-1 md:space-x-3"},S={class:"inline-flex items-center"},j={class:"flex items-center"},D={class:"flex items-center space-x-3 mb-4"},M={class:"max-w-4xl","data-testid":"opportunity-form-container"},L={key:0,class:"mt-6 max-w-4xl"},W={class:"p-4 border border-red-300 rounded-md bg-red-50"},$={class:"flex"},q={class:"mt-1 text-sm text-red-700"},F={key:1,class:"mt-6 max-w-4xl"},P={class:"p-4 border border-green-300 rounded-md bg-green-50"},U={class:"flex"},A={class:"mt-1 text-sm text-green-700"},Z=w({__name:"OpportunityCreateView",setup(G){const n=B(),v=O(),r=p(null),s=p(null),g=C(()=>{const o=v.query,e={};return o.contextType==="contact"&&(e.organizationName=o.organizationName||"",e.context=f.NEW_PRODUCT_INTEREST,e.notes=o.contactName?`Opportunity created from contact: ${o.contactName}`:"Opportunity created from contact page"),o.contextType==="organization"&&(e.organizationName=o.organizationName||"",e.context=f.FOLLOW_UP,e.notes="Opportunity created from organization page"),e}),y=o=>{if(console.log("Opportunity(s) created successfully:",o),r.value=null,o.opportunityId)s.value="Opportunity created successfully! Redirecting to details...",setTimeout(()=>{n.push(`/opportunities/${o.opportunityId}`)},1500);else if(o.opportunityIds&&o.opportunityIds.length>0){const e=o.count||o.opportunityIds.length;s.value=`${e} opportunities created successfully! Redirecting to list...`,setTimeout(()=>{n.push("/opportunities")},2e3)}else s.value="Opportunity created successfully! Redirecting...",setTimeout(()=>{n.push("/opportunities")},1500)},_=()=>{r.value=null,s.value=null,n.push("/opportunities")},h=o=>{console.error("Opportunity creation error:",o),s.value=null,r.value=typeof o=="string"?o:o.message||"An unexpected error occurred"},k=()=>{r.value=null};return(o,e)=>{const a=N("router-link");return d(),l("div",V,[t("div",z,[t("nav",I,[t("ol",R,[t("li",S,[i(a,{to:"/",class:"inline-flex items-center text-sm font-medium text-gray-700 hover:text-primary-600"},{default:u(()=>e[0]||(e[0]=[t("svg",{class:"w-3 h-3 mr-2.5",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"m19.707 9.293-2-2-7-7a1 1 0 0 0-1.414 0l-7 7-2 2a1 1 0 0 0 1.414 1.414L2 10.414V18a2 2 0 0 0 2 2h3a1 1 0 0 0 1-1v-4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h3a2 2 0 0 0 2-2v-7.586l.293.293a1 1 0 0 0 1.414-1.414Z"})],-1),x(" Dashboard ",-1)])),_:1,__:[0]})]),t("li",null,[t("div",j,[e[2]||(e[2]=t("svg",{class:"w-3 h-3 text-gray-400 mx-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m9 5 7 7-7 7"})],-1)),i(a,{to:"/opportunities",class:"ml-1 text-sm font-medium text-gray-700 hover:text-primary-600 md:ml-2"},{default:u(()=>e[1]||(e[1]=[x(" Opportunities ",-1)])),_:1,__:[1]})])]),e[3]||(e[3]=b('<li aria-current="page" data-v-1279af65><div class="flex items-center" data-v-1279af65><svg class="w-3 h-3 text-gray-400 mx-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-1279af65><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m9 5 7 7-7 7" data-v-1279af65></path></svg><span class="ml-1 text-sm font-medium text-gray-500 md:ml-2" data-v-1279af65>New Opportunity</span></div></li>',1))])]),t("div",D,[i(a,{to:"/opportunities",class:"inline-flex items-center text-gray-500 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded-md p-1","aria-label":"Back to opportunities list"},{default:u(()=>e[4]||(e[4]=[t("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),_:1,__:[4]}),e[5]||(e[5]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900","data-testid":"page-title"},"Create New Opportunity"),t("p",{class:"mt-2 text-gray-600"}," Set up a new sales opportunity with auto-naming, multi-principal support, and stage tracking. ")],-1))])]),t("div",M,[i(E,{"is-editing":!1,"initial-data":g.value,onSuccess:y,onCancel:_,onError:h,"data-testid":"opportunity-form"},null,8,["initial-data"])]),r.value?(d(),l("div",L,[t("div",W,[t("div",$,[e[7]||(e[7]=t("svg",{class:"h-5 w-5 text-red-400 mr-2 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t("div",null,[e[6]||(e[6]=t("h3",{class:"text-sm font-medium text-red-800"},"Error creating opportunity",-1)),t("p",q,m(r.value),1),t("div",{class:"mt-3"},[t("button",{onClick:k,class:"text-sm font-medium text-red-800 hover:text-red-900 focus:outline-none focus:ring-2 focus:ring-red-500 rounded-md px-2 py-1"}," Dismiss ")])])])])])):c("",!0),s.value?(d(),l("div",F,[t("div",P,[t("div",U,[e[9]||(e[9]=t("svg",{class:"h-5 w-5 text-green-400 mr-2 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)),t("div",null,[e[8]||(e[8]=t("h3",{class:"text-sm font-medium text-green-800"},"Success!",-1)),t("p",A,m(s.value),1)])])])])):c("",!0)])}}}),st=T(Z,[["__scopeId","data-v-1279af65"]]);export{st as default};
//# sourceMappingURL=OpportunityCreateView-B8bsQ8o0.js.map
