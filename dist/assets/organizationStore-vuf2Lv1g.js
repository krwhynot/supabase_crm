import{c as De,b as be,i as Oe,r as T,y as ne,j as z,m as Te}from"./index-B1F6v5N1.js";import{s as D}from"./supabaseClient-CzRfYRoe.js";function Pe(o,I){return Oe(),De("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[be("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})])}const le={api_call:{acceptable:500,tolerable:2e3},user_interaction:{acceptable:100,tolerable:300},page_load:{acceptable:2e3,tolerable:5e3},database_query:{acceptable:200,tolerable:1e3}};function xe(){const o=T([]),I=T(!0),A=ne(new Map),W=z(()=>{const c={};return["api_call","user_interaction","page_load","database_query"].forEach(v=>{const f=o.value.filter(b=>b.type===v);if(f.length===0){c[v]={averageResponseTime:0,p95ResponseTime:0,p99ResponseTime:0,successRate:0,totalRequests:0,errorCount:0,slowestRequests:[],fastestRequests:[]};return}const u=f.map(b=>b.duration).sort((b,x)=>b-x),p=f.filter(b=>b.success).length,M=Math.floor(u.length*.95),Z=Math.floor(u.length*.99);c[v]={averageResponseTime:u.reduce((b,x)=>b+x,0)/u.length,p95ResponseTime:u[M]||0,p99ResponseTime:u[Z]||0,successRate:p/f.length,totalRequests:f.length,errorCount:f.length-p,slowestRequests:[...f].sort((b,x)=>x.duration-b.duration).slice(0,5),fastestRequests:[...f].sort((b,x)=>b.duration-x.duration).slice(0,5)}}),c}),S=z(()=>{if(o.value.length===0)return{averageResponseTime:0,p95ResponseTime:0,p99ResponseTime:0,successRate:0,totalRequests:0,errorCount:0,slowestRequests:[],fastestRequests:[]};const c=o.value.map(u=>u.duration).sort((u,p)=>u-p),l=o.value.filter(u=>u.success).length,v=Math.floor(c.length*.95),f=Math.floor(c.length*.99);return{averageResponseTime:c.reduce((u,p)=>u+p,0)/c.length,p95ResponseTime:c[v]||0,p99ResponseTime:c[f]||0,successRate:l/o.value.length,totalRequests:o.value.length,errorCount:o.value.length-l,slowestRequests:[...o.value].sort((u,p)=>p.duration-u.duration).slice(0,10),fastestRequests:[...o.value].sort((u,p)=>u.duration-p.duration).slice(0,10)}}),$=z(()=>{const c=new Date(Date.now()-36e5).toISOString();return o.value.filter(l=>l.timestamp>c)}),Y=z(()=>o.value.filter(c=>{const l=le[c.type];return c.duration>l.tolerable})),X=z(()=>{const c=[];return Object.entries(W.value).forEach(([l,v])=>{const f=le[l];v.averageResponseTime>f.tolerable?c.push({type:l,message:`Average ${l} response time (${Math.round(v.averageResponseTime)}ms) exceeds tolerable threshold (${f.tolerable}ms)`,severity:"error"}):v.averageResponseTime>f.acceptable&&c.push({type:l,message:`Average ${l} response time (${Math.round(v.averageResponseTime)}ms) exceeds acceptable threshold (${f.acceptable}ms)`,severity:"warning"}),v.successRate<.95?c.push({type:l,message:`${l} success rate (${Math.round(v.successRate*100)}%) is below 95%`,severity:"error"}):v.successRate<.98&&c.push({type:l,message:`${l} success rate (${Math.round(v.successRate*100)}%) is below 98%`,severity:"warning"})}),c}),V=(c,l,v)=>{I.value&&A.set(c,{start:performance.now(),name:l,type:v})},E=(c,l=!0,v)=>{if(!I.value)return;const f=A.get(c);if(!f)return;const u=performance.now()-f.start,p={id:c,name:f.name,type:f.type,duration:u,timestamp:new Date().toISOString(),success:l,metadata:v};o.value.push(p),A.delete(c),o.value.length>1e3&&(o.value=o.value.slice(-1e3))},F=(c,l,v,f=!0,u)=>{if(!I.value)return;const p={id:`${l}_${Date.now()}_${Math.random()}`,name:c,type:l,duration:v,timestamp:new Date().toISOString(),success:f,metadata:u};o.value.push(p),o.value.length>1e3&&(o.value=o.value.slice(-1e3))},H=async(c,l,v,f)=>{const u=`${v}_${Date.now()}_${Math.random()}`;V(u,l,v);try{const p=await c();return E(u,!0,f),p}catch(p){throw E(u,!1,{...f,error:p instanceof Error?p.message:"Unknown error"}),p}},h=(c,l,v,f)=>{const u=performance.now();try{const p=c(),M=performance.now()-u;return F(l,v,M,!0,f),p}catch(p){const M=performance.now()-u;throw F(l,v,M,!1,{...f,error:p instanceof Error?p.message:"Unknown error"}),p}},C=()=>{o.value=[],A.clear()},P=()=>({metrics:o.value,statistics:W.value,overallStatistics:S.value,exportedAt:new Date().toISOString()}),i=(c,l)=>o.value.filter(v=>v.timestamp>=c&&v.timestamp<=l),L=(c=24)=>{const l=new Date,v=[];for(let f=c-1;f>=0;f--){const u=new Date(l.getTime()-f*60*60*1e3),p=new Date(u.getTime()+60*60*1e3),M=o.value.filter(b=>{const x=new Date(b.timestamp);return x>=u&&x<p}),Z=M.length>0?M.reduce((b,x)=>b+x.duration,0)/M.length:0;v.push({hour:u.toISOString().substring(0,13)+":00",averageTime:Z,requestCount:M.length})}return v},g=()=>{I.value=!0},Q=()=>{I.value=!1};return{metrics:z(()=>o.value),isRecording:z(()=>I.value),activeOperations:z(()=>Array.from(A.entries())),statistics:W,overallStatistics:S,recentMetrics:$,slowRequests:Y,performanceIssues:X,startOperation:V,endOperation:E,recordMetric:F,measureFunction:H,measureSyncFunction:h,clearMetrics:C,exportMetrics:P,getMetricsByTimeRange:i,getAverageResponseTimeByHour:L,startRecording:g,stopRecording:Q,thresholds:le}}function ke(){const o=T([]),I=T([]),A=T(!0),W=ne(new Map),S=z(()=>{const n=new Map;return o.value.forEach(t=>{const s=n.get(t.fingerprint);if(s){s.count++,s.lastSeen=t.timestamp,s.errors.push(t);const w={low:1,medium:2,high:3,critical:4};w[t.severity]>w[s.severity]&&(s.severity=t.severity)}else n.set(t.fingerprint,{fingerprint:t.fingerprint,message:t.message,count:1,firstSeen:t.timestamp,lastSeen:t.timestamp,severity:t.severity,source:t.source,resolved:t.resolved,errors:[t]})}),Array.from(n.values()).sort((t,s)=>new Date(s.lastSeen).getTime()-new Date(t.lastSeen).getTime())}),$=z(()=>{const n=new Date,t=new Date(n.getTime()-60*60*1e3),s=o.value.filter(_=>new Date(_.timestamp)>t),w={javascript:0,api:0,database:0,user_action:0,system:0},O={low:0,medium:0,high:0,critical:0};o.value.forEach(_=>{w[_.source]++,O[_.severity]++});const R=o.value.filter(_=>_.resolved),k=R.length>0?R.reduce((_,j)=>{if(j.resolvedAt){const ee=new Date(j.resolvedAt).getTime()-new Date(j.timestamp).getTime();return _+ee/(1e3*60)}return _},0)/R.length:0;return{total:o.value.length,bySource:w,bySeverity:O,errorRate:s.length/60,uniqueErrors:S.value.length,resolvedErrors:R.length,averageResolutionTime:k}}),Y=z(()=>{const n=new Date(Date.now()-36e5).toISOString();return o.value.filter(t=>t.timestamp>n)}),X=z(()=>o.value.filter(n=>n.severity==="critical"&&!n.resolved)),V=z(()=>o.value.filter(n=>!n.resolved)),E=(n,t,s)=>{const w=(t==null?void 0:t.split(`
`).slice(0,3).join("|"))||"",O=`${s}:${n}:${w}`;let R=0;for(let k=0;k<O.length;k++){const _=O.charCodeAt(k);R=(R<<5)-R+_,R=R&R}return Math.abs(R).toString(36)},F=(n,t={})=>{if(!A.value)return;const s={id:`error_${Date.now()}_${Math.random().toString(36).substring(7)}`,message:n,stack:t.stack,source:t.source||"javascript",severity:t.severity||"medium",timestamp:new Date().toISOString(),url:window.location.href,userAgent:navigator.userAgent,userId:t.userId,context:t.context,resolved:!1,tags:t.tags||[],fingerprint:E(n,t.stack,t.source)};return o.value.push(s),o.value.length>2e3&&(o.value=o.value.slice(-2e3)),c(s),s},H=(n,t)=>F(n.message,{stack:n.stack,source:"javascript",severity:"high",context:t,tags:["javascript","unhandled"]}),h=(n,t,s,w)=>{const O=t&&t>=500?"high":"medium";return F(n,{source:"api",severity:O,context:{statusCode:t,endpoint:s,...w},tags:["api","http"]})},C=(n,t,s)=>F(n,{source:"database",severity:"high",context:{query:t,...s},tags:["database","sql"]}),P=(n,t,s)=>F(`User action failed: ${n} - ${t}`,{source:"user_action",severity:"medium",context:{action:n,...s},tags:["user_action",n]}),i=(n,t)=>{const s=o.value.find(w=>w.id===n);s&&(s.resolved=!0,s.resolvedAt=new Date().toISOString(),s.resolvedBy=t)},L=(n,t)=>{o.value.filter(w=>w.fingerprint===n).forEach(w=>{w.resolved=!0,w.resolvedAt=new Date().toISOString(),w.resolvedBy=t})},g=(n,t)=>{const s=o.value.find(w=>w.id===n);s&&!s.tags.includes(t)&&s.tags.push(t)},Q=(n,t)=>{const s=o.value.find(w=>w.id===n);s&&(s.tags=s.tags.filter(w=>w!==t))},c=n=>{I.value.forEach(t=>{if(!t.enabled)return;const s=new Date,w=W.get(t.id);if(w){const R=new Date(w);if(R.setMinutes(R.getMinutes()+t.cooldownPeriod),s<R)return}let O=!1;switch(t.condition.type){case"new_error":O=!0;break;case"severity":O=t.condition.severity===n.severity;break;case"error_rate":const R=new Date(s.getTime()-t.condition.timeWindow*60*1e3);O=o.value.filter(te=>new Date(te.timestamp)>R).length/t.condition.timeWindow>t.condition.threshold;break;case"error_count":const j=new Date(s.getTime()-t.condition.timeWindow*60*1e3);O=o.value.filter(te=>new Date(te.timestamp)>j).length>t.condition.threshold;break}O&&l(t,n)})},l=(n,t)=>{var s;console.warn(`Alert triggered: ${n.name}`,{rule:n,error:t,timestamp:new Date().toISOString()}),W.set(n.id,new Date().toISOString()),n.webhookUrl&&console.log(`Would send webhook to: ${n.webhookUrl}`),(s=n.emailRecipients)!=null&&s.length&&console.log(`Would send emails to: ${n.emailRecipients.join(", ")}`)},v=n=>{const t={...n,id:`rule_${Date.now()}_${Math.random().toString(36).substring(7)}`};return I.value.push(t),t},f=n=>{const t=I.value.findIndex(s=>s.id===n);t>-1&&(I.value.splice(t,1),W.delete(n))},u=()=>{o.value=[]},p=n=>{let t=o.value;return n&&(t=o.value.filter(s=>!(n.startDate&&s.timestamp<n.startDate||n.endDate&&s.timestamp>n.endDate||n.source&&s.source!==n.source||n.severity&&s.severity!==n.severity||n.resolved!==void 0&&s.resolved!==n.resolved))),{errors:t,statistics:$.value,errorGroups:S.value,exportedAt:new Date().toISOString(),filters:n}},M=(n=24)=>{const t=new Date,s=[];for(let w=n-1;w>=0;w--){const O=new Date(t.getTime()-w*60*60*1e3),R=new Date(O.getTime()+60*60*1e3),k=o.value.filter(j=>{const ee=new Date(j.timestamp);return ee>=O&&ee<R}),_=new Set(k.map(j=>j.fingerprint));s.push({hour:O.toISOString().substring(0,13)+":00",errorCount:k.length,uniqueErrors:_.size})}return s},Z=()=>{A.value=!0},b=()=>{A.value=!1},x=()=>{window.addEventListener("error",n=>{H(n.error||new Error(n.message),{filename:n.filename,lineno:n.lineno,colno:n.colno})}),window.addEventListener("unhandledrejection",n=>{const t=n.reason instanceof Error?n.reason:new Error(String(n.reason));H(t,{type:"unhandled_promise_rejection"})})};return{errors:z(()=>o.value),alertRules:z(()=>I.value),isTracking:z(()=>A.value),errorGroups:S,statistics:$,recentErrors:Y,criticalErrors:X,unresolvedErrors:V,recordError:F,recordJavaScriptError:H,recordApiError:h,recordDatabaseError:C,recordUserActionError:P,resolveError:i,resolveErrorGroup:L,addTag:g,removeTag:Q,addAlertRule:v,removeAlertRule:f,clearErrors:u,exportErrors:p,getErrorTrend:M,startTracking:Z,stopTracking:b,setupGlobalErrorHandlers:x}}const je=Te("organization",()=>{const{measureFunction:o,recordMetric:I}=xe(),{recordDatabaseError:A,recordUserActionError:W}=ke(),S=T([]),$=T(null),Y=T([]),X=T([]),V=T([]),E=T(null),F=T([]),H=T([]),h=ne({organizations:!1,currentOrganization:!1,analytics:!1,performance:!1,leadScoring:!1,metrics:!1,interactions:!1,documents:!1,creating:!1,updating:!1,deleting:!1,bulkOperations:!1}),C=ne({organizations:"",currentOrganization:"",analytics:"",performance:"",leadScoring:"",metrics:"",interactions:"",documents:"",creating:"",updating:"",deleting:"",bulkOperations:""}),P=T(""),i=T({}),L=T({field:"name",order:"asc"}),g=T({page:1,limit:20,total:0,totalPages:0,hasNext:!1,hasPrevious:!1}),Q=T(null),c=ne({}),l=z(()=>S.value.length>0),v=z(()=>g.value.total),f=z(()=>Object.values(h).some(e=>e)),u=z(()=>Object.values(C).some(e=>e!=="")),p=z(()=>{const r=Object.keys(C).find(a=>C[a]!=="");return r?C[r]:""}),M=z(()=>E.value?{total:E.value.totalOrganizations,active:E.value.activeOrganizations,prospects:E.value.prospects,customers:E.value.customers,partners:E.value.partners,totalRevenue:E.value.totalRevenue,averageLeadScore:E.value.averageLeadScore,thisMonth:E.value.monthlyGrowth>0?Math.round(E.value.totalOrganizations*E.value.monthlyGrowth/100):0,thisWeek:Math.round((E.value.monthlyGrowth>0?E.value.totalOrganizations*E.value.monthlyGrowth/100:0)/4)}:null),Z=z(()=>S.value.filter(e=>e.lead_score!==null).sort((e,r)=>(r.lead_score||0)-(e.lead_score||0)).slice(0,10)),b=z(()=>S.value.reduce((e,r)=>{const a=r.status||"Unknown";return e[a]=(e[a]||0)+1,e},{})),x=z(()=>{const e=new Date;return e.setDate(e.getDate()-30),S.value.filter(r=>r.created_at?new Date(r.created_at)>=e:!1)}),n=()=>{Object.keys(C).forEach(e=>{C[e]=""})},t=e=>{C[e]=""},s=(e,r)=>{C[e]=r,console.error(`Organization Store Error (${e}):`,r)},w=e=>{const r=c[e];return r?Date.now()-r.timestamp<r.ttl:!1},O=e=>w(e)?c[e].data:null,R=(e,r,a=3e5)=>{c[e]={data:r,timestamp:Date.now(),ttl:a}},k=e=>{e?delete c[e]:Object.keys(c).forEach(r=>delete c[r])},_=async(e={})=>await o(async()=>{try{h.organizations=!0,t("organizations"),e.page!==void 0&&(g.value.page=e.page),e.limit!==void 0&&(g.value.limit=e.limit),e.filters&&(i.value={...i.value,...e.filters}),e.sort&&(L.value={...L.value,...e.sort}),e.search!==void 0&&(P.value=e.search);const r=`organizations_${JSON.stringify({page:g.value.page,limit:g.value.limit,filters:i.value,sort:L.value,search:P.value})}`;if(e.useCache!==!1){const m=O(r);if(m)return S.value=e.resetList?m.data:[...S.value,...m.data],g.value=m.pagination,m}let a=D.from("organizations").select("*",{count:"exact"});if(P.value.trim()){const m=P.value.trim();a=a.or(`name.ilike.%${m}%,legal_name.ilike.%${m}%,industry.ilike.%${m}%`)}i.value.industry&&i.value.industry.length>0&&(a=a.in("industry",i.value.industry)),i.value.status&&i.value.status.length>0&&(a=a.in("status",i.value.status)),i.value.type&&i.value.type.length>0&&(a=a.in("type",i.value.type)),i.value.size&&i.value.size.length>0&&(a=a.in("size",i.value.size)),i.value.country&&i.value.country.length>0&&(a=a.in("country",i.value.country)),i.value.leadScoreRange&&(i.value.leadScoreRange.min!==void 0&&(a=a.gte("lead_score",i.value.leadScoreRange.min)),i.value.leadScoreRange.max!==void 0&&(a=a.lte("lead_score",i.value.leadScoreRange.max))),i.value.employeeRange&&(i.value.employeeRange.min!==void 0&&(a=a.gte("employees_count",i.value.employeeRange.min)),i.value.employeeRange.max!==void 0&&(a=a.lte("employees_count",i.value.employeeRange.max))),i.value.revenueRange&&(i.value.revenueRange.min!==void 0&&(a=a.gte("annual_revenue",i.value.revenueRange.min)),i.value.revenueRange.max!==void 0&&(a=a.lte("annual_revenue",i.value.revenueRange.max))),i.value.lastContactDateRange&&(i.value.lastContactDateRange.start&&(a=a.gte("last_contact_date",i.value.lastContactDateRange.start.toISOString())),i.value.lastContactDateRange.end&&(a=a.lte("last_contact_date",i.value.lastContactDateRange.end.toISOString())));const d=L.value.order==="asc";a=a.order(L.value.field,{ascending:d});const y=(g.value.page-1)*g.value.limit;a=a.range(y,y+g.value.limit-1);const{data:q,error:B,count:U}=await a;if(B)throw new Error(B.message);const N=(q||[]).map(m=>({id:m.id||"",name:m.name||"",legal_name:m.legal_name,industry:m.industry,type:m.type,size:m.size,status:m.status,website:m.website,email:m.email,primary_phone:m.primary_phone,city:m.city,country:m.country,employees_count:m.employees_count,annual_revenue:m.annual_revenue,lead_score:m.lead_score,contact_count:void 0,last_interaction_date:m.last_contact_date,next_follow_up_date:m.next_follow_up_date,created_at:m.created_at,updated_at:m.updated_at}));g.value.total=U||0,g.value.totalPages=Math.ceil(g.value.total/g.value.limit),g.value.hasNext=g.value.page<g.value.totalPages,g.value.hasPrevious=g.value.page>1,e.resetList!==!1?S.value=N:S.value=[...S.value,...N];const G={data:N,pagination:{...g.value},filters:{...i.value},sort:{...L.value}};return R(r,G),Q.value=new Date,G}catch(r){const a=r instanceof Error?r.message:"Failed to fetch organizations";return s("organizations",a),A(`Failed to fetch organizations: ${a}`,"SELECT FROM organizations",{operation:"fetch_organizations",options:e}),null}finally{h.organizations=!1}},"Fetch Organizations","database_query",{operation:"fetch",filters:e.filters,page:e.page,limit:e.limit}),j=async e=>{var r,a,d;try{h.currentOrganization=!0,t("currentOrganization");const y=`organization_${e}`,q=O(y);if(q)return $.value=q,q;const{data:B,error:U}=await D.from("organizations").select("*").eq("id",e).single();if(U)throw new Error(U.message);const[N,G,m]=await Promise.all([D.from("contacts").select("id, first_name, last_name, email, title").eq("organization_id",e),D.from("organization_interactions").select("id, type, subject, interaction_date, contact_id, direction").eq("organization_id",e).order("interaction_date",{ascending:!1}).limit(10),D.from("organization_documents").select("id, name, category, size, created_at").eq("organization_id",e)]),re={...B,contact_count:((r=N.data)==null?void 0:r.length)||0,interaction_count:((a=G.data)==null?void 0:a.length)||0,document_count:((d=m.data)==null?void 0:d.length)||0,recent_interactions:(G.data||[]).map(K=>{var se,oe,ae;return{id:K.id,type:K.type,subject:K.subject,interaction_date:K.interaction_date,contact_name:(se=N.data)!=null&&se.find(J=>J.id===K.contact_id)?`${(oe=N.data.find(J=>J.id===K.contact_id))==null?void 0:oe.first_name} ${(ae=N.data.find(J=>J.id===K.contact_id))==null?void 0:ae.last_name}`:void 0}})};return $.value=re,R(y,re),re}catch(y){const q=y instanceof Error?y.message:"Failed to fetch organization";return s("currentOrganization",q),$.value=null,null}finally{h.currentOrganization=!1}},ee=async e=>await o(async()=>{try{h.creating=!0,t("creating");const{data:r,error:a}=await D.from("organizations").insert(e).select().single();if(a)throw A(`Failed to create organization: ${a.message}`,"INSERT INTO organizations",{operation:"create_organization",data:e}),new Error(a.message);return k(),await _({resetList:!0}),I("create_organization_success","user_interaction",0,!0,{organizationName:e.name,organizationIndustry:e.industry}),r}catch(r){const a=r instanceof Error?r.message:"Failed to create organization";return s("creating",a),W("create_organization",a,{organizationData:e}),null}finally{h.creating=!1}},"Create Organization","database_query",{operation:"create"}),te=async(e,r)=>{var a;try{h.updating=!0,t("updating");const{data:d,error:y}=await D.from("organizations").update(r).eq("id",e).select().single();if(y)throw new Error(y.message);return((a=$.value)==null?void 0:a.id)===e&&await j(e),k(),await _({resetList:!0}),d}catch(d){const y=d instanceof Error?d.message:"Failed to update organization";return s("updating",y),null}finally{h.updating=!1}},ue=async e=>{var r;try{h.deleting=!0,t("deleting");const{error:a}=await D.from("organizations").delete().eq("id",e);if(a)throw new Error(a.message);return S.value=S.value.filter(d=>d.id!==e),((r=$.value)==null?void 0:r.id)===e&&($.value=null),k(),!0}catch(a){const d=a instanceof Error?a.message:"Failed to delete organization";return s("deleting",d),!1}finally{h.deleting=!1}},me=async e=>{P.value=e,g.value.page=1,await _({search:e,resetList:!0})},he=async()=>{P.value="",g.value.page=1,await _({resetList:!0})},pe=async e=>{i.value={...i.value,...e},g.value.page=1,await _({resetList:!0})},we=async()=>{i.value={},g.value.page=1,await _({resetList:!0})},ye=async(e,r)=>{L.value={field:e,order:r},g.value.page=1,await _({resetList:!0})},ie=async e=>{e>=1&&e<=g.value.totalPages&&(g.value.page=e,await _())},_e=async()=>{g.value.hasNext&&await ie(g.value.page+1)},ze=async()=>{g.value.hasPrevious&&await ie(g.value.page-1)},de=async()=>{var e,r;try{h.metrics=!0,t("metrics");const a="dashboard_metrics",d=O(a);if(d)return E.value=d,d;const[y,q,B,U,N,G]=await Promise.all([D.from("organizations").select("id",{count:"exact",head:!0}),D.from("organizations").select("id",{count:"exact",head:!0}).eq("status","Active"),D.from("organizations").select("id",{count:"exact",head:!0}).eq("status","Prospect"),D.from("organizations").select("id",{count:"exact",head:!0}).eq("status","Customer"),D.from("organizations").select("id",{count:"exact",head:!0}).eq("status","Partner"),D.from("organizations").select("annual_revenue, lead_score",{count:"exact"}).not("annual_revenue","is",null)]),m=new Date,re=new Date(m.getFullYear(),m.getMonth(),1),K=await D.from("organizations").select("id",{count:"exact",head:!0}).gte("created_at",re.toISOString()),se=((e=G.data)==null?void 0:e.reduce((J,ce)=>J+(ce.annual_revenue||0),0))||0,oe=(r=G.data)!=null&&r.length?G.data.reduce((J,ce)=>J+(ce.lead_score||0),0)/G.data.length:0,ae={totalOrganizations:y.count||0,activeOrganizations:q.count||0,prospects:B.count||0,customers:U.count||0,partners:N.count||0,totalRevenue:se,averageLeadScore:oe,monthlyGrowth:K.count||0,industryDistribution:[],statusDistribution:[],recentActivity:[]};return E.value=ae,R(a,ae,6e5),ae}catch(a){const d=a instanceof Error?a.message:"Failed to fetch dashboard metrics";return s("metrics",d),null}finally{h.metrics=!1}},ge=async()=>{try{h.analytics=!0,t("analytics");const{data:e,error:r}=await D.from("organization_summary_analytics").select("*").order("lead_score",{ascending:!1}).limit(50);if(r)throw new Error(r.message);return Y.value=e||[],e}catch(e){const r=e instanceof Error?e.message:"Failed to fetch analytics";return s("analytics",r),null}finally{h.analytics=!1}},Ee=async()=>{try{h.performance=!0,t("performance");const{data:e,error:r}=await D.from("monthly_organization_performance").select("*").order("performance_month",{ascending:!1}).limit(12);if(r)throw new Error(r.message);return X.value=e||[],e}catch(e){const r=e instanceof Error?e.message:"Failed to fetch performance data";return s("performance",r),null}finally{h.performance=!1}},Re=async()=>{try{h.leadScoring=!0,t("leadScoring");const{data:e,error:r}=await D.from("organization_lead_scoring").select("*").order("lead_score",{ascending:!1}).limit(100);if(r)throw new Error(r.message);return V.value=e||[],e}catch(e){const r=e instanceof Error?e.message:"Failed to fetch lead scoring data";return s("leadScoring",r),null}finally{h.leadScoring=!1}},ve=async e=>{var r;try{h.interactions=!0,t("interactions");const a=e||((r=$.value)==null?void 0:r.id);if(!a)throw new Error("No organization ID provided");const{data:d,error:y}=await D.from("organization_interactions").select("*").eq("organization_id",a).order("interaction_date",{ascending:!1});if(y)throw new Error(y.message);return F.value=d||[],d}catch(a){const d=a instanceof Error?a.message:"Failed to fetch interactions";return s("interactions",d),null}finally{h.interactions=!1}},Se=async e=>{try{const{data:r,error:a}=await D.from("organization_interactions").insert(e).select().single();if(a)throw new Error(a.message);return await ve(e.organization_id),r}catch(r){const a=r instanceof Error?r.message:"Failed to create interaction";return s("interactions",a),null}},fe=async e=>{var r;try{h.documents=!0,t("documents");const a=e||((r=$.value)==null?void 0:r.id);if(!a)throw new Error("No organization ID provided");const{data:d,error:y}=await D.from("organization_documents").select("*").eq("organization_id",a).order("created_at",{ascending:!1});if(y)throw new Error(y.message);return H.value=d||[],d}catch(a){const d=a instanceof Error?a.message:"Failed to fetch documents";return s("documents",d),null}finally{h.documents=!1}};return{organizations:S,currentOrganization:$,analyticsData:Y,performanceData:X,leadScoringData:V,dashboardMetrics:E,interactions:F,documents:H,searchQuery:P,appliedFilters:i,sortConfig:L,pagination:g,lastRefreshed:Q,loading:h,isLoading:f,errors:C,hasErrors:u,currentError:p,hasOrganizations:l,totalOrganizations:v,organizationStats:M,topPerformingOrganizations:Z,organizationsByStatus:b,recentOrganizations:x,fetchOrganizations:_,fetchOrganization:j,createOrganization:ee,updateOrganization:te,deleteOrganization:ue,searchOrganizations:me,clearSearch:he,applyFilters:pe,clearFilters:we,setSorting:ye,setPage:ie,nextPage:_e,previousPage:ze,fetchDashboardMetrics:de,fetchAnalytics:ge,fetchPerformanceData:Ee,fetchLeadScoringData:Re,fetchInteractions:ve,createInteraction:Se,fetchDocuments:fe,createDocument:async e=>{try{const{data:r,error:a}=await D.from("organization_documents").insert(e).select().single();if(a)throw new Error(a.message);return await fe(e.organization_id),r}catch(r){const a=r instanceof Error?r.message:"Failed to create document";return s("documents",a),null}},performBulkOperation:async e=>{var r,a;try{h.bulkOperations=!0,t("bulkOperations");let d=0,y=0;const q=[];for(const B of e.organizationIds)try{switch(e.type){case"update_status":(r=e.data)!=null&&r.status&&(await te(B,{status:e.data.status}),d++);break;case"delete":await ue(B),d++;break;case"add_tags":(a=e.data)!=null&&a.tags&&S.value.find(N=>N.id===B)&&(await te(B,{tags:e.data.tags}),d++);break;default:throw new Error(`Unsupported bulk operation: ${e.type}`)}}catch(U){y++,q.push({id:B,error:U instanceof Error?U.message:"Unknown error"})}return{operation:e,success:y===0,total:e.organizationIds.length,successful:d,failed:y,errors:q}}catch(d){const y=d instanceof Error?d.message:"Failed to perform bulk operation";return s("bulkOperations",y),{operation:e,success:!1,total:e.organizationIds.length,successful:0,failed:e.organizationIds.length,errors:e.organizationIds.map(q=>({id:q,error:y}))}}finally{h.bulkOperations=!1}},getOrganizationById:e=>S.value.find(r=>r.id===e),organizationExists:e=>S.value.some(r=>r.id===e),refreshAllData:async()=>{k(),await Promise.all([_({resetList:!0}),de(),ge()]),Q.value=new Date},resetStore:()=>{S.value=[],$.value=null,Y.value=[],X.value=[],V.value=[],E.value=null,F.value=[],H.value=[],P.value="",i.value={},L.value={field:"name",order:"asc"},g.value={page:1,limit:20,total:0,totalPages:0,hasNext:!1,hasPrevious:!1},Object.keys(h).forEach(e=>{h[e]=!1}),n(),k(),Q.value=null},clearErrors:n,clearError:t,clearCache:k}});export{Pe as r,je as u};
//# sourceMappingURL=organizationStore-vuf2Lv1g.js.map
