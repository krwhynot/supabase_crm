import{d as J,r as g,c as M,y as Q,o as X,C as Y,q as Z,w as tt,j as m,b as t,a as _,h as w,l as et,f as c,e as at,u as p,m as ot,t as u,F as N,i as T,J as rt}from"./index-CtjJHjR0.js";import{_ as st}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-CSI_IRkI.js";import{P as nt}from"./PrincipalSelector-Bvv7zegO.js";import{r as it,P as lt,a as dt}from"./ManagePrincipalProductsButton.vue_vue_type_style_index_0_scoped_f75a9cbf_lang-CgdDeQZV.js";import{u as ct}from"./principalStore-DHqEcCuF.js";import"./PrincipalDashboard.vue_vue_type_style_index_0_scoped_daf2c332_lang-TY93HFqY.js";import"./supabaseClient-Dum322BS.js";/* empty css                                                                       *//* empty css                                                                          */import"./EngagementScoreRing-BkhISJFZ.js";import{E as ut,A as mt,O as pt}from"./OpportunityPipelineChart-BwfMBvfP.js";/* empty css                                                                                     */import"./opportunityStore-B1hLuFtx.js";/* empty css                                                                       */import{r as _t}from"./ArrowDownTrayIcon-CO3_VHAU.js";import{r as ft}from"./ChartBarIcon-DnppHkPB.js";import{r as ht}from"./CalendarDaysIcon-DqOrfd2h.js";import{r as gt}from"./CurrencyDollarIcon-DIE48oxp.js";import{r as vt}from"./TrophyIcon-BzssDnry.js";import{r as yt}from"./InformationCircleIcon-1Ldx3HPC.js";import{r as xt}from"./ExclamationTriangleIcon-BvwA24I5.js";import{_ as bt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./dashboardStore-BEBNMsxJ.js";import"./productStore-9Dx38iZU.js";import"./organizationStore-nVvH6PxL.js";import"./index.esm-Do0MT1Iq.js";import"./MagnifyingGlassIcon-C7DlFZAR.js";import"./XMarkIcon-D9bsmxiL.js";import"./UserGroupIcon-CL3csMZ9.js";import"./CalendarIcon-DPP_Fow2.js";import"./BuildingOfficeIcon-DckFZ7iO.js";import"./CheckIcon-B_41sR31.js";import"./organizationsApi-DotikQjO.js";import"./FunnelIcon-DBMyC3nZ.js";const Mt={class:"principal-analytics-view"},wt={class:"mb-6"},St={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between"},Pt={class:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3"},Et=["disabled"],At={class:"mb-6"},Dt={key:0,class:"flex items-center justify-center py-12"},It={key:1,class:"text-center py-12"},Lt={key:2,class:"space-y-6"},Ot={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},Ct={class:"bg-white rounded-lg border border-gray-200 p-4"},kt={class:"flex items-center"},Vt={class:"flex-shrink-0"},Nt={class:"ml-3"},Tt={class:"text-2xl font-bold text-gray-900"},$t={class:"bg-white rounded-lg border border-gray-200 p-4"},Rt={class:"flex items-center"},Ft={class:"flex-shrink-0"},jt={class:"ml-3"},Bt={class:"text-2xl font-bold text-gray-900"},Ut={class:"bg-white rounded-lg border border-gray-200 p-4"},Ht={class:"flex items-center"},Wt={class:"flex-shrink-0"},Kt={class:"ml-3"},Gt={class:"text-2xl font-bold text-gray-900"},qt={class:"bg-white rounded-lg border border-gray-200 p-4"},zt={class:"flex items-center"},Jt={class:"flex-shrink-0"},Qt={class:"ml-3"},Xt={class:"text-2xl font-bold text-gray-900"},Yt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Zt={class:"bg-white rounded-lg border border-gray-200 p-6"},te={class:"h-64"},ee={class:"bg-white rounded-lg border border-gray-200 p-6"},ae={class:"h-64"},oe={class:"bg-white rounded-lg border border-gray-200 p-6"},re={class:"h-64"},se={class:"bg-white rounded-lg border border-gray-200 p-6"},ne={class:"h-64"},ie={class:"bg-white rounded-lg border border-gray-200 p-6"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},de={class:"space-y-2"},ce={class:"flex-1 min-w-0"},ue={class:"text-sm font-medium text-gray-900 truncate"},me={class:"text-xs text-gray-500"},pe={class:"flex-shrink-0 ml-4"},_e={key:0,class:"text-center py-4"},fe={class:"space-y-2"},he={class:"flex items-center"},ge={class:"text-sm font-medium text-gray-900"},ve={class:"text-xs text-gray-500"},ye={class:"text-sm font-semibold text-gray-900"},xe={key:0,class:"text-center py-4"},be={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Me={class:"flex items-start"},we={class:"flex-1"},Se={class:"text-sm text-blue-700 mt-1"},Pe={key:3,class:"bg-red-50 border border-red-200 rounded-lg p-4"},Ee={class:"flex"},Ae={class:"text-sm text-red-700 mt-1"},De=J({__name:"PrincipalAnalyticsView",setup(Ie){const $=Y(),v=ct(),o=g(null),l=g("30d"),S=g(!1),y=g(null),s=g(null),E=g(null),R=M(()=>v.loading),F=M(()=>v.error),D=M(()=>{var a;return(a=s.value)!=null&&a.productPerformance?s.value.productPerformance.slice(0,5).sort((e,r)=>(r.product_performance_score||0)-(e.product_performance_score||0)):[]}),A=M(()=>{var a;return((a=s.value)==null?void 0:a.activityBreakdown)||[]}),j=M(()=>A.value.reduce((a,e)=>a+e.count,0)),I=async()=>{if(o.value){S.value=!0,y.value=null;try{await new Promise(a=>setTimeout(a,1500)),s.value={currentEngagementScore:Math.floor(Math.random()*40)+60,totalActivities:Math.floor(Math.random()*200)+50,totalPipelineValue:Math.floor(Math.random()*5e5)+1e5,winRate:Math.floor(Math.random()*30)+40,engagementTrend:B(),activityVolume:U(),productPerformance:H(),opportunityPipeline:W(),activityBreakdown:[{type:"PHONE_CALL",count:Math.floor(Math.random()*20)+10},{type:"EMAIL",count:Math.floor(Math.random()*30)+15},{type:"IN_PERSON",count:Math.floor(Math.random()*15)+5},{type:"VIDEO_CALL",count:Math.floor(Math.random()*10)+3},{type:"SAMPLE_VISIT",count:Math.floor(Math.random()*8)+2}]},E.value={principalName:o.value.name,timeRange:l.value,totalDataPoints:s.value.engagementTrend.length+s.value.activityVolume.length+s.value.productPerformance.length+s.value.opportunityPipeline.length,generatedAt:new Date().toISOString()}}catch(a){y.value=a instanceof Error?a.message:"Failed to load analytics data",console.error("Error loading analytics data:",a)}finally{S.value=!1}}},B=()=>{var r;const a=[],e=l.value==="7d"?7:l.value==="30d"?30:l.value==="90d"?90:365;for(let n=e-1;n>=0;n--){const i=new Date;i.setDate(i.getDate()-n),a.push({date:i.toISOString().split("T")[0],engagement_score:Math.floor(Math.random()*30)+55,activity_type:["PHONE_CALL","EMAIL","IN_PERSON","VIDEO_CALL"][Math.floor(Math.random()*4)],principal_name:((r=o.value)==null?void 0:r.name)||"Principal"})}return a},U=()=>{const a=[],e=l.value==="7d"?7:l.value==="30d"?30:l.value==="90d"?90:365;for(let r=e-1;r>=0;r--){const n=new Date;n.setDate(n.getDate()-r);const i=Math.floor(Math.random()*8),f=[];if(i>0){const h=["PHONE_CALL","EMAIL","IN_PERSON","VIDEO_CALL","SAMPLE_VISIT"],P=Math.min(i,Math.floor(Math.random()*3)+1);for(let x=0;x<P;x++){const b=Math.floor(Math.random()*h.length);f.includes(h[b])||f.push(h[b])}}a.push({date:n.toISOString().split("T")[0],count:i,types:f})}return a},H=()=>["Premium Widget","Standard Package","Enterprise Solution","Basic Service","Advanced Analytics","Custom Integration","Mobile App","Cloud Platform","Security Suite"].map((e,r)=>({principal_id:"mock_principal",principal_name:"Mock Principal",product_id:`prod_${r+1}`,product_name:e,product_category:null,product_sku:`SKU-${r+1}`,is_primary_principal:!0,exclusive_rights:!1,wholesale_price:Math.floor(Math.random()*1e3)+100,minimum_order_quantity:Math.floor(Math.random()*100)+10,lead_time_days:Math.floor(Math.random()*30)+7,contract_start_date:new Date(Date.now()-Math.random()*365*24*60*60*1e3).toISOString(),contract_end_date:new Date(Date.now()+Math.random()*365*24*60*60*1e3).toISOString(),territory_restrictions:null,opportunities_for_product:Math.floor(Math.random()*15)+3,won_opportunities_for_product:Math.floor(Math.random()*8)+1,active_opportunities_for_product:Math.floor(Math.random()*10)+2,latest_opportunity_date:new Date(Date.now()-Math.random()*30*24*60*60*1e3).toISOString(),avg_opportunity_probability:Math.floor(Math.random()*50)+25,total_opportunities:Math.floor(Math.random()*15)+3,win_rate:Math.floor(Math.random()*50)+25,total_value:Math.floor(Math.random()*1e5)+5e4,interactions_for_product:Math.floor(Math.random()*20)+5,recent_interactions_for_product:Math.floor(Math.random()*5)+1,last_interaction_date:new Date(Date.now()-Math.random()*30*24*60*60*1e3).toISOString(),product_is_active:!0,launch_date:new Date(Date.now()-Math.random()*365*24*60*60*1e3).toISOString(),discontinue_date:null,unit_cost:Math.floor(Math.random()*500)+50,suggested_retail_price:Math.floor(Math.random()*1500)+200,contract_status:"ACTIVE",product_performance_score:Math.floor(Math.random()*40)+40,relationship_created_at:new Date(Date.now()-Math.random()*365*24*60*60*1e3).toISOString(),relationship_updated_at:new Date(Date.now()-Math.random()*30*24*60*60*1e3).toISOString()})).slice(0,6),W=()=>{const a=["NEW_LEAD","INITIAL_OUTREACH","SAMPLE_VISIT_OFFERED","AWAITING_RESPONSE","FEEDBACK_LOGGED","DEMO_SCHEDULED","CLOSED_WON"];let e=Math.floor(Math.random()*20)+15;return a.map(r=>{const n=Math.max(1,Math.floor(e*(.6+Math.random()*.3))),i=n*(Math.floor(Math.random()*25e3)+15e3);return e=Math.floor(n*.8),{stage:r,count:n,value:i}})},K=a=>a>=1e6?`$${(a/1e6).toFixed(1)}M`:a>=1e3?`$${(a/1e3).toFixed(0)}K`:`$${a.toFixed(0)}`,G=a=>({PHONE_CALL:"#3b82f6",EMAIL:"#10b981",IN_PERSON:"#f59e0b",VIDEO_CALL:"#8b5cf6",SAMPLE_VISIT:"#ef4444",FOLLOW_UP:"#6b7280",OTHER:"#9ca3af"})[a]||"#9ca3af",q=a=>a.toLowerCase().replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase()),z=async()=>{if(!(!o.value||!s.value))try{const a={principal:o.value,timeRange:l.value,analytics:s.value,exportedAt:new Date().toISOString()};console.log("Exporting analytics data:",a);const e=JSON.stringify(a,null,2),r="data:application/json;charset=utf-8,"+encodeURIComponent(e),n=`principal-analytics-${o.value.name.replace(/\s+/g,"-")}-${l.value}.json`,i=document.createElement("a");i.setAttribute("href",r),i.setAttribute("download",n),i.click()}catch(a){console.error("Export failed:",a),y.value="Failed to export analytics data"}};return Q([o,l],()=>{o.value&&I()},{immediate:!1}),X(async()=>{v.principals.length===0&&await v.fetchPrincipals();const a=$.params.principalId;if(a){const e=v.principals.find(r=>r.id===a);e&&(o.value=e)}}),(a,e)=>(m(),Z(st,null,{default:tt(()=>{var r,n,i,f,h,P,x,b,L,O,C,k,V;return[t("div",Mt,[t("div",wt,[t("div",St,[e[4]||(e[4]=t("div",{class:"mb-4 sm:mb-0"},[t("h1",{class:"text-2xl font-bold text-gray-900"},"Principal Analytics"),t("p",{class:"mt-1 text-sm text-gray-500"}," Comprehensive performance insights and trends ")],-1)),t("div",Pt,[t("button",{onClick:z,disabled:S.value||!o.value,class:"inline-flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed min-h-[44px]"},[c(p(_t),{class:"h-4 w-4 mr-2"}),e[2]||(e[2]=at(" Export ",-1))],8,Et),et(t("select",{"onUpdate:modelValue":e[0]||(e[0]=d=>l.value=d),class:"block w-full sm:w-auto px-3 py-2 border border-gray-300 rounded-md shadow-sm text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-h-[44px]"},e[3]||(e[3]=[t("option",{value:"7d"},"Last 7 days",-1),t("option",{value:"30d"},"Last 30 days",-1),t("option",{value:"90d"},"Last 90 days",-1),t("option",{value:"1y"},"Last year",-1)]),512),[[ot,l.value]])])])]),t("div",At,[c(nt,{modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=d=>o.value=d),loading:R.value,error:F.value,placeholder:"Select a principal to view analytics...",class:"w-full"},null,8,["modelValue","loading","error"])]),S.value&&o.value?(m(),_("div",Dt,e[5]||(e[5]=[t("div",{class:"text-center"},[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),t("p",{class:"mt-4 text-sm text-gray-500"},"Loading analytics data...")],-1)]))):o.value?o.value?(m(),_("div",Lt,[t("div",Ot,[t("div",Ct,[t("div",kt,[t("div",Vt,[c(p(it),{class:"h-6 w-6 text-blue-500"})]),t("div",Nt,[e[8]||(e[8]=t("p",{class:"text-sm font-medium text-gray-500"},"Current Score",-1)),t("p",Tt,u(((r=s.value)==null?void 0:r.currentEngagementScore)||0),1)])])]),t("div",$t,[t("div",Rt,[t("div",Ft,[c(p(ht),{class:"h-6 w-6 text-green-500"})]),t("div",jt,[e[9]||(e[9]=t("p",{class:"text-sm font-medium text-gray-500"},"Total Activities",-1)),t("p",Bt,u(((n=s.value)==null?void 0:n.totalActivities)||0),1)])])]),t("div",Ut,[t("div",Ht,[t("div",Wt,[c(p(gt),{class:"h-6 w-6 text-purple-500"})]),t("div",Kt,[e[10]||(e[10]=t("p",{class:"text-sm font-medium text-gray-500"},"Pipeline Value",-1)),t("p",Gt,u(K(((i=s.value)==null?void 0:i.totalPipelineValue)||0)),1)])])]),t("div",qt,[t("div",zt,[t("div",Jt,[c(p(vt),{class:"h-6 w-6 text-yellow-500"})]),t("div",Qt,[e[11]||(e[11]=t("p",{class:"text-sm font-medium text-gray-500"},"Win Rate",-1)),t("p",Xt,u(Math.round(((f=s.value)==null?void 0:f.winRate)||0))+"% ",1)])])])]),t("div",Yt,[t("div",Zt,[t("div",te,[c(p(ut),{data:((h=s.value)==null?void 0:h.engagementTrend)||[],"time-range":l.value,"principal-name":(P=o.value)==null?void 0:P.name,"show-trend-line":!0},null,8,["data","time-range","principal-name"])])]),t("div",ee,[t("div",ae,[c(p(mt),{data:((x=s.value)==null?void 0:x.activityVolume)||[],"time-range":l.value,"principal-name":(b=o.value)==null?void 0:b.name},null,8,["data","time-range","principal-name"])])]),t("div",oe,[t("div",re,[c(p(lt),{data:((L=s.value)==null?void 0:L.productPerformance)||[],"principal-name":(O=o.value)==null?void 0:O.name},null,8,["data","principal-name"])])]),t("div",se,[t("div",ne,[c(p(pt),{data:((C=s.value)==null?void 0:C.opportunityPipeline)||[],"principal-name":(k=o.value)==null?void 0:k.name},null,8,["data","principal-name"])])])]),t("div",ie,[e[16]||(e[16]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Key Insights",-1)),t("div",le,[t("div",null,[e[13]||(e[13]=t("h4",{class:"text-sm font-medium text-gray-700 mb-3"},"Top Performing Products",-1)),t("div",de,[(m(!0),_(N,null,T(D.value,d=>(m(),_("div",{key:d.product_id,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[t("div",ce,[t("p",ue,u(d.product_name),1),t("p",me,u(d.total_opportunities)+" opportunities ",1)]),t("div",pe,[c(dt,{score:d.product_performance_score||0,size:"sm","show-label":!1},null,8,["score"])])]))),128)),D.value.length===0?(m(),_("div",_e,e[12]||(e[12]=[t("p",{class:"text-sm text-gray-500"},"No product data available",-1)]))):w("",!0)])]),t("div",null,[e[15]||(e[15]=t("h4",{class:"text-sm font-medium text-gray-700 mb-3"},"Activity Distribution",-1)),t("div",fe,[(m(!0),_(N,null,T(A.value,d=>(m(),_("div",{key:d.type,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[t("div",he,[t("div",{class:"w-3 h-3 rounded-full mr-3",style:rt({backgroundColor:G(d.type)})},null,4),t("div",null,[t("p",ge,u(q(d.type)),1),t("p",ve,u(Math.round(d.count/j.value*100))+"% of total ",1)])]),t("span",ye,u(d.count),1)]))),128)),A.value.length===0?(m(),_("div",xe,e[14]||(e[14]=[t("p",{class:"text-sm text-gray-500"},"No activity data available",-1)]))):w("",!0)])])])]),E.value?(m(),_("div",be,[t("div",Me,[c(p(yt),{class:"h-5 w-5 text-blue-400 mt-0.5 mr-3 flex-shrink-0"}),t("div",we,[e[17]||(e[17]=t("h4",{class:"text-sm font-medium text-blue-900"},"Export Ready",-1)),t("p",Se," Analytics data for "+u((V=o.value)==null?void 0:V.name)+" ("+u(l.value)+") is ready for export. Includes "+u(E.value.totalDataPoints)+" data points across all metrics. ",1)])])])):w("",!0)])):w("",!0):(m(),_("div",It,[c(p(ft),{class:"mx-auto h-16 w-16 text-gray-400"}),e[6]||(e[6]=t("h3",{class:"mt-4 text-lg font-medium text-gray-900"},"Principal Analytics",-1)),e[7]||(e[7]=t("p",{class:"mt-2 text-sm text-gray-500"}," Select a principal above to view comprehensive analytics and performance insights. ",-1))])),y.value?(m(),_("div",Pe,[t("div",Ee,[c(p(xt),{class:"h-5 w-5 text-red-400 mr-3 flex-shrink-0"}),t("div",null,[e[18]||(e[18]=t("h3",{class:"text-sm font-medium text-red-800"},"Error Loading Analytics",-1)),t("p",Ae,u(y.value),1),t("button",{onClick:I,class:"mt-2 text-sm font-medium text-red-800 hover:text-red-900"}," Try again ")])])])):w("",!0)])]}),_:1}))}}),ca=bt(De,[["__scopeId","data-v-9843ad2a"]]);export{ca as default};
//# sourceMappingURL=PrincipalAnalyticsView-Cn5m8Pgh.js.map
