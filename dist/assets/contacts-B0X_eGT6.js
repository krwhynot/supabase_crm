var b=Object.defineProperty;var w=(r,e,t)=>e in r?b(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var g=(r,e,t)=>w(r,typeof e!="symbol"?e+"":e,t);import{s as l,c as h,V as d,a as o,b as p}from"./supabaseClient-CwP9wSpS.js";class C{constructor(){g(this,"isDemoMode",!1);this.isDemoMode=this.checkDemoMode()}checkDemoMode(){return"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp6eHh3cHRnc3l6aGR0dWxyZGp5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1NDYyNzEsImV4cCI6MjA2OTEyMjI3MX0.X9eZUb_hM2g0pDTHYRbfxjKbrHeRbzYxWsWLrorEzRU"==="your-supabase-anon-key"}async getContacts(e={}){if(this.isDemoMode)return this.getMockContacts(e);try{let t=l.from("contacts").select("*");e.search&&(t=t.or(`first_name.ilike.%${e.search}%,last_name.ilike.%${e.search}%,organization.ilike.%${e.search}%,email.ilike.%${e.search}%`));const a=e.sortBy||"last_name",n=e.sortOrder||"asc";t=t.order(a,{ascending:n==="asc"}),e.limit&&(t=t.limit(e.limit)),e.offset&&(t=t.range(e.offset,e.offset+(e.limit||50)-1));const{data:i,error:s}=await t;return s?(console.error("Error fetching contacts:",s),{data:null,error:`Failed to fetch contacts: ${s.message}`,success:!1}):{data:i||[],error:null,success:!0}}catch(t){return console.error("Unexpected error fetching contacts:",t),{data:null,error:"An unexpected error occurred while fetching contacts",success:!1}}}async getContact(e){if(this.isDemoMode)return this.getMockContact(e);try{const{data:t,error:a}=await l.from("contacts").select("*").eq("id",e).single();return a?(console.error("Error fetching contact:",a),{data:null,error:`Failed to fetch contact: ${a.message}`,success:!1}):{data:t,error:null,success:!0}}catch(t){return console.error("Unexpected error fetching contact:",t),{data:null,error:"An unexpected error occurred while fetching the contact",success:!1}}}async createContact(e){if(this.isDemoMode)return this.createMockContact(e);try{const{data:t,error:a}=await l.from("contacts").insert(e).select().single();return a?(console.error("Error creating contact:",a),{data:null,error:`Failed to create contact: ${a.message}`,success:!1}):{data:t,error:null,success:!0}}catch(t){return console.error("Unexpected error creating contact:",t),{data:null,error:"An unexpected error occurred while creating the contact",success:!1}}}async updateContact(e,t){if(this.isDemoMode)return this.updateMockContact(e,t);try{const{data:a,error:n}=await l.from("contacts").update(t).eq("id",e).select().single();return n?(console.error("Error updating contact:",n),{data:null,error:`Failed to update contact: ${n.message}`,success:!1}):{data:a,error:null,success:!0}}catch(a){return console.error("Unexpected error updating contact:",a),{data:null,error:"An unexpected error occurred while updating the contact",success:!1}}}async deleteContact(e){if(this.isDemoMode)return this.deleteMockContact(e);try{const{error:t}=await l.from("contacts").delete().eq("id",e);return t?(console.error("Error deleting contact:",t),{data:null,error:`Failed to delete contact: ${t.message}`,success:!1}):{data:!0,error:null,success:!0}}catch(t){return console.error("Unexpected error deleting contact:",t),{data:null,error:"An unexpected error occurred while deleting the contact",success:!1}}}async getContactStats(){if(this.isDemoMode)return this.getMockStats();try{const{count:e,error:t}=await l.from("contacts").select("*",{count:"exact",head:!0});if(t)throw t;const a=new Date;a.setDate(a.getDate()-30);const{count:n,error:i}=await l.from("contacts").select("*",{count:"exact",head:!0}).gte("created_at",a.toISOString());if(i)throw i;const{data:s,error:c}=await l.from("contacts").select("organization").not("organization","is",null);if(c)throw c;const u=new Set(s==null?void 0:s.map(m=>m.organization)).size;return{data:{total:e||0,recentlyAdded:n||0,organizations:u},error:null,success:!0}}catch(e){return console.error("Error fetching contact stats:",e),{data:null,error:"Failed to fetch contact statistics",success:!1}}}async getMockContacts(e){const t=[{id:"mock-1",first_name:"John",last_name:"Doe",organization:"Tech Corp",email:"john.doe@techcorp.com",title:"Software Engineer",phone:"+1-555-0123",notes:"Met at tech conference 2024",created_at:"2024-01-15T10:00:00Z",updated_at:"2024-01-15T10:00:00Z"},{id:"mock-2",first_name:"Jane",last_name:"Smith",organization:"Design Studio",email:"jane.smith@designstudio.com",title:"UX Designer",phone:"+1-555-0124",notes:"Portfolio review scheduled",created_at:"2024-01-20T14:30:00Z",updated_at:"2024-01-20T14:30:00Z"},{id:"mock-3",first_name:"Bob",last_name:"Johnson",organization:"Marketing Agency",email:"bob.johnson@marketing.com",title:"Marketing Manager",phone:null,notes:null,created_at:"2024-02-01T09:15:00Z",updated_at:"2024-02-01T09:15:00Z"}];let a=t;if(e.search){const s=e.search.toLowerCase();a=t.filter(c=>c.first_name.toLowerCase().includes(s)||c.last_name.toLowerCase().includes(s)||c.organization.toLowerCase().includes(s)||c.email.toLowerCase().includes(s))}const n=e.sortBy||"last_name",i=e.sortOrder||"asc";if(a.sort((s,c)=>{const u=s[n]||"",f=c[n]||"",m=u.localeCompare(f);return i==="asc"?m:-m}),e.offset||e.limit){const s=e.offset||0,c=s+(e.limit||a.length);a=a.slice(s,c)}return{data:a,error:null,success:!0}}async getMockContact(e){var n;const a=(n=(await this.getMockContacts({})).data)==null?void 0:n.find(i=>i.id===e);return a?{data:a,error:null,success:!0}:{data:null,error:"Contact not found",success:!1}}async createMockContact(e){return{data:{id:`mock-${Date.now()}`,first_name:e.first_name,last_name:e.last_name,organization:e.organization,email:e.email,title:e.title||null,phone:e.phone||null,notes:e.notes||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},error:null,success:!0}}async updateMockContact(e,t){const a=await this.getMockContact(e);return!a.success||!a.data?a:{data:{...a.data,...t,updated_at:new Date().toISOString()},error:null,success:!0}}async deleteMockContact(e){return{data:!0,error:null,success:!0}}async getMockStats(){return{data:{total:3,recentlyAdded:2,organizations:3},error:null,success:!0}}}const E=new C,_=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,y=/^[+]?[1-9][\d]{0,15}$|^[+]?[()]?[\d\s\-()]{10,20}$/,z=h({first_name:o().required("First name is required").min(1,"First name cannot be empty").max(255,"First name must be less than 255 characters").trim(),last_name:o().required("Last name is required").min(1,"Last name cannot be empty").max(255,"Last name must be less than 255 characters").trim(),organization:o().required("Organization is required").min(1,"Organization cannot be empty").max(255,"Organization must be less than 255 characters").trim(),email:o().required("Email is required").matches(_,"Please enter a valid email address").max(255,"Email must be less than 255 characters").trim().lowercase(),title:o().nullable().max(255,"Title must be less than 255 characters").trim().transform(r=>r===""?null:r),phone:o().nullable().max(50,"Phone number must be less than 50 characters").matches(y,"Please enter a valid phone number").trim().transform(r=>r===""?null:r),notes:o().nullable().max(5e3,"Notes must be less than 5000 characters").trim().transform(r=>r===""?null:r)}),k=h({first_name:o().min(1,"First name cannot be empty").max(255,"First name must be less than 255 characters").trim(),last_name:o().min(1,"Last name cannot be empty").max(255,"Last name must be less than 255 characters").trim(),organization:o().min(1,"Organization cannot be empty").max(255,"Organization must be less than 255 characters").trim(),email:o().matches(_,"Please enter a valid email address").max(255,"Email must be less than 255 characters").trim().lowercase(),title:o().nullable().max(255,"Title must be less than 255 characters").trim().transform(r=>r===""?null:r),phone:o().nullable().max(50,"Phone number must be less than 50 characters").matches(y,"Please enter a valid phone number").trim().transform(r=>r===""?null:r),notes:o().nullable().max(5e3,"Notes must be less than 5000 characters").trim().transform(r=>r===""?null:r)}),M=h({search:o().max(255,"Search term must be less than 255 characters").trim(),limit:p().positive("Limit must be positive").max(100,"Limit cannot exceed 100").integer("Limit must be an integer"),offset:p().min(0,"Offset cannot be negative").integer("Offset must be an integer"),sortBy:o().oneOf(["first_name","last_name","organization","email","created_at"],"Invalid sort field"),sortOrder:o().oneOf(["asc","desc"],"Sort order must be asc or desc")});class S{static async validateCreate(e){try{return{isValid:!0,data:await z.validate(e,{abortEarly:!1}),errors:[]}}catch(t){return t instanceof d?{isValid:!1,errors:t.inner.map(a=>({field:a.path||"unknown",message:a.message}))}:{isValid:!1,errors:[{field:"general",message:"Validation failed"}]}}}static async validateUpdate(e){try{return{isValid:!0,data:await k.validate(e,{abortEarly:!1}),errors:[]}}catch(t){return t instanceof d?{isValid:!1,errors:t.inner.map(a=>({field:a.path||"unknown",message:a.message}))}:{isValid:!1,errors:[{field:"general",message:"Validation failed"}]}}}static async validateSearch(e){try{return{isValid:!0,data:await M.validate(e,{abortEarly:!1}),errors:[]}}catch(t){return t instanceof d?{isValid:!1,errors:t.inner.map(a=>({field:a.path||"unknown",message:a.message}))}:{isValid:!1,errors:[{field:"general",message:"Validation failed"}]}}}static cleanFormData(e){const t={};return Object.entries(e).forEach(([a,n])=>{if(typeof n=="string"){const i=n.trim();t[a]=i===""?null:i}else t[a]=n}),t}static formToInsert(e){return{first_name:e.first_name,last_name:e.last_name,organization:e.organization,email:e.email,title:e.title,phone:e.phone,notes:e.notes}}static formToUpdate(e){const t={};return e.first_name!==void 0&&(t.first_name=e.first_name),e.last_name!==void 0&&(t.last_name=e.last_name),e.organization!==void 0&&(t.organization=e.organization),e.email!==void 0&&(t.email=e.email),e.title!==void 0&&(t.title=e.title),e.phone!==void 0&&(t.phone=e.phone),e.notes!==void 0&&(t.notes=e.notes),t}static contactToForm(e){return{first_name:e.first_name,last_name:e.last_name,organization:e.organization,email:e.email,title:e.title,phone:e.phone,notes:e.notes}}}const x={getFullName:r=>`${r.first_name} ${r.last_name}`.trim(),getDisplayName:r=>{const e=x.getFullName(r);return r.organization?`${e} (${r.organization})`:e},formatPhone:r=>{if(!r)return"No phone";const e=r.replace(/\D/g,"");return e.length===10?`(${e.slice(0,3)}) ${e.slice(3,6)}-${e.slice(6)}`:e.length===11&&e[0]==="1"?`+1 (${e.slice(1,4)}) ${e.slice(4,7)}-${e.slice(7)}`:r},getInitials:r=>{const e=r.first_name.charAt(0).toUpperCase(),t=r.last_name.charAt(0).toUpperCase();return`${e}${t}`},formatCreatedDate:r=>r.created_at?new Date(r.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Unknown"};export{S as C,x as a,E as c};
//# sourceMappingURL=contacts-B0X_eGT6.js.map
