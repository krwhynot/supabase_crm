import{m as Ne,r as O,z as X,j as I}from"./index-CmEEd-r9.js";import{s as d}from"./supabaseClient-CpZNRF9L.js";import{c as F,b as n,a as L,f as k,d as A,e as f,g as E}from"./index.esm-BaJX624_.js";const ce=F({name:n().required("Organization name is required").trim().min(1,"Organization name cannot be empty").max(255,"Organization name must be less than 255 characters"),legal_name:n().nullable().max(255,"Legal name must be less than 255 characters"),description:n().nullable(),industry:n().nullable().max(255,"Industry must be less than 255 characters"),type:E().oneOf(["B2B","B2C","B2B2C","Non-Profit","Government","Other"]).nullable(),size:E().oneOf(["Startup","Small","Medium","Large","Enterprise"]).nullable(),status:E().oneOf(["Active","Inactive","Prospect","Customer","Partner","Vendor"]).nullable(),website:n().nullable().matches(/^https?:\/\/[^\s]+$/,"Website must be a valid URL starting with http:// or https://"),email:n().nullable().email("Email must be a valid email address"),primary_phone:n().nullable().max(50,"Primary phone must be less than 50 characters"),secondary_phone:n().nullable().max(50,"Secondary phone must be less than 50 characters"),address_line_1:n().nullable().max(255,"Address line 1 must be less than 255 characters"),address_line_2:n().nullable().max(255,"Address line 2 must be less than 255 characters"),city:n().nullable().max(100,"City must be less than 100 characters"),state_province:n().nullable().max(100,"State/Province must be less than 100 characters"),postal_code:n().nullable().max(20,"Postal code must be less than 20 characters"),country:n().nullable().max(100,"Country must be less than 100 characters"),founded_year:f().nullable().integer("Founded year must be a whole number").min(1800,"Founded year must be 1800 or later").max(new Date().getFullYear()+1,"Founded year cannot be in the future"),employees_count:f().nullable().integer("Employee count must be a whole number").min(0,"Employee count cannot be negative"),annual_revenue:f().nullable().min(0,"Annual revenue cannot be negative"),currency_code:n().nullable().matches(/^[A-Z]{3}$/,"Currency code must be 3 uppercase letters (e.g., USD)"),lead_source:n().nullable().max(255,"Lead source must be less than 255 characters"),lead_score:f().nullable().integer("Lead score must be a whole number").min(0,"Lead score cannot be negative").max(100,"Lead score cannot exceed 100"),tags:A().of(n()).nullable(),custom_fields:F().nullable(),parent_org_id:n().nullable().uuid("Parent organization ID must be a valid UUID"),assigned_user_id:n().nullable().uuid("Assigned user ID must be a valid UUID"),last_contact_date:k().nullable(),next_follow_up_date:k().nullable(),is_principal:L().nullable(),is_distributor:L().nullable(),distributor_id:n().nullable().uuid("Distributor ID must be a valid UUID"),account_manager_id:n().nullable().uuid("Account Manager ID must be a valid UUID")}),$e=ce;ce.partial();const je=F({organization_id:n().required("Organization ID is required").uuid("Organization ID must be a valid UUID"),contact_id:n().nullable().uuid("Contact ID must be a valid UUID"),type:E().oneOf(["Email","Phone","Meeting","Demo","Proposal","Contract","Note","Task","Event","Social","Website","Other"]).required("Interaction type is required"),direction:E().oneOf(["Inbound","Outbound"]).nullable(),subject:n().nullable().max(500,"Subject must be less than 500 characters").test("not-empty","Subject cannot be empty if provided",function(s){return s==null||s.trim().length>0}),description:n().nullable(),interaction_date:k().required("Interaction date is required"),duration_minutes:f().nullable().integer("Duration must be a whole number of minutes").min(0,"Duration cannot be negative"),tags:A().of(n()).nullable(),metadata:F().nullable(),created_by_user_id:n().nullable().uuid("Created by user ID must be a valid UUID")});je.partial().shape({organization_id:n().uuid("Organization ID must be a valid UUID")});const Te=F({organization_id:n().required("Organization ID is required").uuid("Organization ID must be a valid UUID"),name:n().required("Document name is required").trim().min(1,"Document name cannot be empty").max(500,"Document name must be less than 500 characters"),description:n().nullable(),file_type:n().nullable().max(50,"File type must be less than 50 characters"),file_size_bytes:f().nullable().integer("File size must be a whole number").min(0,"File size cannot be negative"),storage_path:n().nullable().max(1e3,"Storage path must be less than 1000 characters"),external_url:n().nullable().matches(/^https?:\/\/[^\s]+$/,"External URL must be a valid URL starting with http:// or https://").max(1e3,"External URL must be less than 1000 characters"),category:n().nullable().max(255,"Category must be less than 255 characters"),tags:A().of(n()).nullable(),is_public:L().nullable(),access_level:n().nullable().max(50,"Access level must be less than 50 characters"),version:n().nullable().max(50,"Version must be less than 50 characters"),parent_document_id:n().nullable().uuid("Parent document ID must be a valid UUID"),uploaded_by_user_id:n().nullable().uuid("Uploaded by user ID must be a valid UUID")}).test("has-location","Document must have either a storage path or external URL",function(s){return!!(s.storage_path||s.external_url)});Te.partial().shape({organization_id:n().uuid("Organization ID must be a valid UUID")});const Ge=F({organization_id:n().required("Organization ID is required").uuid("Organization ID must be a valid UUID"),period_start:k().required("Period start date is required"),period_end:k().required("Period end date is required").test("after-start","Period end must be after period start",function(s){const{period_start:y}=this.parent;return!y||!s?!0:s>y}),period_type:n().required("Period type is required").oneOf(["daily","weekly","monthly","quarterly","yearly"],"Period type must be one of: daily, weekly, monthly, quarterly, yearly"),total_interactions:f().nullable().integer("Total interactions must be a whole number").min(0,"Total interactions cannot be negative"),email_interactions:f().nullable().integer("Email interactions must be a whole number").min(0,"Email interactions cannot be negative"),phone_interactions:f().nullable().integer("Phone interactions must be a whole number").min(0,"Phone interactions cannot be negative"),meeting_interactions:f().nullable().integer("Meeting interactions must be a whole number").min(0,"Meeting interactions cannot be negative"),revenue_generated:f().nullable().min(0,"Revenue generated cannot be negative"),deals_closed:f().nullable().integer("Deals closed must be a whole number").min(0,"Deals closed cannot be negative"),deals_in_progress:f().nullable().integer("Deals in progress must be a whole number").min(0,"Deals in progress cannot be negative"),lead_score_change:f().nullable().integer("Lead score change must be a whole number"),conversion_events:f().nullable().integer("Conversion events must be a whole number").min(0,"Conversion events cannot be negative"),documents_added:f().nullable().integer("Documents added must be a whole number").min(0,"Documents added cannot be negative"),documents_accessed:f().nullable().integer("Documents accessed must be a whole number").min(0,"Documents accessed cannot be negative"),new_contacts_added:f().nullable().integer("New contacts added must be a whole number").min(0,"New contacts added cannot be negative"),active_contacts:f().nullable().integer("Active contacts must be a whole number").min(0,"Active contacts cannot be negative"),custom_metrics:F().nullable()});Ge.partial().shape({organization_id:n().uuid("Organization ID must be a valid UUID")});const We=$e;We.shape({status:E().oneOf(["Prospect","Active Customer","Inactive Customer","Other","Principal","Distributor"]).required("Organization status is required"),custom_fields:F({is_principal:L().nullable(),is_distributor:L().nullable(),distributor_id:n().nullable().uuid("Distributor ID must be valid UUID"),account_manager_id:n().nullable().uuid("Account Manager ID must be valid UUID"),food_beverage_segment:n().nullable().max(255)}).test("principal-distributor-exclusive","Cannot be both Principal and Distributor",function(s){return!(s!=null&&s.is_principal&&(s!=null&&s.is_distributor))}),priority_letter:E().oneOf(["A","B","C","D"]).required("Priority is required"),assigned_contacts:A().of(n().uuid()).nullable()});F({search:n().nullable().optional(),industry:n().nullable().optional(),type:E().oneOf(["B2B","B2C","B2B2C","Non-Profit","Government","Other"]).nullable().optional(),size:E().oneOf(["Startup","Small","Medium","Large","Enterprise"]).nullable().optional(),status:E().oneOf(["Active","Inactive","Prospect","Customer","Partner","Vendor"]).nullable().optional(),country:n().nullable().optional(),min_employees:f().min(0).nullable().optional(),max_employees:f().min(0).nullable().optional(),min_revenue:f().min(0).nullable().optional(),max_revenue:f().min(0).nullable().optional(),min_lead_score:f().min(0).max(100).nullable().optional(),max_lead_score:f().min(0).max(100).nullable().optional(),tags:A().of(n()).nullable().optional(),limit:f().min(1).max(100).optional().default(20),offset:f().min(0).optional().default(0),sortBy:E().oneOf(["name","legal_name","industry","type","size","status","lead_score","employees_count","annual_revenue","founded_year","created_at","updated_at","last_contact_date","next_follow_up_date"]).optional().default("name"),sortOrder:E().oneOf(["asc","desc"]).optional().default("asc")});const nt=["B2B","B2C","B2B2C","Non-Profit","Government","Other"],Ke=[{value:90,label:"A",description:"Highest priority - Strategic accounts"},{value:70,label:"B",description:"High priority - Major opportunities"},{value:50,label:"C",description:"Medium priority - Qualified prospects"},{value:30,label:"D",description:"Lower priority - New prospects"}],le=s=>({A:90,B:70,C:50,D:30})[s],He=s=>s?s>=90?"A":s>=70?"B":s>=50?"C":"D":"D",rt=Ne("organization",()=>{const s=O([]),y=O(null),j=O([]),T=O([]),G=O([]),p=O(null),W=O([]),K=O([]),c=X({organizations:!1,currentOrganization:!1,analytics:!1,performance:!1,leadScoring:!1,metrics:!1,interactions:!1,documents:!1,creating:!1,updating:!1,deleting:!1,bulkOperations:!1}),D=X({organizations:"",currentOrganization:"",analytics:"",performance:"",leadScoring:"",metrics:"",interactions:"",documents:"",creating:"",updating:"",deleting:"",bulkOperations:""}),R=O(""),o=O({}),x=O({field:"name",order:"asc"}),u=O({page:1,limit:20,total:0,totalPages:0,hasNext:!1,hasPrevious:!1}),M=O(null),q=X({}),ue=I(()=>s.value.length>0),de=I(()=>u.value.total),ge=I(()=>Object.values(c).some(e=>e)),me=I(()=>Object.values(D).some(e=>e!=="")),fe=I(()=>{const a=Object.keys(D).find(t=>D[t]!=="");return a?D[a]:""}),he=I(()=>p.value?{total:p.value.totalOrganizations,active:p.value.activeOrganizations,prospects:p.value.prospects,customers:p.value.customers,partners:p.value.partners,totalRevenue:p.value.totalRevenue,averageLeadScore:p.value.averageLeadScore,thisMonth:p.value.monthlyGrowth>0?Math.round(p.value.totalOrganizations*p.value.monthlyGrowth/100):0,thisWeek:Math.round((p.value.monthlyGrowth>0?p.value.totalOrganizations*p.value.monthlyGrowth/100:0)/4)}:null),ve=I(()=>s.value.filter(e=>e.lead_score!==null).sort((e,a)=>(a.lead_score||0)-(e.lead_score||0)).slice(0,10)),pe=I(()=>s.value.reduce((e,a)=>{const t=a.status||"Unknown";return e[t]=(e[t]||0)+1,e},{})),_e=I(()=>{const e=new Date;return e.setDate(e.getDate()-30),s.value.filter(a=>a.created_at?new Date(a.created_at)>=e:!1)}),be=I(()=>Ke),ye=I(()=>[{value:"Food & Beverage - Restaurants",label:"Food & Beverage - Restaurants",priority:!0},{value:"Food & Beverage - Manufacturing",label:"Food & Beverage - Manufacturing",priority:!0},{value:"Food & Beverage - Distribution",label:"Food & Beverage - Distribution",priority:!0},{value:"Food & Beverage - Retail",label:"Food & Beverage - Retail",priority:!0},{value:"Food & Beverage - Service",label:"Food & Beverage - Service",priority:!0},{value:"Technology",label:"Technology",priority:!1},{value:"Healthcare",label:"Healthcare",priority:!1},{value:"Manufacturing",label:"Manufacturing",priority:!1},{value:"Retail",label:"Retail",priority:!1},{value:"Financial Services",label:"Financial Services",priority:!1},{value:"Real Estate",label:"Real Estate",priority:!1},{value:"Education",label:"Education",priority:!1},{value:"Government",label:"Government",priority:!1},{value:"Non-Profit",label:"Non-Profit",priority:!1},{value:"Other",label:"Other",priority:!1}]),we=I(()=>s.value.filter(e=>{const a=e;return a.custom_fields&&typeof a.custom_fields=="object"&&"is_distributor"in a.custom_fields&&a.custom_fields.is_distributor===!0})),ze=I(()=>s.value.filter(e=>{const a=e;return a.custom_fields&&typeof a.custom_fields=="object"&&"is_principal"in a.custom_fields&&a.custom_fields.is_principal===!0})),ee=()=>{Object.keys(D).forEach(e=>{D[e]=""})},b=e=>{D[e]=""},_=(e,a)=>{D[e]=a,console.error(`Organization Store Error (${e}):`,a)},Oe=e=>{const a=q[e];return a?Date.now()-a.timestamp<a.ttl:!1},H=e=>Oe(e)?q[e].data:null,V=(e,a,t=3e5)=>{q[e]={data:a,timestamp:Date.now(),ttl:t}},S=e=>{e?delete q[e]:Object.keys(q).forEach(a=>delete q[a])},z=async(e={})=>{try{c.organizations=!0,b("organizations"),e.page!==void 0&&(u.value.page=e.page),e.limit!==void 0&&(u.value.limit=e.limit),e.filters&&(o.value={...o.value,...e.filters}),e.sort&&(x.value={...x.value,...e.sort}),e.search!==void 0&&(R.value=e.search);const a=`organizations_${JSON.stringify({page:u.value.page,limit:u.value.limit,filters:o.value,sort:x.value,search:R.value})}`;if(e.useCache!==!1){const l=H(a);if(l)return s.value=e.resetList?l.data:[...s.value,...l.data],u.value=l.pagination,l}let t=d.from("organizations").select("*",{count:"exact"});if(R.value.trim()){const l=R.value.trim();t=t.or(`name.ilike.%${l}%,legal_name.ilike.%${l}%,industry.ilike.%${l}%`)}o.value.industry&&o.value.industry.length>0&&(t=t.in("industry",o.value.industry)),o.value.status&&o.value.status.length>0&&(t=t.in("status",o.value.status)),o.value.type&&o.value.type.length>0&&(t=t.in("type",o.value.type)),o.value.size&&o.value.size.length>0&&(t=t.in("size",o.value.size)),o.value.country&&o.value.country.length>0&&(t=t.in("country",o.value.country)),o.value.leadScoreRange&&(o.value.leadScoreRange.min!==void 0&&(t=t.gte("lead_score",o.value.leadScoreRange.min)),o.value.leadScoreRange.max!==void 0&&(t=t.lte("lead_score",o.value.leadScoreRange.max))),o.value.employeeRange&&(o.value.employeeRange.min!==void 0&&(t=t.gte("employees_count",o.value.employeeRange.min)),o.value.employeeRange.max!==void 0&&(t=t.lte("employees_count",o.value.employeeRange.max))),o.value.revenueRange&&(o.value.revenueRange.min!==void 0&&(t=t.gte("annual_revenue",o.value.revenueRange.min)),o.value.revenueRange.max!==void 0&&(t=t.lte("annual_revenue",o.value.revenueRange.max))),o.value.lastContactDateRange&&(o.value.lastContactDateRange.start&&(t=t.gte("last_contact_date",o.value.lastContactDateRange.start.toISOString())),o.value.lastContactDateRange.end&&(t=t.lte("last_contact_date",o.value.lastContactDateRange.end.toISOString())));const r=x.value.order==="asc";t=t.order(x.value.field,{ascending:r});const i=(u.value.page-1)*u.value.limit;t=t.range(i,i+u.value.limit-1);const{data:m,error:g,count:h}=await t;if(g)throw new Error(g.message);const v=(m||[]).map(l=>({id:l.id||"",name:l.name||"",legal_name:l.legal_name,industry:l.industry,type:l.type,size:l.size,status:l.status,website:l.website,email:l.email,primary_phone:l.primary_phone,city:l.city,country:l.country,employees_count:l.employees_count,annual_revenue:l.annual_revenue,lead_score:l.lead_score,contact_count:void 0,last_interaction_date:l.last_contact_date,next_follow_up_date:l.next_follow_up_date,created_at:l.created_at,updated_at:l.updated_at}));u.value.total=h||0,u.value.totalPages=Math.ceil(u.value.total/u.value.limit),u.value.hasNext=u.value.page<u.value.totalPages,u.value.hasPrevious=u.value.page>1,e.resetList!==!1?s.value=v:s.value=[...s.value,...v];const w={data:v,pagination:{...u.value},filters:{...o.value},sort:{...x.value}};return V(a,w),M.value=new Date,w}catch(a){const t=a instanceof Error?a.message:"Failed to fetch organizations";return _("organizations",t),console.error(`Failed to fetch organizations: ${t}`,{operation:"fetch_organizations",options:e}),null}finally{c.organizations=!1}},Y=async e=>{var a,t,r;try{c.currentOrganization=!0,b("currentOrganization");const i=`organization_${e}`,m=H(i);if(m)return y.value=m,m;const{data:g,error:h}=await d.from("organizations").select("*").eq("id",e).single();if(h)throw new Error(h.message);const[v,w,l]=await Promise.all([d.from("contacts").select("id, first_name, last_name, email, position").eq("organization_id",e),d.from("organization_interactions").select("id, type, subject, interaction_date, contact_id, direction").eq("organization_id",e).order("interaction_date",{ascending:!1}).limit(10),d.from("organization_documents").select("id, name, category, size, created_at").eq("organization_id",e)]),U={...g,contact_count:((a=v.data)==null?void 0:a.length)||0,interaction_count:((t=w.data)==null?void 0:t.length)||0,document_count:((r=l.data)==null?void 0:r.length)||0,recent_interactions:(w.data||[]).map(C=>{var N,$,B;return{id:C.id,type:C.type,subject:C.subject,interaction_date:C.interaction_date,contact_name:(N=v.data)!=null&&N.find(P=>P.id===C.contact_id)?`${($=v.data.find(P=>P.id===C.contact_id))==null?void 0:$.first_name} ${(B=v.data.find(P=>P.id===C.contact_id))==null?void 0:B.last_name}`:void 0}})};return y.value=U,V(i,U),U}catch(i){const m=i instanceof Error?i.message:"Failed to fetch organization";return _("currentOrganization",m),y.value=null,null}finally{c.currentOrganization=!1}},Ie=async e=>{try{c.creating=!0,b("creating");const{data:a,error:t}=await d.from("organizations").insert(e).select().single();if(t)throw console.error(`Failed to create organization: ${t.message}`,{operation:"create_organization",data:e}),new Error(t.message);return S(),await z({resetList:!0}),console.log("Organization created successfully",{organizationName:e.name,organizationIndustry:e.industry}),a}catch(a){const t=a instanceof Error?a.message:"Failed to create organization";return _("creating",t),console.error("Failed to create organization",t,{organizationData:e}),null}finally{c.creating=!1}},Ee=async(e,a)=>{try{c.creating=!0,b("creating");const{data:t,error:r}=await d.from("organizations").insert(e).select().single();if(r)throw new Error(r.message);if(a.mode==="create"&&a.newContacts.length>0){const i=a.newContacts.map(g=>({organization_id:t.id,first_name:g.first_name,last_name:g.last_name,email:g.email,phone:g.phone||null,position:g.title||"Unknown",purchase_influence:"Unknown",decision_authority:"End User",department:g.department||null})),{error:m}=await d.from("contacts").insert(i);m&&console.warn("Failed to create some contacts:",m.message)}else if(a.mode==="select"&&a.selectedContactIds.length>0){const{error:i}=await d.from("contacts").update({organization_id:t.id}).in("id",a.selectedContactIds);i&&console.warn("Failed to associate some contacts:",i.message)}return S(),await z({resetList:!0}),console.log("Organization with contacts created successfully",{organizationName:e.name,organizationIndustry:e.industry,contactMode:a.mode,contactCount:a.mode==="create"?a.newContacts.length:a.selectedContactIds.length}),t}catch(t){const r=t instanceof Error?t.message:"Failed to create organization with contacts";return _("creating",r),console.error("Failed to create organization with contacts",r,{organizationData:e,contactData:a}),null}finally{c.creating=!1}},De=async e=>{var a,t,r,i;try{c.creating=!0,b("creating");const{priority_letter:m,assigned_contacts:g,...h}=e,v={...h,lead_score:le(m),status:te(e),tags:h.tags?h.tags.filter(U=>U!==void 0):null,custom_fields:h.custom_fields,last_contact_date:h.last_contact_date instanceof Date?h.last_contact_date.toISOString():h.last_contact_date,next_follow_up_date:h.next_follow_up_date instanceof Date?h.next_follow_up_date.toISOString():h.next_follow_up_date},{data:w,error:l}=await d.from("organizations").insert(v).select().single();if(l)throw l;return(a=e.assigned_contacts)!=null&&a.length&&w&&await ae(w.id,e.assigned_contacts),S(),await z({resetList:!0}),console.log("Enhanced organization created successfully",{organizationName:e.name,priority:e.priority_letter,leadScore:v.lead_score,isPrincipal:(t=e.custom_fields)==null?void 0:t.is_principal,isDistributor:(r=e.custom_fields)==null?void 0:r.is_distributor,contactCount:((i=e.assigned_contacts)==null?void 0:i.length)||0}),{success:!0,data:w}}catch(m){const g=m instanceof Error?m.message:"Failed to create organization";return _("creating",g),{success:!1,error:g}}finally{c.creating=!1}},te=e=>{var a,t;return(a=e.custom_fields)!=null&&a.is_principal?"Principal":(t=e.custom_fields)!=null&&t.is_distributor?"Distributor":e.status},ae=async(e,a)=>{try{const{error:t}=await d.from("contacts").update({organization_id:e}).in("id",a);if(t)throw t}catch(t){throw console.warn("Failed to create contact relationships:",t),t}},xe=e=>le(e),Se=e=>He(e),Q=async(e,a)=>{var t;try{c.updating=!0,b("updating");const{data:r,error:i}=await d.from("organizations").update(a).eq("id",e).select().single();if(i)throw new Error(i.message);return((t=y.value)==null?void 0:t.id)===e&&await Y(e),S(),await z({resetList:!0}),r}catch(r){const i=r instanceof Error?r.message:"Failed to update organization";return _("updating",i),null}finally{c.updating=!1}},Ce=async(e,a,t)=>{var r;try{c.updating=!0,b("updating");const{data:i,error:m}=await d.from("organizations").update(a).eq("id",e).select().single();if(m)throw new Error(m.message);if(t.mode==="create"&&t.newContacts.length>0){const g=t.newContacts.map(v=>({organization_id:e,first_name:v.first_name,last_name:v.last_name,email:v.email,phone:v.phone||null,position:v.title||"Unknown",purchase_influence:"Unknown",decision_authority:"End User",department:v.department||null})),{error:h}=await d.from("contacts").insert(g);h&&console.warn("Failed to create some contacts:",h.message)}else if(t.mode==="select"&&t.selectedContactIds.length>0){const{error:g}=await d.from("contacts").update({organization_id:e}).in("id",t.selectedContactIds);g&&console.warn("Failed to associate some contacts:",g.message)}return((r=y.value)==null?void 0:r.id)===e&&await Y(e),S(),await z({resetList:!0}),console.log("Organization with contacts updated successfully",{organizationId:e,contactMode:t.mode,contactCount:t.mode==="create"?t.newContacts.length:t.selectedContactIds.length}),i}catch(i){const m=i instanceof Error?i.message:"Failed to update organization with contacts";return _("updating",m),null}finally{c.updating=!1}},ne=async e=>{var a;try{c.deleting=!0,b("deleting");const{error:t}=await d.from("organizations").delete().eq("id",e);if(t)throw new Error(t.message);return s.value=s.value.filter(r=>r.id!==e),((a=y.value)==null?void 0:a.id)===e&&(y.value=null),S(),!0}catch(t){const r=t instanceof Error?t.message:"Failed to delete organization";return _("deleting",r),!1}finally{c.deleting=!1}},Pe=async e=>{R.value=e,u.value.page=1,await z({search:e,resetList:!0})},Fe=async()=>{R.value="",u.value.page=1,await z({resetList:!0})},Re=async e=>{o.value={...o.value,...e},u.value.page=1,await z({resetList:!0})},Ue=async()=>{o.value={},u.value.page=1,await z({resetList:!0})},qe=async(e,a)=>{x.value={field:e,order:a},u.value.page=1,await z({resetList:!0})},Z=async e=>{e>=1&&e<=u.value.totalPages&&(u.value.page=e,await z())},Be=async()=>{u.value.hasNext&&await Z(u.value.page+1)},Le=async()=>{u.value.hasPrevious&&await Z(u.value.page-1)},re=async()=>{var e,a;try{c.metrics=!0,b("metrics");const t="dashboard_metrics",r=H(t);if(r)return p.value=r,r;const[i,m,g,h,v,w]=await Promise.all([d.from("organizations").select("id",{count:"exact",head:!0}),d.from("organizations").select("id",{count:"exact",head:!0}).eq("status","Active"),d.from("organizations").select("id",{count:"exact",head:!0}).eq("status","Prospect"),d.from("organizations").select("id",{count:"exact",head:!0}).eq("status","Customer"),d.from("organizations").select("id",{count:"exact",head:!0}).eq("status","Partner"),d.from("organizations").select("annual_revenue, lead_score",{count:"exact"}).not("annual_revenue","is",null)]),l=new Date,U=new Date(l.getFullYear(),l.getMonth(),1),C=await d.from("organizations").select("id",{count:"exact",head:!0}).gte("created_at",U.toISOString()),N=((e=w.data)==null?void 0:e.reduce((P,J)=>P+(J.annual_revenue||0),0))||0,$=(a=w.data)!=null&&a.length?w.data.reduce((P,J)=>P+(J.lead_score||0),0)/w.data.length:0,B={totalOrganizations:i.count||0,activeOrganizations:m.count||0,prospects:g.count||0,customers:h.count||0,partners:v.count||0,totalRevenue:N,averageLeadScore:$,monthlyGrowth:C.count||0,industryDistribution:[],statusDistribution:[],recentActivity:[]};return p.value=B,V(t,B,6e5),B}catch(t){const r=t instanceof Error?t.message:"Failed to fetch dashboard metrics";return _("metrics",r),null}finally{c.metrics=!1}},oe=async()=>{try{c.analytics=!0,b("analytics");const{data:e,error:a}=await d.from("organization_summary_analytics").select("*").order("lead_score",{ascending:!1}).limit(50);if(a)throw new Error(a.message);return j.value=e||[],e}catch(e){const a=e instanceof Error?e.message:"Failed to fetch analytics";return _("analytics",a),null}finally{c.analytics=!1}},ke=async()=>{try{c.performance=!0,b("performance");const{data:e,error:a}=await d.from("monthly_organization_performance").select("*").order("performance_month",{ascending:!1}).limit(12);if(a)throw new Error(a.message);return T.value=e||[],e}catch(e){const a=e instanceof Error?e.message:"Failed to fetch performance data";return _("performance",a),null}finally{c.performance=!1}},Ae=async()=>{try{c.leadScoring=!0,b("leadScoring");const{data:e,error:a}=await d.from("organization_lead_scoring").select("*").order("lead_score",{ascending:!1}).limit(100);if(a)throw new Error(a.message);return G.value=e||[],e}catch(e){const a=e instanceof Error?e.message:"Failed to fetch lead scoring data";return _("leadScoring",a),null}finally{c.leadScoring=!1}},se=async e=>{var a;try{c.interactions=!0,b("interactions");const t=e||((a=y.value)==null?void 0:a.id);if(!t)throw new Error("No organization ID provided");const{data:r,error:i}=await d.from("organization_interactions").select("*").eq("organization_id",t).order("interaction_date",{ascending:!1});if(i)throw new Error(i.message);return W.value=r||[],r}catch(t){const r=t instanceof Error?t.message:"Failed to fetch interactions";return _("interactions",r),null}finally{c.interactions=!1}},Me=async e=>{try{const{data:a,error:t}=await d.from("organization_interactions").insert(e).select().single();if(t)throw new Error(t.message);return await se(e.organization_id),a}catch(a){const t=a instanceof Error?a.message:"Failed to create interaction";return _("interactions",t),null}},ie=async e=>{var a;try{c.documents=!0,b("documents");const t=e||((a=y.value)==null?void 0:a.id);if(!t)throw new Error("No organization ID provided");const{data:r,error:i}=await d.from("organization_documents").select("*").eq("organization_id",t).order("created_at",{ascending:!1});if(i)throw new Error(i.message);return K.value=r||[],r}catch(t){const r=t instanceof Error?t.message:"Failed to fetch documents";return _("documents",r),null}finally{c.documents=!1}};return{organizations:s,currentOrganization:y,analyticsData:j,performanceData:T,leadScoringData:G,dashboardMetrics:p,interactions:W,documents:K,searchQuery:R,appliedFilters:o,sortConfig:x,pagination:u,lastRefreshed:M,loading:c,isLoading:ge,errors:D,hasErrors:me,currentError:fe,hasOrganizations:ue,totalOrganizations:de,organizationStats:he,topPerformingOrganizations:ve,organizationsByStatus:pe,recentOrganizations:_e,priorityOptions:be,foodBeverageSegments:ye,distributorOrganizations:we,principalOrganizations:ze,fetchOrganizations:z,fetchOrganization:Y,createOrganization:Ie,createOrganizationWithContacts:Ee,createOrganizationWithEnhancedForm:De,updateOrganization:Q,updateOrganizationWithContacts:Ce,deleteOrganization:ne,searchOrganizations:Pe,clearSearch:Fe,applyFilters:Re,clearFilters:Ue,setSorting:qe,setPage:Z,nextPage:Be,previousPage:Le,fetchDashboardMetrics:re,fetchAnalytics:oe,fetchPerformanceData:ke,fetchLeadScoringData:Ae,fetchInteractions:se,createInteraction:Me,fetchDocuments:ie,createDocument:async e=>{try{const{data:a,error:t}=await d.from("organization_documents").insert(e).select().single();if(t)throw new Error(t.message);return await ie(e.organization_id),a}catch(a){const t=a instanceof Error?a.message:"Failed to create document";return _("documents",t),null}},performBulkOperation:async e=>{var a,t;try{c.bulkOperations=!0,b("bulkOperations");let r=0,i=0;const m=[];for(const g of e.organizationIds)try{switch(e.type){case"update_status":(a=e.data)!=null&&a.status&&(await Q(g,{status:e.data.status}),r++);break;case"delete":await ne(g),r++;break;case"add_tags":(t=e.data)!=null&&t.tags&&s.value.find(v=>v.id===g)&&(await Q(g,{tags:e.data.tags}),r++);break;default:throw new Error(`Unsupported bulk operation: ${e.type}`)}}catch(h){i++,m.push({id:g,error:h instanceof Error?h.message:"Unknown error"})}return{operation:e,success:i===0,total:e.organizationIds.length,successful:r,failed:i,errors:m}}catch(r){const i=r instanceof Error?r.message:"Failed to perform bulk operation";return _("bulkOperations",i),{operation:e,success:!1,total:e.organizationIds.length,successful:0,failed:e.organizationIds.length,errors:e.organizationIds.map(m=>({id:m,error:i}))}}finally{c.bulkOperations=!1}},getOrganizationById:e=>s.value.find(a=>a.id===e),organizationExists:e=>s.value.some(a=>a.id===e),refreshAllData:async()=>{S(),await Promise.all([z({resetList:!0}),re(),oe()]),M.value=new Date},resetStore:()=>{s.value=[],y.value=null,j.value=[],T.value=[],G.value=[],p.value=null,W.value=[],K.value=[],R.value="",o.value={},x.value={field:"name",order:"asc"},u.value={page:1,limit:20,total:0,totalPages:0,hasNext:!1,hasPrevious:!1},Object.keys(c).forEach(e=>{c[e]=!1}),ee(),S(),M.value=null},clearErrors:ee,clearError:b,clearCache:S,convertPriorityLetterToScore:xe,convertScoreToPriorityLetter:Se,getAutoStatus:te,createContactRelationships:ae}});export{nt as O,We as o,rt as u};
//# sourceMappingURL=organizationStore-CO45XK51.js.map
