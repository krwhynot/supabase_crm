import{c as h,i as g,b as e,d as I,r as $,y as M,j as O,f as b,z as E,t as _,A as X,o as P,s as Z,e as z,w as q,k as B,n as T,p as pe,F as J,l as Q,v as ve,B as L,u as te,h as ae,C as fe,x as oe,g as ge}from"./index-EqgV18wk.js";import{u as ye}from"./contactStore-Pv4rUlUj.js";import{P as he,a as be,b as we,D as xe,d as Ve,e as _e,C as A}from"./contacts-Cn5kMXkN.js";import{_ as Y}from"./Button.vue_vue_type_script_setup_true_lang-DBhhTdvk.js";import{u as re}from"./organizationStore-CCNIEwvT.js";import{_ as F,a as N}from"./SelectField.vue_vue_type_script_setup_true_lang-DLwiTIwV.js";import{r as ke}from"./XMarkIcon-oWnazQ7o.js";import{r as Ce}from"./PlusIcon-D6kXjnLP.js";import{r as $e}from"./ExclamationTriangleIcon-D2ylqx6-.js";import"./contactsApi-BMT6P3Fq.js";import"./supabaseClient-Ueky6YRs.js";import"./index.esm-DUXcyDU6.js";function Se(C,k){return g(),h("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"})])}const ze={class:"relative top-20 mx-auto p-5 border w-11/12 max-w-md shadow-lg rounded-md bg-white"},Fe={class:"flex items-center justify-between pb-3"},De={class:"mt-4 space-y-4"},Oe={class:"flex items-center justify-end pt-6 space-x-3"},Ee=["disabled"],Ie=I({__name:"OrganizationCreateModal",emits:["close","success"],setup(C,{emit:k}){const o=k,w=re(),c=$(!1),u=M({name:"",industry:""}),n=M({}),l=[{value:"Food & Beverage - Manufacturing",label:"Food & Beverage - Manufacturing",description:"Food and beverage production"},{value:"Food & Beverage - Distribution",label:"Food & Beverage - Distribution",description:"Food and beverage distribution"},{value:"Food & Beverage - Restaurant",label:"Food & Beverage - Restaurant",description:"Restaurants and food service"},{value:"Technology",label:"Technology",description:"Software and tech services"},{value:"Healthcare",label:"Healthcare",description:"Medical and health services"},{value:"Finance",label:"Finance",description:"Banking and financial services"},{value:"Manufacturing",label:"Manufacturing",description:"Production and industrial"},{value:"Retail",label:"Retail",description:"Consumer goods and services"}],r=O(()=>u.name.trim().length>0&&u.industry.trim().length>0),s=(t,a)=>{u[t]=a,n[t]&&delete n[t]},y=t=>{t.target===t.currentTarget&&o("close")},m=async()=>{try{if(c.value=!0,Object.keys(n).forEach(i=>delete n[i]),!u.name.trim()){n.name="Organization name is required";return}if(!u.industry.trim()){n.industry="Industry is required";return}const t={name:u.name.trim(),industry:u.industry,lead_score:50,status:"Prospect"},a=await w.createOrganization(t);a?o("success",a.id):n.name=w.errors.creating||"Failed to create organization"}catch(t){console.error("Error creating organization:",t),n.name=t.message||"An unexpected error occurred"}finally{c.value=!1}};return(t,a)=>(g(),h("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",onClick:y},[e("div",ze,[e("div",Fe,[a[4]||(a[4]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Create New Organization",-1)),e("button",{onClick:a[0]||(a[0]=i=>t.$emit("close")),type:"button",class:"text-gray-400 hover:text-gray-600 focus:outline-none focus:text-gray-600","aria-label":"Close modal"},[b(E(ke),{class:"h-5 w-5"})])]),e("div",De,[b(F,{name:"organization_name",label:"Organization Name",type:"text","model-value":u.name,error:n.name,placeholder:"Enter organization name",required:"","onUpdate:modelValue":a[1]||(a[1]=i=>s("name",String(i)))},null,8,["model-value","error"]),b(N,{name:"industry",label:"Industry","model-value":u.industry,options:l,error:n.industry,placeholder:"Select industry",required:"","onUpdate:modelValue":a[2]||(a[2]=i=>s("industry",String(Array.isArray(i)?i[0]||"":i)))},null,8,["model-value","error"])]),e("div",Oe,[e("button",{onClick:a[3]||(a[3]=i=>t.$emit("close")),type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Cancel "),e("button",{onClick:m,type:"button",disabled:!r.value||c.value,class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},_(c.value?"Creating...":"Create Organization"),9,Ee)])])]))}}),Me={class:"space-y-4 md:space-y-6"},Be={class:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6"},Te={class:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6"},Ne={class:"space-y-2"},Pe={class:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6"},Ue=I({__name:"ContactStepOne",props:{modelValue:{},errors:{},loading:{type:Boolean,default:!1}},emits:["update:modelValue","validate"],setup(C,{emit:k}){const o=C,w=k,c=re(),u=$(!1),n=he.map(t=>({value:t,label:t,description:`${t} role`})),l=O(()=>c.organizations.map(t=>({value:t.id,label:t.name,description:t.industry||"No industry specified"}))),r=(t,a)=>{const i={...o.modelValue,[t]:a};w("update:modelValue",i)},s=async(t,a)=>{await y()},y=async()=>{const t={};let a=!0;try{const i={first_name:o.modelValue.first_name,last_name:o.modelValue.last_name,organization_id:o.modelValue.organization_id,position:o.modelValue.position,email:o.modelValue.email,phone:o.modelValue.phone};await be.validate(i,{abortEarly:!1})}catch(i){a=!1,i.inner&&i.inner.forEach(S=>{S.path&&(t[S.path]=S.message)})}w("validate",1,a,t)},m=t=>{r("organization_id",t),u.value=!1,c.fetchOrganizations({resetList:!0})};return X(()=>[o.modelValue.first_name,o.modelValue.last_name,o.modelValue.organization_id,o.modelValue.position,o.modelValue.email,o.modelValue.phone],async()=>{await y()},{immediate:!0}),P(async()=>{c.organizations.length===0&&await c.fetchOrganizations({resetList:!0}),await y()}),(t,a)=>(g(),h("div",Me,[e("div",Be,[b(F,{name:"first_name",label:"First Name",type:"text","model-value":t.modelValue.first_name||"",error:t.errors.first_name,placeholder:"Enter first name",required:"",autocomplete:"given-name","onUpdate:modelValue":a[0]||(a[0]=i=>r("first_name",i)),onValidate:a[1]||(a[1]=i=>s())},null,8,["model-value","error"]),b(F,{name:"last_name",label:"Last Name",type:"text","model-value":t.modelValue.last_name||"",error:t.errors.last_name,placeholder:"Enter last name",required:"",autocomplete:"family-name","onUpdate:modelValue":a[2]||(a[2]=i=>r("last_name",i)),onValidate:a[3]||(a[3]=i=>s())},null,8,["model-value","error"])]),e("div",Te,[e("div",Ne,[b(N,{name:"organization_id",label:"Organization","model-value":t.modelValue.organization_id||"",options:l.value,error:t.errors.organization_id,placeholder:"Select an organization",searchable:"",required:"","onUpdate:modelValue":a[4]||(a[4]=i=>r("organization_id",i)),onValidate:a[5]||(a[5]=i=>s())},null,8,["model-value","options","error"]),b(Y,{variant:"secondary",size:"sm",class:"w-full",onClick:a[6]||(a[6]=i=>u.value=!0)},{default:q(()=>[b(E(Ce),{class:"h-4 w-4 mr-2"}),a[14]||(a[14]=B(" Create New Organization ",-1))]),_:1,__:[14]})]),b(N,{name:"position",label:"Position","model-value":t.modelValue.position||"",options:E(n),error:t.errors.position,placeholder:"Select or enter position","allow-custom":"",required:"","onUpdate:modelValue":a[7]||(a[7]=i=>r("position",i)),onValidate:a[8]||(a[8]=i=>s())},null,8,["model-value","options","error"])]),e("div",Pe,[b(F,{name:"email",label:"Email Address",type:"email","model-value":t.modelValue.email||"",error:t.errors.email,placeholder:"contact@company.com",autocomplete:"email","onUpdate:modelValue":a[9]||(a[9]=i=>r("email",i)),onValidate:a[10]||(a[10]=i=>s())},null,8,["model-value","error"]),b(F,{name:"phone",label:"Phone Number",type:"tel","model-value":t.modelValue.phone||"",error:t.errors.phone,placeholder:"(555) 123-4567",autocomplete:"tel","onUpdate:modelValue":a[11]||(a[11]=i=>r("phone",i)),onValidate:a[12]||(a[12]=i=>s())},null,8,["model-value","error"])]),u.value?(g(),Z(Ie,{key:0,onClose:a[13]||(a[13]=i=>u.value=!1),onSuccess:m})):z("",!0)]))}}),Ae={class:"space-y-2"},je={class:"relative"},Le={class:"flex flex-wrap gap-2 items-center"},qe=["onClick","aria-label"],Re=["placeholder","aria-describedby","aria-invalid"],He={key:0,class:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto"},Ke=["onMousedown","aria-selected"],We={class:"flex items-center justify-between"},Ge={class:"text-sm font-medium text-gray-900"},Ze={key:0,class:"text-xs text-gray-500"},Je={key:0,class:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Qe={key:0,class:"px-3 py-2 text-sm text-gray-500"},Ye=["id"],Xe={key:1,class:"text-xs text-gray-500"},et=I({__name:"PrincipalMultiSelector",props:{name:{},modelValue:{},error:{},placeholder:{default:"Select principals..."},helperText:{},allowMultiple:{type:Boolean,default:!0},loading:{type:Boolean,default:!1}},emits:["update:modelValue","validate"],setup(C,{emit:k}){const o=C,w=k,c=$(""),u=$(!1),n=$(),l=$(),r=[{value:"prin-1",label:"ABC Foods Inc.",description:"Premium food manufacturer"},{value:"prin-2",label:"XYZ Beverages Corp.",description:"National beverage distributor"},{value:"prin-3",label:"Global Ingredients Ltd.",description:"Specialty ingredients supplier"},{value:"prin-4",label:"Fresh Products Co.",description:"Organic produce distributor"},{value:"prin-5",label:"Quality Meats LLC.",description:"Premium meat processor"},{value:"prin-6",label:"Dairy Excellence Inc.",description:"Regional dairy processor"},{value:"prin-7",label:"Spice World Trading",description:"International spice importer"},{value:"prin-8",label:"Frozen Foods Direct",description:"Frozen food manufacturer"}],s=O(()=>{if(!c.value.trim())return r;const d=c.value.toLowerCase();return r.filter(f=>f.label.toLowerCase().includes(d)||f.description&&f.description.toLowerCase().includes(d))}),y=d=>{const f=r.find(x=>x.value===d);return f?f.label:d},m=()=>{L(()=>{var d;(d=n.value)==null||d.focus()})},t=d=>{let f;o.modelValue.includes(d)?f=o.modelValue.filter(x=>x!==d):o.allowMultiple?f=[...o.modelValue,d]:f=[d],w("update:modelValue",f),w("validate",o.name,f),c.value="",u.value=!1,m()},a=d=>{const f=o.modelValue.filter(x=>x!==d);w("update:modelValue",f),w("validate",o.name,f)},i=()=>{u.value=!0},S=d=>{if(d.key==="Escape")u.value=!1,c.value="";else if(d.key==="Backspace"&&!c.value&&o.modelValue.length>0){const f=o.modelValue.slice(0,-1);w("update:modelValue",f),w("validate",o.name,f)}else if(d.key==="Enter"&&s.value.length>0){d.preventDefault();const f=s.value[0];o.modelValue.includes(f.value)||t(f.value)}},R=()=>{setTimeout(()=>{u.value=!1,c.value=""},150)};return P(()=>{w("validate",o.name,o.modelValue)}),(d,f)=>(g(),h("div",Ae,[e("div",je,[e("div",{ref_key:"containerRef",ref:l,class:T(["min-h-[2.5rem] w-full px-3 py-2 border rounded-md focus-within:outline-none focus-within:ring-2 transition-colors duration-200 cursor-text",d.error?"border-red-500 focus-within:ring-red-500":"border-gray-300 focus-within:ring-blue-500"]),onClick:m},[e("div",Le,[(g(!0),h(J,null,Q(d.modelValue,x=>(g(),h("div",{key:x,class:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-blue-100 text-blue-800"},[B(_(y(x))+" ",1),e("button",{type:"button",onClick:te(H=>a(x),["stop"]),class:"ml-1 inline-flex items-center justify-center w-4 h-4 rounded-full hover:bg-blue-200 focus:outline-none focus:bg-blue-200","aria-label":`Remove ${y(x)}`},f[2]||(f[2]=[e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,qe)]))),128)),pe(e("input",{ref_key:"inputRef",ref:n,"onUpdate:modelValue":f[0]||(f[0]=x=>c.value=x),type:"text",placeholder:d.modelValue.length===0?d.placeholder:"",class:"flex-1 min-w-[120px] border-0 p-0 focus:ring-0 focus:outline-none bg-transparent",onInput:i,onKeydown:S,onFocus:f[1]||(f[1]=x=>u.value=!0),onBlur:R,"aria-describedby":d.error?`${d.name}-error`:void 0,"aria-invalid":!!d.error},null,40,Re),[[ve,c.value]])])],2),u.value&&s.value.length>0?(g(),h("div",He,[(g(!0),h(J,null,Q(s.value,x=>(g(),h("div",{key:x.value,onMousedown:te(H=>t(x.value),["prevent"]),class:T(["px-3 py-2 cursor-pointer hover:bg-gray-100 focus:bg-gray-100 focus:outline-none",{"bg-blue-50":d.modelValue.includes(x.value)}]),role:"option","aria-selected":d.modelValue.includes(x.value)},[e("div",We,[e("div",null,[e("div",Ge,_(x.label),1),x.description?(g(),h("div",Ze,_(x.description),1)):z("",!0)]),d.modelValue.includes(x.value)?(g(),h("svg",Je,f[3]||(f[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):z("",!0)])],42,Ke))),128)),c.value&&s.value.length===0?(g(),h("div",Qe,' No principals found matching "'+_(c.value)+'" ',1)):z("",!0)])):z("",!0)]),d.error?(g(),h("div",{key:0,id:`${d.name}-error`,class:"text-sm text-red-600",role:"alert"},_(d.error),9,Ye)):z("",!0),!d.error&&d.helperText?(g(),h("div",Xe,_(d.helperText),1)):z("",!0)]))}}),tt={class:"space-y-4 md:space-y-6"},at={class:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6"},ot={class:"space-y-2"},rt=I({__name:"ContactStepTwo",props:{modelValue:{},errors:{},loading:{type:Boolean,default:!1}},emits:["update:modelValue","validate"],setup(C,{emit:k}){const o=C,w=k,c=we.map(m=>({value:m,label:m,description:n(m)})),u=xe.map(m=>({value:m,label:m,description:l(m)}));function n(m){switch(m){case"High":return"Can directly approve or reject purchases";case"Medium":return"Has significant input in purchase decisions";case"Low":return"Limited influence on purchase decisions";case"Unknown":return"Influence level not yet determined";default:return"Purchase influence level"}}function l(m){switch(m){case"Decision Maker":return"Final authority on purchases";case"Influencer":return"Can sway decisions but doesn't have final say";case"End User":return"Will use the product/service but may not decide";case"Gatekeeper":return"Controls access to decision makers";default:return"Decision authority role"}}const r=(m,t)=>{const a={...o.modelValue,[m]:t};w("update:modelValue",a)},s=async(m,t)=>{await y()},y=async()=>{const m={};let t=!0;try{const a={purchase_influence:o.modelValue.purchase_influence,decision_authority:o.modelValue.decision_authority,preferred_principals:o.modelValue.preferred_principals};await Ve.validate(a,{abortEarly:!1})}catch(a){t=!1,a.inner&&a.inner.forEach(i=>{i.path&&(m[i.path]=i.message)})}w("validate",2,t,m)};return X(()=>[o.modelValue.purchase_influence,o.modelValue.decision_authority,o.modelValue.preferred_principals],async()=>{await y()},{immediate:!0}),P(async()=>{await y()}),(m,t)=>(g(),h("div",tt,[e("div",at,[b(N,{name:"purchase_influence",label:"Purchase Influence","model-value":m.modelValue.purchase_influence||"",options:E(c),error:m.errors.purchase_influence,placeholder:"Select purchase influence level",required:"","onUpdate:modelValue":t[0]||(t[0]=a=>r("purchase_influence",a)),onValidate:t[1]||(t[1]=a=>s())},null,8,["model-value","options","error"]),b(N,{name:"decision_authority",label:"Decision Authority","model-value":m.modelValue.decision_authority||"",options:E(u),error:m.errors.decision_authority,placeholder:"Select decision authority role",required:"","onUpdate:modelValue":t[2]||(t[2]=a=>r("decision_authority",a)),onValidate:t[3]||(t[3]=a=>s())},null,8,["model-value","options","error"])]),e("div",ot,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium text-gray-700"},[B(" Preferred Principals "),e("span",{class:"text-xs text-gray-500 ml-2"},"(Optional)")],-1)),b(et,{name:"preferred_principals","model-value":(m.modelValue.preferred_principals||[]).filter(a=>typeof a=="string"),error:m.errors.preferred_principals,placeholder:"Select preferred principals...","allow-multiple":"","onUpdate:modelValue":t[4]||(t[4]=a=>r("preferred_principals",a)),onValidate:t[5]||(t[5]=a=>s())},null,8,["model-value","error"]),t[7]||(t[7]=e("p",{class:"text-xs text-gray-500 mt-1"}," Select the principals this contact prefers to work with or advocate for ",-1))]),t[8]||(t[8]=ae('<div class="bg-blue-50 border border-blue-200 rounded-md p-4"><div class="flex items-start"><svg class="h-5 w-5 text-blue-400 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div><h3 class="text-sm font-medium text-blue-800">Authority &amp; Influence Guide</h3><div class="mt-2 text-sm text-blue-700"><p class="mb-2"><strong>Purchase Influence</strong> indicates how much this contact can affect buying decisions:</p><ul class="list-disc list-inside space-y-1 mb-3 ml-4"><li><strong>High:</strong> Can directly approve or reject purchases</li><li><strong>Medium:</strong> Has significant input in purchase decisions</li><li><strong>Low:</strong> Limited influence on purchase decisions</li><li><strong>Unknown:</strong> Influence level not yet determined</li></ul><p class="mb-2"><strong>Decision Authority</strong> defines their role in the decision process:</p><ul class="list-disc list-inside space-y-1 ml-4"><li><strong>Decision Maker:</strong> Final authority on purchases</li><li><strong>Influencer:</strong> Can sway decisions but doesn&#39;t have final say</li><li><strong>End User:</strong> Will use the product/service but may not decide</li><li><strong>Gatekeeper:</strong> Controls access to decision makers</li></ul></div></div></div></div>',1))]))}}),st={class:"space-y-4 md:space-y-6"},lt={class:"space-y-4"},nt={class:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6"},it={class:"space-y-4"},dt={class:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6"},ut={class:"flex items-center space-x-3"},ct=["checked"],mt={class:"space-y-2"},pt=["value","aria-describedby","aria-invalid"],vt={class:"flex justify-between items-center"},ft={key:0,id:"notes-error",class:"text-sm text-red-600",role:"alert"},gt={key:1,class:"text-xs text-gray-500"},yt={class:"text-xs text-gray-400"},ht=I({__name:"ContactStepThree",props:{modelValue:{},errors:{},loading:{type:Boolean,default:!1}},emits:["update:modelValue","validate"],setup(C,{emit:k}){const o=C,w=k,c=(l,r)=>{const s={...o.modelValue,[l]:r};w("update:modelValue",s)},u=async(l,r)=>{await n()},n=async()=>{const l={};let r=!0;try{const s={address:o.modelValue.address,city:o.modelValue.city,state:o.modelValue.state,zip_code:o.modelValue.zip_code,website:o.modelValue.website,account_manager:o.modelValue.account_manager,notes:o.modelValue.notes,is_primary:o.modelValue.is_primary};await _e.validate(s,{abortEarly:!1})}catch(s){r=!1,s.inner&&s.inner.forEach(y=>{y.path&&(l[y.path]=y.message)})}w("validate",3,r,l)};return X(()=>[o.modelValue.address,o.modelValue.city,o.modelValue.state,o.modelValue.zip_code,o.modelValue.website,o.modelValue.account_manager,o.modelValue.notes,o.modelValue.is_primary],async()=>{await n()},{immediate:!0}),P(async()=>{await n()}),(l,r)=>(g(),h("div",st,[e("div",lt,[r[15]||(r[15]=e("h3",{class:"text-sm font-medium text-gray-900"},"Address Information",-1)),b(F,{name:"address",label:"Street Address",type:"text","model-value":l.modelValue.address||"",error:l.errors.address,placeholder:"Enter street address",autocomplete:"street-address","onUpdate:modelValue":r[0]||(r[0]=s=>c("address",s)),onValidate:r[1]||(r[1]=s=>u())},null,8,["model-value","error"]),e("div",nt,[b(F,{name:"city",label:"City",type:"text","model-value":l.modelValue.city||"",error:l.errors.city,placeholder:"Enter city","onUpdate:modelValue":r[2]||(r[2]=s=>c("city",s)),onValidate:r[3]||(r[3]=s=>u())},null,8,["model-value","error"]),b(F,{name:"state",label:"State",type:"text","model-value":l.modelValue.state||"",error:l.errors.state,placeholder:"Enter state","onUpdate:modelValue":r[4]||(r[4]=s=>c("state",s)),onValidate:r[5]||(r[5]=s=>u())},null,8,["model-value","error"]),b(F,{name:"zip_code",label:"ZIP Code",type:"text","model-value":l.modelValue.zip_code||"",error:l.errors.zip_code,placeholder:"Enter ZIP code",autocomplete:"postal-code","onUpdate:modelValue":r[6]||(r[6]=s=>c("zip_code",s)),onValidate:r[7]||(r[7]=s=>u())},null,8,["model-value","error"])])]),e("div",it,[r[16]||(r[16]=e("h3",{class:"text-sm font-medium text-gray-900"},"Additional Information",-1)),e("div",dt,[b(F,{name:"website",label:"Website",type:"url","model-value":l.modelValue.website||"",error:l.errors.website,placeholder:"https://example.com",autocomplete:"url","onUpdate:modelValue":r[8]||(r[8]=s=>c("website",s)),onValidate:r[9]||(r[9]=s=>u())},null,8,["model-value","error"]),b(F,{name:"account_manager",label:"Account Manager",type:"text","model-value":l.modelValue.account_manager||"",error:l.errors.account_manager,placeholder:"Enter account manager name","onUpdate:modelValue":r[10]||(r[10]=s=>c("account_manager",s)),onValidate:r[11]||(r[11]=s=>u())},null,8,["model-value","error"])])]),e("div",ut,[e("input",{id:"is_primary",name:"is_primary",type:"checkbox",checked:l.modelValue.is_primary||!1,onChange:r[12]||(r[12]=s=>c("is_primary",s.target.checked)),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,40,ct),r[17]||(r[17]=e("label",{for:"is_primary",class:"flex-1"},[e("span",{class:"text-sm font-medium text-gray-900"},"Primary Contact"),e("p",{class:"text-xs text-gray-500 mt-0.5"}," Mark this as the primary contact for the organization ")],-1))]),e("div",mt,[r[18]||(r[18]=e("label",{for:"notes",class:"block text-sm font-medium text-gray-700"}," Notes ",-1)),e("textarea",{id:"notes",name:"notes",rows:"4",value:l.modelValue.notes||"",onInput:r[13]||(r[13]=s=>c("notes",s.target.value)),onBlur:r[14]||(r[14]=s=>u("notes",s.target.value)),class:T(["w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors duration-200 resize-none",l.errors.notes?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-blue-500"]),placeholder:"Add any additional notes about this contact...","aria-describedby":l.errors.notes?"notes-error":void 0,"aria-invalid":!!l.errors.notes,maxlength:"5000"},null,42,pt),e("div",vt,[l.errors.notes?(g(),h("div",ft,_(l.errors.notes),1)):(g(),h("div",gt," Optional notes and comments ")),e("div",yt,_((l.modelValue.notes||"").length)+"/5000 ",1)])]),r[19]||(r[19]=ae('<div class="bg-green-50 border border-green-200 rounded-md p-4"><div class="flex items-start"><svg class="h-5 w-5 text-green-400 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div><h3 class="text-sm font-medium text-green-800">Contact Details</h3><p class="mt-1 text-sm text-green-700"> All fields in this step are optional. Add any additional information that will help you and your team better understand and communicate with this contact. </p></div></div></div>',1))]))}}),bt={class:"max-w-4xl mx-auto"},wt={class:"mb-3"},xt={class:"flex items-center justify-center space-x-2 mb-2"},Vt=["aria-label"],_t={class:"text-center"},kt={class:"text-base font-medium text-gray-900"},Ct={class:"text-xs text-gray-600 mt-0.5"},$t={key:0,class:"mb-3 flex items-center justify-center text-xs"},St={key:0,class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"},zt={key:1,class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ft={key:2,class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Dt={key:1,class:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",role:"alert"},Ot={class:"flex items-start"},Et={class:"mt-1 text-sm text-red-700"},It={class:"bg-white shadow-sm rounded-lg border border-gray-200"},Mt={class:"p-3 md:p-4"},Bt={class:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg md:relative md:bg-gray-50 md:border-0 md:shadow-none md:mt-3 md:rounded-lg"},Tt={class:"max-w-4xl mx-auto px-3 py-2 md:px-4 md:py-3"},Nt={class:"flex items-center justify-between"},Pt={key:1},Ut={class:"flex items-center space-x-3"},At={class:"text-xs text-gray-500"},jt={key:0,class:"h-4 w-4 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},j=3,Lt=I({__name:"ContactFormWrapper",props:{initialData:{},isEditing:{type:Boolean,default:!1},contactId:{}},emits:["success","cancel","draft-saved"],setup(C,{emit:k}){const o=C,w=k,c=oe(),u=ye(),n=$(1),l=$(!1),r=$(!1),s=$(""),y=$(null),m=M({1:!1,2:!1,3:!0}),t=M({first_name:"",last_name:"",organization_id:"",position:"",purchase_influence:"Unknown",decision_authority:"End User",preferred_principals:[],email:null,phone:null,address:null,city:null,state:null,zip_code:null,website:null,account_manager:null,notes:null,is_primary:!1,...o.initialData}),a=M({1:{},2:{},3:{}}),i=[{id:1,title:"Basic Info",description:"Enter contact name, organization, position, and contact details",component:"ContactStepOne",requiredFields:["first_name","last_name","organization_id","position"],optionalFields:["email","phone"]},{id:2,title:"Authority & Influence",description:"Define purchase influence and decision authority",component:"ContactStepTwo",requiredFields:["purchase_influence","decision_authority"],optionalFields:["preferred_principals"]},{id:3,title:"Contact Details",description:"Add address, website, and additional information",component:"ContactStepThree",requiredFields:[],optionalFields:["address","city","state","zip_code","website","account_manager","notes","is_primary"]}],S=O(()=>i[n.value-1]),R=O(()=>({ContactStepOne:Ue,ContactStepTwo:rt,ContactStepThree:ht})[S.value.component]),d=O(()=>n.value===j),f=O(()=>a[n.value]||{}),x=O(()=>m[n.value]),H=p=>{Object.assign(t,p),de()},U=async(p,v,V={})=>{m[p]=v,a[p]=V,v&&s.value&&(s.value="")},K=async()=>{r.value=!0;try{const p=[...S.value.requiredFields,...S.value.optionalFields],v={};p.forEach(D=>{v[D]=t[D]});let V;switch(n.value){case 1:V=await A.validateStepOne(v);break;case 2:V=await A.validateStepTwo(v);break;case 3:V=await A.validateStepThree(v);break;default:throw new Error("Invalid step number")}if(V.isValid)return await U(n.value,!0,{}),!0;{const D={};return V.errors.forEach(ee=>{D[ee.field]=ee.message}),await U(n.value,!1,D),!1}}catch(p){const v={general:p.message||"Validation failed"};return await U(n.value,!1,v),!1}finally{r.value=!1}},se=async()=>{n.value<j&&await K()&&(n.value++,await L(),G())},le=()=>{n.value>1&&(n.value--,L(()=>{G()}))},ne=async()=>{d.value?await ie():await se()},ie=async()=>{try{l.value=!0,s.value="";for(let V=1;V<=j;V++)if(n.value=V,!await K()){s.value=`Please fix errors in Step ${V}`;return}const p=await A.validateCreate(t);if(!p.isValid){s.value="Please fix all validation errors";return}let v;o.isEditing&&o.contactId?v=await u.updateContact(o.contactId,p.data):v=await u.createContact(p.data),v?(me(),w("success",v.id),c.push(`/contacts/${v.id}`)):s.value="Failed to save contact. Please try again."}catch(p){s.value=p.message||"An unexpected error occurred",console.error("Contact form submission error:",p)}finally{l.value=!1}};let W=null;const de=()=>{W&&clearTimeout(W),W=setTimeout(async()=>{await ue()},2e3)},ue=async()=>{try{y.value="saving";const p=o.isEditing?`contact-edit-draft-${o.contactId}`:"contact-create-draft";localStorage.setItem(p,JSON.stringify({formData:{...t},currentStep:n.value,timestamp:Date.now()})),y.value="saved",setTimeout(()=>{y.value==="saved"&&(y.value=null)},3e3),w("draft-saved",{...t})}catch(p){y.value="error",console.error("Failed to save draft:",p),setTimeout(()=>{y.value==="error"&&(y.value=null)},5e3)}},ce=async()=>{try{const p=o.isEditing?`contact-edit-draft-${o.contactId}`:"contact-create-draft",v=localStorage.getItem(p);if(v){const V=JSON.parse(v);Date.now()-V.timestamp<36e5?(Object.assign(t,V.formData),n.value=V.currentStep||1):localStorage.removeItem(p)}}catch(p){console.error("Failed to load auto-saved draft:",p)}},me=()=>{try{const p=o.isEditing?`contact-edit-draft-${o.contactId}`:"contact-create-draft";localStorage.removeItem(p)}catch(p){console.error("Failed to clear auto-saved draft:",p)}},G=()=>{L(()=>{const p=document.querySelector("input, select, textarea");p&&p.focus()})};return P(async()=>{o.isEditing||await ce(),G(),await K()}),(p,v)=>(g(),h("div",bt,[e("div",wt,[e("div",xt,[(g(),h(J,null,Q(i,(V,D)=>e("div",{key:V.id,class:T(["h-1.5 w-6 rounded-full transition-colors duration-200",D+1<=n.value?"bg-primary-600":"bg-gray-200"]),"aria-label":`Step ${D+1}: ${V.title}`},null,10,Vt)),64))]),e("div",_t,[e("h2",kt,_(S.value.title),1),e("p",Ct,_(S.value.description),1)])]),y.value?(g(),h("div",$t,[e("div",{class:T(["flex items-center space-x-2 px-3 py-1 rounded-full",y.value==="saving"?"bg-blue-50 text-blue-700":y.value==="saved"?"bg-green-50 text-green-700":"bg-red-50 text-red-700"])},[y.value==="saving"?(g(),h("svg",St,v[0]||(v[0]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):y.value==="saved"?(g(),h("svg",zt,v[1]||(v[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(g(),h("svg",Ft,v[2]||(v[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]))),e("span",null,_(y.value==="saving"?"Saving draft...":y.value==="saved"?"Draft saved":"Failed to save draft"),1)],2)])):z("",!0),s.value?(g(),h("div",Dt,[e("div",Ot,[v[4]||(v[4]=e("svg",{class:"h-5 w-5 text-red-400 mr-3 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("div",null,[v[3]||(v[3]=e("h3",{class:"text-sm font-medium text-red-800"},"Error",-1)),e("p",Et,_(s.value),1)])])])):z("",!0),e("div",It,[e("div",Mt,[(g(),Z(fe(R.value),{"model-value":t,errors:f.value,loading:r.value,onValidate:U,"onUpdate:modelValue":H},null,40,["model-value","errors","loading"]))])]),e("div",Bt,[e("div",Tt,[e("div",Nt,[n.value>1?(g(),Z(Y,{key:0,variant:"secondary",size:"sm",disabled:l.value,onClick:le},{default:q(()=>v[5]||(v[5]=[e("svg",{class:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),B(" Back ",-1)])),_:1,__:[5]},8,["disabled"])):(g(),h("div",Pt)),e("div",Ut,[e("div",At," Step "+_(n.value)+" of "+_(j),1),b(Y,{variant:d.value?"success":"primary",size:"sm",loading:l.value||r.value,disabled:!x.value||l.value,onClick:ne},{default:q(()=>[B(_(d.value?"Create Contact":"Next")+" ",1),d.value?z("",!0):(g(),h("svg",jt,v[6]||(v[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])))]),_:1},8,["variant","loading","disabled"])])])])])]))}}),qt={class:"max-w-4xl mx-auto"},Rt={class:"mb-8"},Ht={class:"flex items-center space-x-3 mb-4"},Kt={key:0,class:"mt-6 p-4 border border-red-300 rounded-md bg-red-50"},Wt={class:"flex"},Gt={class:"mt-1 text-sm text-red-700"},na=I({__name:"ContactCreateView",setup(C){const k=oe(),o=$(null),w=n=>{console.log("Contact created successfully with ID:",n),o.value=null},c=n=>{console.log("Contact form draft saved:",n)},u=()=>{k.push("/contacts")};return(n,l)=>{const r=ge("router-link");return g(),h("div",qt,[e("div",Rt,[e("div",Ht,[b(r,{to:"/contacts",class:"text-gray-500 hover:text-gray-700"},{default:q(()=>[b(E(Se),{class:"h-5 w-5"})]),_:1}),l[0]||(l[0]=e("h1",{class:"text-3xl font-bold text-gray-900"},"Create New Contact",-1))]),l[1]||(l[1]=e("p",{class:"text-gray-600"}," Add a new contact with their organization, authority level, and contact details in three simple steps. ",-1))]),b(Lt,{"is-editing":!1,onSuccess:w,onCancel:u,onDraftSaved:c}),o.value?(g(),h("div",Kt,[e("div",Wt,[b(E($e),{class:"h-5 w-5 text-red-400 mr-2 mt-0.5"}),e("div",null,[l[2]||(l[2]=e("h3",{class:"text-sm font-medium text-red-800"},"Error creating contact",-1)),e("p",Gt,_(o.value),1)])])])):z("",!0)])}}});export{na as default};
//# sourceMappingURL=ContactCreateView-PV5sp1AY.js.map
