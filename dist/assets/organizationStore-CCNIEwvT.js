import{m as $e,r as O,y as X,j as I}from"./index-EqgV18wk.js";import{s as g}from"./supabaseClient-Ueky6YRs.js";import{c as P,b as n,a as B,f as k,d as A,e as f,g as E}from"./index.esm-DUXcyDU6.js";const ce=P({name:n().required("Organization name is required").trim().min(1,"Organization name cannot be empty").max(255,"Organization name must be less than 255 characters"),legal_name:n().nullable().max(255,"Legal name must be less than 255 characters"),description:n().nullable(),industry:n().nullable().max(255,"Industry must be less than 255 characters"),type:E().oneOf(["B2B","B2C","B2B2C","Non-Profit","Government","Other"]).nullable(),size:E().oneOf(["Startup","Small","Medium","Large","Enterprise"]).nullable(),status:E().oneOf(["Active","Inactive","Prospect","Customer","Partner","Vendor"]).nullable(),website:n().nullable().matches(/^https?:\/\/[^\s]+$/,"Website must be a valid URL starting with http:// or https://"),email:n().nullable().email("Email must be a valid email address"),primary_phone:n().nullable().max(50,"Primary phone must be less than 50 characters"),secondary_phone:n().nullable().max(50,"Secondary phone must be less than 50 characters"),address_line_1:n().nullable().max(255,"Address line 1 must be less than 255 characters"),address_line_2:n().nullable().max(255,"Address line 2 must be less than 255 characters"),city:n().nullable().max(100,"City must be less than 100 characters"),state_province:n().nullable().max(100,"State/Province must be less than 100 characters"),postal_code:n().nullable().max(20,"Postal code must be less than 20 characters"),country:n().nullable().max(100,"Country must be less than 100 characters"),founded_year:f().nullable().integer("Founded year must be a whole number").min(1800,"Founded year must be 1800 or later").max(new Date().getFullYear()+1,"Founded year cannot be in the future"),employees_count:f().nullable().integer("Employee count must be a whole number").min(0,"Employee count cannot be negative"),annual_revenue:f().nullable().min(0,"Annual revenue cannot be negative"),currency_code:n().nullable().matches(/^[A-Z]{3}$/,"Currency code must be 3 uppercase letters (e.g., USD)"),lead_source:n().nullable().max(255,"Lead source must be less than 255 characters"),lead_score:f().nullable().integer("Lead score must be a whole number").min(0,"Lead score cannot be negative").max(100,"Lead score cannot exceed 100"),tags:A().of(n()).nullable(),custom_fields:P().nullable(),parent_org_id:n().nullable().uuid("Parent organization ID must be a valid UUID"),assigned_user_id:n().nullable().uuid("Assigned user ID must be a valid UUID"),last_contact_date:k().nullable(),next_follow_up_date:k().nullable(),is_principal:B().nullable(),is_distributor:B().nullable(),distributor_id:n().nullable().uuid("Distributor ID must be a valid UUID"),account_manager_id:n().nullable().uuid("Account Manager ID must be a valid UUID")}),Ne=ce;ce.partial();const je=P({organization_id:n().required("Organization ID is required").uuid("Organization ID must be a valid UUID"),contact_id:n().nullable().uuid("Contact ID must be a valid UUID"),type:E().oneOf(["Email","Phone","Meeting","Demo","Proposal","Contract","Note","Task","Event","Social","Website","Other"]).required("Interaction type is required"),direction:E().oneOf(["Inbound","Outbound"]).nullable(),subject:n().nullable().max(500,"Subject must be less than 500 characters").test("not-empty","Subject cannot be empty if provided",function(s){return s==null||s.trim().length>0}),description:n().nullable(),interaction_date:k().required("Interaction date is required"),duration_minutes:f().nullable().integer("Duration must be a whole number of minutes").min(0,"Duration cannot be negative"),tags:A().of(n()).nullable(),metadata:P().nullable(),created_by_user_id:n().nullable().uuid("Created by user ID must be a valid UUID")});je.partial().shape({organization_id:n().uuid("Organization ID must be a valid UUID")});const Te=P({organization_id:n().required("Organization ID is required").uuid("Organization ID must be a valid UUID"),name:n().required("Document name is required").trim().min(1,"Document name cannot be empty").max(500,"Document name must be less than 500 characters"),description:n().nullable(),file_type:n().nullable().max(50,"File type must be less than 50 characters"),file_size_bytes:f().nullable().integer("File size must be a whole number").min(0,"File size cannot be negative"),storage_path:n().nullable().max(1e3,"Storage path must be less than 1000 characters"),external_url:n().nullable().matches(/^https?:\/\/[^\s]+$/,"External URL must be a valid URL starting with http:// or https://").max(1e3,"External URL must be less than 1000 characters"),category:n().nullable().max(255,"Category must be less than 255 characters"),tags:A().of(n()).nullable(),is_public:B().nullable(),access_level:n().nullable().max(50,"Access level must be less than 50 characters"),version:n().nullable().max(50,"Version must be less than 50 characters"),parent_document_id:n().nullable().uuid("Parent document ID must be a valid UUID"),uploaded_by_user_id:n().nullable().uuid("Uploaded by user ID must be a valid UUID")}).test("has-location","Document must have either a storage path or external URL",function(s){return!!(s.storage_path||s.external_url)});Te.partial().shape({organization_id:n().uuid("Organization ID must be a valid UUID")});const Ge=P({organization_id:n().required("Organization ID is required").uuid("Organization ID must be a valid UUID"),period_start:k().required("Period start date is required"),period_end:k().required("Period end date is required").test("after-start","Period end must be after period start",function(s){const{period_start:y}=this.parent;return!y||!s?!0:s>y}),period_type:n().required("Period type is required").oneOf(["daily","weekly","monthly","quarterly","yearly"],"Period type must be one of: daily, weekly, monthly, quarterly, yearly"),total_interactions:f().nullable().integer("Total interactions must be a whole number").min(0,"Total interactions cannot be negative"),email_interactions:f().nullable().integer("Email interactions must be a whole number").min(0,"Email interactions cannot be negative"),phone_interactions:f().nullable().integer("Phone interactions must be a whole number").min(0,"Phone interactions cannot be negative"),meeting_interactions:f().nullable().integer("Meeting interactions must be a whole number").min(0,"Meeting interactions cannot be negative"),revenue_generated:f().nullable().min(0,"Revenue generated cannot be negative"),deals_closed:f().nullable().integer("Deals closed must be a whole number").min(0,"Deals closed cannot be negative"),deals_in_progress:f().nullable().integer("Deals in progress must be a whole number").min(0,"Deals in progress cannot be negative"),lead_score_change:f().nullable().integer("Lead score change must be a whole number"),conversion_events:f().nullable().integer("Conversion events must be a whole number").min(0,"Conversion events cannot be negative"),documents_added:f().nullable().integer("Documents added must be a whole number").min(0,"Documents added cannot be negative"),documents_accessed:f().nullable().integer("Documents accessed must be a whole number").min(0,"Documents accessed cannot be negative"),new_contacts_added:f().nullable().integer("New contacts added must be a whole number").min(0,"New contacts added cannot be negative"),active_contacts:f().nullable().integer("Active contacts must be a whole number").min(0,"Active contacts cannot be negative"),custom_metrics:P().nullable()});Ge.partial().shape({organization_id:n().uuid("Organization ID must be a valid UUID")});const We=Ne;We.shape({status:E().oneOf(["Prospect","Active Customer","Inactive Customer","Other","Principal","Distributor"]).required("Organization status is required"),custom_fields:P({is_principal:B().nullable(),is_distributor:B().nullable(),distributor_id:n().nullable().uuid("Distributor ID must be valid UUID"),account_manager_id:n().nullable().uuid("Account Manager ID must be valid UUID"),food_beverage_segment:n().nullable().max(255)}).test("principal-distributor-exclusive","Cannot be both Principal and Distributor",function(s){return!(s!=null&&s.is_principal&&(s!=null&&s.is_distributor))}),priority_letter:E().oneOf(["A","B","C","D"]).required("Priority is required"),assigned_contacts:A().of(n().uuid()).nullable()});P({search:n().nullable().optional(),industry:n().nullable().optional(),type:E().oneOf(["B2B","B2C","B2B2C","Non-Profit","Government","Other"]).nullable().optional(),size:E().oneOf(["Startup","Small","Medium","Large","Enterprise"]).nullable().optional(),status:E().oneOf(["Active","Inactive","Prospect","Customer","Partner","Vendor"]).nullable().optional(),country:n().nullable().optional(),min_employees:f().min(0).nullable().optional(),max_employees:f().min(0).nullable().optional(),min_revenue:f().min(0).nullable().optional(),max_revenue:f().min(0).nullable().optional(),min_lead_score:f().min(0).max(100).nullable().optional(),max_lead_score:f().min(0).max(100).nullable().optional(),tags:A().of(n()).nullable().optional(),limit:f().min(1).max(100).optional().default(20),offset:f().min(0).optional().default(0),sortBy:E().oneOf(["name","legal_name","industry","type","size","status","lead_score","employees_count","annual_revenue","founded_year","created_at","updated_at","last_contact_date","next_follow_up_date"]).optional().default("name"),sortOrder:E().oneOf(["asc","desc"]).optional().default("asc")});const Ke=[{value:90,label:"A",description:"Highest priority - Strategic accounts"},{value:70,label:"B",description:"High priority - Major opportunities"},{value:50,label:"C",description:"Medium priority - Qualified prospects"},{value:30,label:"D",description:"Lower priority - New prospects"}],le=s=>({A:90,B:70,C:50,D:30})[s],He=s=>s?s>=90?"A":s>=70?"B":s>=50?"C":"D":"D",nt=$e("organization",()=>{const s=O([]),y=O(null),j=O([]),T=O([]),G=O([]),v=O(null),W=O([]),K=O([]),u=X({organizations:!1,currentOrganization:!1,analytics:!1,performance:!1,leadScoring:!1,metrics:!1,interactions:!1,documents:!1,creating:!1,updating:!1,deleting:!1,bulkOperations:!1}),D=X({organizations:"",currentOrganization:"",analytics:"",performance:"",leadScoring:"",metrics:"",interactions:"",documents:"",creating:"",updating:"",deleting:"",bulkOperations:""}),R=O(""),o=O({}),x=O({field:"name",order:"asc"}),d=O({page:1,limit:20,total:0,totalPages:0,hasNext:!1,hasPrevious:!1}),M=O(null),U=X({}),ue=I(()=>s.value.length>0),de=I(()=>d.value.total),ge=I(()=>Object.values(u).some(e=>e)),me=I(()=>Object.values(D).some(e=>e!=="")),fe=I(()=>{const a=Object.keys(D).find(t=>D[t]!=="");return a?D[a]:""}),he=I(()=>v.value?{total:v.value.totalOrganizations,active:v.value.activeOrganizations,prospects:v.value.prospects,customers:v.value.customers,partners:v.value.partners,totalRevenue:v.value.totalRevenue,averageLeadScore:v.value.averageLeadScore,thisMonth:v.value.monthlyGrowth>0?Math.round(v.value.totalOrganizations*v.value.monthlyGrowth/100):0,thisWeek:Math.round((v.value.monthlyGrowth>0?v.value.totalOrganizations*v.value.monthlyGrowth/100:0)/4)}:null),ve=I(()=>s.value.filter(e=>e.lead_score!==null).sort((e,a)=>(a.lead_score||0)-(e.lead_score||0)).slice(0,10)),pe=I(()=>s.value.reduce((e,a)=>{const t=a.status||"Unknown";return e[t]=(e[t]||0)+1,e},{})),_e=I(()=>{const e=new Date;return e.setDate(e.getDate()-30),s.value.filter(a=>a.created_at?new Date(a.created_at)>=e:!1)}),be=I(()=>Ke),ye=I(()=>[{value:"Food & Beverage - Restaurants",label:"Food & Beverage - Restaurants",priority:!0},{value:"Food & Beverage - Manufacturing",label:"Food & Beverage - Manufacturing",priority:!0},{value:"Food & Beverage - Distribution",label:"Food & Beverage - Distribution",priority:!0},{value:"Food & Beverage - Retail",label:"Food & Beverage - Retail",priority:!0},{value:"Food & Beverage - Service",label:"Food & Beverage - Service",priority:!0},{value:"Technology",label:"Technology",priority:!1},{value:"Healthcare",label:"Healthcare",priority:!1},{value:"Manufacturing",label:"Manufacturing",priority:!1},{value:"Retail",label:"Retail",priority:!1},{value:"Financial Services",label:"Financial Services",priority:!1},{value:"Real Estate",label:"Real Estate",priority:!1},{value:"Education",label:"Education",priority:!1},{value:"Government",label:"Government",priority:!1},{value:"Non-Profit",label:"Non-Profit",priority:!1},{value:"Other",label:"Other",priority:!1}]),we=I(()=>s.value.filter(e=>{const a=e;return a.custom_fields&&typeof a.custom_fields=="object"&&"is_distributor"in a.custom_fields&&a.custom_fields.is_distributor===!0})),ze=I(()=>s.value.filter(e=>{const a=e;return a.custom_fields&&typeof a.custom_fields=="object"&&"is_principal"in a.custom_fields&&a.custom_fields.is_principal===!0})),ee=()=>{Object.keys(D).forEach(e=>{D[e]=""})},_=e=>{D[e]=""},p=(e,a)=>{D[e]=a,console.error(`Organization Store Error (${e}):`,a)},Oe=e=>{const a=U[e];return a?Date.now()-a.timestamp<a.ttl:!1},H=e=>Oe(e)?U[e].data:null,V=(e,a,t=3e5)=>{U[e]={data:a,timestamp:Date.now(),ttl:t}},S=e=>{e?delete U[e]:Object.keys(U).forEach(a=>delete U[a])},w=async(e={})=>{try{u.organizations=!0,_("organizations"),e.page!==void 0&&(d.value.page=e.page),e.limit!==void 0&&(d.value.limit=e.limit),e.filters&&(o.value={...o.value,...e.filters}),e.sort&&(x.value={...x.value,...e.sort}),e.search!==void 0&&(R.value=e.search);const a=`organizations_${JSON.stringify({page:d.value.page,limit:d.value.limit,filters:o.value,sort:x.value,search:R.value})}`;if(e.useCache!==!1){const c=H(a);if(c)return s.value=e.resetList?c.data:[...s.value,...c.data],d.value=c.pagination,c}let t=g.from("organizations").select("*",{count:"exact"});if(R.value.trim()){const c=R.value.trim();t=t.or(`name.ilike.%${c}%,legal_name.ilike.%${c}%,industry.ilike.%${c}%`)}o.value.industry&&o.value.industry.length>0&&(t=t.in("industry",o.value.industry)),o.value.status&&o.value.status.length>0&&(t=t.in("status",o.value.status)),o.value.type&&o.value.type.length>0&&(t=t.in("type",o.value.type)),o.value.size&&o.value.size.length>0&&(t=t.in("size",o.value.size)),o.value.country&&o.value.country.length>0&&(t=t.in("country",o.value.country)),o.value.leadScoreRange&&(o.value.leadScoreRange.min!==void 0&&(t=t.gte("lead_score",o.value.leadScoreRange.min)),o.value.leadScoreRange.max!==void 0&&(t=t.lte("lead_score",o.value.leadScoreRange.max))),o.value.employeeRange&&(o.value.employeeRange.min!==void 0&&(t=t.gte("employees_count",o.value.employeeRange.min)),o.value.employeeRange.max!==void 0&&(t=t.lte("employees_count",o.value.employeeRange.max))),o.value.revenueRange&&(o.value.revenueRange.min!==void 0&&(t=t.gte("annual_revenue",o.value.revenueRange.min)),o.value.revenueRange.max!==void 0&&(t=t.lte("annual_revenue",o.value.revenueRange.max))),o.value.lastContactDateRange&&(o.value.lastContactDateRange.start&&(t=t.gte("last_contact_date",o.value.lastContactDateRange.start.toISOString())),o.value.lastContactDateRange.end&&(t=t.lte("last_contact_date",o.value.lastContactDateRange.end.toISOString())));const r=x.value.order==="asc";t=t.order(x.value.field,{ascending:r});const i=(d.value.page-1)*d.value.limit;t=t.range(i,i+d.value.limit-1);const{data:m,error:l,count:b}=await t;if(l)throw new Error(l.message);const h=(m||[]).map(c=>({id:c.id||"",name:c.name||"",legal_name:c.legal_name,industry:c.industry,type:c.type,size:c.size,status:c.status,website:c.website,email:c.email,primary_phone:c.primary_phone,city:c.city,country:c.country,employees_count:c.employees_count,annual_revenue:c.annual_revenue,lead_score:c.lead_score,contact_count:void 0,last_interaction_date:c.last_contact_date,next_follow_up_date:c.next_follow_up_date,created_at:c.created_at,updated_at:c.updated_at}));d.value.total=b||0,d.value.totalPages=Math.ceil(d.value.total/d.value.limit),d.value.hasNext=d.value.page<d.value.totalPages,d.value.hasPrevious=d.value.page>1,e.resetList!==!1?s.value=h:s.value=[...s.value,...h];const z={data:h,pagination:{...d.value},filters:{...o.value},sort:{...x.value}};return V(a,z),M.value=new Date,z}catch(a){const t=a instanceof Error?a.message:"Failed to fetch organizations";return p("organizations",t),console.error(`Failed to fetch organizations: ${t}`,{operation:"fetch_organizations",options:e}),null}finally{u.organizations=!1}},Y=async e=>{var a,t,r;try{u.currentOrganization=!0,_("currentOrganization");const i=`organization_${e}`,m=H(i);if(m)return y.value=m,m;const{data:l,error:b}=await g.from("organizations").select("*").eq("id",e).single();if(b)throw new Error(b.message);const[h,z,c]=await Promise.all([g.from("contacts").select("id, first_name, last_name, email, position").eq("organization_id",e),g.from("organization_interactions").select("id, type, subject, interaction_date, contact_id, direction").eq("organization_id",e).order("interaction_date",{ascending:!1}).limit(10),g.from("organization_documents").select("id, name, category, size, created_at").eq("organization_id",e)]),L={...l,contact_count:((a=h.data)==null?void 0:a.length)||0,interaction_count:((t=z.data)==null?void 0:t.length)||0,document_count:((r=c.data)==null?void 0:r.length)||0,recent_interactions:(z.data||[]).map(C=>{var $,N,q;return{id:C.id,type:C.type,subject:C.subject,interaction_date:C.interaction_date,contact_name:($=h.data)!=null&&$.find(F=>F.id===C.contact_id)?`${(N=h.data.find(F=>F.id===C.contact_id))==null?void 0:N.first_name} ${(q=h.data.find(F=>F.id===C.contact_id))==null?void 0:q.last_name}`:void 0}})};return y.value=L,V(i,L),L}catch(i){const m=i instanceof Error?i.message:"Failed to fetch organization";return p("currentOrganization",m),y.value=null,null}finally{u.currentOrganization=!1}},Ie=async e=>{try{u.creating=!0,_("creating");const{data:a,error:t}=await g.from("organizations").insert(e).select().single();if(t)throw console.error(`Failed to create organization: ${t.message}`,{operation:"create_organization",data:e}),new Error(t.message);return S(),await w({resetList:!0}),console.log("Organization created successfully",{organizationName:e.name,organizationIndustry:e.industry}),a}catch(a){const t=a instanceof Error?a.message:"Failed to create organization";return p("creating",t),console.error("Failed to create organization",t,{organizationData:e}),null}finally{u.creating=!1}},Ee=async(e,a)=>{try{u.creating=!0,_("creating");const{data:t,error:r}=await g.from("organizations").insert(e).select().single();if(r)throw new Error(r.message);if(a.mode==="create"&&a.newContacts.length>0){const i=a.newContacts.map(l=>({organization_id:t.id,first_name:l.first_name,last_name:l.last_name,email:l.email,phone:l.phone||null,position:l.title||"Unknown",purchase_influence:"Unknown",decision_authority:"End User",department:l.department||null})),{error:m}=await g.from("contacts").insert(i);m&&console.warn("Failed to create some contacts:",m.message)}else if(a.mode==="select"&&a.selectedContactIds.length>0){const{error:i}=await g.from("contacts").update({organization_id:t.id}).in("id",a.selectedContactIds);i&&console.warn("Failed to associate some contacts:",i.message)}return S(),await w({resetList:!0}),console.log("Organization with contacts created successfully",{organizationName:e.name,organizationIndustry:e.industry,contactMode:a.mode,contactCount:a.mode==="create"?a.newContacts.length:a.selectedContactIds.length}),t}catch(t){const r=t instanceof Error?t.message:"Failed to create organization with contacts";return p("creating",r),console.error("Failed to create organization with contacts",r,{organizationData:e,contactData:a}),null}finally{u.creating=!1}},De=async e=>{var a,t,r,i;try{u.creating=!0,_("creating");const{priority_letter:m,...l}=e,b={...l,lead_score:le(m),status:te(e),tags:l.tags?l.tags.filter(c=>c!==void 0):null,custom_fields:l.custom_fields,last_contact_date:l.last_contact_date instanceof Date?l.last_contact_date.toISOString():l.last_contact_date,next_follow_up_date:l.next_follow_up_date instanceof Date?l.next_follow_up_date.toISOString():l.next_follow_up_date},{data:h,error:z}=await g.from("organizations").insert(b).select().single();if(z)throw z;return(a=e.assigned_contacts)!=null&&a.length&&h&&await ae(h.id,e.assigned_contacts),S(),await w({resetList:!0}),console.log("Enhanced organization created successfully",{organizationName:e.name,priority:e.priority_letter,leadScore:b.lead_score,isPrincipal:(t=e.custom_fields)==null?void 0:t.is_principal,isDistributor:(r=e.custom_fields)==null?void 0:r.is_distributor,contactCount:((i=e.assigned_contacts)==null?void 0:i.length)||0}),{success:!0,data:h}}catch(m){const l=m instanceof Error?m.message:"Failed to create organization";return p("creating",l),{success:!1,error:l}}finally{u.creating=!1}},te=e=>{var a,t;return(a=e.custom_fields)!=null&&a.is_principal?"Principal":(t=e.custom_fields)!=null&&t.is_distributor?"Distributor":e.status},ae=async(e,a)=>{try{const{error:t}=await g.from("contacts").update({organization_id:e}).in("id",a);if(t)throw t}catch(t){throw console.warn("Failed to create contact relationships:",t),t}},xe=e=>le(e),Se=e=>He(e),Q=async(e,a)=>{var t;try{u.updating=!0,_("updating");const{data:r,error:i}=await g.from("organizations").update(a).eq("id",e).select().single();if(i)throw new Error(i.message);return((t=y.value)==null?void 0:t.id)===e&&await Y(e),S(),await w({resetList:!0}),r}catch(r){const i=r instanceof Error?r.message:"Failed to update organization";return p("updating",i),null}finally{u.updating=!1}},Ce=async(e,a,t)=>{var r;try{u.updating=!0,_("updating");const{data:i,error:m}=await g.from("organizations").update(a).eq("id",e).select().single();if(m)throw new Error(m.message);if(t.mode==="create"&&t.newContacts.length>0){const l=t.newContacts.map(h=>({organization_id:e,first_name:h.first_name,last_name:h.last_name,email:h.email,phone:h.phone||null,position:h.title||"Unknown",purchase_influence:"Unknown",decision_authority:"End User",department:h.department||null})),{error:b}=await g.from("contacts").insert(l);b&&console.warn("Failed to create some contacts:",b.message)}else if(t.mode==="select"&&t.selectedContactIds.length>0){const{error:l}=await g.from("contacts").update({organization_id:e}).in("id",t.selectedContactIds);l&&console.warn("Failed to associate some contacts:",l.message)}return((r=y.value)==null?void 0:r.id)===e&&await Y(e),S(),await w({resetList:!0}),console.log("Organization with contacts updated successfully",{organizationId:e,contactMode:t.mode,contactCount:t.mode==="create"?t.newContacts.length:t.selectedContactIds.length}),i}catch(i){const m=i instanceof Error?i.message:"Failed to update organization with contacts";return p("updating",m),null}finally{u.updating=!1}},ne=async e=>{var a;try{u.deleting=!0,_("deleting");const{error:t}=await g.from("organizations").delete().eq("id",e);if(t)throw new Error(t.message);return s.value=s.value.filter(r=>r.id!==e),((a=y.value)==null?void 0:a.id)===e&&(y.value=null),S(),!0}catch(t){const r=t instanceof Error?t.message:"Failed to delete organization";return p("deleting",r),!1}finally{u.deleting=!1}},Fe=async e=>{R.value=e,d.value.page=1,await w({search:e,resetList:!0})},Pe=async()=>{R.value="",d.value.page=1,await w({resetList:!0})},Re=async e=>{o.value={...o.value,...e},d.value.page=1,await w({resetList:!0})},Ue=async()=>{o.value={},d.value.page=1,await w({resetList:!0})},qe=async(e,a)=>{x.value={field:e,order:a},d.value.page=1,await w({resetList:!0})},J=async e=>{e>=1&&e<=d.value.totalPages&&(d.value.page=e,await w())},Le=async()=>{d.value.hasNext&&await J(d.value.page+1)},Be=async()=>{d.value.hasPrevious&&await J(d.value.page-1)},re=async()=>{var e,a;try{u.metrics=!0,_("metrics");const t="dashboard_metrics",r=H(t);if(r)return v.value=r,r;const[i,m,l,b,h,z]=await Promise.all([g.from("organizations").select("id",{count:"exact",head:!0}),g.from("organizations").select("id",{count:"exact",head:!0}).eq("status","Active"),g.from("organizations").select("id",{count:"exact",head:!0}).eq("status","Prospect"),g.from("organizations").select("id",{count:"exact",head:!0}).eq("status","Customer"),g.from("organizations").select("id",{count:"exact",head:!0}).eq("status","Partner"),g.from("organizations").select("annual_revenue, lead_score",{count:"exact"}).not("annual_revenue","is",null)]),c=new Date,L=new Date(c.getFullYear(),c.getMonth(),1),C=await g.from("organizations").select("id",{count:"exact",head:!0}).gte("created_at",L.toISOString()),$=((e=z.data)==null?void 0:e.reduce((F,Z)=>F+(Z.annual_revenue||0),0))||0,N=(a=z.data)!=null&&a.length?z.data.reduce((F,Z)=>F+(Z.lead_score||0),0)/z.data.length:0,q={totalOrganizations:i.count||0,activeOrganizations:m.count||0,prospects:l.count||0,customers:b.count||0,partners:h.count||0,totalRevenue:$,averageLeadScore:N,monthlyGrowth:C.count||0,industryDistribution:[],statusDistribution:[],recentActivity:[]};return v.value=q,V(t,q,6e5),q}catch(t){const r=t instanceof Error?t.message:"Failed to fetch dashboard metrics";return p("metrics",r),null}finally{u.metrics=!1}},oe=async()=>{try{u.analytics=!0,_("analytics");const{data:e,error:a}=await g.from("organization_summary_analytics").select("*").order("lead_score",{ascending:!1}).limit(50);if(a)throw new Error(a.message);return j.value=e||[],e}catch(e){const a=e instanceof Error?e.message:"Failed to fetch analytics";return p("analytics",a),null}finally{u.analytics=!1}},ke=async()=>{try{u.performance=!0,_("performance");const{data:e,error:a}=await g.from("monthly_organization_performance").select("*").order("performance_month",{ascending:!1}).limit(12);if(a)throw new Error(a.message);return T.value=e||[],e}catch(e){const a=e instanceof Error?e.message:"Failed to fetch performance data";return p("performance",a),null}finally{u.performance=!1}},Ae=async()=>{try{u.leadScoring=!0,_("leadScoring");const{data:e,error:a}=await g.from("organization_lead_scoring").select("*").order("lead_score",{ascending:!1}).limit(100);if(a)throw new Error(a.message);return G.value=e||[],e}catch(e){const a=e instanceof Error?e.message:"Failed to fetch lead scoring data";return p("leadScoring",a),null}finally{u.leadScoring=!1}},se=async e=>{var a;try{u.interactions=!0,_("interactions");const t=e||((a=y.value)==null?void 0:a.id);if(!t)throw new Error("No organization ID provided");const{data:r,error:i}=await g.from("organization_interactions").select("*").eq("organization_id",t).order("interaction_date",{ascending:!1});if(i)throw new Error(i.message);return W.value=r||[],r}catch(t){const r=t instanceof Error?t.message:"Failed to fetch interactions";return p("interactions",r),null}finally{u.interactions=!1}},Me=async e=>{try{const{data:a,error:t}=await g.from("organization_interactions").insert(e).select().single();if(t)throw new Error(t.message);return await se(e.organization_id),a}catch(a){const t=a instanceof Error?a.message:"Failed to create interaction";return p("interactions",t),null}},ie=async e=>{var a;try{u.documents=!0,_("documents");const t=e||((a=y.value)==null?void 0:a.id);if(!t)throw new Error("No organization ID provided");const{data:r,error:i}=await g.from("organization_documents").select("*").eq("organization_id",t).order("created_at",{ascending:!1});if(i)throw new Error(i.message);return K.value=r||[],r}catch(t){const r=t instanceof Error?t.message:"Failed to fetch documents";return p("documents",r),null}finally{u.documents=!1}};return{organizations:s,currentOrganization:y,analyticsData:j,performanceData:T,leadScoringData:G,dashboardMetrics:v,interactions:W,documents:K,searchQuery:R,appliedFilters:o,sortConfig:x,pagination:d,lastRefreshed:M,loading:u,isLoading:ge,errors:D,hasErrors:me,currentError:fe,hasOrganizations:ue,totalOrganizations:de,organizationStats:he,topPerformingOrganizations:ve,organizationsByStatus:pe,recentOrganizations:_e,priorityOptions:be,foodBeverageSegments:ye,distributorOrganizations:we,principalOrganizations:ze,fetchOrganizations:w,fetchOrganization:Y,createOrganization:Ie,createOrganizationWithContacts:Ee,createOrganizationWithEnhancedForm:De,updateOrganization:Q,updateOrganizationWithContacts:Ce,deleteOrganization:ne,searchOrganizations:Fe,clearSearch:Pe,applyFilters:Re,clearFilters:Ue,setSorting:qe,setPage:J,nextPage:Le,previousPage:Be,fetchDashboardMetrics:re,fetchAnalytics:oe,fetchPerformanceData:ke,fetchLeadScoringData:Ae,fetchInteractions:se,createInteraction:Me,fetchDocuments:ie,createDocument:async e=>{try{const{data:a,error:t}=await g.from("organization_documents").insert(e).select().single();if(t)throw new Error(t.message);return await ie(e.organization_id),a}catch(a){const t=a instanceof Error?a.message:"Failed to create document";return p("documents",t),null}},performBulkOperation:async e=>{var a,t;try{u.bulkOperations=!0,_("bulkOperations");let r=0,i=0;const m=[];for(const l of e.organizationIds)try{switch(e.type){case"update_status":(a=e.data)!=null&&a.status&&(await Q(l,{status:e.data.status}),r++);break;case"delete":await ne(l),r++;break;case"add_tags":(t=e.data)!=null&&t.tags&&s.value.find(h=>h.id===l)&&(await Q(l,{tags:e.data.tags}),r++);break;default:throw new Error(`Unsupported bulk operation: ${e.type}`)}}catch(b){i++,m.push({id:l,error:b instanceof Error?b.message:"Unknown error"})}return{operation:e,success:i===0,total:e.organizationIds.length,successful:r,failed:i,errors:m}}catch(r){const i=r instanceof Error?r.message:"Failed to perform bulk operation";return p("bulkOperations",i),{operation:e,success:!1,total:e.organizationIds.length,successful:0,failed:e.organizationIds.length,errors:e.organizationIds.map(m=>({id:m,error:i}))}}finally{u.bulkOperations=!1}},getOrganizationById:e=>s.value.find(a=>a.id===e),organizationExists:e=>s.value.some(a=>a.id===e),refreshAllData:async()=>{S(),await Promise.all([w({resetList:!0}),re(),oe()]),M.value=new Date},resetStore:()=>{s.value=[],y.value=null,j.value=[],T.value=[],G.value=[],v.value=null,W.value=[],K.value=[],R.value="",o.value={},x.value={field:"name",order:"asc"},d.value={page:1,limit:20,total:0,totalPages:0,hasNext:!1,hasPrevious:!1},Object.keys(u).forEach(e=>{u[e]=!1}),ee(),S(),M.value=null},clearErrors:ee,clearError:_,clearCache:S,convertPriorityLetterToScore:xe,convertScoreToPriorityLetter:Se,getAutoStatus:te,createContactRelationships:ae}});export{We as o,nt as u};
//# sourceMappingURL=organizationStore-CCNIEwvT.js.map
