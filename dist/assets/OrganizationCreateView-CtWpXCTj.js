import{d as G,r as E,j as B,o as W,a as de,B as se,c as u,b as e,e as x,k as j,t as y,n as P,F as Y,l as ee,i,f as I,s as oe,w as ae,h as ge,p as fe,E as be,z as le,G as ye,x as me,y as ie,g as he,A as ue}from"./index-CmEEd-r9.js";import{o as pe,u as xe}from"./organizationStore-CO45XK51.js";import{_ as ce}from"./Button.vue_vue_type_script_setup_true_lang-oXDYoq0e.js";import{_ as O,a as re}from"./SelectField.vue_vue_type_script_setup_true_lang-CSEe2URD.js";import{u as ve}from"./contactStore-C1BCHQej.js";import{r as we}from"./ChevronRightIcon-DTx_03hq.js";import{r as ke}from"./XMarkIcon-DGitNaOw.js";import"./supabaseClient-CpZNRF9L.js";import"./index.esm-BaJX624_.js";import"./contactsApi-xddaDT_l.js";const _e={class:"space-y-1"},Ce=["for"],$e={key:0,class:"text-danger ml-1","aria-label":"required"},Ve=["id"],Se={class:"relative"},ze=["id","name","placeholder","disabled","required","value","aria-describedby","aria-invalid","aria-required","aria-expanded","aria-owns"],Be=["disabled"],Me={key:0,class:"absolute inset-y-0 right-8 flex items-center pr-3","aria-hidden":"true"},De=["id","aria-label"],Ie={key:0,class:"px-3 py-2 text-sm text-gray-500",role:"option","aria-selected":"false"},Ne=["aria-selected","onClick","onMouseenter"],Ae={class:"flex items-center justify-between"},Ee={key:0,class:"h-4 w-4 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Fe={key:0,class:"text-xs text-gray-500 mt-1"},Pe={key:1,class:"border-t border-gray-200"},je={class:"flex items-center"},Le={key:2,class:"border-t border-gray-200"},Oe=["aria-selected","onClick"],Te={class:"flex items-center justify-between"},Re={class:"text-xs text-gray-400"},Ue=["id"],qe=["id"],He=G({__name:"SegmentSelector",props:{name:{},label:{},modelValue:{},options:{default:()=>[]},error:{},placeholder:{default:"Select or type a segment..."},description:{},helpText:{},required:{type:Boolean},disabled:{type:Boolean},loading:{type:Boolean},allowAddNew:{type:Boolean,default:!0},popularSegments:{default:()=>[]},minSearchLength:{default:1},inputClass:{},labelClass:{}},emits:["update:modelValue","add-new","search","focus","blur","validate"],setup(L,{emit:F}){const a=L,C=F,w=E(),d=E(!1),n=E(""),l=E(-1),t=E(!1),s=[{value:"Technology",label:"Technology",description:"Software, hardware, and tech services"},{value:"Healthcare",label:"Healthcare",description:"Medical, pharmaceutical, and health services"},{value:"Finance",label:"Finance",description:"Banking, insurance, and financial services"},{value:"Manufacturing",label:"Manufacturing",description:"Production and industrial companies"},{value:"Retail",label:"Retail",description:"Consumer goods and retail services"},{value:"Education",label:"Education",description:"Schools, universities, and educational services"},{value:"Real Estate",label:"Real Estate",description:"Property development and real estate services"},{value:"Energy",label:"Energy",description:"Oil, gas, renewable energy, and utilities"},{value:"Transportation",label:"Transportation",description:"Logistics, shipping, and transportation"},{value:"Media",label:"Media",description:"Publishing, broadcasting, and entertainment"},{value:"Agriculture",label:"Agriculture",description:"Farming, food production, and agribusiness"},{value:"Construction",label:"Construction",description:"Building and construction services"},{value:"Consulting",label:"Consulting",description:"Business and professional consulting"},{value:"Government",label:"Government",description:"Public sector and government agencies"},{value:"Non-Profit",label:"Non-Profit",description:"Charitable organizations and NGOs"}],p=B(()=>`segment-${a.name}`),D=B(()=>`segment-dropdown-${a.name}`),$=B(()=>`error-${a.name}`),z=B(()=>`desc-${a.name}`),h=B(()=>`help-${a.name}`),V=B(()=>!!a.error),S=B(()=>{const o=[];return a.description&&o.push(z.value),a.error&&o.push($.value),a.helpText&&!a.error&&o.push(h.value),o.length>0?o.join(" "):void 0}),_=B(()=>{const r=[...a.options||[]];return s.forEach(g=>{r.some(M=>M.value.toLowerCase()===g.value.toLowerCase())||r.push(g)}),r.sort((g,M)=>g.label.localeCompare(M.label))}),q=B(()=>d.value&&n.value!==""?n.value:a.modelValue||""),A=B(()=>{if(!n.value||n.value.length<a.minSearchLength)return _.value.slice(0,10);const o=n.value.toLowerCase();return _.value.filter(r=>{var g;return r.label.toLowerCase().includes(o)||((g=r.description)==null?void 0:g.toLowerCase().includes(o))}).slice(0,20)}),b=B(()=>!a.allowAddNew||!n.value||n.value.length<a.minSearchLength?!1:!_.value.some(r=>r.label.toLowerCase()===n.value.toLowerCase())),f=B(()=>!n.value&&a.popularSegments.length>0),k=B(()=>{const o="block text-sm font-medium transition-colors duration-200",r=V.value?"text-red-700":t.value?"text-primary-600":"text-gray-700",g=a.disabled?"opacity-60":"",M=a.labelClass||"";return`${o} ${r} ${g} ${M}`.trim()}),T=B(()=>{const o="w-full px-3 py-2 pr-10 border rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:border-transparent",r=V.value?"border-red-500 bg-red-50 focus:ring-red-500 focus:bg-white":t.value?"border-primary-500 bg-white focus:ring-primary-500":"border-gray-300 bg-white hover:border-gray-400 focus:ring-primary-500",g=a.disabled?"bg-gray-100 text-gray-500 cursor-not-allowed":"cursor-text",M=a.loading?"pr-16":"",K=a.inputClass||"";return`${o} ${r} ${g} ${M} ${K}`.trim()}),J=B(()=>["absolute z-50 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg","max-h-60 overflow-auto focus:outline-none"].join(" ")),R=o=>{const r=o.target;n.value=r.value,!d.value&&r.value.length>=a.minSearchLength&&v(),l.value=-1,r.value.length>=a.minSearchLength&&C("search",r.value)},Q=o=>{t.value=!0,C("focus",o),n.value=a.modelValue||"",setTimeout(()=>{v()},100)},Z=o=>{setTimeout(()=>{if(t.value=!1,N(),n.value&&!a.modelValue){const r=_.value.find(g=>g.label.toLowerCase()===n.value.toLowerCase());r?U(r):a.allowAddNew&&H()}n.value="",C("blur",o),C("validate",a.modelValue)},200)},m=o=>{var r;switch(o.key){case"ArrowDown":if(o.preventDefault(),!d.value)v();else{const g=b.value?A.value.length:A.value.length-1;l.value=Math.min(l.value+1,g)}break;case"ArrowUp":o.preventDefault(),l.value=Math.max(l.value-1,-1);break;case"Enter":o.preventDefault(),d.value&&(l.value===A.value.length&&b.value?H():l.value>=0&&l.value<A.value.length&&U(A.value[l.value]));break;case"Escape":o.preventDefault(),N(),(r=w.value)==null||r.blur();break;case"Tab":N();break}},c=()=>{var o;d.value?N():(v(),(o=w.value)==null||o.focus())},v=()=>{a.disabled||(d.value=!0,l.value=-1)},N=()=>{d.value=!1,l.value=-1},U=o=>{var r;C("update:modelValue",o.value),n.value="",N(),(r=w.value)==null||r.blur()},H=()=>{var o;if(n.value.trim()){const r=n.value.trim();C("add-new",r),C("update:modelValue",r),n.value="",N(),(o=w.value)==null||o.blur()}},te=o=>{const r=o.target,g=document.getElementById(D.value),M=w.value;g&&M&&!g.contains(r)&&!M.contains(r)&&N()};return W(()=>{document.addEventListener("click",te)}),de(()=>{document.removeEventListener("click",te)}),se(()=>a.modelValue,o=>{t.value||(n.value=o||"")}),(o,r)=>(i(),u("div",_e,[e("label",{for:p.value,class:P(k.value)},[j(y(o.label)+" ",1),o.required?(i(),u("span",$e,"*")):x("",!0)],10,Ce),o.description?(i(),u("p",{key:0,id:z.value,class:"text-sm text-gray-600"},y(o.description),9,Ve)):x("",!0),e("div",Se,[e("input",{id:p.value,ref_key:"inputRef",ref:w,name:o.name,type:"text",placeholder:o.placeholder,disabled:o.disabled,required:o.required,value:q.value,"aria-describedby":S.value,"aria-invalid":V.value,"aria-required":o.required,"aria-expanded":d.value,"aria-haspopup":!0,"aria-owns":D.value,class:P(T.value),autocomplete:"off",onInput:R,onFocus:Q,onBlur:Z,onKeydown:m},null,42,ze),e("button",{type:"button",disabled:o.disabled,class:"absolute inset-y-0 right-0 flex items-center pr-2","aria-label":"Toggle dropdown",onClick:c},[(i(),u("svg",{class:P(["h-4 w-4 transition-transform duration-200",d.value?"rotate-180":"",V.value?"text-red-500":"text-gray-400"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},r[1]||(r[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))],8,Be),o.loading?(i(),u("div",Me,r[2]||(r[2]=[e("svg",{class:"h-4 w-4 animate-spin text-gray-400",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):x("",!0),d.value?(i(),u("div",{key:1,id:D.value,class:P(J.value),role:"listbox","aria-label":`${o.label} options`},[A.value.length===0&&!b.value?(i(),u("div",Ie," No segments found ")):x("",!0),(i(!0),u(Y,null,ee(A.value,(g,M)=>(i(),u("button",{key:g.value,type:"button",class:P(["w-full text-left px-3 py-2 text-sm hover:bg-gray-100 focus:bg-gray-100 focus:outline-none",M===l.value?"bg-primary-50 text-primary-900":"text-gray-900"]),role:"option","aria-selected":g.value===o.modelValue,onClick:K=>U(g),onMouseenter:K=>l.value=M},[e("div",Ae,[e("span",null,y(g.label),1),g.value===o.modelValue?(i(),u("svg",Ee,r[3]||(r[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):x("",!0)]),g.description?(i(),u("p",Fe,y(g.description),1)):x("",!0)],42,Ne))),128)),b.value?(i(),u("div",Pe,[e("button",{type:"button",class:P(["w-full text-left px-3 py-2 text-sm hover:bg-blue-50 focus:bg-blue-50 focus:outline-none",l.value===A.value.length?"bg-blue-50 text-blue-900":"text-blue-700"]),role:"option","aria-selected":"false",onClick:H,onMouseenter:r[0]||(r[0]=g=>l.value=A.value.length)},[e("div",je,[r[4]||(r[4]=e("svg",{class:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1)),j(' Add new segment: "'+y(n.value)+'" ',1)])],34)])):x("",!0),f.value&&o.popularSegments.length>0?(i(),u("div",Le,[r[5]||(r[5]=e("div",{class:"px-3 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wide"}," Popular Segments ",-1)),(i(!0),u(Y,null,ee(o.popularSegments,g=>(i(),u("button",{key:`popular-${g.value}`,type:"button",class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 focus:bg-gray-100 focus:outline-none",role:"option","aria-selected":g.value===o.modelValue,onClick:M=>U(g)},[e("div",Te,[e("span",null,y(g.label),1),e("span",Re,y(g.count)+" orgs",1)])],8,Oe))),128))])):x("",!0)],10,De)):x("",!0)]),o.error?(i(),u("p",{key:1,id:$.value,role:"alert",class:"text-sm text-danger flex items-center space-x-1"},[r[6]||(r[6]=e("svg",{class:"h-4 w-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,y(o.error),1)],8,Ue)):x("",!0),o.helpText&&!o.error?(i(),u("p",{key:2,id:h.value,class:"text-sm text-gray-500"},y(o.helpText),9,qe)):x("",!0)]))}}),We={class:"space-y-6"},Ke={class:"space-y-4"},Ge={class:"space-y-3"},Je={class:"flex items-center"},Qe=["checked"],Ze={class:"flex items-center"},Xe=["checked"],Ye=G({__name:"OrganizationStepOne",props:{modelValue:{},errors:{},loading:{type:Boolean,default:!1}},emits:["update:modelValue","validate"],setup(L,{emit:F}){const a=L,C=F,w=[{value:90,label:"A",description:"Highest priority - Strategic accounts and major opportunities"},{value:70,label:"B",description:"High priority - Important prospects and qualified leads"},{value:50,label:"C",description:"Medium priority - Regular prospects and opportunities"},{value:30,label:"D",description:"Low priority - New prospects and informational contacts"}],d=[{value:"Prospect",label:"Prospect",description:"Potential customer or client"},{value:"Active",label:"Active",description:"Currently engaged organization"},{value:"Customer",label:"Customer",description:"Paying customer or client"},{value:"Partner",label:"Partner",description:"Business partner or alliance"},{value:"Vendor",label:"Vendor",description:"Service or product provider"},{value:"Inactive",label:"Inactive",description:"No longer active relationship"}],n=[{value:"Food & Beverage - Manufacturing",label:"Food & Beverage - Manufacturing",description:"Food and beverage production companies"},{value:"Food & Beverage - Distribution",label:"Food & Beverage - Distribution",description:"Food and beverage distribution companies"},{value:"Food & Beverage - Retail",label:"Food & Beverage - Retail",description:"Food and beverage retail outlets"},{value:"Food & Beverage - Restaurant",label:"Food & Beverage - Restaurant",description:"Restaurants and food service establishments"},{value:"Technology",label:"Technology",description:"Software, hardware, and tech services"},{value:"Healthcare",label:"Healthcare",description:"Medical and health services"},{value:"Finance",label:"Finance",description:"Banking and financial services"},{value:"Manufacturing",label:"Manufacturing",description:"Production and industrial"},{value:"Retail",label:"Retail",description:"Consumer goods and services"},{value:"Professional Services",label:"Professional Services",description:"Consulting and professional services"}],l=[{value:"Food & Beverage - Manufacturing",label:"Food & Beverage - Manufacturing",count:312},{value:"Food & Beverage - Distribution",label:"Food & Beverage - Distribution",count:287},{value:"Food & Beverage - Restaurant",label:"Food & Beverage - Restaurant",count:245},{value:"Technology",label:"Technology",count:189},{value:"Manufacturing",label:"Manufacturing",count:156}],t=[{value:"dist-1",label:"ABC Distribution Corp",description:"National food distributor"},{value:"dist-2",label:"XYZ Supply Chain",description:"Regional beverage distributor"},{value:"dist-3",label:"Global Foods Distribution",description:"International food distributor"}],s=[{value:"am-1",label:"John Smith",description:"Senior Account Manager"},{value:"am-2",label:"Sarah Johnson",description:"Account Manager - Food & Beverage"},{value:"am-3",label:"Mike Davis",description:"Regional Account Manager"}],p=B(()=>{const b=a.modelValue.lead_score;return b==null?"":b>=90?90:b>=70?70:b>=50?50:30}),D=B(()=>a.modelValue.is_principal===!0),$=B(()=>a.modelValue.is_distributor===!0),z=(b,f)=>{const k={...a.modelValue,[b]:f};C("update:modelValue",k)},h=b=>{const f=Array.isArray(b)?b[0]:b,k=typeof f=="string"?parseInt(f):f;z("lead_score",k)},V=(b,f)=>{b==="principal"?f?(z("is_principal",!0),z("is_distributor",!1),z("distributor_id","")):z("is_principal",!1):b==="distributor"&&(f?(z("is_distributor",!0),z("is_principal",!1),z("distributor_id","")):z("is_distributor",!1))},S=async(b,f)=>{await _()},_=async()=>{const b={};let f=!0;try{const k={name:a.modelValue.name,industry:a.modelValue.industry,lead_score:a.modelValue.lead_score,status:a.modelValue.status,is_principal:a.modelValue.is_principal,is_distributor:a.modelValue.is_distributor,distributor_id:a.modelValue.distributor_id,account_manager_id:a.modelValue.account_manager_id};await pe.pick(["name","industry","lead_score","status"]).validate(k,{abortEarly:!1})}catch(k){f=!1,k.inner&&k.inner.forEach(T=>{if(T.path){const J=T.path==="industry"?"segment":T.path==="lead_score"?"priority":T.path;b[J]=T.message}})}C("validate",1,f,b)},q=b=>{z("industry",b)},A=b=>{};return se(()=>[a.modelValue.name,a.modelValue.industry,a.modelValue.lead_score,a.modelValue.status,a.modelValue.is_principal,a.modelValue.is_distributor,a.modelValue.distributor_id,a.modelValue.account_manager_id],async()=>{await _()},{immediate:!0}),W(async()=>{await _()}),(b,f)=>(i(),u("div",We,[I(O,{name:"name",label:"Organization Name",type:"text","model-value":b.modelValue.name||"",error:b.errors.name,placeholder:"Enter the organization name",required:"",autocomplete:"organization","onUpdate:modelValue":f[0]||(f[0]=k=>z("name",k)),onValidate:f[1]||(f[1]=k=>S())},null,8,["model-value","error"]),I(re,{name:"priority",label:"Priority","model-value":p.value,options:w,error:b.errors.priority||b.errors.lead_score,placeholder:"Select organization priority",required:"","onUpdate:modelValue":h,onValidate:f[2]||(f[2]=k=>S())},null,8,["model-value","error"]),I(He,{name:"segment",label:"Segment","model-value":b.modelValue.industry||"",error:b.errors.segment||b.errors.industry,options:n,"popular-segments":l,placeholder:"Select or type an industry segment...",required:"","allow-add-new":"","onUpdate:modelValue":f[3]||(f[3]=k=>z("industry",k)),onAddNew:q,onSearch:A,onValidate:f[4]||(f[4]=k=>S())},null,8,["model-value","error"]),e("div",Ke,[f[15]||(f[15]=e("label",{class:"block text-sm font-medium text-gray-700"}," Business Type ",-1)),e("div",Ge,[e("div",Je,[e("input",{id:"principal",name:"business-type",type:"checkbox",checked:D.value,onChange:f[5]||(f[5]=k=>V("principal",k.target.checked)),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,40,Qe),f[13]||(f[13]=e("label",{for:"principal",class:"ml-2 block text-sm text-gray-900"}," Principal ",-1))]),e("div",Ze,[e("input",{id:"distributor",name:"business-type",type:"checkbox",checked:$.value,onChange:f[6]||(f[6]=k=>V("distributor",k.target.checked)),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,40,Xe),f[14]||(f[14]=e("label",{for:"distributor",class:"ml-2 block text-sm text-gray-900"}," Distributor ",-1))])])]),$.value?x("",!0):(i(),oe(re,{key:0,name:"distributor_id",label:"Distributor","model-value":b.modelValue.distributor_id||"",options:t,error:b.errors.distributor_id,placeholder:"Select a distributor","onUpdate:modelValue":f[7]||(f[7]=k=>z("distributor_id",k)),onValidate:f[8]||(f[8]=k=>S())},null,8,["model-value","error"])),I(re,{name:"account_manager_id",label:"Account Manager","model-value":b.modelValue.account_manager_id||"",options:s,error:b.errors.account_manager_id,placeholder:"Select an account manager","onUpdate:modelValue":f[9]||(f[9]=k=>z("account_manager_id",k)),onValidate:f[10]||(f[10]=k=>S())},null,8,["model-value","error"]),I(re,{name:"status",label:"Organization Status","model-value":b.modelValue.status||"Prospect",options:d,error:b.errors.status,placeholder:"Select organization status","onUpdate:modelValue":f[11]||(f[11]=k=>z("status",k)),onValidate:f[12]||(f[12]=k=>S())},null,8,["model-value","error"])]))}}),et={class:"space-y-6"},tt={class:"space-y-4"},ot={class:"space-y-4"},at={class:"space-y-2"},st=["value"],rt={key:0,class:"text-sm text-red-600"},nt=G({__name:"OrganizationStepTwo",props:{modelValue:{},errors:{},loading:{type:Boolean,default:!1}},emits:["update:modelValue","validate"],setup(L,{emit:F}){const a=L,C=F,w=(l,t)=>{const s={...a.modelValue,[l]:t};C("update:modelValue",s)},d=(l,t)=>{n()},n=()=>{C("validate",2,!0,{})};return se(()=>[a.modelValue.address_line_1,a.modelValue.address_line_2,a.modelValue.city,a.modelValue.state_province,a.modelValue.postal_code,a.modelValue.primary_phone,a.modelValue.description],()=>{n()},{immediate:!0}),W(()=>{n()}),(l,t)=>(i(),u("div",et,[e("div",tt,[t[14]||(t[14]=e("div",null,[e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Address Information"),e("p",{class:"text-sm text-gray-600 mb-4"}," Provide the organization's address and contact details ")],-1)),I(O,{name:"address_line_1",label:"Address Line 1",type:"text","model-value":l.modelValue.address_line_1||"",error:l.errors.address_line_1,placeholder:"Enter street address","onUpdate:modelValue":t[0]||(t[0]=s=>w("address_line_1",s)),onValidate:t[1]||(t[1]=s=>d())},null,8,["model-value","error"]),I(O,{name:"address_line_2",label:"Address Line 2",type:"text","model-value":l.modelValue.address_line_2||"",error:l.errors.address_line_2,placeholder:"Apt, suite, unit, etc. (optional)","onUpdate:modelValue":t[2]||(t[2]=s=>w("address_line_2",s)),onValidate:t[3]||(t[3]=s=>d())},null,8,["model-value","error"]),I(O,{name:"city",label:"City",type:"text","model-value":l.modelValue.city||"",error:l.errors.city,placeholder:"Enter city","onUpdate:modelValue":t[4]||(t[4]=s=>w("city",s)),onValidate:t[5]||(t[5]=s=>d())},null,8,["model-value","error"]),I(O,{name:"state_province",label:"State",type:"text","model-value":l.modelValue.state_province||"",error:l.errors.state_province,placeholder:"Enter state","onUpdate:modelValue":t[6]||(t[6]=s=>w("state_province",s)),onValidate:t[7]||(t[7]=s=>d())},null,8,["model-value","error"]),I(O,{name:"postal_code",label:"Zip Code",type:"text","model-value":l.modelValue.postal_code||"",error:l.errors.postal_code,placeholder:"Enter zip code","onUpdate:modelValue":t[8]||(t[8]=s=>w("postal_code",s)),onValidate:t[9]||(t[9]=s=>d())},null,8,["model-value","error"]),I(O,{name:"primary_phone",label:"Office Phone",type:"tel","model-value":l.modelValue.primary_phone||"",error:l.errors.primary_phone,placeholder:"Enter office phone number","onUpdate:modelValue":t[10]||(t[10]=s=>w("primary_phone",s)),onValidate:t[11]||(t[11]=s=>d())},null,8,["model-value","error"])]),e("div",ot,[t[16]||(t[16]=e("div",null,[e("h4",{class:"text-md font-medium text-gray-900 mb-2"},"Notes & Description"),e("p",{class:"text-sm text-gray-600"}," Additional information about the organization ")],-1)),e("div",at,[t[15]||(t[15]=e("label",{for:"description",class:"block text-sm font-medium text-gray-700"}," Notes & Description ",-1)),e("textarea",{id:"description",name:"description",rows:"4",value:l.modelValue.description||"",class:P(["w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2",l.errors.description?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-blue-500"]),placeholder:"Enter any additional notes or description about the organization...",onInput:t[12]||(t[12]=s=>w("description",s.target.value)),onBlur:t[13]||(t[13]=s=>d("description",s.target.value))},null,42,st),l.errors.description?(i(),u("p",rt,y(l.errors.description),1)):x("",!0)])])]))}}),lt={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},it={class:"flex items-center justify-between mb-4"},dt={class:"flex items-center space-x-3"},ut={class:"text-md font-medium text-gray-900"},ct={key:1,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},mt=["aria-label"],pt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},vt={key:0,class:"mt-4 p-3 bg-white border border-gray-200 rounded-md"},gt={class:"flex items-start space-x-3"},ft={class:"flex-1 min-w-0"},bt={class:"text-sm font-medium text-gray-900"},yt={key:0,class:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800"},ht={class:"text-sm text-gray-500"},xt={key:0,class:"text-xs text-gray-400"},wt={key:0},kt={key:1,class:"text-xs text-gray-400"},_t={key:1,class:"mt-3"},Ct={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},$t={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},Vt=G({__name:"QuickContactForm",props:{modelValue:{},errors:{},contactNumber:{},showRemove:{type:Boolean,default:!0},isPrimary:{type:Boolean,default:!1},showSetPrimary:{type:Boolean,default:!0}},emits:["update:modelValue","remove","set-primary"],setup(L,{emit:F}){const a=L,C=F,w=B(()=>{var t,s,p;return((t=a.modelValue.first_name)==null?void 0:t.trim())&&((s=a.modelValue.last_name)==null?void 0:s.trim())&&((p=a.modelValue.email)==null?void 0:p.trim())}),d=B(()=>{const t=Object.keys(a.errors).length,s=["first_name","last_name","email"],p=s.filter(D=>{var $;return($=a.modelValue[D])==null?void 0:$.trim()}).length;return t>0?{isValid:!1,message:`${t} validation error${t>1?"s":""} found`}:p===s.length?{isValid:!0,message:"Contact information is complete"}:{isValid:!1,message:`${s.length-p} required field${s.length-p>1?"s":""} remaining`}}),n=(t,s)=>{var $;const p=Array.isArray(s)?(($=s[0])==null?void 0:$.toString())||"":(s==null?void 0:s.toString())||"",D={...a.modelValue,[t]:p};C("update:modelValue",D)},l=t=>{console.debug(`Validating field: ${t}`)};return(t,s)=>(i(),u("div",lt,[e("div",it,[e("div",dt,[e("h4",ut," Contact "+y(t.contactNumber),1),!t.isPrimary&&t.showSetPrimary?(i(),u("button",{key:0,type:"button",onClick:s[0]||(s[0]=p=>t.$emit("set-primary")),class:"inline-flex items-center px-2 py-1 text-xs font-medium rounded border border-gray-300 text-gray-700 bg-white hover:bg-blue-50 hover:text-blue-700 hover:border-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors"}," Set as Primary ")):t.isPrimary?(i(),u("span",ct,s[12]||(s[12]=[e("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),j(" Primary Contact ",-1)]))):x("",!0)]),t.showRemove?(i(),u("button",{key:0,type:"button",onClick:s[1]||(s[1]=p=>t.$emit("remove")),class:"text-red-600 hover:text-red-800 transition-colors","aria-label":`Remove contact ${t.contactNumber}`},s[13]||(s[13]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,mt)):x("",!0)]),e("div",pt,[I(O,{name:`contact_${t.contactNumber}_first_name`,label:"First Name",type:"text","model-value":t.modelValue.first_name,error:t.errors.first_name,placeholder:"Enter first name",required:"","onUpdate:modelValue":s[2]||(s[2]=p=>n("first_name",p)),onBlur:s[3]||(s[3]=p=>l("first_name"))},null,8,["name","model-value","error"]),I(O,{name:`contact_${t.contactNumber}_last_name`,label:"Last Name",type:"text","model-value":t.modelValue.last_name,error:t.errors.last_name,placeholder:"Enter last name",required:"","onUpdate:modelValue":s[4]||(s[4]=p=>n("last_name",p)),onBlur:s[5]||(s[5]=p=>l("last_name"))},null,8,["name","model-value","error"]),I(O,{name:`contact_${t.contactNumber}_email`,label:"Email Address",type:"email","model-value":t.modelValue.email,error:t.errors.email,placeholder:"Enter email address",required:"",autocomplete:"email","onUpdate:modelValue":s[6]||(s[6]=p=>n("email",p)),onBlur:s[7]||(s[7]=p=>l("email"))},null,8,["name","model-value","error"]),I(O,{name:`contact_${t.contactNumber}_phone`,label:"Phone Number",type:"tel","model-value":t.modelValue.phone,error:t.errors.phone,placeholder:"Enter phone number",autocomplete:"tel","onUpdate:modelValue":s[8]||(s[8]=p=>n("phone",p)),onBlur:s[9]||(s[9]=p=>l("phone"))},null,8,["name","model-value","error"]),I(O,{name:`contact_${t.contactNumber}_position`,label:"Job Title",type:"text","model-value":t.modelValue.position,error:t.errors.position,placeholder:"Enter job title",autocomplete:"organization","onUpdate:modelValue":s[10]||(s[10]=p=>n("position",p))},null,8,["name","model-value","error"]),I(O,{name:`contact_${t.contactNumber}_department`,label:"Department",type:"text","model-value":t.modelValue.department,error:t.errors.department,placeholder:"Enter department","onUpdate:modelValue":s[11]||(s[11]=p=>n("department",p))},null,8,["name","model-value","error"])]),w.value?(i(),u("div",vt,[e("div",gt,[s[14]||(s[14]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})])])],-1)),e("div",ft,[e("p",bt,[j(y(t.modelValue.first_name)+" "+y(t.modelValue.last_name)+" ",1),t.isPrimary?(i(),u("span",yt," Primary ")):x("",!0)]),e("p",ht,y(t.modelValue.email),1),t.modelValue.position?(i(),u("p",xt,[j(y(t.modelValue.position)+" ",1),t.modelValue.department?(i(),u("span",wt," • "+y(t.modelValue.department),1)):x("",!0)])):x("",!0),t.modelValue.phone?(i(),u("p",kt,y(t.modelValue.phone),1)):x("",!0)])])])):x("",!0),d.value?(i(),u("div",_t,[e("div",{class:P(["flex items-center text-xs px-2 py-1 rounded",d.value.isValid?"bg-green-50 text-green-700":"bg-red-50 text-red-700"])},[(i(),u("svg",{class:P(["w-4 h-4 mr-1",d.value.isValid?"text-green-400":"text-red-400"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d.value.isValid?(i(),u("path",Ct)):(i(),u("path",$t))],2)),j(" "+y(d.value.message),1)],2)])):x("",!0)]))}}),St={class:"space-y-6"},zt={class:"flex items-center justify-center space-x-4"},Bt={key:0,class:"space-y-4"},Mt={class:"relative"},Dt={key:0,class:"space-y-2"},It={class:"flex items-center justify-between"},Nt={class:"text-xs text-gray-500"},At={class:"max-h-64 overflow-y-auto border border-gray-200 rounded-md bg-white"},Et={class:"flex items-center space-x-3"},Ft=["id","checked","onChange"],Pt={class:"flex-1"},jt=["for"],Lt={class:"text-xs text-gray-500"},Ot={key:0,class:"text-xs text-gray-400"},Tt={class:"flex items-center space-x-2"},Rt={key:0,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Ut=["onClick","disabled"],qt={key:1,class:"text-center py-8"},Ht={class:"mt-2 text-sm text-gray-500"},Wt={key:2,class:"text-center py-4"},Kt={key:3,class:"mt-6"},Gt={class:"flex items-center justify-between mb-3"},Jt={class:"text-sm font-medium text-gray-700"},Qt={class:"space-y-2"},Zt={class:"flex items-center space-x-3"},Xt={class:"flex-1"},Yt={class:"text-sm font-medium text-gray-900"},eo={key:0,class:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800"},to=["onClick","aria-label"],oo={key:1,class:"space-y-4"},ao={key:0,class:"space-y-6"},so={key:1,class:"text-center py-8"},ro={key:2,class:"p-3 bg-red-50 border border-red-200 rounded-md",role:"alert"},no={class:"flex items-start"},lo={class:"text-sm text-red-700"},io=G({__name:"ContactMultiSelector",props:{modelValue:{},error:{},loading:{type:Boolean,default:!1}},emits:["update:modelValue","validate"],setup(L,{emit:F}){const a=L,C=F,w=ve(),d=E(a.modelValue.mode||"select"),n=E(""),l=E(a.modelValue.selectedContactIds||[]),t=E(a.modelValue.newContacts||[]),s=E(a.modelValue.primaryContactIndex??-1),p=E({}),D=E(!1),$=B(()=>{if(!n.value)return w.contacts.slice(0,20);const m=n.value.toLowerCase();return w.contacts.filter(c=>{var v,N,U,H;return((v=c.first_name)==null?void 0:v.toLowerCase().includes(m))||((N=c.last_name)==null?void 0:N.toLowerCase().includes(m))||((U=c.email)==null?void 0:U.toLowerCase().includes(m))||((H=c.position)==null?void 0:H.toLowerCase().includes(m))}).slice(0,50)}),z=m=>{d.value=m,m==="select"?(t.value=[],s.value=-1,p.value={}):(l.value=[],n.value=""),R()},h=async m=>{if(n.value=m,m.length>=2){D.value=!0;try{await w.searchContacts(m)}finally{D.value=!1}}},V=(m,c)=>{c?l.value.includes(m)||(l.value.push(m),l.value.length===1&&q(m)):(l.value=l.value.filter(v=>v!==m),A()===m&&l.value.length>0&&q(l.value[0])),R()},S=m=>{l.value=l.value.filter(c=>c!==m),A()===m&&l.value.length>0&&q(l.value[0]),R()},_=()=>{l.value=[],R()},q=m=>{R({primaryContactId:m})},A=()=>a.modelValue.primaryContactId||l.value[0],b=m=>{const c=w.contacts.find(v=>v.id===m);return c?`${c.first_name} ${c.last_name}`:"Unknown Contact"},f=()=>{const m={tempId:`temp_${Date.now()}_${Math.random()}`,first_name:"",last_name:"",email:"",phone:"",position:"",department:""};t.value.push(m),t.value.length===1&&(s.value=0),R()},k=m=>{const c=t.value[m];t.value.splice(m,1),p.value[c.tempId]&&delete p.value[c.tempId],s.value===m?s.value=t.value.length>0?0:-1:s.value>m&&s.value--,R()},T=(m,c)=>{t.value[m]&&(t.value[m]={...c},p.value[c.tempId]&&(p.value[c.tempId]={}),R())},J=m=>{s.value=m,R()},R=(m={})=>{const c={mode:d.value,selectedContactIds:[...l.value],newContacts:[...t.value],primaryContactId:A(),primaryContactIndex:s.value,...m};C("update:modelValue",c);const v=Q();C("validate",v,{})},Q=()=>{let m=!0;return d.value==="select"?l.value.length===0&&(m=!1):d.value==="create"&&(t.value.length===0?m=!1:t.value.forEach(c=>{const v={};c.first_name.trim()||(v.first_name="First name is required",m=!1),c.last_name.trim()||(v.last_name="Last name is required",m=!1),c.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.email)||(v.email="Please enter a valid email address",m=!1):(v.email="Email is required",m=!1),Object.keys(v).length>0&&(p.value[c.tempId]=v)})),m},Z=()=>{d.value=a.modelValue.mode||"select",l.value=[...a.modelValue.selectedContactIds||[]],t.value=[...a.modelValue.newContacts||[]],s.value=a.modelValue.primaryContactIndex??-1};return se(()=>a.modelValue,Z,{deep:!0}),W(async()=>{await w.fetchContacts(),Z();const m=Q();C("validate",m,{})}),(m,c)=>(i(),u("div",St,[e("div",zt,[e("button",{type:"button",class:P(["px-4 py-2 rounded-md font-medium text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors",d.value==="select"?"bg-blue-100 text-blue-800 border border-blue-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"]),onClick:c[0]||(c[0]=v=>z("select"))},c[4]||(c[4]=[e("svg",{class:"w-4 h-4 mr-2 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1),j(" Select Existing Contacts ",-1)]),2),e("button",{type:"button",class:P(["px-4 py-2 rounded-md font-medium text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors",d.value==="create"?"bg-blue-100 text-blue-800 border border-blue-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"]),onClick:c[1]||(c[1]=v=>z("create"))},c[5]||(c[5]=[e("svg",{class:"w-4 h-4 mr-2 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),j(" Create New Contacts ",-1)]),2)]),d.value==="select"?(i(),u("div",Bt,[e("div",Mt,[I(O,{name:"contact_search",label:"Search Contacts",type:"text","model-value":n.value,placeholder:"Type to search for existing contacts...","onUpdate:modelValue":c[2]||(c[2]=v=>h(String(v)))},{icon:ae(()=>c[6]||(c[6]=[e("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)])),_:1},8,["model-value"])]),$.value.length>0?(i(),u("div",Dt,[e("div",It,[c[7]||(c[7]=e("h4",{class:"text-sm font-medium text-gray-700"},"Available Contacts",-1)),e("span",Nt,y($.value.length)+" found",1)]),e("div",At,[(i(!0),u(Y,null,ee($.value,v=>(i(),u("div",{key:v.id,class:"flex items-center justify-between p-3 hover:bg-gray-50 border-b border-gray-100 last:border-b-0 transition-colors"},[e("div",Et,[e("input",{id:`contact-${v.id}`,type:"checkbox",checked:l.value.includes(v.id),onChange:N=>V(v.id,N.target.checked),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,40,Ft),e("div",Pt,[e("label",{for:`contact-${v.id}`,class:"text-sm font-medium text-gray-900 cursor-pointer block"},y(v.first_name)+" "+y(v.last_name),9,jt),e("p",Lt,y(v.email),1),v.position?(i(),u("p",Ot,y(v.position),1)):x("",!0)])]),e("div",Tt,[A()===v.id?(i(),u("span",Rt," Primary ")):x("",!0),l.value.includes(v.id)?(i(),u("button",{key:1,type:"button",onClick:N=>q(v.id),class:P(["text-xs px-2 py-1 rounded border transition-colors",A()===v.id?"bg-blue-50 text-blue-600 border-blue-200 cursor-default":"bg-gray-50 text-gray-600 border-gray-200 hover:bg-blue-50 hover:text-blue-600"]),disabled:A()===v.id},y(A()===v.id?"Primary":"Set Primary"),11,Ut)):x("",!0)])]))),128))])])):n.value&&!D.value?(i(),u("div",qt,[c[8]||(c[8]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),e("p",Ht,'No contacts found matching "'+y(n.value)+'"',1),e("button",{type:"button",onClick:c[3]||(c[3]=v=>z("create")),class:"mt-2 text-sm text-blue-600 hover:text-blue-500"}," Create a new contact instead ")])):x("",!0),D.value?(i(),u("div",Wt,c[9]||(c[9]=[ge('<div class="inline-flex items-center"><svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-blue-600" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span class="text-sm text-gray-600">Searching contacts...</span></div>',1)]))):x("",!0),l.value.length>0?(i(),u("div",Kt,[e("div",Gt,[e("h4",Jt," Selected Contacts ("+y(l.value.length)+") ",1),e("button",{type:"button",onClick:_,class:"text-xs text-gray-500 hover:text-gray-700"}," Clear all ")]),e("div",Qt,[(i(!0),u(Y,null,ee(l.value,v=>(i(),u("div",{key:v,class:"flex items-center justify-between bg-blue-50 border border-blue-200 p-3 rounded-md"},[e("div",Zt,[e("div",Xt,[e("span",Yt,y(b(v)),1),A()===v?(i(),u("span",eo," Primary Contact ")):x("",!0)])]),e("button",{type:"button",onClick:N=>S(v),class:"text-red-600 hover:text-red-800 transition-colors","aria-label":`Remove ${b(v)}`},c[10]||(c[10]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,to)]))),128))])])):x("",!0)])):d.value==="create"?(i(),u("div",oo,[e("div",{class:"text-center"},[e("button",{type:"button",onClick:f,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"},c[11]||(c[11]=[e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),j(" Add New Contact ",-1)]))]),t.value.length>0?(i(),u("div",ao,[(i(!0),u(Y,null,ee(t.value,(v,N)=>(i(),oe(Vt,{key:v.tempId,"model-value":v,errors:p.value[v.tempId]||{},"contact-number":N+1,"show-remove":t.value.length>1,"is-primary":s.value===N,"onUpdate:modelValue":U=>T(N,U),onRemove:U=>k(N),onSetPrimary:U=>J(N)},null,8,["model-value","errors","contact-number","show-remove","is-primary","onUpdate:modelValue","onRemove","onSetPrimary"]))),128))])):(i(),u("div",so,c[12]||(c[12]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1),e("p",{class:"mt-2 text-sm text-gray-500"},"No contacts added yet",-1),e("p",{class:"text-xs text-gray-400"},'Click "Add New Contact" to get started',-1)])))])):x("",!0),m.error?(i(),u("div",ro,[e("div",no,[c[13]||(c[13]=e("svg",{class:"w-5 h-5 text-red-400 mr-2 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",lo,y(m.error),1)])])):x("",!0)]))}}),uo={class:"space-y-6"},co={class:"space-y-4"},mo={key:0,class:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-md"},po={class:"flex items-start"},vo={class:"flex-1"},go={class:"mt-2 text-sm text-blue-700"},fo={key:0},bo={key:1},yo={key:2,class:"mt-1"},ho=G({__name:"OrganizationStepThree",props:{modelValue:{},errors:{},loading:{type:Boolean,default:!1}},emits:["update:modelValue","validate"],setup(L,{emit:F}){const a=L,C=F,w=ve(),d=E({mode:"select",selectedContactIds:[],newContacts:[],primaryContactId:void 0,primaryContactIndex:-1}),n=E(""),l=E(!1),t=B(()=>d.value.mode==="select"?d.value.selectedContactIds.length>0:d.value.newContacts.length>0),s=B(()=>{if(d.value.mode==="select"&&d.value.primaryContactId){const h=w.contacts.find(V=>V.id===d.value.primaryContactId);return h?`${h.first_name} ${h.last_name}`:void 0}else if(d.value.mode==="create"&&d.value.primaryContactIndex!==void 0&&d.value.primaryContactIndex>=0){const h=d.value.newContacts[d.value.primaryContactIndex];return h?`${h.first_name} ${h.last_name}`:void 0}}),p=h=>{d.value={...h},$()},D=(h,V)=>{l.value=h,n.value=V.contacts||"",C("validate",3,h,V)},$=()=>{const h={...a.modelValue};h.custom_fields={...h.custom_fields,contact_mode:d.value.mode,selected_contact_ids:d.value.selectedContactIds,new_contacts:d.value.newContacts,primary_contact_id:d.value.primaryContactId,primary_contact_index:d.value.primaryContactIndex},C("update:modelValue",h)},z=()=>{const h=a.modelValue.custom_fields;h&&(d.value={mode:h.contact_mode||"select",selectedContactIds:h.selected_contact_ids||[],newContacts:h.new_contacts||[],primaryContactId:h.primary_contact_id,primaryContactIndex:h.primary_contact_index??-1})};return se(()=>a.modelValue.custom_fields,()=>{z()},{deep:!0}),W(async()=>{await w.fetchContacts(),z()}),(h,V)=>(i(),u("div",uo,[e("div",co,[V[3]||(V[3]=e("div",{class:"text-center"},[e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Contact Information"),e("p",{class:"text-sm text-gray-600 mb-6"}," Select existing contacts or create new contacts for this organization ")],-1)),I(io,{"model-value":d.value,error:n.value,loading:h.loading,"onUpdate:modelValue":p,onValidate:D},null,8,["model-value","error","loading"]),t.value?(i(),u("div",mo,[e("div",po,[V[2]||(V[2]=e("svg",{class:"w-5 h-5 text-blue-400 mr-3 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("div",vo,[V[1]||(V[1]=e("h4",{class:"text-sm font-medium text-blue-800"},"Contact Assignment",-1)),e("div",go,[d.value.mode==="select"?(i(),u("p",fo,y(d.value.selectedContactIds.length)+" existing contact"+y(d.value.selectedContactIds.length!==1?"s":"")+" will be linked to this organization. ",1)):(i(),u("p",bo,y(d.value.newContacts.length)+" new contact"+y(d.value.newContacts.length!==1?"s":"")+" will be created and linked to this organization. ",1)),s.value?(i(),u("p",yo,[e("strong",null,y(s.value),1),V[0]||(V[0]=j(" will be set as the primary contact. ",-1))])):x("",!0)])])])])):x("",!0)])]))}}),xo={"data-testid":"contact-status-warning",class:"bg-amber-50 border border-amber-200 rounded-md p-4",role:"alert","aria-labelledby":"contact-warning-title"},wo={class:"flex items-start"},ko={class:"ml-3 flex-1"},_o={class:"mt-2 text-sm text-amber-700"},Co={key:0},$o={key:1},Vo={class:"mt-4 flex flex-col sm:flex-row gap-3"},So={class:"mt-3 flex items-center"},zo=["id"],Bo=["for"],Mo=G({__name:"ContactStatusWarning",props:{organizationName:{},hideAddNowButton:{type:Boolean,default:!1},autoDismissAfter:{},customMessage:{},contactCount:{default:0}},emits:["add-contact-now","add-contact-later","dismiss","close"],setup(L,{expose:F,emit:a}){const C=L,w=a,d=E(!1),n=E(!0),l=B(()=>`dismiss-contact-warning-${Math.random().toString(36).substr(2,9)}`),t=()=>{w("add-contact-now"),D()},s=()=>{w("add-contact-later"),D()},p=()=>{if(d.value){try{sessionStorage.setItem("contact-warning-dismissed","true")}catch(S){console.warn("Failed to store dismissal preference:",S)}w("dismiss")}else try{sessionStorage.removeItem("contact-warning-dismissed")}catch(S){console.warn("Failed to remove dismissal preference:",S)}},D=()=>{n.value=!1,w("close")},$=()=>{try{return sessionStorage.getItem("contact-warning-dismissed")!=="true"}catch{return!0}},z=()=>{C.autoDismissAfter&&C.autoDismissAfter>0&&setTimeout(()=>{n.value&&!d.value&&D()},C.autoDismissAfter*1e3)};W(()=>{if(!$()){n.value=!1;return}z()});const h=()=>{const S=document.createElement("div");S.setAttribute("aria-live","polite"),S.setAttribute("aria-atomic","true"),S.className="sr-only",S.textContent=`Warning: ${C.organizationName||"This organization"} has no contacts. Consider adding contacts for better CRM functionality.`,document.body.appendChild(S),setTimeout(()=>{document.body.removeChild(S)},1e3)};W(()=>{n.value&&h()});const V=S=>{S.key==="Escape"&&D()};return W(()=>{document.addEventListener("keydown",V)}),de(()=>{document.removeEventListener("keydown",V)}),F({dismiss:D,isVisible:()=>n.value,isDismissed:()=>d.value}),(S,_)=>(i(),u("div",xo,[e("div",wo,[_[8]||(_[8]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",ko,[_[6]||(_[6]=e("h3",{id:"contact-warning-title",class:"text-sm font-medium text-amber-800"}," No Contacts Found ",-1)),e("div",_o,[S.organizationName?(i(),u("p",Co,[e("strong",null,y(S.organizationName),1),_[1]||(_[1]=j(" currently has no associated contacts. ",-1))])):(i(),u("p",$o," This organization currently has no associated contacts. ")),_[2]||(_[2]=e("p",{class:"mt-2"}," Consider adding contacts after creating the organization to: ",-1)),_[3]||(_[3]=e("ul",{class:"mt-2 list-disc list-inside space-y-1"},[e("li",null,"Track communication and interactions"),e("li",null,"Manage relationships with key decision makers"),e("li",null,"Improve lead scoring and follow-up activities"),e("li",null,"Enable comprehensive CRM functionality")],-1))]),e("div",Vo,[e("button",{type:"button",class:"inline-flex items-center px-3 py-2 border border-amber-300 shadow-sm text-sm leading-4 font-medium rounded-md text-amber-700 bg-amber-100 hover:bg-amber-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-colors duration-200",onClick:s},_[4]||(_[4]=[e("svg",{class:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),j(" I'll add contacts later ",-1)])),S.hideAddNowButton?x("",!0):(i(),u("button",{key:0,type:"button",class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-colors duration-200",onClick:t},_[5]||(_[5]=[e("svg",{class:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1),j(" Add contact now ",-1)])))]),e("div",So,[fe(e("input",{id:l.value,"onUpdate:modelValue":_[0]||(_[0]=q=>d.value=q),type:"checkbox",class:"h-4 w-4 text-amber-600 focus:ring-amber-500 border-amber-300 rounded",onChange:p},null,40,zo),[[be,d.value]]),e("label",{for:l.value,class:"ml-2 text-sm text-amber-700 cursor-pointer"}," Don't show this warning again for this session ",8,Bo)])]),e("div",{class:"ml-auto pl-3"},[e("div",{class:"-mx-1.5 -my-1.5"},[e("button",{type:"button",class:"inline-flex rounded-md p-1.5 text-amber-500 hover:bg-amber-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-amber-50 focus:ring-amber-600","aria-label":"Dismiss warning",onClick:D},_[7]||(_[7]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{d:"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"})],-1)]))])])])]))}}),Do={class:"max-w-4xl mx-auto"},Io={class:"mb-8"},No={"aria-label":"Progress"},Ao={role:"list",class:"flex items-center justify-center"},Eo={key:0,class:"absolute inset-0 flex items-center","aria-hidden":"true"},Fo={key:0,class:"h-5 w-5 text-white",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},Po={class:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 whitespace-nowrap"},jo={class:"mt-12 text-center"},Lo={class:"text-2xl font-bold text-gray-900"},Oo={class:"mt-2 text-gray-600"},To={key:0,class:"mb-4 flex items-center justify-center text-sm"},Ro={key:0,class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"},Uo={key:1,class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},qo={key:2,class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ho={key:1,class:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",role:"alert"},Wo={class:"flex items-start"},Ko={class:"mt-1 text-sm text-red-700"},Go={class:"bg-white shadow-sm rounded-lg border border-gray-200"},Jo={class:"p-6"},Qo={class:"px-6 py-4 bg-gray-50 border-t border-gray-200 rounded-b-lg"},Zo={class:"flex items-center justify-between"},Xo={key:1},Yo={key:0,class:"h-4 w-4 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ea={class:"mt-4 text-center text-sm text-gray-500"},ne=3,ta=G({__name:"OrganizationFormWrapper",props:{initialData:{},isEditing:{type:Boolean,default:!1},organizationId:{},showContactWarning:{type:Boolean,default:!0}},emits:["success","cancel","draft-saved"],setup(L,{emit:F}){const a=L,C=F,w=me(),d=xe(),n=E(1),l=E(!1),t=E(!1),s=E(""),p=E(null),D=le({1:!1,2:!0,3:!0}),$=le({name:"",industry:"",lead_score:null,type:null,status:"Prospect",address_line_1:"",city:"",state_province:"",postal_code:"",primary_phone:"",website:"",assigned_user_id:null,description:"",...a.initialData}),z=le({1:{},2:{},3:{}}),h=[{id:1,title:"Basic Info",description:"Enter organization name, priority, segment, and business type",component:"OrganizationStepOne",requiredFields:["name","industry","lead_score"]},{id:2,title:"Organization Info",description:"Add address, phone, and additional notes",component:"OrganizationStepTwo",requiredFields:[]},{id:3,title:"Contact Info",description:"Select existing contacts or create new contacts",component:"OrganizationStepThree",requiredFields:[]}],V=B(()=>h[n.value-1]),S=B(()=>({OrganizationStepOne:Ye,OrganizationStepTwo:nt,OrganizationStepThree:ho})[V.value.component]),_=B(()=>n.value===ne),q=B(()=>z[n.value]||{}),A=B(()=>D[n.value]),b=o=>o<n.value||o===n.value?"bg-primary-600":"bg-gray-200",f=o=>{Object.assign($,o),c()},k=async(o,r,g={})=>{D[o]=r,z[o]=g,r&&s.value&&(s.value="")},T=async()=>{t.value=!0;try{const o=V.value.requiredFields,r={};return o.forEach(g=>{r[g]=$[g]}),o.length>0&&await pe.pick(o).validate(r,{abortEarly:!1}),await k(n.value,!0,{}),!0}catch(o){const r={};return o.inner?o.inner.forEach(g=>{g.path&&(r[g.path]=g.message)}):r.general=o.message||"Validation failed",await k(n.value,!1,r),!1}finally{t.value=!1}},J=async()=>{n.value<ne&&await T()&&(n.value++,await ie(),H())},R=()=>{n.value>1&&(n.value--,ie(()=>{H()}))},Q=async()=>{_.value?await Z():await J()},Z=async()=>{var o;try{l.value=!0,s.value="";for(let X=1;X<=ne;X++)if(n.value=X,!await T()){s.value=`Please fix errors in Step ${X}`;return}const r=$.custom_fields,g={mode:(r==null?void 0:r.contact_mode)||"select",selectedContactIds:(r==null?void 0:r.selected_contact_ids)||[],newContacts:(r==null?void 0:r.new_contacts)||[]},M={...$,name:$.name||"",industry:$.industry||null,lead_score:$.lead_score||null,tags:((o=$.tags)==null?void 0:o.filter(X=>X!==void 0))||null,custom_fields:r?{...r,contact_mode:void 0,selected_contact_ids:void 0,new_contacts:void 0}:{}};let K;a.isEditing&&a.organizationId?K=await d.updateOrganizationWithContacts(a.organizationId,M,g):K=await d.createOrganizationWithContacts(M,g),K?(U(),C("success",K.id),w.push(`/organizations/${K.id}`)):s.value="Failed to save organization. Please try again."}catch(r){s.value=r.message||"An unexpected error occurred",console.error("Form submission error:",r)}finally{l.value=!1}};let m=null;const c=()=>{m&&clearTimeout(m),m=setTimeout(async()=>{await v()},2e3)},v=async()=>{try{p.value="saving";const o=a.isEditing?`org-edit-draft-${a.organizationId}`:"org-create-draft";localStorage.setItem(o,JSON.stringify({formData:{...$},currentStep:n.value,timestamp:Date.now()})),p.value="saved",C("draft-saved",{...$}),setTimeout(()=>{p.value=null},3e3)}catch(o){p.value="error",console.error("Auto-save error:",o),setTimeout(()=>{p.value=null},3e3)}},N=()=>{try{const o=a.isEditing?`org-edit-draft-${a.organizationId}`:"org-create-draft",r=localStorage.getItem(o);if(r){const g=JSON.parse(r);(Date.now()-g.timestamp)/(1e3*60)<60&&!a.initialData&&(Object.assign($,g.formData),n.value=g.currentStep||1)}}catch(o){console.error("Failed to load auto-saved draft:",o)}},U=()=>{try{const o=a.isEditing?`org-edit-draft-${a.organizationId}`:"org-create-draft";localStorage.removeItem(o)}catch(o){console.error("Failed to clear auto-saved draft:",o)}},H=()=>{ie(()=>{const o=document.querySelector("input, select, textarea");o==null||o.focus()})};W(()=>{N(),H()});const te=o=>{o.key==="Escape"&&C("cancel")};return W(()=>{document.addEventListener("keydown",te)}),de(()=>{document.removeEventListener("keydown",te),m&&clearTimeout(m)}),(o,r)=>(i(),u("div",Do,[e("div",Io,[e("nav",No,[e("ol",Ao,[(i(),u(Y,null,ee(h,(g,M)=>e("li",{key:g.id,class:P([M!==h.length-1?"pr-8 sm:pr-20":"","relative"])},[M!==h.length-1?(i(),u("div",Eo,[e("div",{class:P(["h-0.5 w-full",M+1<n.value?"bg-primary-600":"bg-gray-200"])},null,2)])):x("",!0),e("div",{class:P(["relative flex h-10 w-10 items-center justify-center rounded-full",b(M+1)])},[M+1<n.value?(i(),u("svg",Fo,r[0]||(r[0]=[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)]))):(i(),u("span",{key:1,class:P(["text-sm font-semibold",M+1===n.value?"text-white":"text-gray-500"])},y(M+1),3))],2),e("div",Po,[e("span",{class:P(["text-sm font-medium",M+1===n.value?"text-primary-600":M+1<n.value?"text-green-600":"text-gray-500"])},y(g.title),3)])],2)),64))])]),e("div",jo,[e("h2",Lo,y(V.value.title),1),e("p",Oo,y(V.value.description),1)])]),p.value?(i(),u("div",To,[e("div",{class:P(["flex items-center space-x-2 px-3 py-1 rounded-full",p.value==="saving"?"bg-blue-50 text-blue-700":p.value==="saved"?"bg-green-50 text-green-700":"bg-red-50 text-red-700"])},[p.value==="saving"?(i(),u("svg",Ro,r[1]||(r[1]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):p.value==="saved"?(i(),u("svg",Uo,r[2]||(r[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(i(),u("svg",qo,r[3]||(r[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]))),e("span",null,y(p.value==="saving"?"Saving draft...":p.value==="saved"?"Draft saved":"Failed to save draft"),1)],2)])):x("",!0),s.value?(i(),u("div",Ho,[e("div",Wo,[r[5]||(r[5]=e("svg",{class:"h-5 w-5 text-red-400 mr-3 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("div",null,[r[4]||(r[4]=e("h3",{class:"text-sm font-medium text-red-800"},"Error",-1)),e("p",Ko,y(s.value),1)])])])):x("",!0),e("div",Go,[e("div",Jo,[(i(),oe(ye(S.value),{"model-value":$,errors:q.value,loading:t.value,onValidate:k,"onUpdate:modelValue":f},null,40,["model-value","errors","loading"]))]),e("div",Qo,[e("div",Zo,[n.value>1?(i(),oe(ce,{key:0,variant:"secondary",disabled:l.value,onClick:R},{default:ae(()=>r[6]||(r[6]=[e("svg",{class:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),j(" Back ",-1)])),_:1,__:[6]},8,["disabled"])):(i(),u("div",Xo)),I(ce,{variant:_.value?"success":"primary",loading:l.value||t.value,disabled:!A.value||l.value,onClick:Q},{default:ae(()=>[j(y(_.value?"Create Organization":"Next")+" ",1),_.value?x("",!0):(i(),u("svg",Yo,r[7]||(r[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])))]),_:1},8,["variant","loading","disabled"])]),e("div",ea," Step "+y(n.value)+" of "+y(ne),1)])]),o.showContactWarning?(i(),oe(Mo,{key:2,"organization-name":$.name,class:"mt-6"},null,8,["organization-name"])):x("",!0)]))}}),oa={class:"max-w-4xl mx-auto space-y-6"},aa={class:"flex items-center justify-between"},sa={class:"flex items-center space-x-2 text-sm text-gray-500 mb-2"},fa=G({__name:"OrganizationCreateView",setup(L){const F=me(),a=d=>{F.push(`/organizations/${d}`)},C=()=>{F.push("/organizations")},w=d=>{console.log("Draft saved:",d)};return(d,n)=>{const l=he("router-link");return i(),u("div",oa,[e("div",aa,[e("div",null,[e("nav",sa,[I(l,{to:"/organizations",class:"hover:text-gray-700"},{default:ae(()=>n[0]||(n[0]=[j("Organizations",-1)])),_:1,__:[0]}),I(ue(we),{class:"h-4 w-4"}),n[1]||(n[1]=e("span",{class:"text-gray-900"},"New Organization",-1))]),n[2]||(n[2]=e("h1",{class:"text-2xl font-bold text-gray-900"},"Create New Organization",-1)),n[3]||(n[3]=e("p",{class:"mt-1 text-sm text-gray-500"}," Add a new organization to your CRM system ",-1))]),I(l,{to:"/organizations",class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},{default:ae(()=>[I(ue(ke),{class:"h-4 w-4 mr-2"}),n[4]||(n[4]=j(" Cancel ",-1))]),_:1,__:[4]})]),I(ta,{onSuccess:a,onCancel:C,onDraftSaved:w})])}}});export{fa as default};
//# sourceMappingURL=OrganizationCreateView-CtWpXCTj.js.map
