import{d as F,r as B,j as w,o as E,a as de,A as Q,c as v,b as e,e as z,k as O,t as S,n as D,F as re,l as ie,i as p,f as b,h as W,w as G,p as ge,D as fe,y as le,s as ne,E as be,x as pe,G as se,g as he,z as ue}from"./index-DYX0fJsY.js";import{u as ye}from"./organizationStore-DdKLZJnm.js";import{_ as $,a as j,o as ve,c as me,b as we}from"./organizations-CIkKF7Vq.js";import{_ as ce}from"./Button.vue_vue_type_script_setup_true_lang-C2BKPGyV.js";import{r as xe}from"./ChevronRightIcon-DrsVjjEE.js";import{r as Ve}from"./XMarkIcon-DVCE7Xj_.js";import"./supabaseClient-XVdxyLPD.js";import"./index.esm-GMrlL8k3.js";const ke={class:"space-y-1"},Se=["for"],Ce={key:0,class:"text-danger ml-1","aria-label":"required"},ze=["id"],$e={class:"relative"},_e=["id","name","placeholder","disabled","required","value","aria-describedby","aria-invalid","aria-required","aria-expanded","aria-owns"],Me=["disabled"],Ae={key:0,class:"absolute inset-y-0 right-8 flex items-center pr-3","aria-hidden":"true"},De=["id","aria-label"],Be={key:0,class:"px-3 py-2 text-sm text-gray-500",role:"option","aria-selected":"false"},Oe=["aria-selected","onClick","onMouseenter"],Ne={class:"flex items-center justify-between"},Te={key:0,class:"h-4 w-4 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ee={key:0,class:"text-xs text-gray-500 mt-1"},Pe={key:1,class:"border-t border-gray-200"},Le={class:"flex items-center"},Fe={key:2,class:"border-t border-gray-200"},Ie=["aria-selected","onClick"],Ue={class:"flex items-center justify-between"},Re={class:"text-xs text-gray-400"},je=["id"],qe=["id"],He=F({__name:"SegmentSelector",props:{name:{},label:{},modelValue:{},options:{default:()=>[]},error:{},placeholder:{default:"Select or type a segment..."},description:{},helpText:{},required:{type:Boolean},disabled:{type:Boolean},loading:{type:Boolean},allowAddNew:{type:Boolean,default:!0},popularSegments:{default:()=>[]},minSearchLength:{default:1},inputClass:{},labelClass:{}},emits:["update:modelValue","add-new","search","focus","blur","validate"],setup(A,{emit:_}){const o=A,y=_,V=B(),h=B(!1),s=B(""),m=B(-1),k=B(!1),d=[{value:"Technology",label:"Technology",description:"Software, hardware, and tech services"},{value:"Healthcare",label:"Healthcare",description:"Medical, pharmaceutical, and health services"},{value:"Finance",label:"Finance",description:"Banking, insurance, and financial services"},{value:"Manufacturing",label:"Manufacturing",description:"Production and industrial companies"},{value:"Retail",label:"Retail",description:"Consumer goods and retail services"},{value:"Education",label:"Education",description:"Schools, universities, and educational services"},{value:"Real Estate",label:"Real Estate",description:"Property development and real estate services"},{value:"Energy",label:"Energy",description:"Oil, gas, renewable energy, and utilities"},{value:"Transportation",label:"Transportation",description:"Logistics, shipping, and transportation"},{value:"Media",label:"Media",description:"Publishing, broadcasting, and entertainment"},{value:"Agriculture",label:"Agriculture",description:"Farming, food production, and agribusiness"},{value:"Construction",label:"Construction",description:"Building and construction services"},{value:"Consulting",label:"Consulting",description:"Business and professional consulting"},{value:"Government",label:"Government",description:"Public sector and government agencies"},{value:"Non-Profit",label:"Non-Profit",description:"Charitable organizations and NGOs"}],t=w(()=>`segment-${o.name}`),i=w(()=>`segment-dropdown-${o.name}`),x=w(()=>`error-${o.name}`),N=w(()=>`desc-${o.name}`),C=w(()=>`help-${o.name}`),c=w(()=>!!o.error),r=w(()=>{const a=[];return o.description&&a.push(N.value),o.error&&a.push(x.value),o.helpText&&!o.error&&a.push(C.value),a.length>0?a.join(" "):void 0}),l=w(()=>{const n=[...o.options||[]];return d.forEach(u=>{n.some(f=>f.value.toLowerCase()===u.value.toLowerCase())||n.push(u)}),n.sort((u,f)=>u.label.localeCompare(f.label))}),g=w(()=>h.value&&s.value!==""?s.value:o.modelValue||""),M=w(()=>{if(!s.value||s.value.length<o.minSearchLength)return l.value.slice(0,10);const a=s.value.toLowerCase();return l.value.filter(n=>{var u;return n.label.toLowerCase().includes(a)||((u=n.description)==null?void 0:u.toLowerCase().includes(a))}).slice(0,20)}),I=w(()=>!o.allowAddNew||!s.value||s.value.length<o.minSearchLength?!1:!l.value.some(n=>n.label.toLowerCase()===s.value.toLowerCase())),X=w(()=>!s.value&&o.popularSegments.length>0),q=w(()=>{const a="block text-sm font-medium transition-colors duration-200",n=c.value?"text-red-700":k.value?"text-primary-600":"text-gray-700",u=o.disabled?"opacity-60":"",f=o.labelClass||"";return`${a} ${n} ${u} ${f}`.trim()}),K=w(()=>{const a="w-full px-3 py-2 pr-10 border rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:border-transparent",n=c.value?"border-red-500 bg-red-50 focus:ring-red-500 focus:bg-white":k.value?"border-primary-500 bg-white focus:ring-primary-500":"border-gray-300 bg-white hover:border-gray-400 focus:ring-primary-500",u=o.disabled?"bg-gray-100 text-gray-500 cursor-not-allowed":"cursor-text",f=o.loading?"pr-16":"",J=o.inputClass||"";return`${a} ${n} ${u} ${f} ${J}`.trim()}),Z=w(()=>["absolute z-50 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg","max-h-60 overflow-auto focus:outline-none"].join(" ")),ee=a=>{const n=a.target;s.value=n.value,!h.value&&n.value.length>=o.minSearchLength&&U(),m.value=-1,n.value.length>=o.minSearchLength&&y("search",n.value)},te=a=>{k.value=!0,y("focus",a),s.value=o.modelValue||"",setTimeout(()=>{U()},100)},ae=a=>{setTimeout(()=>{if(k.value=!1,T(),s.value&&!o.modelValue){const n=l.value.find(u=>u.label.toLowerCase()===s.value.toLowerCase());n?R(n):o.allowAddNew&&L()}s.value="",y("blur",a),y("validate",o.modelValue)},200)},P=a=>{var n;switch(a.key){case"ArrowDown":if(a.preventDefault(),!h.value)U();else{const u=I.value?M.value.length:M.value.length-1;m.value=Math.min(m.value+1,u)}break;case"ArrowUp":a.preventDefault(),m.value=Math.max(m.value-1,-1);break;case"Enter":a.preventDefault(),h.value&&(m.value===M.value.length&&I.value?L():m.value>=0&&m.value<M.value.length&&R(M.value[m.value]));break;case"Escape":a.preventDefault(),T(),(n=V.value)==null||n.blur();break;case"Tab":T();break}},oe=()=>{var a;h.value?T():(U(),(a=V.value)==null||a.focus())},U=()=>{o.disabled||(h.value=!0,m.value=-1)},T=()=>{h.value=!1,m.value=-1},R=a=>{var n;y("update:modelValue",a.value),s.value="",T(),(n=V.value)==null||n.blur()},L=()=>{var a;if(s.value.trim()){const n=s.value.trim();y("add-new",n),y("update:modelValue",n),s.value="",T(),(a=V.value)==null||a.blur()}},H=a=>{const n=a.target,u=document.getElementById(i.value),f=V.value;u&&f&&!u.contains(n)&&!f.contains(n)&&T()};return E(()=>{document.addEventListener("click",H)}),de(()=>{document.removeEventListener("click",H)}),Q(()=>o.modelValue,a=>{k.value||(s.value=a||"")}),(a,n)=>(p(),v("div",ke,[e("label",{for:t.value,class:D(q.value)},[O(S(a.label)+" ",1),a.required?(p(),v("span",Ce,"*")):z("",!0)],10,Se),a.description?(p(),v("p",{key:0,id:N.value,class:"text-sm text-gray-600"},S(a.description),9,ze)):z("",!0),e("div",$e,[e("input",{id:t.value,ref_key:"inputRef",ref:V,name:a.name,type:"text",placeholder:a.placeholder,disabled:a.disabled,required:a.required,value:g.value,"aria-describedby":r.value,"aria-invalid":c.value,"aria-required":a.required,"aria-expanded":h.value,"aria-haspopup":!0,"aria-owns":i.value,class:D(K.value),autocomplete:"off",onInput:ee,onFocus:te,onBlur:ae,onKeydown:P},null,42,_e),e("button",{type:"button",disabled:a.disabled,class:"absolute inset-y-0 right-0 flex items-center pr-2","aria-label":"Toggle dropdown",onClick:oe},[(p(),v("svg",{class:D(["h-4 w-4 transition-transform duration-200",h.value?"rotate-180":"",c.value?"text-red-500":"text-gray-400"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},n[1]||(n[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))],8,Me),a.loading?(p(),v("div",Ae,n[2]||(n[2]=[e("svg",{class:"h-4 w-4 animate-spin text-gray-400",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):z("",!0),h.value?(p(),v("div",{key:1,id:i.value,class:D(Z.value),role:"listbox","aria-label":`${a.label} options`},[M.value.length===0&&!I.value?(p(),v("div",Be," No segments found ")):z("",!0),(p(!0),v(re,null,ie(M.value,(u,f)=>(p(),v("button",{key:u.value,type:"button",class:D(["w-full text-left px-3 py-2 text-sm hover:bg-gray-100 focus:bg-gray-100 focus:outline-none",f===m.value?"bg-primary-50 text-primary-900":"text-gray-900"]),role:"option","aria-selected":u.value===a.modelValue,onClick:J=>R(u),onMouseenter:J=>m.value=f},[e("div",Ne,[e("span",null,S(u.label),1),u.value===a.modelValue?(p(),v("svg",Te,n[3]||(n[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):z("",!0)]),u.description?(p(),v("p",Ee,S(u.description),1)):z("",!0)],42,Oe))),128)),I.value?(p(),v("div",Pe,[e("button",{type:"button",class:D(["w-full text-left px-3 py-2 text-sm hover:bg-blue-50 focus:bg-blue-50 focus:outline-none",m.value===M.value.length?"bg-blue-50 text-blue-900":"text-blue-700"]),role:"option","aria-selected":"false",onClick:L,onMouseenter:n[0]||(n[0]=u=>m.value=M.value.length)},[e("div",Le,[n[4]||(n[4]=e("svg",{class:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1)),O(' Add new segment: "'+S(s.value)+'" ',1)])],34)])):z("",!0),X.value&&a.popularSegments.length>0?(p(),v("div",Fe,[n[5]||(n[5]=e("div",{class:"px-3 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wide"}," Popular Segments ",-1)),(p(!0),v(re,null,ie(a.popularSegments,u=>(p(),v("button",{key:`popular-${u.value}`,type:"button",class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 focus:bg-gray-100 focus:outline-none",role:"option","aria-selected":u.value===a.modelValue,onClick:f=>R(u)},[e("div",Ue,[e("span",null,S(u.label),1),e("span",Re,S(u.count)+" orgs",1)])],8,Ie))),128))])):z("",!0)],10,De)):z("",!0)]),a.error?(p(),v("p",{key:1,id:x.value,role:"alert",class:"text-sm text-danger flex items-center space-x-1"},[n[6]||(n[6]=e("svg",{class:"h-4 w-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,S(a.error),1)],8,je)):z("",!0),a.helpText&&!a.error?(p(),v("p",{key:2,id:C.value,class:"text-sm text-gray-500"},S(a.helpText),9,qe)):z("",!0)]))}}),We={class:"space-y-6"},Ge=F({__name:"OrganizationStepOne",props:{modelValue:{},errors:{},loading:{type:Boolean,default:!1}},emits:["update:modelValue","validate"],setup(A,{emit:_}){const o=A,y=_,V=[{value:90,label:"High",description:"Strategic accounts and major opportunities"},{value:60,label:"Medium",description:"Regular prospects and qualified leads"},{value:30,label:"Low",description:"New prospects and informational contacts"}],h=[{value:"Prospect",label:"Prospect",description:"Potential customer or client"},{value:"Active",label:"Active",description:"Currently engaged organization"},{value:"Customer",label:"Customer",description:"Paying customer or client"},{value:"Partner",label:"Partner",description:"Business partner or alliance"},{value:"Vendor",label:"Vendor",description:"Service or product provider"},{value:"Inactive",label:"Inactive",description:"No longer active relationship"}],s=[{value:"Technology",label:"Technology",description:"Software, hardware, and tech services"},{value:"Healthcare",label:"Healthcare",description:"Medical and health services"},{value:"Finance",label:"Finance",description:"Banking and financial services"},{value:"Manufacturing",label:"Manufacturing",description:"Production and industrial"},{value:"Retail",label:"Retail",description:"Consumer goods and services"}],m=[{value:"Technology",label:"Technology",count:245},{value:"Healthcare",label:"Healthcare",count:189},{value:"Finance",label:"Finance",count:156},{value:"Manufacturing",label:"Manufacturing",count:134},{value:"Professional Services",label:"Professional Services",count:98}],k=w(()=>{const c=o.modelValue.lead_score;return c==null?"":c>=80?90:c>=50?60:30}),d=(c,r)=>{const l={...o.modelValue,[c]:r};y("update:modelValue",l)},t=c=>{const r=Array.isArray(c)?c[0]:c,l=typeof r=="string"?parseInt(r):r;d("lead_score",l)},i=async(c,r)=>{await x()},x=async()=>{const c={};let r=!0;try{const l={name:o.modelValue.name,industry:o.modelValue.industry,lead_score:o.modelValue.lead_score};await ve.pick(["name","industry","lead_score"]).validate(l,{abortEarly:!1})}catch(l){r=!1,l.inner&&l.inner.forEach(g=>{if(g.path){const M=g.path==="industry"?"segment":g.path==="lead_score"?"priority":g.path;c[M]=g.message}})}y("validate",1,r,c)},N=c=>{d("industry",c)},C=c=>{};return Q(()=>[o.modelValue.name,o.modelValue.industry,o.modelValue.lead_score],async()=>{await x()},{immediate:!0}),E(async()=>{await x()}),(c,r)=>(p(),v("div",We,[b($,{name:"name",label:"Organization Name",type:"text","model-value":c.modelValue.name||"",error:c.errors.name,placeholder:"Enter the organization name",description:"The legal or commonly used name of the organization",required:"",autocomplete:"organization","onUpdate:modelValue":r[0]||(r[0]=l=>d("name",l)),onValidate:r[1]||(r[1]=l=>i())},null,8,["model-value","error"]),b(j,{name:"priority",label:"Priority","model-value":k.value,options:V,error:c.errors.priority||c.errors.lead_score,placeholder:"Select organization priority",description:"How important this organization is for your business objectives",required:"","onUpdate:modelValue":t,onValidate:r[2]||(r[2]=l=>i())},{"help-text":G(()=>r[7]||(r[7]=[e("div",{class:"text-sm text-gray-600 mt-2"},[e("p",{class:"mb-2"},[e("strong",null,"Priority Guidelines:")]),e("ul",{class:"space-y-1 text-xs"},[e("li",null,[e("span",{class:"inline-block w-12 text-red-600 font-medium"},"High:"),O(" Strategic accounts, major clients, high-value prospects")]),e("li",null,[e("span",{class:"inline-block w-12 text-orange-600 font-medium"},"Medium:"),O(" Regular clients, qualified leads, growth opportunities")]),e("li",null,[e("span",{class:"inline-block w-12 text-blue-600 font-medium"},"Low:"),O(" New prospects, small accounts, informational contacts")])])],-1)])),_:1},8,["model-value","error"]),b(He,{name:"segment",label:"Segment","model-value":c.modelValue.industry||"",error:c.errors.segment||c.errors.industry,options:s,"popular-segments":m,placeholder:"Select or type an industry segment...",description:"The industry or market segment this organization operates in","help-text":"Start typing to search existing segments or create a new one",required:"","allow-add-new":"","onUpdate:modelValue":r[3]||(r[3]=l=>d("industry",l)),onAddNew:N,onSearch:C,onValidate:r[4]||(r[4]=l=>i())},null,8,["model-value","error"]),b(j,{name:"status",label:"Organization Status","model-value":c.modelValue.status||"Prospect",options:h,error:c.errors.status,placeholder:"Select organization status",description:"Current relationship status with this organization","onUpdate:modelValue":r[5]||(r[5]=l=>d("status",l)),onValidate:r[6]||(r[6]=l=>i())},null,8,["model-value","error"]),r[8]||(r[8]=W('<div class="mt-8 p-4 bg-blue-50 rounded-md"><div class="flex items-start"><svg class="h-5 w-5 text-blue-400 mt-0.5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div><h3 class="text-sm font-medium text-blue-800">Step 1 of 3: Basic Information</h3><div class="mt-2 text-sm text-blue-700"><p>Enter the essential details to identify and categorize the organization.</p><p class="mt-1"><strong>Next:</strong> Organization type and business relationship details </p></div></div></div></div>',1))]))}}),Ke={class:"space-y-6"},Je={class:"space-y-4"},Ye={class:"space-y-2"},Qe={class:"space-y-2"},Xe={class:"space-y-4"},Ze=F({__name:"OrganizationStepTwo",props:{modelValue:{},errors:{},loading:{type:Boolean,default:!1}},emits:["update:modelValue","validate"],setup(A,{emit:_}){const o=A,y=_,V=[{value:"B2B",label:"B2B",description:"Sells products or services to other businesses"},{value:"B2C",label:"B2C",description:"Sells directly to individual consumers"},{value:"B2B2C",label:"B2B2C",description:"Sells to businesses who sell to consumers"},{value:"Non-Profit",label:"Non-Profit",description:"Charitable or educational organization"},{value:"Government",label:"Government",description:"Government agency or public sector"},{value:"Other",label:"Other",description:"Other business model"}],h=[{value:"Startup",label:"Startup (1-10 employees)",description:"Early-stage company"},{value:"Small",label:"Small (11-50 employees)",description:"Small business"},{value:"Medium",label:"Medium (51-250 employees)",description:"Medium-sized company"},{value:"Large",label:"Large (251-1000 employees)",description:"Large corporation"},{value:"Enterprise",label:"Enterprise (1000+ employees)",description:"Large enterprise"}],s=w(()=>new Date().getFullYear()),m=w(()=>o.modelValue.custom_fields||{}),k=w(()=>m.value.is_principal||!1),d=w(()=>m.value.is_distributor||!1),t=(r,l)=>{const g={...o.modelValue,[r]:l};y("update:modelValue",g)},i=(r,l)=>{const g={...m.value,[r]:l};t("custom_fields",g)},x=r=>{const l=Array.isArray(r)?r.length>0:r;i("is_principal",l)},N=r=>{const l=Array.isArray(r)?r.length>0:r;i("is_distributor",l)},C=(r,l)=>{c()},c=()=>{const r={};let l=!0;if(o.modelValue.founded_year!==null&&o.modelValue.founded_year!==void 0){const g=o.modelValue.founded_year;(g<1800||g>s.value+1)&&(r.founded_year=`Founded year must be between 1800 and ${s.value+1}`,l=!1)}o.modelValue.employees_count!==null&&o.modelValue.employees_count!==void 0&&o.modelValue.employees_count<0&&(r.employees_count="Employee count cannot be negative",l=!1),y("validate",2,l,r)};return Q(()=>[o.modelValue.type,o.modelValue.size,o.modelValue.founded_year,o.modelValue.employees_count,o.modelValue.custom_fields],()=>{c()},{immediate:!0}),E(()=>{c()}),(r,l)=>(p(),v("div",Ke,[e("div",Je,[l[10]||(l[10]=e("div",null,[e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Organization Type"),e("p",{class:"text-sm text-gray-600 mb-4"}," Select the type of organization and specify its business relationships ")],-1)),b(j,{name:"type",label:"Business Type","model-value":r.modelValue.type||"",options:V,error:r.errors.type,placeholder:"Select the business type",description:"The primary business model of this organization","onUpdate:modelValue":l[0]||(l[0]=g=>t("type",g)),onValidate:l[1]||(l[1]=g=>C())},null,8,["model-value","error"])]),e("div",Ye,[b(me,{name:"isPrincipal",label:"Principal Organization","model-value":k.value,description:"Mark this organization as a principal","help-text":"Principal organizations are primary decision makers or parent companies","onUpdate:modelValue":x,onValidate:l[2]||(l[2]=g=>C())},null,8,["model-value"]),l[11]||(l[11]=W('<div class="ml-8 p-3 bg-blue-50 border border-blue-200 rounded-md"><div class="flex items-start"><svg class="h-5 w-5 text-blue-400 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class="text-sm"><p class="font-medium text-blue-800 mb-1">What is a Principal Organization?</p><p class="text-blue-700"> A principal organization typically has decision-making authority, acts as a parent company, or serves as the primary point of contact for business relationships. Examples include: </p><ul class="mt-2 list-disc list-inside text-blue-700 space-y-1"><li>Headquarters or parent companies</li><li>Primary contractors or vendors</li><li>Organizations with signing authority</li><li>Strategic partners with decision power</li></ul></div></div></div>',1))]),e("div",Qe,[b(me,{name:"isDistributor",label:"Distributor Organization","model-value":d.value,description:"Mark this organization as a distributor","help-text":"Distributor organizations resell or distribute products/services","onUpdate:modelValue":N,onValidate:l[3]||(l[3]=g=>C())},null,8,["model-value"]),l[12]||(l[12]=W('<div class="ml-8 p-3 bg-green-50 border border-green-200 rounded-md"><div class="flex items-start"><svg class="h-5 w-5 text-green-400 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class="text-sm"><p class="font-medium text-green-800 mb-1">What is a Distributor Organization?</p><p class="text-green-700"> A distributor organization resells, distributes, or channels products and services to end customers. They often act as intermediaries in the sales process: </p><ul class="mt-2 list-disc list-inside text-green-700 space-y-1"><li>Authorized resellers and dealers</li><li>Channel partners and distributors</li><li>Retail chains and franchisees</li><li>Value-added resellers (VARs)</li></ul></div></div></div>',1))]),b(j,{name:"size",label:"Organization Size","model-value":r.modelValue.size||"",options:h,error:r.errors.size,placeholder:"Select organization size",description:"Approximate size of the organization","help-text":"This helps categorize the organization for targeted engagement strategies","onUpdate:modelValue":l[4]||(l[4]=g=>t("size",g)),onValidate:l[5]||(l[5]=g=>C())},null,8,["model-value","error"]),e("div",Xe,[l[13]||(l[13]=e("div",null,[e("h4",{class:"text-md font-medium text-gray-900 mb-2"},"Relationship Context"),e("p",{class:"text-sm text-gray-600"}," Optional information to provide more context about this organization ")],-1)),b($,{name:"founded_year",label:"Founded Year",type:"number","model-value":r.modelValue.founded_year||"",error:r.errors.founded_year,placeholder:"e.g., 2010",description:"Year the organization was established",min:1800,max:s.value+1,"onUpdate:modelValue":l[6]||(l[6]=g=>t("founded_year",g?parseInt(g.toString()):null)),onValidate:l[7]||(l[7]=g=>C())},null,8,["model-value","error","max"]),b($,{name:"employees_count",label:"Number of Employees",type:"number","model-value":r.modelValue.employees_count||"",error:r.errors.employees_count,placeholder:"e.g., 50",description:"Approximate number of employees",min:0,"onUpdate:modelValue":l[8]||(l[8]=g=>t("employees_count",g?parseInt(g.toString()):null)),onValidate:l[9]||(l[9]=g=>C())},null,8,["model-value","error"])]),l[14]||(l[14]=W('<div class="mt-8 p-4 bg-purple-50 rounded-md"><div class="flex items-start"><svg class="h-5 w-5 text-purple-400 mt-0.5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg><div><h3 class="text-sm font-medium text-purple-800">Step 2 of 3: Organization Type</h3><div class="mt-2 text-sm text-purple-700"><p>Define the business relationship and organizational characteristics.</p><p class="mt-1"><strong>Next:</strong> Contact details, address, and additional information </p></div></div></div></div>',1))]))}}),et={class:"space-y-6"},tt={class:"space-y-4"},at={class:"space-y-4"},ot={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},lt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},nt={class:"space-y-4"},st={class:"space-y-4"},rt=F({__name:"OrganizationStepThree",props:{modelValue:{},errors:{},loading:{type:Boolean,default:!1}},emits:["update:modelValue","validate"],setup(A,{emit:_}){const o=A,y=_,V=[{value:"US",label:"United States"},{value:"CA",label:"Canada"},{value:"GB",label:"United Kingdom"},{value:"DE",label:"Germany"},{value:"FR",label:"France"},{value:"IT",label:"Italy"},{value:"ES",label:"Spain"},{value:"NL",label:"Netherlands"},{value:"AU",label:"Australia"},{value:"JP",label:"Japan"},{value:"CN",label:"China"},{value:"IN",label:"India"},{value:"BR",label:"Brazil"},{value:"MX",label:"Mexico"},{value:"SG",label:"Singapore"},{value:"HK",label:"Hong Kong"},{value:"Other",label:"Other"}],h=[{value:"",label:"Unassigned",description:"No account manager assigned"},{value:"user-1",label:"John Smith",description:"Senior Account Manager"},{value:"user-2",label:"Sarah Johnson",description:"Account Manager"},{value:"user-3",label:"Mike Davis",description:"Regional Manager"},{value:"user-4",label:"Lisa Chen",description:"Enterprise Account Manager"},{value:"user-5",label:"David Wilson",description:"Account Executive"}],s=(d,t)=>{const i={...o.modelValue,[d]:t};y("update:modelValue",i)},m=(d,t)=>{k()},k=()=>{const d={};let t=!0;o.modelValue.email&&o.modelValue.email.trim()&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.modelValue.email)||(d.email="Please enter a valid email address",t=!1)),o.modelValue.website&&o.modelValue.website.trim()&&(/^https?:\/\/[^\s]+$/.test(o.modelValue.website)||(d.website="Website must be a valid URL starting with http:// or https://",t=!1)),o.modelValue.primary_phone&&o.modelValue.primary_phone.trim()&&(/^[+\-\s().\d]{10,}$/.test(o.modelValue.primary_phone.replace(/\s/g,""))||(d.primary_phone="Please enter a valid phone number",t=!1)),o.modelValue.secondary_phone&&o.modelValue.secondary_phone.trim()&&(/^[+\-\s().\d]{10,}$/.test(o.modelValue.secondary_phone.replace(/\s/g,""))||(d.secondary_phone="Please enter a valid phone number",t=!1)),o.modelValue.annual_revenue!==null&&o.modelValue.annual_revenue!==void 0&&o.modelValue.annual_revenue<0&&(d.annual_revenue="Annual revenue cannot be negative",t=!1),o.modelValue.description&&o.modelValue.description.length>2e3&&(d.description="Description must be less than 2000 characters",t=!1),y("validate",3,t,d)};return Q(()=>[o.modelValue.email,o.modelValue.website,o.modelValue.primary_phone,o.modelValue.secondary_phone,o.modelValue.annual_revenue,o.modelValue.description],()=>{k()},{immediate:!0}),E(()=>{k()}),(d,t)=>(p(),v("div",et,[e("div",tt,[t[30]||(t[30]=e("div",null,[e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Contact Information"),e("p",{class:"text-sm text-gray-600 mb-4"}," Provide contact details and address information for this organization ")],-1)),b($,{name:"primary_phone",label:"Primary Phone",type:"tel","model-value":d.modelValue.primary_phone||"",error:d.errors.primary_phone,placeholder:"e.g., +1 (555) 123-4567",description:"Main phone number for the organization",autocomplete:"tel","onUpdate:modelValue":t[0]||(t[0]=i=>s("primary_phone",i)),onValidate:t[1]||(t[1]=i=>m())},null,8,["model-value","error"]),b($,{name:"secondary_phone",label:"Secondary Phone",type:"tel","model-value":d.modelValue.secondary_phone||"",error:d.errors.secondary_phone,placeholder:"e.g., +1 (555) 987-6543",description:"Alternative phone number (optional)",autocomplete:"tel","onUpdate:modelValue":t[2]||(t[2]=i=>s("secondary_phone",i)),onValidate:t[3]||(t[3]=i=>m())},null,8,["model-value","error"]),b($,{name:"email",label:"Email Address",type:"email","model-value":d.modelValue.email||"",error:d.errors.email,placeholder:"e.g., contact@company.com",description:"Primary email address for the organization",autocomplete:"email","onUpdate:modelValue":t[4]||(t[4]=i=>s("email",i)),onValidate:t[5]||(t[5]=i=>m())},null,8,["model-value","error"]),b($,{name:"website",label:"Website",type:"url","model-value":d.modelValue.website||"",error:d.errors.website,placeholder:"e.g., https://www.company.com",description:"Organization's website URL",autocomplete:"url","onUpdate:modelValue":t[6]||(t[6]=i=>s("website",i)),onValidate:t[7]||(t[7]=i=>m())},null,8,["model-value","error"])]),e("div",at,[t[31]||(t[31]=e("div",null,[e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Address"),e("p",{class:"text-sm text-gray-600 mb-4"}," Physical address of the organization's main office or headquarters ")],-1)),b($,{name:"address_line_1",label:"Address Line 1",type:"text","model-value":d.modelValue.address_line_1||"",error:d.errors.address_line_1,placeholder:"e.g., 123 Main Street",description:"Street address, building number, and street name",autocomplete:"street-address","onUpdate:modelValue":t[8]||(t[8]=i=>s("address_line_1",i)),onValidate:t[9]||(t[9]=i=>m())},null,8,["model-value","error"]),b($,{name:"address_line_2",label:"Address Line 2",type:"text","model-value":d.modelValue.address_line_2||"",error:d.errors.address_line_2,placeholder:"e.g., Suite 100",description:"Apartment, suite, unit, or floor (optional)",autocomplete:"off","onUpdate:modelValue":t[10]||(t[10]=i=>s("address_line_2",i)),onValidate:t[11]||(t[11]=i=>m())},null,8,["model-value","error"]),e("div",ot,[b($,{name:"city",label:"City",type:"text","model-value":d.modelValue.city||"",error:d.errors.city,placeholder:"e.g., New York",description:"City or locality",autocomplete:"off","onUpdate:modelValue":t[12]||(t[12]=i=>s("city",i)),onValidate:t[13]||(t[13]=i=>m())},null,8,["model-value","error"]),b($,{name:"state_province",label:"State/Province",type:"text","model-value":d.modelValue.state_province||"",error:d.errors.state_province,placeholder:"e.g., NY",description:"State, province, or region",autocomplete:"off","onUpdate:modelValue":t[14]||(t[14]=i=>s("state_province",i)),onValidate:t[15]||(t[15]=i=>m())},null,8,["model-value","error"])]),e("div",lt,[b($,{name:"postal_code",label:"Postal Code",type:"text","model-value":d.modelValue.postal_code||"",error:d.errors.postal_code,placeholder:"e.g., 10001",description:"ZIP or postal code",autocomplete:"postal-code","onUpdate:modelValue":t[16]||(t[16]=i=>s("postal_code",i)),onValidate:t[17]||(t[17]=i=>m())},null,8,["model-value","error"]),b(j,{name:"country",label:"Country","model-value":d.modelValue.country||"",options:V,error:d.errors.country,placeholder:"Select country",description:"Country or territory","onUpdate:modelValue":t[18]||(t[18]=i=>s("country",i)),onValidate:t[19]||(t[19]=i=>m())},null,8,["model-value","error"])])]),e("div",nt,[t[32]||(t[32]=e("div",null,[e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Business Details"),e("p",{class:"text-sm text-gray-600 mb-4"}," Additional information about the organization's business and operations ")],-1)),b($,{name:"legal_name",label:"Legal Name",type:"text","model-value":d.modelValue.legal_name||"",error:d.errors.legal_name,placeholder:"e.g., Company Name LLC",description:"Official legal name if different from organization name","help-text":"Only fill this if the legal name differs from the organization name","onUpdate:modelValue":t[20]||(t[20]=i=>s("legal_name",i)),onValidate:t[21]||(t[21]=i=>m())},null,8,["model-value","error"]),b($,{name:"annual_revenue",label:"Annual Revenue",type:"number","model-value":d.modelValue.annual_revenue||"",error:d.errors.annual_revenue,placeholder:"e.g., 1000000",description:"Annual revenue in USD (optional)","help-text":"This helps with lead scoring and segmentation",min:0,"onUpdate:modelValue":t[22]||(t[22]=i=>s("annual_revenue",i?parseFloat(i.toString()):null)),onValidate:t[23]||(t[23]=i=>m())},null,8,["model-value","error"]),b(j,{name:"assigned_user_id",label:"Account Manager","model-value":d.modelValue.assigned_user_id||"",options:h,error:d.errors.assigned_user_id,placeholder:"Select account manager",description:"Team member responsible for this organization","help-text":"This person will be the primary contact for this organization","onUpdate:modelValue":t[24]||(t[24]=i=>s("assigned_user_id",i)),onValidate:t[25]||(t[25]=i=>m())},null,8,["model-value","error"])]),e("div",st,[t[33]||(t[33]=e("div",null,[e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Additional Information"),e("p",{class:"text-sm text-gray-600 mb-4"}," Any additional notes or context about this organization ")],-1)),b(we,{name:"description",label:"Notes & Description","model-value":d.modelValue.description||"",error:d.errors.description,placeholder:"Enter any additional notes, context, or important information about this organization...",description:"Internal notes about the organization, relationship history, or other relevant details",rows:4,maxlength:2e3,"show-character-count":"","onUpdate:modelValue":t[26]||(t[26]=i=>s("description",i)),onValidate:t[27]||(t[27]=i=>m())},null,8,["model-value","error"]),b($,{name:"lead_source",label:"Lead Source",type:"text","model-value":d.modelValue.lead_source||"",error:d.errors.lead_source,placeholder:"e.g., Website, Referral, Trade Show",description:"How did you learn about this organization?","help-text":"This helps track the effectiveness of different marketing channels","onUpdate:modelValue":t[28]||(t[28]=i=>s("lead_source",i)),onValidate:t[29]||(t[29]=i=>m())},null,8,["model-value","error"])]),t[34]||(t[34]=W('<div class="mt-8 p-4 bg-green-50 rounded-md"><div class="flex items-start"><svg class="h-5 w-5 text-green-400 mt-0.5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div><h3 class="text-sm font-medium text-green-800">Step 3 of 3: Contact Details &amp; Notes</h3><div class="mt-2 text-sm text-green-700"><p>Complete the organization profile with contact information and additional details.</p><p class="mt-1"><strong>Ready to create:</strong> All required information has been collected </p></div></div></div></div>',1))]))}}),it={"data-testid":"contact-status-warning",class:"bg-amber-50 border border-amber-200 rounded-md p-4",role:"alert","aria-labelledby":"contact-warning-title"},dt={class:"flex items-start"},ut={class:"ml-3 flex-1"},mt={class:"mt-2 text-sm text-amber-700"},ct={key:0},pt={key:1},vt={class:"mt-4 flex flex-col sm:flex-row gap-3"},gt={class:"mt-3 flex items-center"},ft=["id"],bt=["for"],ht=F({__name:"ContactStatusWarning",props:{organizationName:{},hideAddNowButton:{type:Boolean,default:!1},autoDismissAfter:{},customMessage:{},contactCount:{default:0}},emits:["add-contact-now","add-contact-later","dismiss","close"],setup(A,{expose:_,emit:o}){const y=A,V=o,h=B(!1),s=B(!0),m=w(()=>`dismiss-contact-warning-${Math.random().toString(36).substr(2,9)}`),k=()=>{V("add-contact-now"),i()},d=()=>{V("add-contact-later"),i()},t=()=>{if(h.value){try{sessionStorage.setItem("contact-warning-dismissed","true")}catch(r){console.warn("Failed to store dismissal preference:",r)}V("dismiss")}else try{sessionStorage.removeItem("contact-warning-dismissed")}catch(r){console.warn("Failed to remove dismissal preference:",r)}},i=()=>{s.value=!1,V("close")},x=()=>{try{return sessionStorage.getItem("contact-warning-dismissed")!=="true"}catch{return!0}},N=()=>{y.autoDismissAfter&&y.autoDismissAfter>0&&setTimeout(()=>{s.value&&!h.value&&i()},y.autoDismissAfter*1e3)};E(()=>{if(!x()){s.value=!1;return}N()});const C=()=>{const r=document.createElement("div");r.setAttribute("aria-live","polite"),r.setAttribute("aria-atomic","true"),r.className="sr-only",r.textContent=`Warning: ${y.organizationName||"This organization"} has no contacts. Consider adding contacts for better CRM functionality.`,document.body.appendChild(r),setTimeout(()=>{document.body.removeChild(r)},1e3)};E(()=>{s.value&&C()});const c=r=>{r.key==="Escape"&&i()};return E(()=>{document.addEventListener("keydown",c)}),de(()=>{document.removeEventListener("keydown",c)}),_({dismiss:i,isVisible:()=>s.value,isDismissed:()=>h.value}),(r,l)=>(p(),v("div",it,[e("div",dt,[l[8]||(l[8]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",ut,[l[6]||(l[6]=e("h3",{id:"contact-warning-title",class:"text-sm font-medium text-amber-800"}," No Contacts Found ",-1)),e("div",mt,[r.organizationName?(p(),v("p",ct,[e("strong",null,S(r.organizationName),1),l[1]||(l[1]=O(" currently has no associated contacts. ",-1))])):(p(),v("p",pt," This organization currently has no associated contacts. ")),l[2]||(l[2]=e("p",{class:"mt-2"}," Consider adding contacts after creating the organization to: ",-1)),l[3]||(l[3]=e("ul",{class:"mt-2 list-disc list-inside space-y-1"},[e("li",null,"Track communication and interactions"),e("li",null,"Manage relationships with key decision makers"),e("li",null,"Improve lead scoring and follow-up activities"),e("li",null,"Enable comprehensive CRM functionality")],-1))]),e("div",vt,[e("button",{type:"button",class:"inline-flex items-center px-3 py-2 border border-amber-300 shadow-sm text-sm leading-4 font-medium rounded-md text-amber-700 bg-amber-100 hover:bg-amber-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-colors duration-200",onClick:d},l[4]||(l[4]=[e("svg",{class:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),O(" I'll add contacts later ",-1)])),r.hideAddNowButton?z("",!0):(p(),v("button",{key:0,type:"button",class:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-colors duration-200",onClick:k},l[5]||(l[5]=[e("svg",{class:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1),O(" Add contact now ",-1)])))]),e("div",gt,[ge(e("input",{id:m.value,"onUpdate:modelValue":l[0]||(l[0]=g=>h.value=g),type:"checkbox",class:"h-4 w-4 text-amber-600 focus:ring-amber-500 border-amber-300 rounded",onChange:t},null,40,ft),[[fe,h.value]]),e("label",{for:m.value,class:"ml-2 text-sm text-amber-700 cursor-pointer"}," Don't show this warning again for this session ",8,bt)])]),e("div",{class:"ml-auto pl-3"},[e("div",{class:"-mx-1.5 -my-1.5"},[e("button",{type:"button",class:"inline-flex rounded-md p-1.5 text-amber-500 hover:bg-amber-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-amber-50 focus:ring-amber-600","aria-label":"Dismiss warning",onClick:i},l[7]||(l[7]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{d:"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"})],-1)]))])])])]))}}),yt={class:"max-w-4xl mx-auto"},wt={class:"mb-8"},xt={"aria-label":"Progress"},Vt={role:"list",class:"flex items-center justify-center"},kt={key:0,class:"absolute inset-0 flex items-center","aria-hidden":"true"},St={key:0,class:"h-5 w-5 text-white",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},Ct={class:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 whitespace-nowrap"},zt={class:"mt-12 text-center"},$t={class:"text-2xl font-bold text-gray-900"},_t={class:"mt-2 text-gray-600"},Mt={key:0,class:"mb-4 flex items-center justify-center text-sm"},At={key:0,class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"},Dt={key:1,class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Bt={key:2,class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ot={key:1,class:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",role:"alert"},Nt={class:"flex items-start"},Tt={class:"mt-1 text-sm text-red-700"},Et={class:"bg-white shadow-sm rounded-lg border border-gray-200"},Pt={class:"p-6"},Lt={class:"px-6 py-4 bg-gray-50 border-t border-gray-200 rounded-b-lg"},Ft={class:"flex items-center justify-between"},It={key:1},Ut={key:0,class:"h-4 w-4 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Rt={class:"mt-4 text-center text-sm text-gray-500"},Y=3,jt=F({__name:"OrganizationFormWrapper",props:{initialData:{},isEditing:{type:Boolean,default:!1},organizationId:{},showContactWarning:{type:Boolean,default:!0}},emits:["success","cancel","draft-saved"],setup(A,{emit:_}){const o=A,y=_,V=pe(),h=ye(),s=B(1),m=B(!1),k=B(!1),d=B(""),t=B(null),i=le({1:!1,2:!0,3:!0}),x=le({name:"",industry:"",lead_score:null,type:null,status:"Prospect",address_line_1:"",city:"",state_province:"",postal_code:"",primary_phone:"",website:"",assigned_user_id:null,description:"",...o.initialData}),N=le({1:{},2:{},3:{}}),C=[{id:1,title:"Basic Info",description:"Enter the organization name, priority, and segment",component:"OrganizationStepOne",requiredFields:["name","industry","lead_score"]},{id:2,title:"Organization Type",description:"Specify if this is a principal or distributor organization",component:"OrganizationStepTwo",requiredFields:[]},{id:3,title:"Contact Details",description:"Add address, phone, website, and additional information",component:"OrganizationStepThree",requiredFields:[]}],c=w(()=>C[s.value-1]),r=w(()=>({OrganizationStepOne:Ge,OrganizationStepTwo:Ze,OrganizationStepThree:rt})[c.value.component]),l=w(()=>s.value===Y),g=w(()=>N[s.value]||{}),M=w(()=>i[s.value]),I=a=>a<s.value||a===s.value?"bg-primary-600":"bg-gray-200",X=a=>{Object.assign(x,a),oe()},q=async(a,n,u={})=>{i[a]=n,N[a]=u,n&&d.value&&(d.value="")},K=async()=>{k.value=!0;try{const a=c.value.requiredFields,n={};return a.forEach(u=>{n[u]=x[u]}),a.length>0&&await ve.pick(a).validate(n,{abortEarly:!1}),await q(s.value,!0,{}),!0}catch(a){const n={};return a.inner?a.inner.forEach(u=>{u.path&&(n[u.path]=u.message)}):n.general=a.message||"Validation failed",await q(s.value,!1,n),!1}finally{k.value=!1}},Z=async()=>{s.value<Y&&await K()&&(s.value++,await se(),L())},ee=()=>{s.value>1&&(s.value--,se(()=>{L()}))},te=async()=>{l.value?await ae():await Z()},ae=async()=>{var a;try{m.value=!0,d.value="";for(let f=1;f<=Y;f++)if(s.value=f,!await K()){d.value=`Please fix errors in Step ${f}`;return}const n={...x,name:x.name||"",industry:x.industry||null,lead_score:x.lead_score||null,tags:((a=x.tags)==null?void 0:a.filter(f=>f!==void 0))||null};let u;o.isEditing&&o.organizationId?u=await h.updateOrganization(o.organizationId,n):u=await h.createOrganization(n),u?(R(),y("success",u.id),V.push(`/organizations/${u.id}`)):d.value="Failed to save organization. Please try again."}catch(n){d.value=n.message||"An unexpected error occurred",console.error("Form submission error:",n)}finally{m.value=!1}};let P=null;const oe=()=>{P&&clearTimeout(P),P=setTimeout(async()=>{await U()},2e3)},U=async()=>{try{t.value="saving";const a=o.isEditing?`org-edit-draft-${o.organizationId}`:"org-create-draft";localStorage.setItem(a,JSON.stringify({formData:{...x},currentStep:s.value,timestamp:Date.now()})),t.value="saved",y("draft-saved",{...x}),setTimeout(()=>{t.value=null},3e3)}catch(a){t.value="error",console.error("Auto-save error:",a),setTimeout(()=>{t.value=null},3e3)}},T=()=>{try{const a=o.isEditing?`org-edit-draft-${o.organizationId}`:"org-create-draft",n=localStorage.getItem(a);if(n){const u=JSON.parse(n);(Date.now()-u.timestamp)/(1e3*60)<60&&!o.initialData&&(Object.assign(x,u.formData),s.value=u.currentStep||1)}}catch(a){console.error("Failed to load auto-saved draft:",a)}},R=()=>{try{const a=o.isEditing?`org-edit-draft-${o.organizationId}`:"org-create-draft";localStorage.removeItem(a)}catch(a){console.error("Failed to clear auto-saved draft:",a)}},L=()=>{se(()=>{const a=document.querySelector("input, select, textarea");a==null||a.focus()})};E(()=>{T(),L()});const H=a=>{a.key==="Escape"&&y("cancel")};return E(()=>{document.addEventListener("keydown",H)}),de(()=>{document.removeEventListener("keydown",H),P&&clearTimeout(P)}),(a,n)=>(p(),v("div",yt,[e("div",wt,[e("nav",xt,[e("ol",Vt,[(p(),v(re,null,ie(C,(u,f)=>e("li",{key:u.id,class:D([f!==C.length-1?"pr-8 sm:pr-20":"","relative"])},[f!==C.length-1?(p(),v("div",kt,[e("div",{class:D(["h-0.5 w-full",f+1<s.value?"bg-primary-600":"bg-gray-200"])},null,2)])):z("",!0),e("div",{class:D(["relative flex h-10 w-10 items-center justify-center rounded-full",I(f+1)])},[f+1<s.value?(p(),v("svg",St,n[1]||(n[1]=[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)]))):(p(),v("span",{key:1,class:D(["text-sm font-semibold",f+1===s.value?"text-white":"text-gray-500"])},S(f+1),3))],2),e("div",Ct,[e("span",{class:D(["text-sm font-medium",f+1===s.value?"text-primary-600":f+1<s.value?"text-green-600":"text-gray-500"])},S(u.title),3)])],2)),64))])]),e("div",zt,[e("h2",$t,S(c.value.title),1),e("p",_t,S(c.value.description),1)])]),t.value?(p(),v("div",Mt,[e("div",{class:D(["flex items-center space-x-2 px-3 py-1 rounded-full",t.value==="saving"?"bg-blue-50 text-blue-700":t.value==="saved"?"bg-green-50 text-green-700":"bg-red-50 text-red-700"])},[t.value==="saving"?(p(),v("svg",At,n[2]||(n[2]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):t.value==="saved"?(p(),v("svg",Dt,n[3]||(n[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(p(),v("svg",Bt,n[4]||(n[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]))),e("span",null,S(t.value==="saving"?"Saving draft...":t.value==="saved"?"Draft saved":"Failed to save draft"),1)],2)])):z("",!0),d.value?(p(),v("div",Ot,[e("div",Nt,[n[6]||(n[6]=e("svg",{class:"h-5 w-5 text-red-400 mr-3 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("div",null,[n[5]||(n[5]=e("h3",{class:"text-sm font-medium text-red-800"},"Error",-1)),e("p",Tt,S(d.value),1)])])])):z("",!0),e("div",Et,[e("div",Pt,[(p(),ne(be(r.value),{modelValue:x,"onUpdate:modelValue":[n[0]||(n[0]=u=>x=u),X],errors:g.value,loading:k.value,onValidate:q},null,40,["modelValue","errors","loading"]))]),e("div",Lt,[e("div",Ft,[s.value>1?(p(),ne(ce,{key:0,variant:"secondary",disabled:m.value,onClick:ee},{default:G(()=>n[7]||(n[7]=[e("svg",{class:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),O(" Back ",-1)])),_:1,__:[7]},8,["disabled"])):(p(),v("div",It)),b(ce,{variant:l.value?"success":"primary",loading:m.value||k.value,disabled:!M.value||m.value,onClick:te},{default:G(()=>[O(S(l.value?"Create Organization":"Next")+" ",1),l.value?z("",!0):(p(),v("svg",Ut,n[8]||(n[8]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])))]),_:1},8,["variant","loading","disabled"])]),e("div",Rt," Step "+S(s.value)+" of "+S(Y),1)])]),a.showContactWarning?(p(),ne(ht,{key:2,"organization-name":x.name,class:"mt-6"},null,8,["organization-name"])):z("",!0)]))}}),qt={class:"max-w-4xl mx-auto space-y-6"},Ht={class:"flex items-center justify-between"},Wt={class:"flex items-center space-x-2 text-sm text-gray-500 mb-2"},ta=F({__name:"OrganizationCreateView",setup(A){const _=pe(),o=h=>{_.push(`/organizations/${h}`)},y=()=>{_.push("/organizations")},V=h=>{console.log("Draft saved:",h)};return(h,s)=>{const m=he("router-link");return p(),v("div",qt,[e("div",Ht,[e("div",null,[e("nav",Wt,[b(m,{to:"/organizations",class:"hover:text-gray-700"},{default:G(()=>s[0]||(s[0]=[O("Organizations",-1)])),_:1,__:[0]}),b(ue(xe),{class:"h-4 w-4"}),s[1]||(s[1]=e("span",{class:"text-gray-900"},"New Organization",-1))]),s[2]||(s[2]=e("h1",{class:"text-2xl font-bold text-gray-900"},"Create New Organization",-1)),s[3]||(s[3]=e("p",{class:"mt-1 text-sm text-gray-500"}," Add a new organization to your CRM system ",-1))]),b(m,{to:"/organizations",class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},{default:G(()=>[b(ue(Ve),{class:"h-4 w-4 mr-2"}),s[4]||(s[4]=O(" Cancel ",-1))]),_:1,__:[4]})]),b(jt,{onSuccess:o,onCancel:y,onDraftSaved:V})])}}});export{ta as default};
//# sourceMappingURL=OrganizationCreateView-CF7TT23F.js.map
