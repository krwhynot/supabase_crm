import{d as W,r as I,c as V,o as X,E as ue,y as ae,a as d,b as e,h as k,e as T,t as y,n as A,F as Z,i as ee,j as n,f as B,l as ve,G as ge,q as re,w as te,p as fe,x as le,z as be,k as ce,B as ne,g as ye,u as ie}from"./index-Br7bM97V.js";import{o as me,u as he}from"./organizationStore-C4EDmZw3.js";import{_ as de}from"./Button.vue_vue_type_script_setup_true_lang-CbBM4C9T.js";import{_ as q,a as oe,u as pe}from"./SelectField.vue_vue_type_script_setup_true_lang-Bi7gw5HP.js";import{r as xe}from"./ChevronRightIcon-DBAMD-2N.js";import{r as we}from"./XMarkIcon-Bq58FYA6.js";import"./supabaseClient-CwaY5m9F.js";import"./index.esm-DHR-h0Sg.js";import"./contactsApi-BCMvmRtV.js";const _e={class:"space-y-1"},ke=["for"],Ce={key:0,class:"text-danger ml-1","aria-label":"required"},$e=["id"],Ve={class:"relative"},Se=["id","name","placeholder","disabled","required","value","aria-describedby","aria-invalid","aria-required","aria-expanded","aria-owns"],Be=["disabled"],ze={key:0,class:"absolute inset-y-0 right-8 flex items-center pr-3","aria-hidden":"true"},Me=["id","aria-label"],Ie={key:0,class:"px-3 py-2 text-sm text-gray-500",role:"option","aria-selected":"false"},De=["aria-selected","onClick","onMouseenter"],Ee={class:"flex items-center justify-between"},Fe={key:0,class:"h-4 w-4 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ne={key:0,class:"text-xs text-gray-500 mt-1"},Pe={key:1,class:"border-t border-gray-200"},Oe={class:"flex items-center"},je={key:2,class:"border-t border-gray-200"},Ae=["aria-selected","onClick"],Te={class:"flex items-center justify-between"},Le={class:"text-xs text-gray-400"},qe=["id"],Ue=["id"],Re=W({__name:"SegmentSelector",props:{name:{},label:{},modelValue:{},options:{default:()=>[]},error:{},placeholder:{default:"Select or type a segment..."},description:{},helpText:{},required:{type:Boolean},disabled:{type:Boolean},loading:{type:Boolean},allowAddNew:{type:Boolean,default:!0},popularSegments:{default:()=>[]},minSearchLength:{default:1},inputClass:{},labelClass:{}},emits:["update:modelValue","add-new","search","focus","blur","validate"],setup(L,{emit:N}){const o=L,$=N,w=I(),i=I(!1),l=I(""),r=I(-1),t=I(!1),s=[{value:"Technology",label:"Technology",description:"Software, hardware, and tech services"},{value:"Healthcare",label:"Healthcare",description:"Medical, pharmaceutical, and health services"},{value:"Finance",label:"Finance",description:"Banking, insurance, and financial services"},{value:"Manufacturing",label:"Manufacturing",description:"Production and industrial companies"},{value:"Retail",label:"Retail",description:"Consumer goods and retail services"},{value:"Education",label:"Education",description:"Schools, universities, and educational services"},{value:"Real Estate",label:"Real Estate",description:"Property development and real estate services"},{value:"Energy",label:"Energy",description:"Oil, gas, renewable energy, and utilities"},{value:"Transportation",label:"Transportation",description:"Logistics, shipping, and transportation"},{value:"Media",label:"Media",description:"Publishing, broadcasting, and entertainment"},{value:"Agriculture",label:"Agriculture",description:"Farming, food production, and agribusiness"},{value:"Construction",label:"Construction",description:"Building and construction services"},{value:"Consulting",label:"Consulting",description:"Business and professional consulting"},{value:"Government",label:"Government",description:"Public sector and government agencies"},{value:"Non-Profit",label:"Non-Profit",description:"Charitable organizations and NGOs"}],g=V(()=>`segment-${o.name}`),E=V(()=>`segment-dropdown-${o.name}`),C=V(()=>`error-${o.name}`),P=V(()=>`desc-${o.name}`),f=V(()=>`help-${o.name}`),S=V(()=>!!o.error),Q=V(()=>{const a=[];return o.description&&a.push(P.value),o.error&&a.push(C.value),o.helpText&&!o.error&&a.push(f.value),a.length>0?a.join(" "):void 0}),F=V(()=>{const u=[...o.options||[]];return s.forEach(h=>{u.some(D=>D.value.toLowerCase()===h.value.toLowerCase())||u.push(h)}),u.sort((h,D)=>h.label.localeCompare(D.label))}),U=V(()=>i.value&&l.value!==""?l.value:o.modelValue||""),M=V(()=>{if(!l.value||l.value.length<o.minSearchLength)return F.value.slice(0,10);const a=l.value.toLowerCase();return F.value.filter(u=>{var h;return u.label.toLowerCase().includes(a)||((h=u.description)==null?void 0:h.toLowerCase().includes(a))}).slice(0,20)}),H=V(()=>!o.allowAddNew||!l.value||l.value.length<o.minSearchLength?!1:!F.value.some(u=>u.label.toLowerCase()===l.value.toLowerCase())),b=V(()=>!l.value&&o.popularSegments.length>0),p=V(()=>{const a="block text-sm font-medium transition-colors duration-200",u=S.value?"text-red-700":t.value?"text-primary-600":"text-gray-700",h=o.disabled?"opacity-60":"",D=o.labelClass||"";return`${a} ${u} ${h} ${D}`.trim()}),_=V(()=>{const a="w-full px-3 py-2 pr-10 border rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:border-transparent",u=S.value?"border-red-500 bg-red-50 focus:ring-red-500 focus:bg-white":t.value?"border-primary-500 bg-white focus:ring-primary-500":"border-gray-300 bg-white hover:border-gray-400 focus:ring-primary-500",h=o.disabled?"bg-gray-100 text-gray-500 cursor-not-allowed":"cursor-text",D=o.loading?"pr-16":"",G=o.inputClass||"";return`${a} ${u} ${h} ${D} ${G}`.trim()}),R=V(()=>["absolute z-50 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg","max-h-60 overflow-auto focus:outline-none"].join(" ")),O=a=>{const u=a.target;l.value=u.value,!i.value&&u.value.length>=o.minSearchLength&&c(),r.value=-1,u.value.length>=o.minSearchLength&&$("search",u.value)},Y=a=>{t.value=!0,$("focus",a),l.value=o.modelValue||"",setTimeout(()=>{c()},100)},K=a=>{setTimeout(()=>{if(t.value=!1,z(),l.value&&!o.modelValue){const u=F.value.find(h=>h.label.toLowerCase()===l.value.toLowerCase());u?j(u):o.allowAddNew&&J()}l.value="",$("blur",a),$("validate",o.modelValue)},200)},v=a=>{var u;switch(a.key){case"ArrowDown":if(a.preventDefault(),!i.value)c();else{const h=H.value?M.value.length:M.value.length-1;r.value=Math.min(r.value+1,h)}break;case"ArrowUp":a.preventDefault(),r.value=Math.max(r.value-1,-1);break;case"Enter":a.preventDefault(),i.value&&(r.value===M.value.length&&H.value?J():r.value>=0&&r.value<M.value.length&&j(M.value[r.value]));break;case"Escape":a.preventDefault(),z(),(u=w.value)==null||u.blur();break;case"Tab":z();break}},m=()=>{var a;i.value?z():(c(),(a=w.value)==null||a.focus())},c=()=>{o.disabled||(i.value=!0,r.value=-1)},z=()=>{i.value=!1,r.value=-1},j=a=>{var u;$("update:modelValue",a.value),l.value="",z(),(u=w.value)==null||u.blur()},J=()=>{var a;if(l.value.trim()){const u=l.value.trim();$("add-new",u),$("update:modelValue",u),l.value="",z(),(a=w.value)==null||a.blur()}},x=a=>{const u=a.target,h=document.getElementById(E.value),D=w.value;h&&D&&!h.contains(u)&&!D.contains(u)&&z()};return X(()=>{document.addEventListener("click",x)}),ue(()=>{document.removeEventListener("click",x)}),ae(()=>o.modelValue,a=>{t.value||(l.value=a||"")}),(a,u)=>(n(),d("div",_e,[e("label",{for:g.value,class:A(p.value)},[T(y(a.label)+" ",1),a.required?(n(),d("span",Ce,"*")):k("",!0)],10,ke),a.description?(n(),d("p",{key:0,id:P.value,class:"text-sm text-gray-600"},y(a.description),9,$e)):k("",!0),e("div",Ve,[e("input",{id:g.value,ref_key:"inputRef",ref:w,name:a.name,type:"text",placeholder:a.placeholder,disabled:a.disabled,required:a.required,value:U.value,"aria-describedby":Q.value,"aria-invalid":S.value,"aria-required":a.required,"aria-expanded":i.value,"aria-haspopup":!0,"aria-owns":E.value,class:A(_.value),autocomplete:"off",onInput:O,onFocus:Y,onBlur:K,onKeydown:v},null,42,Se),e("button",{type:"button",disabled:a.disabled,class:"absolute inset-y-0 right-0 flex items-center pr-2","aria-label":"Toggle dropdown",onClick:m},[(n(),d("svg",{class:A(["h-4 w-4 transition-transform duration-200",i.value?"rotate-180":"",S.value?"text-red-500":"text-gray-400"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},u[1]||(u[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))],8,Be),a.loading?(n(),d("div",ze,u[2]||(u[2]=[e("svg",{class:"h-4 w-4 animate-spin text-gray-400",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):k("",!0),i.value?(n(),d("div",{key:1,id:E.value,class:A(R.value),role:"listbox","aria-label":`${a.label} options`},[M.value.length===0&&!H.value?(n(),d("div",Ie," No segments found ")):k("",!0),(n(!0),d(Z,null,ee(M.value,(h,D)=>(n(),d("button",{key:h.value,type:"button",class:A(["w-full text-left px-3 py-2 text-sm hover:bg-gray-100 focus:bg-gray-100 focus:outline-none",D===r.value?"bg-primary-50 text-primary-900":"text-gray-900"]),role:"option","aria-selected":h.value===a.modelValue,onClick:G=>j(h),onMouseenter:G=>r.value=D},[e("div",Ee,[e("span",null,y(h.label),1),h.value===a.modelValue?(n(),d("svg",Fe,u[3]||(u[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):k("",!0)]),h.description?(n(),d("p",Ne,y(h.description),1)):k("",!0)],42,De))),128)),H.value?(n(),d("div",Pe,[e("button",{type:"button",class:A(["w-full text-left px-3 py-2 text-sm hover:bg-blue-50 focus:bg-blue-50 focus:outline-none",r.value===M.value.length?"bg-blue-50 text-blue-900":"text-blue-700"]),role:"option","aria-selected":"false",onClick:J,onMouseenter:u[0]||(u[0]=h=>r.value=M.value.length)},[e("div",Oe,[u[4]||(u[4]=e("svg",{class:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1)),T(' Add new segment: "'+y(l.value)+'" ',1)])],34)])):k("",!0),b.value&&a.popularSegments.length>0?(n(),d("div",je,[u[5]||(u[5]=e("div",{class:"px-3 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wide"}," Popular Segments ",-1)),(n(!0),d(Z,null,ee(a.popularSegments,h=>(n(),d("button",{key:`popular-${h.value}`,type:"button",class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 focus:bg-gray-100 focus:outline-none",role:"option","aria-selected":h.value===a.modelValue,onClick:D=>j(h)},[e("div",Te,[e("span",null,y(h.label),1),e("span",Le,y(h.count)+" orgs",1)])],8,Ae))),128))])):k("",!0)],10,Me)):k("",!0)]),a.error?(n(),d("p",{key:1,id:C.value,role:"alert",class:"text-sm text-danger flex items-center space-x-1"},[u[6]||(u[6]=e("svg",{class:"h-4 w-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,y(a.error),1)],8,qe)):k("",!0),a.helpText&&!a.error?(n(),d("p",{key:2,id:f.value,class:"text-sm text-gray-500"},y(a.helpText),9,Ue)):k("",!0)]))}}),He={class:"space-y-4 md:space-y-6"},Ke={class:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6"},Ge={class:"md:col-span-2"},Je={class:"space-y-4"},Qe=["aria-expanded"],We={class:"flex items-center"},Xe={class:"text-xs text-gray-500"},Ye={id:"advanced-options",class:"space-y-4 pl-6 border-l-2 border-gray-200 animate-in slide-in-from-top-2 duration-200"},Ze={class:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6"},et={class:"space-y-3"},tt={class:"space-y-2"},at={class:"flex items-center"},ot=["checked"],st={class:"flex items-center"},rt=["checked"],lt=W({__name:"OrganizationStepOne",props:{modelValue:{},errors:{},loading:{type:Boolean,default:!1}},emits:["update:modelValue","validate"],setup(L,{emit:N}){const o=L,$=N,w=I(!1),i=[{value:90,label:"A",description:"Highest priority - Strategic accounts and major opportunities"},{value:70,label:"B",description:"High priority - Important prospects and qualified leads"},{value:50,label:"C",description:"Medium priority - Regular prospects and opportunities"},{value:30,label:"D",description:"Low priority - New prospects and informational contacts"}],l=[{value:"Prospect",label:"Prospect",description:"Potential customer or client"},{value:"Active",label:"Active",description:"Currently engaged organization"},{value:"Customer",label:"Customer",description:"Paying customer or client"},{value:"Partner",label:"Partner",description:"Business partner or alliance"},{value:"Vendor",label:"Vendor",description:"Service or product provider"},{value:"Inactive",label:"Inactive",description:"No longer active relationship"}],r=[{value:"Food & Beverage - Manufacturing",label:"Food & Beverage - Manufacturing",description:"Food and beverage production companies"},{value:"Food & Beverage - Distribution",label:"Food & Beverage - Distribution",description:"Food and beverage distribution companies"},{value:"Food & Beverage - Retail",label:"Food & Beverage - Retail",description:"Food and beverage retail outlets"},{value:"Food & Beverage - Restaurant",label:"Food & Beverage - Restaurant",description:"Restaurants and food service establishments"},{value:"Technology",label:"Technology",description:"Software, hardware, and tech services"},{value:"Healthcare",label:"Healthcare",description:"Medical and health services"},{value:"Finance",label:"Finance",description:"Banking and financial services"},{value:"Manufacturing",label:"Manufacturing",description:"Production and industrial"},{value:"Retail",label:"Retail",description:"Consumer goods and services"},{value:"Professional Services",label:"Professional Services",description:"Consulting and professional services"}],t=[{value:"Food & Beverage - Manufacturing",label:"Food & Beverage - Manufacturing",count:312},{value:"Food & Beverage - Distribution",label:"Food & Beverage - Distribution",count:287},{value:"Food & Beverage - Restaurant",label:"Food & Beverage - Restaurant",count:245},{value:"Technology",label:"Technology",count:189},{value:"Manufacturing",label:"Manufacturing",count:156}],s=[{value:"dist-1",label:"ABC Distribution Corp",description:"National food distributor"},{value:"dist-2",label:"XYZ Supply Chain",description:"Regional beverage distributor"},{value:"dist-3",label:"Global Foods Distribution",description:"International food distributor"}],g=[{value:"am-1",label:"John Smith",description:"Senior Account Manager"},{value:"am-2",label:"Sarah Johnson",description:"Account Manager - Food & Beverage"},{value:"am-3",label:"Mike Davis",description:"Regional Account Manager"}],E=V(()=>{const b=o.modelValue.lead_score;return b==null?"":b>=90?90:b>=70?70:b>=50?50:30}),C=V(()=>o.modelValue.is_principal===!0),P=V(()=>o.modelValue.is_distributor===!0),f=(b,p)=>{const _={...o.modelValue,[b]:p};$("update:modelValue",_)},S=b=>{const p=Array.isArray(b)?b[0]:b,_=typeof p=="string"?parseInt(p):p;f("lead_score",_)},Q=(b,p)=>{b==="principal"?p?(f("is_principal",!0),f("is_distributor",!1),f("distributor_id","")):f("is_principal",!1):b==="distributor"&&(p?(f("is_distributor",!0),f("is_principal",!1),f("distributor_id","")):f("is_distributor",!1))},F=async(b,p)=>{await U()},U=async()=>{const b={};let p=!0;try{const _={name:o.modelValue.name,industry:o.modelValue.industry,lead_score:o.modelValue.lead_score,status:o.modelValue.status,is_principal:o.modelValue.is_principal,is_distributor:o.modelValue.is_distributor,distributor_id:o.modelValue.distributor_id,account_manager_id:o.modelValue.account_manager_id};await me.pick(["name","industry","lead_score","status"]).validate(_,{abortEarly:!1})}catch(_){p=!1,_.inner&&_.inner.forEach(R=>{if(R.path){const O=R.path==="industry"?"segment":R.path==="lead_score"?"priority":R.path;b[O]=R.message}})}$("validate",1,p,b)},M=b=>{f("industry",b)},H=b=>{};return ae(()=>[o.modelValue.name,o.modelValue.industry,o.modelValue.lead_score,o.modelValue.status,o.modelValue.is_principal,o.modelValue.is_distributor,o.modelValue.distributor_id,o.modelValue.account_manager_id],async()=>{await U()},{immediate:!0}),X(async()=>{await U()}),(b,p)=>(n(),d("div",He,[e("div",Ke,[e("div",Ge,[B(q,{name:"name",label:"Organization Name",type:"text","model-value":b.modelValue.name||"",error:b.errors.name,placeholder:"Enter the organization name",required:"",autocomplete:"organization","onUpdate:modelValue":p[0]||(p[0]=_=>f("name",_)),onValidate:p[1]||(p[1]=_=>F())},null,8,["model-value","error"])]),B(oe,{name:"priority",label:"Priority","model-value":E.value,options:i,error:b.errors.priority||b.errors.lead_score,placeholder:"Select organization priority",required:"","onUpdate:modelValue":S,onValidate:p[2]||(p[2]=_=>F())},null,8,["model-value","error"]),B(oe,{name:"status",label:"Organization Status","model-value":b.modelValue.status||"Prospect",options:l,error:b.errors.status,placeholder:"Select organization status","onUpdate:modelValue":p[3]||(p[3]=_=>f("status",_)),onValidate:p[4]||(p[4]=_=>F())},null,8,["model-value","error"])]),B(Re,{name:"segment",label:"Segment","model-value":b.modelValue.industry||"",error:b.errors.segment||b.errors.industry,options:r,"popular-segments":t,placeholder:"Select or type an industry segment...",required:"","allow-add-new":"","onUpdate:modelValue":p[5]||(p[5]=_=>f("industry",_)),onAddNew:M,onSearch:H,onValidate:p[6]||(p[6]=_=>F())},null,8,["model-value","error"]),e("div",Je,[e("button",{type:"button",onClick:p[7]||(p[7]=_=>w.value=!w.value),class:"flex items-center justify-between w-full p-3 text-left text-sm font-medium text-gray-700 bg-gray-50 hover:bg-gray-100 rounded-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2","aria-expanded":w.value,"aria-controls":"advanced-options"},[e("span",We,[(n(),d("svg",{class:A(["h-4 w-4 mr-2 transition-transform duration-200",w.value?"rotate-90":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},p[14]||(p[14]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)]),2)),p[15]||(p[15]=T(" Advanced Options ",-1))]),e("span",Xe,y(w.value?"Hide":"Show")+" additional fields ",1)],8,Qe),ve(e("div",Ye,[e("div",Ze,[e("div",et,[p[18]||(p[18]=e("label",{class:"block text-sm font-medium text-gray-700"}," Business Type ",-1)),e("div",tt,[e("div",at,[e("input",{id:"principal",name:"business-type",type:"checkbox",checked:C.value,onChange:p[8]||(p[8]=_=>Q("principal",_.target.checked)),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,40,ot),p[16]||(p[16]=e("label",{for:"principal",class:"ml-2 block text-sm text-gray-900"}," Principal ",-1))]),e("div",st,[e("input",{id:"distributor",name:"business-type",type:"checkbox",checked:P.value,onChange:p[9]||(p[9]=_=>Q("distributor",_.target.checked)),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,40,rt),p[17]||(p[17]=e("label",{for:"distributor",class:"ml-2 block text-sm text-gray-900"}," Distributor ",-1))])])]),B(oe,{name:"account_manager_id",label:"Account Manager","model-value":b.modelValue.account_manager_id||"",options:g,error:b.errors.account_manager_id,placeholder:"Select an account manager","onUpdate:modelValue":p[10]||(p[10]=_=>f("account_manager_id",_)),onValidate:p[11]||(p[11]=_=>F())},null,8,["model-value","error"])]),P.value?k("",!0):(n(),re(oe,{key:0,name:"distributor_id",label:"Distributor","model-value":b.modelValue.distributor_id||"",options:s,error:b.errors.distributor_id,placeholder:"Select a distributor","onUpdate:modelValue":p[12]||(p[12]=_=>f("distributor_id",_)),onValidate:p[13]||(p[13]=_=>F())},null,8,["model-value","error"]))],512),[[ge,w.value]])])]))}}),nt={class:"space-y-4 md:space-y-6"},it={class:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6"},dt={class:"md:col-span-2"},ut={class:"md:col-span-2"},ct={class:"space-y-4"},mt={class:"space-y-2"},pt=["value"],vt={key:0,class:"text-sm text-red-600"},gt=W({__name:"OrganizationStepTwo",props:{modelValue:{},errors:{},loading:{type:Boolean,default:!1}},emits:["update:modelValue","validate"],setup(L,{emit:N}){const o=L,$=N,w=(r,t)=>{const s={...o.modelValue,[r]:t};$("update:modelValue",s)},i=(r,t)=>{l()},l=()=>{$("validate",2,!0,{})};return ae(()=>[o.modelValue.address_line_1,o.modelValue.address_line_2,o.modelValue.city,o.modelValue.state_province,o.modelValue.postal_code,o.modelValue.primary_phone,o.modelValue.description],()=>{l()},{immediate:!0}),X(()=>{l()}),(r,t)=>(n(),d("div",nt,[t[16]||(t[16]=e("div",null,[e("h3",{class:"text-base font-medium text-gray-900 mb-1"},"Address Information"),e("p",{class:"text-sm text-gray-600 mb-4"}," Provide the organization's address and contact details ")],-1)),e("div",it,[e("div",dt,[B(q,{name:"address_line_1",label:"Address Line 1",type:"text","model-value":r.modelValue.address_line_1||"",error:r.errors.address_line_1,placeholder:"Enter street address","onUpdate:modelValue":t[0]||(t[0]=s=>w("address_line_1",s)),onValidate:t[1]||(t[1]=s=>i())},null,8,["model-value","error"])]),e("div",ut,[B(q,{name:"address_line_2",label:"Address Line 2",type:"text","model-value":r.modelValue.address_line_2||"",error:r.errors.address_line_2,placeholder:"Apt, suite, unit, etc. (optional)","onUpdate:modelValue":t[2]||(t[2]=s=>w("address_line_2",s)),onValidate:t[3]||(t[3]=s=>i())},null,8,["model-value","error"])]),B(q,{name:"city",label:"City",type:"text","model-value":r.modelValue.city||"",error:r.errors.city,placeholder:"Enter city","onUpdate:modelValue":t[4]||(t[4]=s=>w("city",s)),onValidate:t[5]||(t[5]=s=>i())},null,8,["model-value","error"]),B(q,{name:"state_province",label:"State",type:"text","model-value":r.modelValue.state_province||"",error:r.errors.state_province,placeholder:"Enter state","onUpdate:modelValue":t[6]||(t[6]=s=>w("state_province",s)),onValidate:t[7]||(t[7]=s=>i())},null,8,["model-value","error"]),B(q,{name:"postal_code",label:"Postal Code",type:"text","model-value":r.modelValue.postal_code||"",error:r.errors.postal_code,placeholder:"Enter postal/zip code","onUpdate:modelValue":t[8]||(t[8]=s=>w("postal_code",s)),onValidate:t[9]||(t[9]=s=>i())},null,8,["model-value","error"]),B(q,{name:"primary_phone",label:"Office Phone",type:"tel","model-value":r.modelValue.primary_phone||"",error:r.errors.primary_phone,placeholder:"Enter office phone number","onUpdate:modelValue":t[10]||(t[10]=s=>w("primary_phone",s)),onValidate:t[11]||(t[11]=s=>i())},null,8,["model-value","error"])]),e("div",ct,[t[15]||(t[15]=e("div",null,[e("h4",{class:"text-md font-medium text-gray-900 mb-2"},"Notes & Description"),e("p",{class:"text-sm text-gray-600"}," Additional information about the organization ")],-1)),e("div",mt,[t[14]||(t[14]=e("label",{for:"description",class:"block text-sm font-medium text-gray-700"}," Notes & Description ",-1)),e("textarea",{id:"description",name:"description",rows:"4",value:r.modelValue.description||"",class:A(["w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2",r.errors.description?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-blue-500"]),placeholder:"Enter any additional notes or description about the organization...",onInput:t[12]||(t[12]=s=>w("description",s.target.value)),onBlur:t[13]||(t[13]=s=>i("description",s.target.value))},null,42,pt),r.errors.description?(n(),d("p",vt,y(r.errors.description),1)):k("",!0)])])]))}}),ft={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},bt={class:"flex items-center justify-between mb-4"},yt={class:"flex items-center space-x-3"},ht={class:"text-md font-medium text-gray-900"},xt={key:1,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},wt=["aria-label"],_t={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},kt={key:0,class:"mt-4 p-3 bg-white border border-gray-200 rounded-md"},Ct={class:"flex items-start space-x-3"},$t={class:"flex-1 min-w-0"},Vt={class:"text-sm font-medium text-gray-900"},St={key:0,class:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800"},Bt={class:"text-sm text-gray-500"},zt={key:0,class:"text-xs text-gray-400"},Mt={key:0},It={key:1,class:"text-xs text-gray-400"},Dt={key:1,class:"mt-3"},Et={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},Ft={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},Nt=W({__name:"QuickContactForm",props:{modelValue:{},errors:{},contactNumber:{},showRemove:{type:Boolean,default:!0},isPrimary:{type:Boolean,default:!1},showSetPrimary:{type:Boolean,default:!0}},emits:["update:modelValue","remove","set-primary"],setup(L,{emit:N}){const o=L,$=N,w=V(()=>{var t,s,g;return((t=o.modelValue.first_name)==null?void 0:t.trim())&&((s=o.modelValue.last_name)==null?void 0:s.trim())&&((g=o.modelValue.email)==null?void 0:g.trim())}),i=V(()=>{const t=Object.keys(o.errors).length,s=["first_name","last_name","email"],g=s.filter(E=>{var C;return(C=o.modelValue[E])==null?void 0:C.trim()}).length;return t>0?{isValid:!1,message:`${t} validation error${t>1?"s":""} found`}:g===s.length?{isValid:!0,message:"Contact information is complete"}:{isValid:!1,message:`${s.length-g} required field${s.length-g>1?"s":""} remaining`}}),l=(t,s)=>{var C;const g=Array.isArray(s)?((C=s[0])==null?void 0:C.toString())||"":(s==null?void 0:s.toString())||"",E={...o.modelValue,[t]:g};$("update:modelValue",E)},r=t=>{console.debug(`Validating field: ${t}`)};return(t,s)=>(n(),d("div",ft,[e("div",bt,[e("div",yt,[e("h4",ht," Contact "+y(t.contactNumber),1),!t.isPrimary&&t.showSetPrimary?(n(),d("button",{key:0,type:"button",onClick:s[0]||(s[0]=g=>t.$emit("set-primary")),class:"inline-flex items-center px-2 py-1 text-xs font-medium rounded border border-gray-300 text-gray-700 bg-white hover:bg-blue-50 hover:text-blue-700 hover:border-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors"}," Set as Primary ")):t.isPrimary?(n(),d("span",xt,s[12]||(s[12]=[e("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),T(" Primary Contact ",-1)]))):k("",!0)]),t.showRemove?(n(),d("button",{key:0,type:"button",onClick:s[1]||(s[1]=g=>t.$emit("remove")),class:"text-red-600 hover:text-red-800 transition-colors","aria-label":`Remove contact ${t.contactNumber}`},s[13]||(s[13]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,wt)):k("",!0)]),e("div",_t,[B(q,{name:`contact_${t.contactNumber}_first_name`,label:"First Name",type:"text","model-value":t.modelValue.first_name,error:t.errors.first_name,placeholder:"Enter first name",required:"","onUpdate:modelValue":s[2]||(s[2]=g=>l("first_name",g)),onBlur:s[3]||(s[3]=g=>r("first_name"))},null,8,["name","model-value","error"]),B(q,{name:`contact_${t.contactNumber}_last_name`,label:"Last Name",type:"text","model-value":t.modelValue.last_name,error:t.errors.last_name,placeholder:"Enter last name",required:"","onUpdate:modelValue":s[4]||(s[4]=g=>l("last_name",g)),onBlur:s[5]||(s[5]=g=>r("last_name"))},null,8,["name","model-value","error"]),B(q,{name:`contact_${t.contactNumber}_email`,label:"Email Address",type:"email","model-value":t.modelValue.email,error:t.errors.email,placeholder:"Enter email address",required:"",autocomplete:"email","onUpdate:modelValue":s[6]||(s[6]=g=>l("email",g)),onBlur:s[7]||(s[7]=g=>r("email"))},null,8,["name","model-value","error"]),B(q,{name:`contact_${t.contactNumber}_phone`,label:"Phone Number",type:"tel","model-value":t.modelValue.phone,error:t.errors.phone,placeholder:"Enter phone number",autocomplete:"tel","onUpdate:modelValue":s[8]||(s[8]=g=>l("phone",g)),onBlur:s[9]||(s[9]=g=>r("phone"))},null,8,["name","model-value","error"]),B(q,{name:`contact_${t.contactNumber}_position`,label:"Job Title",type:"text","model-value":t.modelValue.position,error:t.errors.position,placeholder:"Enter job title",autocomplete:"organization","onUpdate:modelValue":s[10]||(s[10]=g=>l("position",g))},null,8,["name","model-value","error"]),B(q,{name:`contact_${t.contactNumber}_department`,label:"Department",type:"text","model-value":t.modelValue.department,error:t.errors.department,placeholder:"Enter department","onUpdate:modelValue":s[11]||(s[11]=g=>l("department",g))},null,8,["name","model-value","error"])]),w.value?(n(),d("div",kt,[e("div",Ct,[s[14]||(s[14]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})])])],-1)),e("div",$t,[e("p",Vt,[T(y(t.modelValue.first_name)+" "+y(t.modelValue.last_name)+" ",1),t.isPrimary?(n(),d("span",St," Primary ")):k("",!0)]),e("p",Bt,y(t.modelValue.email),1),t.modelValue.position?(n(),d("p",zt,[T(y(t.modelValue.position)+" ",1),t.modelValue.department?(n(),d("span",Mt," • "+y(t.modelValue.department),1)):k("",!0)])):k("",!0),t.modelValue.phone?(n(),d("p",It,y(t.modelValue.phone),1)):k("",!0)])])])):k("",!0),i.value?(n(),d("div",Dt,[e("div",{class:A(["flex items-center text-xs px-2 py-1 rounded",i.value.isValid?"bg-green-50 text-green-700":"bg-red-50 text-red-700"])},[(n(),d("svg",{class:A(["w-4 h-4 mr-1",i.value.isValid?"text-green-400":"text-red-400"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i.value.isValid?(n(),d("path",Et)):(n(),d("path",Ft))],2)),T(" "+y(i.value.message),1)],2)])):k("",!0)]))}}),Pt={class:"space-y-6"},Ot={class:"flex items-center justify-center space-x-4"},jt={key:0,class:"space-y-4"},At={class:"relative"},Tt={key:0,class:"space-y-2"},Lt={class:"flex items-center justify-between"},qt={class:"text-xs text-gray-500"},Ut={class:"max-h-64 overflow-y-auto border border-gray-200 rounded-md bg-white"},Rt={class:"flex items-center space-x-3"},Ht=["id","checked","onChange"],Kt={class:"flex-1"},Gt=["for"],Jt={class:"text-xs text-gray-500"},Qt={key:0,class:"text-xs text-gray-400"},Wt={class:"flex items-center space-x-2"},Xt={key:0,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Yt=["onClick","disabled"],Zt={key:1,class:"text-center py-8"},ea={class:"mt-2 text-sm text-gray-500"},ta={key:2,class:"text-center py-4"},aa={key:3,class:"mt-6"},oa={class:"flex items-center justify-between mb-3"},sa={class:"text-sm font-medium text-gray-700"},ra={class:"space-y-2"},la={class:"flex items-center space-x-3"},na={class:"flex-1"},ia={class:"text-sm font-medium text-gray-900"},da={key:0,class:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800"},ua=["onClick","aria-label"],ca={key:1,class:"space-y-4"},ma={key:0,class:"space-y-6"},pa={key:1,class:"text-center py-8"},va={key:2,class:"p-3 bg-red-50 border border-red-200 rounded-md",role:"alert"},ga={class:"flex items-start"},fa={class:"text-sm text-red-700"},ba=W({__name:"ContactMultiSelector",props:{modelValue:{},error:{},loading:{type:Boolean,default:!1}},emits:["update:modelValue","validate"],setup(L,{emit:N}){const o=L,$=N,w=pe(),i=I(o.modelValue.mode||"select"),l=I(""),r=I(o.modelValue.selectedContactIds||[]),t=I(o.modelValue.newContacts||[]),s=I(o.modelValue.primaryContactIndex??-1),g=I({}),E=I(!1),C=V(()=>{if(!l.value)return w.contacts.slice(0,20);const v=l.value.toLowerCase();return w.contacts.filter(m=>{var c,z,j,J;return((c=m.first_name)==null?void 0:c.toLowerCase().includes(v))||((z=m.last_name)==null?void 0:z.toLowerCase().includes(v))||((j=m.email)==null?void 0:j.toLowerCase().includes(v))||((J=m.position)==null?void 0:J.toLowerCase().includes(v))}).slice(0,50)}),P=v=>{i.value=v,v==="select"?(t.value=[],s.value=-1,g.value={}):(r.value=[],l.value=""),O()},f=async v=>{if(l.value=v,v.length>=2){E.value=!0;try{await w.searchContacts(v)}finally{E.value=!1}}},S=(v,m)=>{m?r.value.includes(v)||(r.value.push(v),r.value.length===1&&U(v)):(r.value=r.value.filter(c=>c!==v),M()===v&&r.value.length>0&&U(r.value[0])),O()},Q=v=>{r.value=r.value.filter(m=>m!==v),M()===v&&r.value.length>0&&U(r.value[0]),O()},F=()=>{r.value=[],O()},U=v=>{O({primaryContactId:v})},M=()=>o.modelValue.primaryContactId||r.value[0],H=v=>{const m=w.contacts.find(c=>c.id===v);return m&&`${m.first_name||""} ${m.last_name||""}`.trim()||"Unknown Contact"},b=()=>{const v={tempId:`temp_${Date.now()}_${Math.random()}`,first_name:"",last_name:"",email:"",phone:"",position:"",department:""};t.value.push(v),t.value.length===1&&(s.value=0),O()},p=v=>{const m=t.value[v];t.value.splice(v,1),g.value[m.tempId]&&delete g.value[m.tempId],s.value===v?s.value=t.value.length>0?0:-1:s.value>v&&s.value--,O()},_=(v,m)=>{t.value[v]&&(t.value[v]={...m},g.value[m.tempId]&&(g.value[m.tempId]={}),O())},R=v=>{s.value=v,O()},O=(v={})=>{const m={mode:i.value,selectedContactIds:[...r.value],newContacts:[...t.value],primaryContactId:M(),primaryContactIndex:s.value,...v};$("update:modelValue",m);const c=Y();$("validate",c,{})},Y=()=>{let v=!0;return i.value==="select"?r.value.length===0&&(v=!1):i.value==="create"&&(t.value.length===0?v=!1:t.value.forEach(m=>{const c={};m.first_name.trim()||(c.first_name="First name is required",v=!1),m.last_name.trim()||(c.last_name="Last name is required",v=!1),m.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m.email)||(c.email="Please enter a valid email address",v=!1):(c.email="Email is required",v=!1),Object.keys(c).length>0&&(g.value[m.tempId]=c)})),v},K=()=>{i.value=o.modelValue.mode||"select",r.value=[...o.modelValue.selectedContactIds||[]],t.value=[...o.modelValue.newContacts||[]],s.value=o.modelValue.primaryContactIndex??-1};return ae(()=>o.modelValue,K,{deep:!0}),X(async()=>{await w.fetchContacts(),K();const v=Y();$("validate",v,{})}),(v,m)=>(n(),d("div",Pt,[e("div",Ot,[e("button",{type:"button",class:A(["px-4 py-2 rounded-md font-medium text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors",i.value==="select"?"bg-blue-100 text-blue-800 border border-blue-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"]),onClick:m[0]||(m[0]=c=>P("select"))},m[4]||(m[4]=[e("svg",{class:"w-4 h-4 mr-2 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1),T(" Select Existing Contacts ",-1)]),2),e("button",{type:"button",class:A(["px-4 py-2 rounded-md font-medium text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors",i.value==="create"?"bg-blue-100 text-blue-800 border border-blue-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"]),onClick:m[1]||(m[1]=c=>P("create"))},m[5]||(m[5]=[e("svg",{class:"w-4 h-4 mr-2 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),T(" Create New Contacts ",-1)]),2)]),i.value==="select"?(n(),d("div",jt,[e("div",At,[B(q,{name:"contact_search",label:"Search Contacts",type:"text","model-value":l.value,placeholder:"Type to search for existing contacts...","onUpdate:modelValue":m[2]||(m[2]=c=>f(String(c)))},{icon:te(()=>m[6]||(m[6]=[e("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)])),_:1},8,["model-value"])]),C.value.length>0?(n(),d("div",Tt,[e("div",Lt,[m[7]||(m[7]=e("h4",{class:"text-sm font-medium text-gray-700"},"Available Contacts",-1)),e("span",qt,y(C.value.length)+" found",1)]),e("div",Ut,[(n(!0),d(Z,null,ee(C.value,c=>(n(),d("div",{key:c.id||c.email||`contact-${Math.random()}`,class:"flex items-center justify-between p-3 hover:bg-gray-50 border-b border-gray-100 last:border-b-0 transition-colors"},[e("div",Rt,[e("input",{id:`contact-${c.id||"unknown"}`,type:"checkbox",checked:c.id?r.value.includes(c.id):!1,onChange:z=>c.id&&S(c.id,z.target.checked),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,40,Ht),e("div",Kt,[e("label",{for:`contact-${c.id||"unknown"}`,class:"text-sm font-medium text-gray-900 cursor-pointer block"},y(c.first_name)+" "+y(c.last_name),9,Gt),e("p",Jt,y(c.email),1),c.position?(n(),d("p",Qt,y(c.position),1)):k("",!0)])]),e("div",Wt,[c.id&&M()===c.id?(n(),d("span",Xt," Primary ")):k("",!0),c.id&&r.value.includes(c.id)?(n(),d("button",{key:1,type:"button",onClick:z=>c.id&&U(c.id),class:A(["text-xs px-2 py-1 rounded border transition-colors",M()===c.id?"bg-blue-50 text-blue-600 border-blue-200 cursor-default":"bg-gray-50 text-gray-600 border-gray-200 hover:bg-blue-50 hover:text-blue-600"]),disabled:!c.id||M()===c.id},y(M()===c.id?"Primary":"Set Primary"),11,Yt)):k("",!0)])]))),128))])])):l.value&&!E.value?(n(),d("div",Zt,[m[8]||(m[8]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),e("p",ea,'No contacts found matching "'+y(l.value)+'"',1),e("button",{type:"button",onClick:m[3]||(m[3]=c=>P("create")),class:"mt-2 text-sm text-blue-600 hover:text-blue-500"}," Create a new contact instead ")])):k("",!0),E.value?(n(),d("div",ta,m[9]||(m[9]=[fe('<div class="inline-flex items-center"><svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-blue-600" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span class="text-sm text-gray-600">Searching contacts...</span></div>',1)]))):k("",!0),r.value.length>0?(n(),d("div",aa,[e("div",oa,[e("h4",sa," Selected Contacts ("+y(r.value.length)+") ",1),e("button",{type:"button",onClick:F,class:"text-xs text-gray-500 hover:text-gray-700"}," Clear all ")]),e("div",ra,[(n(!0),d(Z,null,ee(r.value,c=>(n(),d("div",{key:c,class:"flex items-center justify-between bg-blue-50 border border-blue-200 p-3 rounded-md"},[e("div",la,[e("div",na,[e("span",ia,y(H(c)),1),M()===c?(n(),d("span",da," Primary Contact ")):k("",!0)])]),e("button",{type:"button",onClick:z=>Q(c),class:"text-red-600 hover:text-red-800 transition-colors","aria-label":`Remove ${H(c)}`},m[10]||(m[10]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,ua)]))),128))])])):k("",!0)])):i.value==="create"?(n(),d("div",ca,[e("div",{class:"text-center"},[e("button",{type:"button",onClick:b,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"},m[11]||(m[11]=[e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),T(" Add New Contact ",-1)]))]),t.value.length>0?(n(),d("div",ma,[(n(!0),d(Z,null,ee(t.value,(c,z)=>(n(),re(Nt,{key:c.tempId,"model-value":c,errors:g.value[c.tempId]||{},"contact-number":z+1,"show-remove":t.value.length>1,"is-primary":s.value===z,"onUpdate:modelValue":j=>_(z,j),onRemove:j=>p(z),onSetPrimary:j=>R(z)},null,8,["model-value","errors","contact-number","show-remove","is-primary","onUpdate:modelValue","onRemove","onSetPrimary"]))),128))])):(n(),d("div",pa,m[12]||(m[12]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1),e("p",{class:"mt-2 text-sm text-gray-500"},"No contacts added yet",-1),e("p",{class:"text-xs text-gray-400"},'Click "Add New Contact" to get started',-1)])))])):k("",!0),v.error?(n(),d("div",va,[e("div",ga,[m[13]||(m[13]=e("svg",{class:"w-5 h-5 text-red-400 mr-2 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",fa,y(v.error),1)])])):k("",!0)]))}}),ya={class:"space-y-6"},ha={class:"space-y-4"},xa={key:0,class:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-md"},wa={class:"flex items-start"},_a={class:"flex-1"},ka={class:"mt-2 text-sm text-blue-700"},Ca={key:0},$a={key:1},Va={key:2,class:"mt-1"},Sa=W({__name:"OrganizationStepThree",props:{modelValue:{},errors:{},loading:{type:Boolean,default:!1}},emits:["update:modelValue","validate"],setup(L,{emit:N}){const o=L,$=N,w=pe(),i=I({mode:"select",selectedContactIds:[],newContacts:[],primaryContactId:void 0,primaryContactIndex:-1}),l=I(""),r=I(!1),t=V(()=>i.value.mode==="select"?i.value.selectedContactIds.length>0:i.value.newContacts.length>0),s=V(()=>{if(i.value.mode==="select"&&i.value.primaryContactId){const f=w.contacts.find(S=>S.id===i.value.primaryContactId);return f?`${f.first_name} ${f.last_name}`:void 0}else if(i.value.mode==="create"&&i.value.primaryContactIndex!==void 0&&i.value.primaryContactIndex>=0){const f=i.value.newContacts[i.value.primaryContactIndex];return f?`${f.first_name} ${f.last_name}`:void 0}}),g=f=>{i.value={...f},C()},E=(f,S)=>{r.value=f,l.value=S.contacts||"",$("validate",3,f,S)},C=()=>{const f={...o.modelValue};f.custom_fields={...f.custom_fields,contact_mode:i.value.mode,selected_contact_ids:i.value.selectedContactIds,new_contacts:i.value.newContacts,primary_contact_id:i.value.primaryContactId,primary_contact_index:i.value.primaryContactIndex},$("update:modelValue",f)},P=()=>{const f=o.modelValue.custom_fields;f&&(i.value={mode:f.contact_mode||"select",selectedContactIds:f.selected_contact_ids||[],newContacts:f.new_contacts||[],primaryContactId:f.primary_contact_id,primaryContactIndex:f.primary_contact_index??-1})};return ae(()=>o.modelValue.custom_fields,()=>{P()},{deep:!0}),X(async()=>{await w.fetchContacts(),P()}),(f,S)=>(n(),d("div",ya,[e("div",ha,[S[3]||(S[3]=e("div",{class:"text-center"},[e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Contact Information"),e("p",{class:"text-sm text-gray-600 mb-6"}," Select existing contacts or create new contacts for this organization ")],-1)),B(ba,{"model-value":i.value,error:l.value,loading:f.loading,"onUpdate:modelValue":g,onValidate:E},null,8,["model-value","error","loading"]),t.value?(n(),d("div",xa,[e("div",wa,[S[2]||(S[2]=e("svg",{class:"w-5 h-5 text-blue-400 mr-3 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("div",_a,[S[1]||(S[1]=e("h4",{class:"text-sm font-medium text-blue-800"},"Contact Assignment",-1)),e("div",ka,[i.value.mode==="select"?(n(),d("p",Ca,y(i.value.selectedContactIds.length)+" existing contact"+y(i.value.selectedContactIds.length!==1?"s":"")+" will be linked to this organization. ",1)):(n(),d("p",$a,y(i.value.newContacts.length)+" new contact"+y(i.value.newContacts.length!==1?"s":"")+" will be created and linked to this organization. ",1)),s.value?(n(),d("p",Va,[e("strong",null,y(s.value),1),S[0]||(S[0]=T(" will be set as the primary contact. ",-1))])):k("",!0)])])])])):k("",!0)])]))}}),Ba={class:"max-w-4xl mx-auto"},za={class:"mb-3"},Ma={class:"flex items-center justify-center space-x-2 mb-2"},Ia=["aria-label"],Da={class:"text-center"},Ea={class:"text-base font-medium text-gray-900"},Fa={class:"text-xs text-gray-600 mt-0.5"},Na={key:0,class:"mb-3 flex items-center justify-center text-xs"},Pa={key:0,class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"},Oa={key:1,class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ja={key:2,class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Aa={key:1,class:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",role:"alert"},Ta={class:"flex items-start"},La={class:"mt-1 text-sm text-red-700"},qa={class:"bg-white shadow-sm rounded-lg border border-gray-200"},Ua={class:"p-3 md:p-4"},Ra={class:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg md:relative md:bg-gray-50 md:border-0 md:shadow-none md:mt-3 md:rounded-lg"},Ha={class:"max-w-4xl mx-auto px-3 py-2 md:px-4 md:py-3"},Ka={class:"flex items-center justify-between"},Ga={key:1},Ja={class:"flex items-center space-x-3"},Qa={class:"text-xs text-gray-500"},Wa={key:0,class:"h-4 w-4 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},se=3,Xa=W({__name:"OrganizationFormWrapper",props:{initialData:{},isEditing:{type:Boolean,default:!1},organizationId:{}},emits:["success","cancel","draft-saved"],setup(L,{emit:N}){const o=L,$=N,w=ce(),i=he(),l=I(1),r=I(!1),t=I(!1),s=I(""),g=I(null),E=le({1:!1,2:!0,3:!0}),C=le({name:"",industry:"",lead_score:null,type:null,status:"Prospect",address_line_1:"",city:"",state_province:"",postal_code:"",primary_phone:"",website:"",assigned_user_id:null,description:"",...o.initialData}),P=le({1:{},2:{},3:{}}),f=[{id:1,title:"Basic Info",description:"Enter organization name, priority, segment, and business type",component:"OrganizationStepOne",requiredFields:["name","industry","lead_score"]},{id:2,title:"Organization Info",description:"Add address, phone, and additional notes",component:"OrganizationStepTwo",requiredFields:[]},{id:3,title:"Contact Info",description:"Select existing contacts or create new contacts",component:"OrganizationStepThree",requiredFields:[]}],S=V(()=>f[l.value-1]),Q=V(()=>({OrganizationStepOne:lt,OrganizationStepTwo:gt,OrganizationStepThree:Sa})[S.value.component]),F=V(()=>l.value===se),U=V(()=>P[l.value]||{}),M=V(()=>E[l.value]),H=x=>{Object.assign(C,x),v()},b=async(x,a,u={})=>{E[x]=a,P[x]=u,a&&s.value&&(s.value="")},p=async()=>{t.value=!0;try{const x=S.value.requiredFields,a={};return x.forEach(u=>{a[u]=C[u]}),x.length>0&&await me.pick(x).validate(a,{abortEarly:!1}),await b(l.value,!0,{}),!0}catch(x){const a={};return x.inner?x.inner.forEach(u=>{u.path&&(a[u.path]=u.message)}):a.general=x.message||"Validation failed",await b(l.value,!1,a),!1}finally{t.value=!1}},_=async()=>{l.value<se&&await p()&&(l.value++,await ne(),j())},R=()=>{l.value>1&&(l.value--,ne(()=>{j()}))},O=async()=>{F.value?await Y():await _()},Y=async()=>{var x;try{r.value=!0,s.value="";for(let G=1;G<=se;G++)if(l.value=G,!await p()){s.value=`Please fix errors in Step ${G}`;return}const a=C.custom_fields,u={mode:(a==null?void 0:a.contact_mode)||"select",selectedContactIds:(a==null?void 0:a.selected_contact_ids)||[],newContacts:(a==null?void 0:a.new_contacts)||[]},h={...C,name:C.name||"",industry:C.industry||null,lead_score:C.lead_score||null,tags:((x=C.tags)==null?void 0:x.filter(G=>G!==void 0))||null,custom_fields:a?{...a,contact_mode:void 0,selected_contact_ids:void 0,new_contacts:void 0}:{}};let D;o.isEditing&&o.organizationId?D=await i.updateOrganizationWithContacts(o.organizationId,h,u):D=await i.createOrganizationWithContacts(h,u),D?(z(),$("success",D.id),w.push(`/organizations/${D.id}`)):s.value="Failed to save organization. Please try again."}catch(a){s.value=a.message||"An unexpected error occurred",console.error("Form submission error:",a)}finally{r.value=!1}};let K=null;const v=()=>{K&&clearTimeout(K),K=setTimeout(async()=>{await m()},2e3)},m=async()=>{try{g.value="saving";const x=o.isEditing?`org-edit-draft-${o.organizationId}`:"org-create-draft";localStorage.setItem(x,JSON.stringify({formData:{...C},currentStep:l.value,timestamp:Date.now()})),g.value="saved",$("draft-saved",{...C}),setTimeout(()=>{g.value=null},3e3)}catch(x){g.value="error",console.error("Auto-save error:",x),setTimeout(()=>{g.value=null},3e3)}},c=()=>{try{const x=o.isEditing?`org-edit-draft-${o.organizationId}`:"org-create-draft",a=localStorage.getItem(x);if(a){const u=JSON.parse(a);(Date.now()-u.timestamp)/(1e3*60)<60&&!o.initialData&&(Object.assign(C,u.formData),l.value=u.currentStep||1)}}catch(x){console.error("Failed to load auto-saved draft:",x)}},z=()=>{try{const x=o.isEditing?`org-edit-draft-${o.organizationId}`:"org-create-draft";localStorage.removeItem(x)}catch(x){console.error("Failed to clear auto-saved draft:",x)}},j=()=>{ne(()=>{const x=document.querySelector("input, select, textarea");x==null||x.focus()})};X(()=>{c(),j()});const J=x=>{x.key==="Escape"&&$("cancel")};return X(()=>{document.addEventListener("keydown",J)}),ue(()=>{document.removeEventListener("keydown",J),K&&clearTimeout(K)}),(x,a)=>(n(),d("div",Ba,[e("div",za,[e("div",Ma,[(n(),d(Z,null,ee(f,(u,h)=>e("div",{key:u.id,class:A(["h-1.5 w-6 rounded-full transition-colors duration-200",h+1<=l.value?"bg-primary-600":"bg-gray-200"]),"aria-label":`Step ${h+1}: ${u.title}`},null,10,Ia)),64))]),e("div",Da,[e("h2",Ea,y(S.value.title),1),e("p",Fa,y(S.value.description),1)])]),g.value?(n(),d("div",Na,[e("div",{class:A(["flex items-center space-x-2 px-3 py-1 rounded-full",g.value==="saving"?"bg-blue-50 text-blue-700":g.value==="saved"?"bg-green-50 text-green-700":"bg-red-50 text-red-700"])},[g.value==="saving"?(n(),d("svg",Pa,a[0]||(a[0]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):g.value==="saved"?(n(),d("svg",Oa,a[1]||(a[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(n(),d("svg",ja,a[2]||(a[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]))),e("span",null,y(g.value==="saving"?"Saving draft...":g.value==="saved"?"Draft saved":"Failed to save draft"),1)],2)])):k("",!0),s.value?(n(),d("div",Aa,[e("div",Ta,[a[4]||(a[4]=e("svg",{class:"h-5 w-5 text-red-400 mr-3 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("div",null,[a[3]||(a[3]=e("h3",{class:"text-sm font-medium text-red-800"},"Error",-1)),e("p",La,y(s.value),1)])])])):k("",!0),e("div",qa,[e("div",Ua,[(n(),re(be(Q.value),{"model-value":C,errors:U.value,loading:t.value,onValidate:b,"onUpdate:modelValue":H},null,40,["model-value","errors","loading"]))])]),e("div",Ra,[e("div",Ha,[e("div",Ka,[l.value>1?(n(),re(de,{key:0,variant:"secondary",size:"sm",disabled:r.value,onClick:R},{default:te(()=>a[5]||(a[5]=[e("svg",{class:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),T(" Back ",-1)])),_:1,__:[5]},8,["disabled"])):(n(),d("div",Ga)),e("div",Ja,[e("div",Qa," Step "+y(l.value)+" of "+y(se),1),B(de,{variant:F.value?"success":"primary",size:"sm",loading:r.value||t.value,disabled:!M.value||r.value,onClick:O},{default:te(()=>[T(y(F.value?"Create Organization":"Next")+" ",1),F.value?k("",!0):(n(),d("svg",Wa,a[6]||(a[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])))]),_:1},8,["variant","loading","disabled"])])])])])]))}}),Ya={class:"max-w-4xl mx-auto space-y-6"},Za={class:"flex items-center justify-between"},eo={class:"flex items-center space-x-2 text-sm text-gray-500 mb-2"},mo=W({__name:"OrganizationCreateView",setup(L){const N=ce(),o=i=>{N.push(`/organizations/${i}`)},$=()=>{N.push("/organizations")},w=i=>{console.log("Draft saved:",i)};return(i,l)=>{const r=ye("router-link");return n(),d("div",Ya,[e("div",Za,[e("div",null,[e("nav",eo,[B(r,{to:"/organizations",class:"hover:text-gray-700"},{default:te(()=>l[0]||(l[0]=[T("Organizations",-1)])),_:1,__:[0]}),B(ie(xe),{class:"h-4 w-4"}),l[1]||(l[1]=e("span",{class:"text-gray-900"},"New Organization",-1))]),l[2]||(l[2]=e("h1",{class:"text-2xl font-bold text-gray-900"},"Create New Organization",-1)),l[3]||(l[3]=e("p",{class:"mt-1 text-sm text-gray-500"}," Add a new organization to your CRM system ",-1))]),B(r,{to:"/organizations",class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},{default:te(()=>[B(ie(we),{class:"h-4 w-4 mr-2"}),l[4]||(l[4]=T(" Cancel ",-1))]),_:1,__:[4]})]),B(Xa,{onSuccess:o,onCancel:$,onDraftSaved:w})])}}});export{mo as default};
//# sourceMappingURL=OrganizationCreateView-DKGGBzIX.js.map
