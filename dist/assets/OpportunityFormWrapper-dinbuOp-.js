import{d as X,r as D,c as y,y as te,a,b as e,h as g,n as $,e as M,t as u,F as q,i as j,B as me,j as o,o as oe,E as ie,l as K,v as Y,s as ee,J as ge,x as ve,m as be,p as he,u as fe,f as Z}from"./index-Br7bM97V.js";import{o as ae,a as S,S as ye,u as xe,O as we}from"./opportunityStore-MF-7Z0oO.js";import{u as ke}from"./principalStore-JxlbTJes.js";import{u as Ce}from"./productStore-tgpLBWvz.js";import{_ as $e}from"./_plugin-vue_export-helper-DlAUqK2U.js";const _e={class:"space-y-3"},Pe=["for"],Ne={key:0,class:"text-danger ml-1","aria-label":"required"},Oe=["id"],Se={class:"flex items-center space-x-3"},Ee={class:"flex items-center space-x-2 cursor-pointer"},Ve=["checked"],Be={key:1,class:"bg-blue-50 border border-blue-200 rounded-md p-3"},De={class:"flex items-start space-x-2"},Ie={class:"flex-1"},ze={class:"text-sm text-blue-700 font-mono mt-1"},Te={key:0,class:"text-xs text-blue-600 mt-1"},Me={class:"font-mono"},Le={key:2,class:"bg-green-50 border border-green-200 rounded-md p-3"},Ae={class:"flex items-start space-x-2"},Fe={class:"flex-1"},qe={class:"text-sm font-medium text-green-900"},je={class:"mt-2 space-y-1 max-h-32 overflow-y-auto"},Ge={key:0,class:"text-xs text-green-600 italic"},Ue={key:3,class:"relative"},Re=["id","name","placeholder","disabled","required","maxlength","value","aria-describedby","aria-invalid","aria-required"],We={key:0,class:"absolute inset-y-0 right-0 flex items-center pr-3"},He={key:4,class:"flex justify-start"},Je={key:5,class:"space-y-2"},Ke=["id","placeholder","value","maxlength"],Ye=["id"],Qe=["id"],Xe=X({__name:"OpportunityNameField",props:{name:{},label:{},modelValue:{},autoGenerate:{type:Boolean},organizationName:{},principalName:{},principalData:{},context:{},customContext:{},error:{},placeholder:{default:"Enter opportunity name..."},description:{},helpText:{default:"Auto-generated names help maintain consistency across opportunities"},required:{type:Boolean},disabled:{type:Boolean},maxlength:{default:255},showCharacterCount:{type:Boolean,default:!0},maxPreviewDisplay:{default:5},inputClass:{},labelClass:{}},emits:["update:modelValue","update:autoGenerate","update:nameTemplate","blur","focus","input","name-generated","batch-names-generated"],setup(G,{expose:U,emit:R}){const t=G,b=R,w=D(!1),_=D(!1),m=D(""),C=D(""),O=D(null),P=D([]),I=y(()=>`name-field-${t.name}`),L=y(()=>`error-${t.name}`),l=y(()=>`desc-${t.name}`),E=y(()=>`help-${t.name}`),T=y(()=>!!t.error),N=y(()=>{const i=[];return t.description&&i.push(l.value),t.error&&i.push(L.value),t.helpText&&!t.error&&i.push(E.value),i.length>0?i.join(" "):void 0}),V=y(()=>{const i="block text-sm font-medium transition-colors duration-200",s=T.value?"text-red-700":w.value?"text-primary-600":"text-gray-700",c=t.disabled?"opacity-60":"",h=t.labelClass||"";return`${i} ${s} ${c} ${h}`.trim()}),z=y(()=>{const i="w-full px-3 py-2 border rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:border-transparent",s=T.value?"border-red-500 bg-red-50 focus:ring-red-500 focus:bg-white":w.value?"border-primary-500 bg-white focus:ring-primary-500":"border-gray-300 bg-white hover:border-gray-400 focus:ring-primary-500",c=t.disabled?"bg-gray-100 text-gray-500 cursor-not-allowed border-gray-200":"",h=t.showCharacterCount&&t.modelValue?"pr-16":"",B=t.inputClass||"";return`${i} ${s} ${c} ${h} ${B}`.trim()}),A=y(()=>"w-full px-3 py-2 border border-amber-300 bg-amber-50 rounded-md focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent text-amber-900 placeholder-amber-600"),F=()=>{if(!t.autoGenerate||!t.organizationName){C.value="",O.value=null;return}if(t.principalName){const i=ae.generateOpportunityName({organization_name:t.organizationName,principal_name:t.principalName,context:t.context,custom_context:t.customContext}),s=ae.generateNameTemplate({organization_name:t.organizationName,principal_name:t.principalName,context:t.context,custom_context:t.customContext});C.value=i,O.value=s,_.value||(b("update:modelValue",i),b("update:nameTemplate",s),b("name-generated",i,s))}else if(t.principalData&&t.principalData.length>0){const i=ae.generateBatchNamePreviews({organization_name:t.organizationName,principal_data:t.principalData,context:t.context,custom_context:t.customContext});P.value=i,i.length>0&&(C.value=i[0].generated_name,O.value=i[0].name_template),b("batch-names-generated",i)}},W=i=>{const c=i.target.checked;b("update:autoGenerate",c),c?(F(),_.value=!1,m.value=""):(C.value="",O.value=null,P.value=[],b("update:nameTemplate",null))},d=i=>{const s=i.target;b("update:modelValue",s.value),b("input",i)},r=i=>{const s=i.target;m.value=s.value,b("update:modelValue",s.value)},p=i=>{w.value=!1,b("blur",i)},x=i=>{w.value=!0,b("focus",i)},k=i=>{!m.value.trim()&&C.value&&b("update:modelValue",C.value)},H=()=>{_.value=!0,m.value=t.modelValue,me(()=>{const i=document.getElementById(`${I.value}-override`);i==null||i.focus()})},Q=()=>{_.value=!1,m.value="",C.value&&b("update:modelValue",C.value)};return te([()=>t.autoGenerate,()=>t.organizationName,()=>t.principalName,()=>t.principalData,()=>t.context,()=>t.customContext],()=>{t.autoGenerate&&F()},{immediate:!0}),U({focus:()=>{const i=document.getElementById(I.value);i==null||i.focus()},generateName:F,getPreviewNames:()=>P.value,getNameTemplate:()=>O.value}),(i,s)=>(o(),a("div",_e,[e("label",{for:I.value,class:$(V.value)},[M(u(i.label)+" ",1),i.required?(o(),a("span",Ne,"*")):g("",!0)],10,Pe),i.description?(o(),a("p",{key:0,id:l.value,class:"text-sm text-gray-600"},u(i.description),9,Oe)):g("",!0),e("div",Se,[e("label",Ee,[e("input",{type:"checkbox",checked:i.autoGenerate,onChange:W,class:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"},null,40,Ve),s[0]||(s[0]=e("span",{class:"text-sm text-gray-700"},"Auto-generate opportunity name",-1))]),s[1]||(s[1]=e("div",{class:"relative group"},[e("svg",{class:"h-4 w-4 text-gray-400 cursor-help",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 text-xs text-white bg-gray-900 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap"}," Names follow pattern: Organization - Principal - Context - Month Year ")],-1))]),i.autoGenerate&&C.value?(o(),a("div",Be,[e("div",De,[s[4]||(s[4]=e("svg",{class:"h-5 w-5 text-blue-500 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)),e("div",Ie,[s[3]||(s[3]=e("p",{class:"text-sm font-medium text-blue-900"},"Generated Name Preview:",-1)),e("p",ze,u(C.value),1),O.value?(o(),a("p",Te,[s[2]||(s[2]=M(" Template: ",-1)),e("span",Me,u(O.value),1)])):g("",!0)])])])):g("",!0),i.autoGenerate&&P.value&&P.value.length>1?(o(),a("div",Le,[e("div",Ae,[s[5]||(s[5]=e("svg",{class:"h-5 w-5 text-green-500 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e("div",Fe,[e("p",qe," Batch Creation Preview ("+u(P.value.length)+" opportunities): ",1),e("div",je,[(o(!0),a(q,null,j(P.value.slice(0,i.maxPreviewDisplay),c=>(o(),a("div",{key:c.principal_id,class:"text-xs font-mono text-green-700 bg-white bg-opacity-50 rounded px-2 py-1"},u(c.generated_name),1))),128)),P.value.length>i.maxPreviewDisplay?(o(),a("p",Ge," ... and "+u(P.value.length-i.maxPreviewDisplay)+" more ",1)):g("",!0)])])])])):g("",!0),i.autoGenerate?g("",!0):(o(),a("div",Ue,[e("input",{id:I.value,type:"text",name:i.name,placeholder:i.placeholder,disabled:i.disabled,required:i.required,maxlength:i.maxlength,value:i.modelValue,"aria-describedby":N.value,"aria-invalid":T.value,"aria-required":i.required,class:$(z.value),onInput:d,onBlur:p,onFocus:x},null,42,Re),i.showCharacterCount&&i.modelValue?(o(),a("div",We,[e("span",{class:$(["text-xs text-gray-400",{"text-red-500":i.modelValue.length>(i.maxlength||255)}])},u(i.modelValue.length)+u(i.maxlength?`/${i.maxlength}`:""),3)])):g("",!0)])),i.autoGenerate&&!_.value?(o(),a("div",He,[e("button",{type:"button",onClick:H,class:"text-sm text-primary-600 hover:text-primary-700 focus:outline-none focus:underline"}," Want to customize the name? Click to override ")])):g("",!0),i.autoGenerate&&_.value?(o(),a("div",Je,[e("div",{class:"flex items-center justify-between"},[s[6]||(s[6]=e("label",{class:"text-sm font-medium text-gray-700"},"Custom Name Override:",-1)),e("button",{type:"button",onClick:Q,class:"text-xs text-gray-500 hover:text-gray-700 focus:outline-none"}," Cancel override ")]),e("input",{id:`${I.value}-override`,type:"text",placeholder:C.value||"Enter custom opportunity name...",value:m.value,maxlength:i.maxlength,class:$(A.value),onInput:r,onBlur:k},null,42,Ke)])):g("",!0),i.error?(o(),a("p",{key:6,id:L.value,role:"alert",class:"text-sm text-danger flex items-center space-x-1"},[s[7]||(s[7]=e("svg",{class:"h-4 w-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,u(i.error),1)],8,Ye)):g("",!0),i.helpText&&!i.error?(o(),a("p",{key:7,id:E.value,class:"text-sm text-gray-500"},u(i.helpText),9,Qe)):g("",!0)]))}}),Ze={class:"space-y-1"},et=["for"],tt={key:0,class:"text-danger ml-1","aria-label":"required"},st=["id"],rt={class:"relative"},at={class:"flex flex-wrap gap-1 min-h-[2.5rem] items-center p-2"},ot={class:"font-medium"},lt=["onClick","aria-label"],nt={key:0,class:"text-gray-500 text-sm"},it={class:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none","aria-hidden":"true"},dt=["aria-labelledby","aria-expanded"],ut={class:"p-2 border-b border-gray-200"},ct={class:"max-h-48 overflow-y-auto"},pt=["aria-selected","onClick"],mt={class:"flex items-center"},gt=["checked","disabled"],vt={class:"ml-3 flex-1"},bt={class:"flex items-center justify-between"},ht={class:"font-medium text-gray-900"},ft={class:"text-xs text-gray-500"},yt={class:"text-sm text-gray-600"},xt={class:"text-xs text-gray-500"},wt={key:0,class:"px-4 py-6 text-center text-gray-500"},kt={class:"p-2 border-t border-gray-200 flex justify-between"},Ct={key:1,class:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-md"},$t={class:"flex items-start space-x-2"},_t={class:"flex-1"},Pt={class:"text-sm text-blue-700 mt-1"},Nt={class:"text-sm text-blue-700 mt-2 space-y-1"},Ot=["id"],St=["id"],Et=X({__name:"PrincipalMultiSelect",props:{name:{},label:{},modelValue:{},error:{},placeholder:{default:"Select principals..."},description:{},helpText:{},required:{type:Boolean},disabled:{type:Boolean},showBatchPreview:{type:Boolean,default:!0},baseOpportunityName:{default:"New Opportunity"},containerClass:{},labelClass:{}},emits:["update:modelValue","selection-changed","principal-added","principal-removed"],setup(G,{expose:U,emit:R}){const t=G,b=R,w=ke(),_=D(!1),m=D(""),C=D(),O=y(()=>`principal-multiselect-${t.name}`),P=y(()=>`error-${t.name}`),I=y(()=>`desc-${t.name}`),L=y(()=>`help-${t.name}`),l=y(()=>!!t.error),E=y(()=>{const s="block text-sm font-medium transition-colors duration-200",c=l.value?"text-red-700":"text-gray-700",h=t.disabled?"opacity-60":"",B=t.labelClass||"";return`${s} ${c} ${h} ${B}`.trim()}),T=y(()=>{const s="relative w-full border rounded-md transition-all duration-200 cursor-pointer focus-within:ring-2 focus-within:border-transparent";let c="";l.value?c="border-red-500 bg-red-50 focus-within:ring-red-500":_.value?c="border-primary-500 bg-white ring-2 ring-primary-500":c="border-gray-300 bg-white hover:border-gray-400 focus-within:ring-primary-500";const h=t.disabled?"bg-gray-100 cursor-not-allowed border-gray-200":"",B=t.containerClass||"";return`${s} ${c} ${h} ${B}`.trim()}),N=y(()=>"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg"),V=s=>{const c="px-4 py-2 cursor-pointer transition-colors duration-150",B=A(s)?"bg-primary-50 text-primary-900":"hover:bg-gray-50 text-gray-900";return`${c} ${B}`},z=y(()=>{if(!m.value)return w.principalOptions;const s=m.value.toLowerCase();return w.principalOptions.filter(c=>c.name.toLowerCase().includes(s)||c.organization_name.toLowerCase().includes(s)||(c.organization_type||"").toLowerCase().includes(s))}),A=s=>t.modelValue.includes(s),F=s=>{const c=w.principalOptions.find(h=>h.id===s);return c?c.name:"Unknown Principal"},W=s=>{const c=w.principalOptions.find(h=>h.id===s);return c?`${t.baseOpportunityName} - ${c.organization_name}`:t.baseOpportunityName},d=s=>{if(t.disabled)return;const c=[...t.modelValue],h=c.indexOf(s),B=w.principalOptions.find(se=>se.id===s);h>-1?(c.splice(h,1),b("principal-removed",s,B)):(c.push(s),B&&b("principal-added",s,B)),b("update:modelValue",c),k(c)},r=s=>{if(t.disabled)return;const c=t.modelValue.filter(B=>B!==s),h=w.principalOptions.find(B=>B.id===s);b("update:modelValue",c),b("principal-removed",s,h),k(c)},p=()=>{t.disabled||(b("update:modelValue",[]),k([]))},x=()=>{if(t.disabled)return;const s=z.value.map(c=>c.id);b("update:modelValue",s),k(s)},k=s=>{const c=w.principalOptions.filter(h=>s.includes(h.id));b("selection-changed",s,c)},H=()=>{t.disabled||(_.value=!_.value,_.value&&setTimeout(()=>{var s;(s=C.value)==null||s.focus()},100))},Q=()=>{_.value=!1,m.value=""},i=s=>{const c=s.target,h=document.getElementById(O.value);h&&!h.contains(c)&&Q()};return oe(async()=>{w.principalOptions.length===0&&await w.fetchPrincipalOptions(),document.addEventListener("click",i)}),ie(()=>{document.removeEventListener("click",i)}),te(()=>t.modelValue,s=>{k(s)},{immediate:!0}),U({focus:()=>{const s=document.getElementById(O.value);s==null||s.focus()},openDropdown:()=>{_.value=!0},closeDropdown:Q,clearSelection:p,selectAll:x,getSelectedPrincipals:()=>w.principalOptions.filter(s=>t.modelValue.includes(s.id))}),(s,c)=>(o(),a("div",Ze,[e("label",{for:O.value,class:$(E.value)},[M(u(s.label)+" ",1),s.required?(o(),a("span",tt,"*")):g("",!0)],10,et),s.description?(o(),a("p",{key:0,id:I.value,class:"text-sm text-gray-600"},u(s.description),9,st)):g("",!0),e("div",rt,[e("div",{class:$(T.value),onClick:H},[e("div",at,[(o(!0),a(q,null,j(s.modelValue,h=>(o(),a("div",{key:h,class:"inline-flex items-center gap-1 px-2 py-1 bg-primary-100 text-primary-800 text-sm rounded-md border border-primary-200"},[e("span",ot,u(F(h)),1),e("button",{type:"button",onClick:ee(B=>r(h),["stop"]),"aria-label":`Remove ${F(h)}`,class:"text-primary-600 hover:text-primary-800 focus:outline-none focus:ring-1 focus:ring-primary-500 rounded"},c[3]||(c[3]=[e("svg",{class:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,lt)]))),128)),s.modelValue.length===0&&s.placeholder?(o(),a("span",nt,u(s.placeholder),1)):g("",!0)]),e("div",it,[(o(),a("svg",{class:$(["h-4 w-4 transition-transform duration-200",_.value?"rotate-180":"",l.value?"text-red-500":"text-gray-400"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},c[4]||(c[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))])],2),_.value?(o(),a("div",{key:0,class:$(N.value),role:"listbox","aria-labelledby":O.value,"aria-expanded":_.value},[e("div",ut,[K(e("input",{ref_key:"searchInput",ref:C,"onUpdate:modelValue":c[0]||(c[0]=h=>m.value=h),type:"text",placeholder:"Search principals...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm",onClick:c[1]||(c[1]=ee(()=>{},["stop"]))},null,512),[[Y,m.value]])]),e("div",ct,[(o(!0),a(q,null,j(z.value,h=>(o(),a("div",{key:h.id,class:$(V(h.id)),role:"option","aria-selected":A(h.id),onClick:B=>d(h.id)},[e("div",mt,[e("input",{type:"checkbox",checked:A(h.id),disabled:s.disabled,class:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded",onClick:c[2]||(c[2]=ee(()=>{},["stop"]))},null,8,gt),e("div",vt,[e("div",bt,[e("span",ht,u(h.name),1),e("span",ft,u(h.organization_type||"Unknown"),1)]),e("p",yt,u(h.organization_name),1),e("p",xt,u(h.available_products.length)+" product"+u(h.available_products.length!==1?"s":"")+" available ",1)])])],10,pt))),128)),z.value.length===0?(o(),a("div",wt,[c[5]||(c[5]=e("svg",{class:"mx-auto h-8 w-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),e("p",null,u(m.value?"No principals found matching your search":"No principals available"),1)])):g("",!0)]),e("div",kt,[e("button",{type:"button",onClick:p,class:"text-sm text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded px-2 py-1"}," Clear All "),e("button",{type:"button",onClick:x,class:"text-sm text-primary-600 hover:text-primary-800 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded px-2 py-1"}," Select All ("+u(z.value.length)+") ",1)])],10,dt)):g("",!0)]),s.modelValue.length>0&&s.showBatchPreview?(o(),a("div",Ct,[e("div",$t,[c[8]||(c[8]=e("svg",{class:"h-5 w-5 text-blue-500 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("div",_t,[c[7]||(c[7]=e("h4",{class:"text-sm font-medium text-blue-800"},"Batch Opportunity Creation",-1)),e("p",Pt,u(s.modelValue.length)+" opportunities will be created, one for each selected principal: ",1),e("ul",Nt,[(o(!0),a(q,null,j(s.modelValue,h=>(o(),a("li",{key:h,class:"flex items-center space-x-2"},[c[6]||(c[6]=e("span",{class:"w-2 h-2 bg-blue-400 rounded-full flex-shrink-0"},null,-1)),e("span",null,u(W(h)),1)]))),128))])])])])):g("",!0),s.error?(o(),a("p",{key:2,id:P.value,role:"alert",class:"text-sm text-danger flex items-center space-x-1"},[c[9]||(c[9]=e("svg",{class:"h-4 w-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,u(s.error),1)],8,Ot)):g("",!0),s.helpText&&!s.error?(o(),a("p",{key:3,id:L.value,class:"text-sm text-gray-500"},u(s.helpText),9,St)):g("",!0)]))}}),Vt={class:"space-y-1"},Bt=["for"],Dt={key:0,class:"text-danger ml-1","aria-label":"required"},It=["id"],zt={key:1,class:"flex items-center space-x-2 text-xs text-gray-600 bg-gray-50 px-2 py-1 rounded"},Tt={class:"relative"},Mt=["id","name","disabled","required","value","aria-describedby","aria-invalid","aria-required"],Lt={key:0,value:"",disabled:""},At=["disabled"],Ft={key:2,value:"",disabled:""},qt=["label"],jt=["value","disabled"],Gt=["value","disabled"],Ut={class:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none","aria-hidden":"true"},Rt={key:0,class:"animate-spin h-4 w-4 text-primary-500",fill:"none",viewBox:"0 0 24 24"},Wt={key:2,class:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded-md"},Ht={class:"flex items-start space-x-3"},Jt={class:"flex-1"},Kt={class:"text-sm font-medium text-blue-900"},Yt={key:0,class:"text-sm text-blue-700"},Qt={class:"text-sm text-blue-700"},Xt={key:1,class:"mt-1"},Zt={class:"text-xs text-blue-600"},es={key:3,class:"mt-2 p-4 bg-gray-50 border border-gray-200 rounded-md text-center"},ts={key:4,class:"text-xs text-gray-500 mt-1"},ss=["id"],rs=["id"],as=X({__name:"ProductSelect",props:{name:{},label:{},modelValue:{},selectedPrincipals:{},error:{},placeholder:{default:"Select a product..."},description:{},helpText:{},required:{type:Boolean},disabled:{type:Boolean},showPrincipalContext:{type:Boolean,default:!0},showProductInfo:{type:Boolean,default:!0},showProductDetails:{type:Boolean,default:!1},showProductCount:{type:Boolean,default:!0},selectClass:{},labelClass:{}},emits:["update:modelValue","blur","focus","change","product-selected","products-filtered"],setup(G,{expose:U,emit:R}){const t=G,b=R,w=Ce(),_=D(!1),m=D(!1),C=y(()=>`product-select-${t.name}`),O=y(()=>`error-${t.name}`),P=y(()=>`desc-${t.name}`),I=y(()=>`help-${t.name}`),L=y(()=>!!t.error),l=y(()=>{const r=[];return t.description&&r.push(P.value),t.error&&r.push(O.value),t.helpText&&!t.error&&r.push(I.value),r.length>0?r.join(" "):void 0}),E=y(()=>{const r="block text-sm font-medium transition-colors duration-200",p=L.value?"text-red-700":_.value?"text-primary":"text-gray-700",x=t.disabled?"opacity-60":"",k=t.labelClass||"";return`${r} ${p} ${x} ${k}`.trim()}),T=y(()=>{const r="w-full px-3 py-2 pr-10 border rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:border-transparent";let p="";L.value?p="border-red-500 bg-red-50 focus:ring-red-500 focus:bg-white":t.modelValue&&t.modelValue!==""?p="border-green-400 bg-green-50 focus:ring-primary-500 focus:bg-white":p=_.value?"border-primary-500 bg-white focus:ring-primary-500":"border-gray-300 bg-white hover:border-gray-400 focus:ring-primary-500";const x=t.disabled||m.value?"bg-gray-100 text-gray-500 cursor-not-allowed border-gray-200":"cursor-pointer",k=t.selectClass||"";return`${r} ${p} ${x} ${k}`.trim()}),N=y(()=>t.selectedPrincipals.length===0?[]:w.getProductsForPrincipals(t.selectedPrincipals)),V=y(()=>t.modelValue&&N.value.find(r=>r.id===t.modelValue)||null),z=y(()=>{const r=new Map;return N.value.forEach(p=>{const x=p.category||"Other";r.has(x)||r.set(x,[]),r.get(x).push(p)}),Array.from(r.entries()).map(([p,x])=>({name:p,label:p,products:x.sort((k,H)=>k.name.localeCompare(H.name))})).sort((p,x)=>p.name==="Other"&&x.name!=="Other"?1:x.name==="Other"&&p.name!=="Other"?-1:p.name.localeCompare(x.name))}),A=async()=>{if(t.selectedPrincipals.length!==0){m.value=!0;try{await w.fetchProductsForPrincipals(t.selectedPrincipals),b("products-filtered",N.value),t.modelValue&&!N.value.find(r=>r.id===t.modelValue)&&(b("update:modelValue",""),b("product-selected","",void 0))}catch(r){console.error("Failed to filter products:",r)}finally{m.value=!1}}},F=r=>{const x=r.target.value;b("update:modelValue",x),b("change",r);const k=N.value.find(H=>H.id===x);b("product-selected",x,k)},W=r=>{_.value=!1,b("blur",r)},d=r=>{_.value=!0,b("focus",r)};return te(()=>t.selectedPrincipals,async(r,p)=>{JSON.stringify(r)!==JSON.stringify(p)&&await A()},{immediate:!0,deep:!0}),oe(async()=>{t.selectedPrincipals.length>0&&await A()}),U({focus:()=>{const r=document.getElementById(C.value);r==null||r.focus()},blur:()=>{const r=document.getElementById(C.value);r==null||r.blur()},refresh:A,getSelectedProduct:()=>V.value,getAvailableProducts:()=>N.value,isFiltering:()=>m.value}),(r,p)=>(o(),a("div",Vt,[e("label",{for:C.value,class:$(E.value)},[M(u(r.label)+" ",1),r.required?(o(),a("span",Dt,"*")):g("",!0)],10,Bt),r.description?(o(),a("p",{key:0,id:P.value,class:"text-sm text-gray-600"},u(r.description),9,It)):g("",!0),r.selectedPrincipals.length>0&&r.showPrincipalContext?(o(),a("div",zt,[p[0]||(p[0]=e("svg",{class:"h-3 w-3 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null," Showing products available to "+u(r.selectedPrincipals.length)+" selected principal"+u(r.selectedPrincipals.length!==1?"s":""),1)])):g("",!0),e("div",Tt,[e("select",{id:C.value,name:r.name,disabled:r.disabled||m.value,required:r.required,value:r.modelValue,"aria-describedby":l.value,"aria-invalid":L.value,"aria-required":r.required,class:$(T.value),onChange:F,onBlur:W,onFocus:d},[m.value?(o(),a("option",Lt," Loading products... ")):r.placeholder?(o(),a("option",{key:1,value:"",disabled:r.required},u(r.placeholder),9,At)):r.selectedPrincipals.length===0?(o(),a("option",Ft," Please select principals first ")):g("",!0),!m.value&&N.value.length>0&&z.value.length>0?(o(!0),a(q,{key:3},j(z.value,x=>(o(),a("optgroup",{key:x.name,label:x.label},[(o(!0),a(q,null,j(x.products,k=>(o(),a("option",{key:k.id,value:k.id,disabled:!k.is_active},[M(u(k.name)+" ",1),r.showProductDetails?(o(),a(q,{key:0},[M(" - "+u(k.category)+" ("+u(k.available_principals.length)+" principal"+u(k.available_principals.length!==1?"s":"")+") ",1)],64)):g("",!0)],8,jt))),128))],8,qt))),128)):!m.value&&N.value.length>0?(o(!0),a(q,{key:4},j(N.value,x=>(o(),a("option",{key:x.id,value:x.id,disabled:!x.is_active},[M(u(x.name)+" ",1),r.showProductDetails?(o(),a(q,{key:0},[M(" ("+u(x.available_principals.length)+" principal"+u(x.available_principals.length!==1?"s":"")+") ",1)],64)):g("",!0)],8,Gt))),128)):g("",!0)],42,Mt),e("div",Ut,[m.value?(o(),a("svg",Rt,p[1]||(p[1]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(o(),a("svg",{key:1,class:$(["h-4 w-4 text-gray-400",{"text-red-500":L.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},p[2]||(p[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))])]),V.value&&r.showProductInfo?(o(),a("div",Wt,[e("div",Ht,[p[3]||(p[3]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-2 h-2 bg-blue-400 rounded-full mt-2"})],-1)),e("div",Jt,[e("h4",Kt,u(V.value.name),1),V.value.category?(o(),a("p",Yt," Category: "+u(V.value.category),1)):g("",!0),e("p",Qt," Available to "+u(V.value.available_principals.length)+" principal"+u(V.value.available_principals.length!==1?"s":""),1),V.value.description?(o(),a("div",Xt,[e("p",Zt,u(V.value.description),1)])):g("",!0)])])])):g("",!0),!m.value&&r.selectedPrincipals.length>0&&N.value.length===0?(o(),a("div",es,p[4]||(p[4]=[e("svg",{class:"mx-auto h-8 w-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2 2v-5m16 0h-2M4 13h2m13-8l-1 1m0 0l-1 1m1-1v4M6 5l1 1v4"})],-1),e("p",{class:"text-sm text-gray-600"}," No products available for the selected principals. ",-1),e("p",{class:"text-xs text-gray-500 mt-1"}," Try selecting different principals or contact your administrator. ",-1)]))):g("",!0),!m.value&&N.value.length>0&&r.showProductCount?(o(),a("div",ts,[M(u(N.value.length)+" product"+u(N.value.length!==1?"s":"")+" available ",1),z.value.length>1?(o(),a(q,{key:0},[M(" across "+u(z.value.length)+" categories ",1)],64)):g("",!0)])):g("",!0),r.error?(o(),a("p",{key:5,id:O.value,role:"alert",class:"text-sm text-danger flex items-center space-x-1"},[p[5]||(p[5]=e("svg",{class:"h-4 w-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,u(r.error),1)],8,ss)):g("",!0),r.helpText&&!r.error?(o(),a("p",{key:6,id:I.value,class:"text-sm text-gray-500"},u(r.helpText),9,rs)):g("",!0)]))}}),os={class:"space-y-1"},ls=["for"],ns={key:0,class:"text-danger ml-1","aria-label":"required"},is=["id"],ds={class:"relative"},us=["id","name","disabled","required","value","aria-describedby","aria-invalid","aria-required"],cs=["disabled"],ps=["value"],ms={class:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none","aria-hidden":"true"},gs={key:1,class:"flex items-center space-x-2 mt-2"},vs={class:"text-xs text-gray-500"},bs={key:2,class:"mt-2"},hs={class:"flex justify-between text-xs text-gray-600 mb-1"},fs={class:"w-full bg-gray-200 rounded-full h-2"},ys=["id"],xs=["id"],ws=X({__name:"StageSelect",props:{name:{},label:{},modelValue:{},error:{},placeholder:{default:"Select opportunity stage..."},description:{},helpText:{},required:{type:Boolean},disabled:{type:Boolean},showStageIndicator:{type:Boolean,default:!0},showProgressBar:{type:Boolean,default:!0},selectClass:{},labelClass:{}},emits:["update:modelValue","blur","focus","change","stage-changed"],setup(G,{expose:U,emit:R}){const t=G,b=R,w=D(!1),_=y(()=>[{value:S.NEW_LEAD,label:"New Lead",progressIcon:"ðŸ”"},{value:S.INITIAL_OUTREACH,label:"Initial Outreach",progressIcon:"ðŸ“ž"},{value:S.SAMPLE_VISIT_OFFERED,label:"Sample/Visit Offered",progressIcon:"ðŸ“¦"},{value:S.AWAITING_RESPONSE,label:"Awaiting Response",progressIcon:"â³"},{value:S.FEEDBACK_LOGGED,label:"Feedback Logged",progressIcon:"ðŸ“"},{value:S.DEMO_SCHEDULED,label:"Demo Scheduled",progressIcon:"ðŸ—“ï¸"},{value:S.CLOSED_WON,label:"Closed - Won",progressIcon:"âœ…"}]),m=y(()=>`stage-select-${t.name}`),C=y(()=>`error-${t.name}`),O=y(()=>`desc-${t.name}`),P=y(()=>`help-${t.name}`),I=y(()=>!!t.error),L=y(()=>{const d=[];return t.description&&d.push(O.value),t.error&&d.push(C.value),t.helpText&&!t.error&&d.push(P.value),d.length>0?d.join(" "):void 0}),l=y(()=>{const d="block text-sm font-medium transition-colors duration-200",r=I.value?"text-red-700":w.value?"text-primary":"text-gray-700",p=t.disabled?"opacity-60":"",x=t.labelClass||"";return`${d} ${r} ${p} ${x}`.trim()}),E=y(()=>{const d="w-full px-3 py-2 pr-10 border rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:border-transparent";let r="";if(I.value)r="border-red-500 bg-red-50 focus:ring-red-500 focus:bg-white";else if(t.modelValue&&t.modelValue!==""){const k=N(t.modelValue);r=`border-${k.border} bg-${k.bgLight} focus:ring-${k.ring} focus:bg-white`}else r=w.value?"border-primary-500 bg-white focus:ring-primary-500":"border-gray-300 bg-white hover:border-gray-400 focus:ring-primary-500";const p=t.disabled?"bg-gray-100 text-gray-500 cursor-not-allowed border-gray-200":"cursor-pointer",x=t.selectClass||"";return`${d} ${r} ${p} ${x}`.trim()}),T=d=>{const r=_.value.find(p=>p.value===d);return r?r.label:d},N=d=>{const r={[S.NEW_LEAD]:{bg:"bg-gray-500",bgLight:"gray-50",text:"text-gray-700",border:"gray-400",ring:"gray-500"},[S.INITIAL_OUTREACH]:{bg:"bg-blue-500",bgLight:"blue-50",text:"text-blue-700",border:"blue-400",ring:"blue-500"},[S.SAMPLE_VISIT_OFFERED]:{bg:"bg-yellow-500",bgLight:"yellow-50",text:"text-yellow-700",border:"yellow-400",ring:"yellow-500"},[S.AWAITING_RESPONSE]:{bg:"bg-orange-500",bgLight:"orange-50",text:"text-orange-700",border:"orange-400",ring:"orange-500"},[S.FEEDBACK_LOGGED]:{bg:"bg-purple-500",bgLight:"purple-50",text:"text-purple-700",border:"purple-400",ring:"purple-500"},[S.DEMO_SCHEDULED]:{bg:"bg-green-500",bgLight:"green-50",text:"text-green-700",border:"green-400",ring:"green-500"},[S.CLOSED_WON]:{bg:"bg-emerald-500",bgLight:"emerald-50",text:"text-emerald-700",border:"emerald-400",ring:"emerald-500"}};return r[d]||r[S.NEW_LEAD]},V=d=>ye[d]||0,z=d=>{const r=[S.NEW_LEAD,S.INITIAL_OUTREACH,S.SAMPLE_VISIT_OFFERED,S.AWAITING_RESPONSE,S.FEEDBACK_LOGGED,S.DEMO_SCHEDULED,S.CLOSED_WON],p=r.indexOf(d);return p===-1?0:Math.round((p+1)/r.length*100)},A=d=>{const p=d.target.value;if(b("update:modelValue",p),b("change",d),p&&p!==""){const x=V(p);b("stage-changed",p,x)}},F=d=>{w.value=!1,b("blur",d)},W=d=>{w.value=!0,b("focus",d)};return U({focus:()=>{const d=document.getElementById(m.value);d==null||d.focus()},blur:()=>{const d=document.getElementById(m.value);d==null||d.blur()},getStageInfo:d=>({label:T(d),colors:N(d),probability:V(d),progress:z(d)})}),(d,r)=>(o(),a("div",os,[e("label",{for:m.value,class:$(l.value)},[M(u(d.label)+" ",1),d.required?(o(),a("span",ns,"*")):g("",!0)],10,ls),d.description?(o(),a("p",{key:0,id:O.value,class:"text-sm text-gray-600"},u(d.description),9,is)):g("",!0),e("div",ds,[e("select",{id:m.value,name:d.name,disabled:d.disabled,required:d.required,value:d.modelValue,"aria-describedby":L.value,"aria-invalid":I.value,"aria-required":d.required,class:$(E.value),onChange:A,onBlur:F,onFocus:W},[d.placeholder?(o(),a("option",{key:0,value:"",disabled:d.required},u(d.placeholder),9,cs)):g("",!0),(o(!0),a(q,null,j(_.value,p=>(o(),a("option",{key:p.value,value:p.value},u(p.label)+" "+u(p.progressIcon),9,ps))),128))],42,us),e("div",ms,[(o(),a("svg",{class:$(["h-4 w-4 text-gray-400",{"text-red-500":I.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},r[0]||(r[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))])]),d.modelValue&&d.showStageIndicator?(o(),a("div",gs,[e("div",{class:$(["w-3 h-3 rounded-full",N(d.modelValue).bg])},null,2),e("span",{class:$(["text-sm font-medium",N(d.modelValue).text])},u(T(d.modelValue)),3),e("span",vs," ("+u(V(d.modelValue))+"% typical probability) ",1)])):g("",!0),d.modelValue&&d.showProgressBar?(o(),a("div",bs,[e("div",hs,[r[1]||(r[1]=e("span",null,"Pipeline Progress",-1)),e("span",null,u(z(d.modelValue))+"%",1)]),e("div",fs,[e("div",{class:$(["h-2 rounded-full transition-all duration-300",N(d.modelValue).bg]),style:ge({width:`${z(d.modelValue)}%`})},null,6)])])):g("",!0),d.error?(o(),a("p",{key:3,id:C.value,role:"alert",class:"text-sm text-danger flex items-center space-x-1"},[r[2]||(r[2]=e("svg",{class:"h-4 w-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,u(d.error),1)],8,ys)):g("",!0),d.helpText&&!d.error?(o(),a("p",{key:4,id:P.value,class:"text-sm text-gray-500"},u(d.helpText),9,xs)):g("",!0)]))}}),ks={class:"opportunity-form-wrapper"},Cs={class:"mb-8"},$s={class:"flex items-center justify-between"},_s={class:"flex items-center space-x-4"},Ps={class:"text-xl font-semibold text-gray-900"},Ns={key:0,class:"text-sm text-gray-500"},Os={key:0,class:"flex items-center space-x-2 bg-blue-50 px-3 py-1 rounded-full"},Ss={class:"text-sm font-medium text-blue-700"},Es={key:0,class:"mt-4"},Vs={class:"flex items-center"},Bs={key:0,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},Ds={key:1},Is={class:"flex mt-2"},zs={key:0,class:"step-section"},Ts={class:"bg-white rounded-lg border border-gray-200 shadow-sm p-6"},Ms={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Ls={class:"lg:col-span-2"},As=["aria-invalid","aria-describedby"],Fs={key:0,id:"org-name-error",class:"mt-1 text-sm text-red-600"},qs={key:0},js={class:"lg:col-span-2"},Gs={key:1,class:"step-section"},Us={class:"bg-white rounded-lg border border-gray-200 shadow-sm p-6"},Rs={class:"space-y-6"},Ws={key:2,class:"step-section"},Hs={class:"bg-white rounded-lg border border-gray-200 shadow-sm p-6"},Js={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Ks={class:"lg:col-span-2"},Ys={class:"relative"},Qs=["min"],Xs={class:"lg:col-span-2"},Zs={key:3,class:"bg-red-50 border border-red-200 rounded-md p-4"},er={class:"flex"},tr={class:"mt-1 text-sm text-red-700"},sr={class:"bg-gray-50 rounded-lg p-6"},rr={class:"flex items-center justify-between"},ar={class:"flex items-center space-x-3"},or={class:"flex items-center space-x-3"},lr=["disabled"],nr=["disabled"],ir=["disabled"],dr={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"},J=3,ur=X({__name:"OpportunityFormWrapper",props:{isEditing:{type:Boolean,default:!1},initialData:{},autoSaveInterval:{default:3e4}},emits:["success","cancel","error","draftSaved","dataChanged"],setup(G,{expose:U,emit:R}){const t=G,b=R,w=xe(),_=we,m=D(1),C=D(!1),O=D(!1),P=D(null),I=D([]),L=[{label:"Basic Info",key:"basic"},{label:"Principals",key:"principals"},{label:"Details",key:"details"}],l=ve({organizationName:"",opportunityName:"",autoGenerateName:!0,context:null,customContext:"",selectedPrincipals:[],selectedProduct:"",stage:"",probabilityPercent:null,expectedCloseDate:null,dealOwner:"",notes:""}),E=D({}),T=y(()=>"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors duration-200"),N=y(()=>"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors duration-200"),V=y(()=>"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors duration-200 resize-vertical"),z=y(()=>new Date().toISOString().split("T")[0]),A=y(()=>{switch(m.value){case 1:return!!(l.organizationName&&l.opportunityName);case 2:return l.selectedPrincipals.length>0;case 3:return!!(l.selectedProduct&&l.stage);default:return!1}}),F=y(()=>!!(l.organizationName&&l.opportunityName&&l.selectedPrincipals.length>0&&l.selectedProduct&&l.stage)),W=()=>l.selectedPrincipals.length>1?`Create ${l.selectedPrincipals.length} Opportunities`:"Create Opportunity",d=()=>({name:l.opportunityName,organization_id:"temp-id",stage:l.stage,principal_ids:l.selectedPrincipals,product_id:l.selectedProduct,context:l.context,probability_percent:l.probabilityPercent,expected_close_date:l.expectedCloseDate,deal_owner:l.dealOwner,notes:l.notes,auto_generate_name:l.autoGenerateName,name_template:null}),r=()=>{if(l.selectedPrincipals.length===1)return l.selectedPrincipals[0]},p=()=>{if(l.selectedPrincipals.length>1)return l.selectedPrincipals.map(v=>({id:v,name:v}))},x=()=>{const v={};return m.value>=1&&(l.organizationName.trim()||(v.organizationName="Organization name is required"),l.opportunityName.trim()||(v.opportunityName="Opportunity name is required")),m.value>=2&&l.selectedPrincipals.length===0&&(v.selectedPrincipals="At least one principal must be selected"),m.value>=3&&(l.selectedProduct||(v.selectedProduct="Product selection is required"),l.stage||(v.stage="Stage selection is required")),E.value=v,Object.keys(v).length===0},k=()=>{const v=m.value;m.value=J;const n=x();return m.value=v,n},H=()=>{x()&&m.value<J&&m.value++},Q=()=>{m.value>1&&m.value--},i=(v,n)=>{console.log("Name generated:",v,n)},s=v=>{I.value=v},c=(v,n)=>{console.log("Principal selection changed:",v,n)},h=(v,n)=>{console.log("Product selected:",v,n)},B=(v,n)=>{l.probabilityPercent=n},se=async()=>{if(k()){C.value=!0,P.value=null;try{if(t.isEditing){const v=d();if(await w.updateOpportunity("",v))b("success",{opportunityId:"updated"});else{const f=w.error||"Failed to update opportunity";P.value=f,b("error",f)}}else if(l.selectedPrincipals.length>1){const v=d();if(await w.createBatchOpportunities(v)&&w.batchCreationResult)b("success",{opportunityIds:w.batchCreationResult.created_opportunities.map(f=>f.id),count:w.batchCreationResult.total_created});else{const f=w.error||"Failed to create opportunities";P.value=f,b("error",f)}}else{const v=d();if(await w.createOpportunity(v))b("success",{opportunityId:"created"});else{const f=w.error||"Failed to create opportunity";P.value=f,b("error",f)}}}catch(v){console.error("Form submission error:",v);const n=v instanceof Error?v.message:"An unexpected error occurred";P.value=n,b("error",n)}finally{C.value=!1}}},de=()=>{b("cancel")},le=async()=>{O.value=!0;try{b("draftSaved",{...l}),setTimeout(()=>{O.value=!1},500)}catch(v){console.error("Draft save error:",v),O.value=!1}},ue=()=>{t.initialData&&(Object.assign(l,t.initialData),t.initialData.organizationName&&l.autoGenerateName&&console.log("Form initialized with organization:",t.initialData.organizationName)),t.isEditing&&(m.value=J)};te(()=>({...l}),v=>{b("dataChanged",v)},{deep:!0});let re;const ce=()=>{!t.isEditing&&t.autoSaveInterval>0&&(re=setInterval(()=>{F.value&&le()},t.autoSaveInterval))},pe=()=>{re&&clearInterval(re)};return oe(()=>{ue(),ce()}),ie(()=>{pe()}),U({validateForm:k,resetForm:()=>{Object.assign(l,{organizationName:"",opportunityName:"",autoGenerateName:!0,context:null,customContext:"",selectedPrincipals:[],selectedProduct:"",stage:"",probabilityPercent:null,expectedCloseDate:null,dealOwner:"",notes:""}),m.value=1,E.value={},P.value=null},goToStep:v=>{v>=1&&v<=J&&(m.value=v)},getFormData:()=>({...l})}),(v,n)=>(o(),a("div",ks,[e("div",Cs,[e("div",$s,[e("div",_s,[e("h2",Ps,u(v.isEditing?"Edit Opportunity":"Create New Opportunity"),1),v.isEditing?g("",!0):(o(),a("div",Ns," Step "+u(m.value)+" of "+u(J),1))]),l.selectedPrincipals.length>1?(o(),a("div",Os,[n[12]||(n[12]=e("svg",{class:"h-4 w-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e("span",Ss," Batch Creation ("+u(l.selectedPrincipals.length)+" opportunities) ",1)])):g("",!0)]),v.isEditing?g("",!0):(o(),a("div",Es,[e("div",Vs,[(o(),a(q,null,j(J,f=>e("div",{key:f,class:"flex items-center"},[e("div",{class:$(["flex items-center justify-center w-8 h-8 rounded-full border-2 text-sm font-medium",f<m.value?"bg-primary-600 border-primary-600 text-white":f===m.value?"bg-white border-primary-600 text-primary-600":"bg-white border-gray-300 text-gray-400"])},[f<m.value?(o(),a("svg",Bs,n[13]||(n[13]=[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)]))):(o(),a("span",Ds,u(f),1))],2),f<J?(o(),a("div",{key:0,class:$(["w-16 h-0.5 mx-2",f<m.value?"bg-primary-600":"bg-gray-300"])},null,2)):g("",!0)])),64))]),e("div",Is,[(o(),a(q,null,j(L,(f,ne)=>e("div",{key:ne,class:"flex-1 text-center"},[e("div",{class:$(["text-xs font-medium",ne+1<=m.value?"text-primary-600":"text-gray-400"])},u(f.label),3)])),64))])]))]),e("form",{onSubmit:ee(se,["prevent"]),class:"space-y-8"},[m.value===1||v.isEditing?(o(),a("div",zs,[e("div",Ts,[n[18]||(n[18]=e("h3",{class:"text-lg font-medium text-gray-900 mb-6"},[e("span",{class:"flex items-center space-x-2"},[e("span",{class:"w-2 h-2 bg-primary-500 rounded-full"}),e("span",null,"Basic Information")])],-1)),e("div",Ms,[e("div",Ls,[n[14]||(n[14]=e("label",{for:"organization-name",class:"block text-sm font-medium text-gray-700 mb-1"},[M(" Organization Name "),e("span",{class:"text-red-500 ml-1"},"*")],-1)),K(e("input",{id:"organization-name","onUpdate:modelValue":n[0]||(n[0]=f=>l.organizationName=f),type:"text",required:"",placeholder:"Enter organization name...",class:$(T.value),"aria-invalid":!!E.value.organizationName,"aria-describedby":E.value.organizationName?"org-name-error":void 0},null,10,As),[[Y,l.organizationName]]),E.value.organizationName?(o(),a("p",Fs,u(E.value.organizationName),1)):g("",!0)]),e("div",null,[n[16]||(n[16]=e("label",{for:"context",class:"block text-sm font-medium text-gray-700 mb-1"}," Opportunity Context ",-1)),K(e("select",{id:"context","onUpdate:modelValue":n[1]||(n[1]=f=>l.context=f),class:$(N.value)},n[15]||(n[15]=[he('<option value="" data-v-01a97ad6>Select context...</option><option value="EVENT" data-v-01a97ad6>Event/Trade Show</option><option value="REFERRAL" data-v-01a97ad6>Referral</option><option value="WEBSITE" data-v-01a97ad6>Website Inquiry</option><option value="COLD_OUTREACH" data-v-01a97ad6>Cold Outreach</option><option value="FOLLOW_UP" data-v-01a97ad6>Follow-up</option><option value="CUSTOM" data-v-01a97ad6>Custom</option>',7)]),2),[[be,l.context]])]),l.context===fe(_).CUSTOM?(o(),a("div",qs,[n[17]||(n[17]=e("label",{for:"custom-context",class:"block text-sm font-medium text-gray-700 mb-1"}," Custom Context ",-1)),K(e("input",{id:"custom-context","onUpdate:modelValue":n[2]||(n[2]=f=>l.customContext=f),type:"text",placeholder:"Describe the context...",class:$(T.value)},null,2),[[Y,l.customContext]])])):g("",!0),e("div",js,[Z(Xe,{name:"opportunity-name",label:"Opportunity Name",modelValue:l.opportunityName,"onUpdate:modelValue":n[3]||(n[3]=f=>l.opportunityName=f),"auto-generate":l.autoGenerateName,"onUpdate:autoGenerate":n[4]||(n[4]=f=>l.autoGenerateName=f),"organization-name":l.organizationName,"principal-name":r(),"principal-data":p(),context:l.context,"custom-context":l.customContext,error:E.value.opportunityName,required:!0,onNameGenerated:i,onBatchNamesGenerated:s},null,8,["modelValue","auto-generate","organization-name","principal-name","principal-data","context","custom-context","error"])])])])])):g("",!0),m.value===2||v.isEditing?(o(),a("div",Gs,[e("div",Us,[n[19]||(n[19]=e("h3",{class:"text-lg font-medium text-gray-900 mb-6"},[e("span",{class:"flex items-center space-x-2"},[e("span",{class:"w-2 h-2 bg-primary-500 rounded-full"}),e("span",null,"Principal Selection")])],-1)),e("div",Rs,[Z(Et,{name:"principals",label:"Select Principals",modelValue:l.selectedPrincipals,"onUpdate:modelValue":n[5]||(n[5]=f=>l.selectedPrincipals=f),error:E.value.selectedPrincipals,required:!0,"show-batch-preview":!0,"base-opportunity-name":l.opportunityName,description:"Choose one or more principals for this opportunity. Multiple selections will create separate opportunities for each principal.",onSelectionChanged:c},null,8,["modelValue","error","base-opportunity-name"])])])])):g("",!0),m.value===3||v.isEditing?(o(),a("div",Ws,[e("div",Hs,[n[26]||(n[26]=e("h3",{class:"text-lg font-medium text-gray-900 mb-6"},[e("span",{class:"flex items-center space-x-2"},[e("span",{class:"w-2 h-2 bg-primary-500 rounded-full"}),e("span",null,"Product & Details")])],-1)),e("div",Js,[e("div",Ks,[Z(as,{name:"product",label:"Product",modelValue:l.selectedProduct,"onUpdate:modelValue":n[6]||(n[6]=f=>l.selectedProduct=f),"selected-principals":l.selectedPrincipals,error:E.value.selectedProduct,required:!0,onProductSelected:h},null,8,["modelValue","selected-principals","error"])]),e("div",null,[Z(ws,{name:"stage",label:"Opportunity Stage",modelValue:l.stage,"onUpdate:modelValue":n[7]||(n[7]=f=>l.stage=f),error:E.value.stage,required:!0,onStageChanged:B},null,8,["modelValue","error"])]),e("div",null,[n[21]||(n[21]=e("label",{for:"probability",class:"block text-sm font-medium text-gray-700 mb-1"}," Success Probability (%) ",-1)),e("div",Ys,[K(e("input",{id:"probability","onUpdate:modelValue":n[8]||(n[8]=f=>l.probabilityPercent=f),type:"number",min:"0",max:"100",step:"5",placeholder:"0",class:$(T.value)},null,2),[[Y,l.probabilityPercent,void 0,{number:!0}]]),n[20]||(n[20]=e("div",{class:"absolute inset-y-0 right-0 flex items-center pr-3"},[e("span",{class:"text-gray-500 text-sm"},"%")],-1))]),n[22]||(n[22]=e("p",{class:"mt-1 text-xs text-gray-500"}," Auto-populated based on stage, but can be customized ",-1))]),e("div",null,[n[23]||(n[23]=e("label",{for:"close-date",class:"block text-sm font-medium text-gray-700 mb-1"}," Expected Close Date ",-1)),K(e("input",{id:"close-date","onUpdate:modelValue":n[9]||(n[9]=f=>l.expectedCloseDate=f),type:"date",min:z.value,class:$(T.value)},null,10,Qs),[[Y,l.expectedCloseDate]])]),e("div",null,[n[24]||(n[24]=e("label",{for:"deal-owner",class:"block text-sm font-medium text-gray-700 mb-1"}," Deal Owner ",-1)),K(e("input",{id:"deal-owner","onUpdate:modelValue":n[10]||(n[10]=f=>l.dealOwner=f),type:"text",placeholder:"Enter deal owner name...",class:$(T.value)},null,2),[[Y,l.dealOwner]])]),e("div",Xs,[n[25]||(n[25]=e("label",{for:"notes",class:"block text-sm font-medium text-gray-700 mb-1"}," Notes ",-1)),K(e("textarea",{id:"notes","onUpdate:modelValue":n[11]||(n[11]=f=>l.notes=f),rows:"4",placeholder:"Add any additional notes about this opportunity...",class:$(V.value)},null,2),[[Y,l.notes]])])])])])):g("",!0),P.value?(o(),a("div",Zs,[e("div",er,[n[28]||(n[28]=e("svg",{class:"h-5 w-5 text-red-400 mr-3 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("div",null,[n[27]||(n[27]=e("h3",{class:"text-sm font-medium text-red-800"},"Error submitting form",-1)),e("p",tr,u(P.value),1)])])])):g("",!0),e("div",sr,[e("div",rr,[e("div",ar,[!v.isEditing&&m.value>1?(o(),a("button",{key:0,type:"button",onClick:Q,class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"},n[29]||(n[29]=[e("svg",{class:"-ml-1 mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),M(" Previous ",-1)]))):g("",!0),e("button",{type:"button",onClick:de,class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Cancel ")]),e("div",or,[v.isEditing?g("",!0):(o(),a("button",{key:0,type:"button",onClick:le,disabled:O.value,class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50"},[n[30]||(n[30]=e("svg",{class:"-ml-1 mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"})],-1)),M(" "+u(O.value?"Saving...":"Save Draft"),1)],8,lr)),!v.isEditing&&m.value<J?(o(),a("button",{key:1,type:"button",onClick:H,disabled:!A.value,class:"inline-flex items-center px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed"},n[31]||(n[31]=[M(" Next ",-1),e("svg",{class:"ml-2 -mr-1 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]),8,nr)):(o(),a("button",{key:2,type:"submit",disabled:C.value||!F.value,class:"inline-flex items-center px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed"},[C.value?(o(),a("svg",dr,n[32]||(n[32]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):g("",!0),M(" "+u(C.value?"Creating...":v.isEditing?"Update Opportunity":W()),1)],8,ir))])])])],32)]))}}),br=$e(ur,[["__scopeId","data-v-01a97ad6"]]);export{br as O};
//# sourceMappingURL=OpportunityFormWrapper-dinbuOp-.js.map
