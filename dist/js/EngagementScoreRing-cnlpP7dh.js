import{s as t}from"./supabaseClient-BTp2rsYU.js";import{d as e,c as a,C as r,B as i,D as s,U as n,V as c,E as o,J as l}from"./vue-runtime-Ds28nt_E.js";import{_ as p}from"./_plugin-vue_export-helper-DYAABpgn.js";const u=new Map;class _{generateCacheKey(t,e={}){return`${t}:${JSON.stringify(e,Object.keys(e).sort())}`}getCachedResult(t){const e=u.get(t);return e?Date.now()-e.timestamp>e.ttl?(u.delete(t),null):e.data:null}setCachedResult(t,e,a=3e5){u.set(t,{data:e,timestamp:Date.now(),ttl:a})}clearCachePattern(t){for(const e of u.keys())e.includes(t)&&u.delete(e)}async monitorPerformance(t,e){Date.now();try{const t=await e();return Date.now(),t}catch(a){throw Date.now(),a}}async getPrincipalSummaries(e={},a={field:"engagement_score",order:"desc"},r={}){const i=this.generateCacheKey("principal_summaries",{filters:e,sort:a,pagination:r}),s=this.getCachedResult(i);return s?{success:!0,data:s}:this.monitorPerformance("getPrincipalSummaries",async()=>{try{const s=r.page||1,n=r.limit||20,c=(s-1)*n;let o=t.from("principal_activity_summary").select("\n            principal_id,\n            principal_name,\n            principal_status,\n            organization_type,\n            industry,\n            organization_size,\n            is_active,\n            lead_score,\n            contact_count,\n            active_contacts,\n            primary_contact_name,\n            primary_contact_email,\n            last_contact_update,\n            total_interactions,\n            interactions_last_30_days,\n            interactions_last_90_days,\n            last_interaction_date,\n            last_interaction_type,\n            next_follow_up_date,\n            avg_interaction_rating,\n            positive_interactions,\n            follow_ups_required,\n            total_opportunities,\n            active_opportunities,\n            won_opportunities,\n            opportunities_last_30_days,\n            latest_opportunity_stage,\n            latest_opportunity_date,\n            avg_probability_percent,\n            highest_value_opportunity,\n            product_count,\n            active_product_count,\n            product_categories,\n            primary_product_category,\n            is_principal,\n            is_distributor,\n            last_activity_date,\n            activity_status,\n            engagement_score,\n            principal_created_at,\n            principal_updated_at,\n            summary_generated_at\n          ",{count:"exact"});this.applyFiltersToQuery(o,e),o=o.order(a.field,{ascending:"asc"===a.order}),o=o.range(c,c+n-1);const{data:l,error:p,count:u}=await o;if(p)return{success:!1,error:p.message||"Failed to fetch principal summaries"};if(!l)return{success:!1,error:"No data returned from query"};const _=u||0,d=Math.ceil(_/n),y={page:s,limit:n,total:_,total_pages:d,has_next:s<d,has_previous:s>1},g=(l||[]).map(t=>t&&"object"==typeof t?t:{}),m=this.calculateSummaryAnalytics(g),h={data:g,pagination:y,filters:e,sort:a,analytics_summary:{total_count:_,active_count:g.filter(t=>t.activity_status&&"ACTIVE"===t.activity_status).length,avg_engagement_score:m.avg_engagement_score,top_activity_status:"ACTIVE"}};return this.setCachedResult(i,h),{success:!0,data:h}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Unexpected error occurred"}}})}async getPrincipalDashboard(e){const a=this.generateCacheKey("principal_dashboard",{principalId:e}),r=this.getCachedResult(a);return r?{success:!0,data:r}:this.monitorPerformance("getPrincipalDashboard",async()=>{try{const{data:r,error:i}=await t.from("principal_activity_summary").select("*").eq("principal_id",e).single();if(i)return{success:!1,error:i.message||"Failed to fetch principal summary"};const s=await this.getDistributorRelationshipsForPrincipal(e),n=await this.getProductPerformanceForPrincipal(e),c={summary:r,relationships:s,product_performance:n,recent_timeline:await this.getTimelineEntriesForPrincipal(e,20),analytics:await this.calculatePrincipalAnalytics(r),kpi_metrics:{total_revenue_potential:n.reduce((t,e)=>t+(e.total_value||0),0),active_opportunity_count:r.active_opportunities||0,pending_follow_ups:r.follow_ups_required||0,overdue_activities:0,engagement_trend:"stable"}};return this.setCachedResult(a,c,18e4),{success:!0,data:c}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Failed to fetch dashboard data"}}})}async getDistributorRelationships(t){const e=this.generateCacheKey("distributor_relationships",{principalIds:t}),a=this.getCachedResult(e);return a?{success:!0,data:a}:this.monitorPerformance("getDistributorRelationships",async()=>{try{const a=[{principal_id:"principal-1",principal_name:"Acme Supplies Co.",principal_status:"Active",distributor_id:"dist-1",distributor_name:"Regional Distribution Corp",distributor_status:"Active",relationship_type:"HAS_DISTRIBUTOR",principal_city:"Los Angeles",principal_state:"CA",principal_country:"USA",distributor_city:"San Francisco",distributor_state:"CA",distributor_country:"USA",principal_lead_score:85,distributor_lead_score:78,principal_created_at:"2023-01-10T00:00:00Z",principal_last_contact:"2024-01-15T10:30:00Z",distributor_last_contact:"2024-01-14T15:20:00Z"}],r=t&&t.length>0?a.filter(e=>t.includes(e.principal_id)):a;return this.setCachedResult(e,r),{success:!0,data:r}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to fetch relationships"}}})}async getProductPerformance(t){const e=this.generateCacheKey("product_performance",{principalIds:t}),a=this.getCachedResult(e);return a?{success:!0,data:a}:this.monitorPerformance("getProductPerformance",async()=>{try{const a=[{principal_id:"principal-1",principal_name:"Acme Supplies Co.",product_id:"prod-1",product_name:"Premium Widget Pro",product_category:"Protein",product_sku:"PWP-001",is_primary_principal:!0,exclusive_rights:!1,wholesale_price:299.99,minimum_order_quantity:50,lead_time_days:14,contract_start_date:"2023-01-01",contract_end_date:"2024-12-31",territory_restrictions:null,opportunities_for_product:15,won_opportunities_for_product:8,active_opportunities_for_product:7,latest_opportunity_date:"2024-01-10T15:30:00Z",avg_opportunity_probability:65,total_opportunities:15,win_rate:53,total_value:125e3,interactions_for_product:32,recent_interactions_for_product:5,last_interaction_date:"2024-01-08T10:20:00Z",product_is_active:!0,launch_date:"2022-06-15",discontinue_date:null,unit_cost:180,suggested_retail_price:399.99,contract_status:"ACTIVE",product_performance_score:78,relationship_created_at:"2023-01-01T00:00:00Z",relationship_updated_at:"2024-01-08T10:20:00Z"}],r=t&&t.length>0?a.filter(e=>t.includes(e.principal_id)):a;return this.setCachedResult(e,r),{success:!0,data:r}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to fetch product performance"}}})}async getPrincipalTimeline(e,a=50){const r=this.generateCacheKey("principal_timeline",{principalIds:e,limit:a}),i=this.getCachedResult(r);return i?{success:!0,data:i}:this.monitorPerformance("getPrincipalTimeline",async()=>{try{const{data:i,error:s}=await t.from("principal_activity_summary").select("*").in("principal_id",e).limit(a);if(s)return{success:!1,error:s.message||"Failed to fetch timeline entries"};const n=i?.map(t=>({principal_id:t.principal_id||"principal-1",principal_name:t.principal_name||"Sample Principal",activity_date:t.last_activity_date||(new Date).toISOString(),activity_type:"INTERACTION",activity_subject:`Activity for ${t.principal_name||"Sample Principal"}`,activity_details:"Recent activity summary with details",source_id:t.id||`source-${Date.now()}`,source_table:"interactions",opportunity_name:null,contact_name:null,product_name:null,created_by:"system",activity_status:"COMPLETED",follow_up_required:!1,follow_up_date:null,timeline_rank:1}))||[];return this.setCachedResult(r,n,12e4),{success:!0,data:n}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Failed to fetch timeline"}}})}async calculateAnalytics(t){return this.monitorPerformance("calculateAnalytics",async()=>{try{return{success:!0,data:{total_principals:t.length,active_principals:t.filter(t=>"ACTIVE"===t.activity_status).length,principals_with_products:t.filter(t=>t.product_count>0).length,principals_with_opportunities:t.filter(t=>t.total_opportunities>0).length,average_products_per_principal:this.calculateAverage(t.map(t=>t.product_count)),average_engagement_score:this.calculateAverage(t.map(t=>t.engagement_score)),top_performers:this.getTopPerformingPrincipals(t,10),activity_status_distribution:this.calculateActivityStatusDistribution(t),product_category_distribution:this.calculateProductCategoryDistribution(t),monthly_activity_trend:await this.calculateMonthlyActivityTrend(t),geographic_distribution:this.calculateGeographicDistribution(t)}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Analytics calculation failed"}}})}async getPrincipalOptions(t){const e=this.generateCacheKey("principal_options",{organizationId:t}),a=this.getCachedResult(e);return a?{success:!0,data:a}:this.monitorPerformance("getPrincipalOptions",async()=>{try{const t=[{principal_id:"principal-1",principal_name:"Acme Supplies Co.",organization_type:"B2B",engagement_score:85,activity_status:"ACTIVE",contact_count:12,total_opportunities:12,last_activity_date:(new Date).toISOString()},{principal_id:"principal-2",principal_name:"Global Distribution Inc.",organization_type:"B2B",engagement_score:72,activity_status:"ACTIVE",contact_count:8,total_opportunities:8,last_activity_date:new Date(Date.now()-864e5).toISOString()}].map(t=>({id:t.principal_id,name:t.principal_name,organization_type:t.organization_type,engagement_score:t.engagement_score,activity_status:t.activity_status,contact_count:t.contact_count,opportunity_count:t.total_opportunities,last_activity_date:t.last_activity_date,is_recommended:t.engagement_score>70&&"ACTIVE"===t.activity_status}));return this.setCachedResult(e,t),{success:!0,data:t}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to fetch options"}}})}async batchUpdatePrincipals(t,e){return this.monitorPerformance("batchUpdatePrincipals",async()=>{try{return this.clearCachePattern("principal_summaries"),this.clearCachePattern("principal_dashboard"),{success:!0,data:!0}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Batch update failed"}}})}applyFiltersToQuery(t,e){e.search&&(t=t.or(`principal_name.ilike.%${e.search}%`)),e.activity_status?.length&&(t=t.in("activity_status",e.activity_status)),e.organization_status?.length&&(t=t.in("principal_status",e.organization_status)),e.organization_type?.length&&(t=t.in("organization_type",e.organization_type)),e.product_categories?.length&&(t=t.overlaps("product_categories",e.product_categories)),null!==e.has_opportunities&&void 0!==e.has_opportunities&&(t=e.has_opportunities?t.gt("total_opportunities",0):t.eq("total_opportunities",0)),null!==e.has_products&&void 0!==e.has_products&&(t=e.has_products?t.gt("product_count",0):t.eq("product_count",0)),e.engagement_score_range&&(t=t.gte("engagement_score",e.engagement_score_range.min).lte("engagement_score",e.engagement_score_range.max)),e.lead_score_range&&(t=t.gte("lead_score",e.lead_score_range.min).lte("lead_score",e.lead_score_range.max)),null!==e.is_principal&&void 0!==e.is_principal&&(t=t.eq("is_principal",e.is_principal)),null!==e.is_distributor&&void 0!==e.is_distributor&&(t=t.eq("is_distributor",e.is_distributor)),e.created_after&&(t=t.gte("principal_created_at",e.created_after)),e.created_before&&(t=t.lte("principal_created_at",e.created_before))}async getDistributorRelationshipsForPrincipal(t){const e=await this.getDistributorRelationships([t]);return e.success&&e.data||[]}async getProductPerformanceForPrincipal(t){const e=await this.getProductPerformance([t]);return e.success&&e.data||[]}async getTimelineEntriesForPrincipal(t,e){const a=await this.getPrincipalTimeline([t],e);return a.success&&a.data||[]}async calculatePrincipalAnalytics(t){const e=await this.calculateAnalytics([t]);return e.success?e.data:{}}calculateSummaryAnalytics(t){return{avg_engagement_score:this.calculateAverage(t.map(t=>t.engagement_score)),total_opportunities:t.reduce((t,e)=>t+e.total_opportunities,0),total_interactions:t.reduce((t,e)=>t+e.total_interactions,0),top_activity_status:this.getMostCommonActivityStatus(t)}}getMostCommonActivityStatus(t){const e=this.calculateActivityStatusDistribution(t);return Object.entries(e).reduce((t,e)=>e[1]>t[1]?e:t,["NO_ACTIVITY",0])[0]}calculateAverage(t){return 0===t.length?0:t.reduce((t,e)=>t+e,0)/t.length}calculateActivityStatusDistribution(t){return{NO_ACTIVITY:t.filter(t=>"NO_ACTIVITY"===t.activity_status).length,STALE:t.filter(t=>"STALE"===t.activity_status).length,MODERATE:t.filter(t=>"MODERATE"===t.activity_status).length,ACTIVE:t.filter(t=>"ACTIVE"===t.activity_status).length}}calculateProductCategoryDistribution(t){const e={};return t.forEach(t=>{t.product_categories&&Array.isArray(t.product_categories)&&t.product_categories.forEach(t=>{e[t]=(e[t]||0)+1})}),e}async calculateMonthlyActivityTrend(t){return[{month:(new Date).toISOString().slice(0,7),new_principals:t.length,active_principals:t.filter(t=>"ACTIVE"===t.activity_status).length,opportunities_created:t.reduce((t,e)=>t+e.opportunities_last_30_days,0),interactions_count:t.reduce((t,e)=>t+e.interactions_last_30_days,0)}]}calculateGeographicDistribution(t){return[]}getTopPerformingPrincipals(t,e){return t.sort((t,e)=>e.engagement_score-t.engagement_score).slice(0,e).map(t=>({principal_id:t.principal_id,principal_name:t.principal_name,engagement_score:t.engagement_score,total_opportunities:t.total_opportunities,won_opportunities:t.won_opportunities,total_revenue:0}))}}const d=new class extends _{async getPrincipalActivitySummary(t){const e=await this.getPrincipalSummaries(t||{});return{success:e.success,data:e.data?.data||[],error:e.error}}async getEngagementScoreBreakdown(){return{success:!0,data:[{range:"0-20",label:"Low",count:0,percentage:0},{range:"21-40",label:"Below Average",count:0,percentage:0},{range:"41-60",label:"Average",count:0,percentage:0},{range:"61-80",label:"Above Average",count:0,percentage:0},{range:"81-100",label:"High",count:0,percentage:0}]}}async getPrincipalStats(){return{success:!0,data:{followUpsRequired:0,activeThisWeek:0,topPerformers:0}}}async searchPrincipalsWithActivity(t,e=!1){const a={search:t,activity_status:e?void 0:["ACTIVE"]},r=await this.getPrincipalSummaries(a);return{success:r.success,data:r.data?.data||[],error:r.error}}async getPrincipalProductPerformance(t){const e=await this.getProductPerformance([t]);return{success:e.success,data:e.data||[],error:e.error}}async getPrincipalDistributorRelationships(t){const e=await this.getDistributorRelationships(t);return{success:e.success,data:e.data||[],error:e.error}}},y=p(e({t:"ActivityStatusBadge",props:{status:{},size:{default:"sm"},showLabel:{type:Boolean,default:!0}},setup(t){const e=t,l=a(()=>{const t={ACTIVE:{label:"Active",colorClasses:"bg-green-100 text-green-800 border border-green-200",dotClasses:"bg-green-400"},MODERATE:{label:"Moderate",colorClasses:"bg-yellow-100 text-yellow-800 border border-yellow-200",dotClasses:"bg-yellow-400"},LOW:{label:"Low",colorClasses:"bg-orange-100 text-orange-800 border border-orange-200",dotClasses:"bg-orange-400"},NO_ACTIVITY:{label:"Inactive",colorClasses:"bg-gray-100 text-gray-800 border border-gray-200",dotClasses:"bg-gray-400"}};return t[e.status]||t.NO_ACTIVITY}),p=a(()=>({xs:"px-2 py-0.5 text-xs",sm:"px-2 py-1 text-xs",md:"px-3 py-1 text-sm",lg:"px-3 py-1.5 text-sm"}[e.size])),u=a(()=>`${{xs:"h-1.5 w-1.5",sm:"h-2 w-2",md:"h-2.5 w-2.5",lg:"h-3 w-3"}[e.size]} ${l.value.dotClasses}`),_=a(()=>l.value.colorClasses),d=a(()=>e.showLabel?l.value.label:"");return(t,e)=>(o(),r("span",{class:i(["activity-status-badge inline-flex items-center font-medium rounded-full transition-colors duration-200",[p.value,_.value]])},[s("span",{class:i(["mr-1 rounded-full",u.value]),"aria-hidden":!0},null,2),n(" "+c(d.value),1)],2))}}),[["__scopeId","data-v-08161919"]]),g=["width","height"],m=["cx","cy","r","stroke-width"],h=["cx","cy","r","stroke-width","stroke-dasharray","stroke-dashoffset"],v={class:"absolute inset-0 flex items-center justify-center"},f={class:"text-center"},b={key:0,class:"text-xs text-gray-500 font-medium"},x={key:0,class:"absolute z-10 px-2 py-1 text-xs font-medium text-white bg-gray-900 rounded-md shadow-lg opacity-0 pointer-events-none transition-opacity duration-200 -top-8 left-1/2 transform -translate-x-1/2 group-hover:opacity-100"},w=p(e({t:"EngagementScoreRing",props:{score:{},size:{default:"md"},showLabel:{type:Boolean,default:!0},showTooltip:{type:Boolean,default:!1},animated:{type:Boolean,default:!0},maxScore:{default:100}},setup(t){const e=t,p=a(()=>({xs:{diameter:32,strokeWidth:3,textClass:"text-xs"},sm:{diameter:40,strokeWidth:3,textClass:"text-sm"},md:{diameter:56,strokeWidth:4,textClass:"text-base"},lg:{diameter:80,strokeWidth:5,textClass:"text-lg"},xl:{diameter:120,strokeWidth:6,textClass:"text-2xl"}}[e.size])),u=a(()=>p.value.diameter),_=a(()=>u.value/2),d=a(()=>_.value-p.value.strokeWidth/2),y=a(()=>p.value.strokeWidth),w=a(()=>2*Math.PI*d.value),A=a(()=>{const t=Math.min(Math.max(e.score,0),e.maxScore)/e.maxScore;return w.value-t*w.value}),C=a(()=>[e.showTooltip?"group cursor-help":"","relative"].filter(Boolean).join(" ")),T=a(()=>{const t=[];return e.animated&&t.push("transition-transform duration-300 hover:scale-105"),t.join(" ")}),P=a(()=>{const t=e.score;return t>=80?"text-green-500":t>=60?"text-blue-500":t>=40?"text-yellow-500":t>=20?"text-orange-500":"text-red-500"}),E=a(()=>{const t=e.score;return t>=80?"text-green-600":t>=60?"text-blue-600":t>=40?"text-yellow-600":t>=20?"text-orange-600":"text-red-600"}),I=a(()=>p.value.textClass),D=a(()=>Math.round(e.score).toString()),S=a(()=>{const t=e.score;return t>=90?"Excellent":t>=80?"Very Good":t>=70?"Good":t>=60?"Above Avg":t>=50?"Average":t>=40?"Below Avg":t>=30?"Poor":t>=20?"Very Poor":"Critical"}),k=a(()=>`Engagement Score: ${e.score}/${e.maxScore} (${S.value})`);return(t,e)=>(o(),r("div",{class:i(["engagement-score-ring relative inline-flex items-center justify-center",C.value])},[(o(),r("svg",{class:i(["transform -rotate-90 transition-all duration-300",T.value]),width:u.value,height:u.value},[s("circle",{cx:_.value,cy:_.value,r:d.value,stroke:"currentColor","stroke-width":y.value,fill:"none",class:"text-gray-200"},null,8,m),s("circle",{cx:_.value,cy:_.value,r:d.value,stroke:"currentColor","stroke-width":y.value,fill:"none","stroke-dasharray":w.value,"stroke-dashoffset":A.value,class:i([P.value,"transition-all duration-500 ease-out"]),"stroke-linecap":"round"},null,10,h)],10,g)),s("div",v,[s("div",f,[s("span",{class:i(["font-bold tabular-nums",[I.value,E.value]])},c(D.value),3),t.showLabel&&"xs"!==t.size&&"sm"!==t.size?(o(),r("div",b,c(S.value),1)):l("",!0)])]),t.showTooltip?(o(),r("div",x,[n(c(k.value)+" ",1),e[0]||(e[0]=s("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"},null,-1))])):l("",!0)],2))}}),[["__scopeId","data-v-5f57d73c"]]);export{y as A,w as E,d as p};
