import{b as t,u as e}from"./vue-router-BP51f1Hv.js";import{O as r}from"./OpportunityFormWrapper-DR5ctsEn.js";import{O as s}from"./opportunityStore-CXzxniyP.js";import{d as o,r as i,c as a,C as n,D as l,J as p,O as u,W as d,N as c,H as m,V as x,E as f,U as v}from"./vue-runtime-Ds28nt_E.js";import{_ as g}from"./_plugin-vue_export-helper-DYAABpgn.js";import"./principalStore-B-JbVMeA.js";import"./pinia-CUC4VGP7.js";import"./organizationsApi-B46nS86y.js";import"./supabaseClient-5bv4QPtU.js";import"./supabase-BzUtZ1M4.js";import"./yup-D02u5inE.js";import"./productStore-CX98uskH.js";const y={class:"opportunity-create-view"},h={class:"mb-8"},k={class:"flex mb-4","aria-label":"Breadcrumb"},w={class:"inline-flex items-center space-x-1 md:space-x-3"},b={class:"inline-flex items-center"},j={class:"flex items-center"},_={class:"flex items-center space-x-3 mb-4"},C={class:"max-w-4xl","data-testid":"opportunity-form-container"},O={key:0,class:"mt-6 max-w-4xl"},B={class:"p-4 border border-red-300 rounded-md bg-red-50"},S={class:"flex"},z={class:"mt-1 text-sm text-red-700"},D={key:1,class:"mt-6 max-w-4xl"},M={class:"p-4 border border-green-300 rounded-md bg-green-50"},T={class:"flex"},E={class:"mt-1 text-sm text-green-700"},N=g(o({t:"OpportunityCreateView",setup(o){const g=e(),N=t(),R=i(null),V=i(null),$=a(()=>{const t=N.query,e={};return"contact"===t.contextType&&(e.organizationName=t.organizationName||"",e.context=s.NEW_PRODUCT_INTEREST,e.notes=t.contactName?`Opportunity created from contact: ${t.contactName}`:"Opportunity created from contact page"),"organization"===t.contextType&&(e.organizationName=t.organizationName||"",e.context=s.FOLLOW_UP,e.notes="Opportunity created from organization page"),e}),A=t=>{if(R.value=null,t.opportunityId)V.value="Opportunity created successfully! Redirecting to details...",setTimeout(()=>{g.push(`/opportunities/${t.opportunityId}`)},1500);else if(t.opportunityIds&&t.opportunityIds.length>0){const e=t.count||t.opportunityIds.length;V.value=`${e} opportunities created successfully! Redirecting to list...`,setTimeout(()=>{g.push("/opportunities")},2e3)}else V.value="Opportunity created successfully! Redirecting...",setTimeout(()=>{g.push("/opportunities")},1500)},F=()=>{R.value=null,V.value=null,g.push("/opportunities")},H=t=>{V.value=null,R.value="string"==typeof t?t:t.message||"An unexpected error occurred"},L=()=>{R.value=null};return(t,e)=>{const s=m("router-link");return f(),n("div",y,[l("div",h,[l("nav",k,[l("ol",w,[l("li",b,[d(s,{to:"/",class:"inline-flex items-center text-sm font-medium text-gray-700 hover:text-primary-600"},{default:c(()=>e[0]||(e[0]=[l("svg",{class:"w-3 h-3 mr-2.5",fill:"currentColor",viewBox:"0 0 20 20"},[l("path",{d:"m19.707 9.293-2-2-7-7a1 1 0 0 0-1.414 0l-7 7-2 2a1 1 0 0 0 1.414 1.414L2 10.414V18a2 2 0 0 0 2 2h3a1 1 0 0 0 1-1v-4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h3a2 2 0 0 0 2-2v-7.586l.293.293a1 1 0 0 0 1.414-1.414Z"})],-1),v(" Dashboard ",-1)])),o:1,i:[0]})]),l("li",null,[l("div",j,[e[2]||(e[2]=l("svg",{class:"w-3 h-3 text-gray-400 mx-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m9 5 7 7-7 7"})],-1)),d(s,{to:"/opportunities",class:"ml-1 text-sm font-medium text-gray-700 hover:text-primary-600 md:ml-2"},{default:c(()=>e[1]||(e[1]=[v(" Opportunities ",-1)])),o:1,i:[1]})])]),e[3]||(e[3]=u('<li aria-current="page" data-v-1279af65><div class="flex items-center" data-v-1279af65><svg class="w-3 h-3 text-gray-400 mx-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-1279af65><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m9 5 7 7-7 7" data-v-1279af65></path></svg><span class="ml-1 text-sm font-medium text-gray-500 md:ml-2" data-v-1279af65>New Opportunity</span></div></li>',1))])]),l("div",_,[d(s,{to:"/opportunities",class:"inline-flex items-center text-gray-500 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded-md p-1","aria-label":"Back to opportunities list"},{default:c(()=>e[4]||(e[4]=[l("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),o:1,i:[4]}),e[5]||(e[5]=l("div",null,[l("h1",{class:"text-3xl font-bold text-gray-900","data-testid":"page-title"},"Create New Opportunity"),l("p",{class:"mt-2 text-gray-600"}," Set up a new sales opportunity with auto-naming, multi-principal support, and stage tracking. ")],-1))])]),l("div",C,[d(r,{"is-editing":!1,"initial-data":$.value,onSuccess:A,onCancel:F,onError:H,"data-testid":"opportunity-form"},null,8,["initial-data"])]),R.value?(f(),n("div",O,[l("div",B,[l("div",S,[e[7]||(e[7]=l("svg",{class:"h-5 w-5 text-red-400 mr-2 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),l("div",null,[e[6]||(e[6]=l("h3",{class:"text-sm font-medium text-red-800"},"Error creating opportunity",-1)),l("p",z,x(R.value),1),l("div",{class:"mt-3"},[l("button",{onClick:L,class:"text-sm font-medium text-red-800 hover:text-red-900 focus:outline-none focus:ring-2 focus:ring-red-500 rounded-md px-2 py-1"}," Dismiss ")])])])])])):p("",!0),V.value?(f(),n("div",D,[l("div",M,[l("div",T,[e[9]||(e[9]=l("svg",{class:"h-5 w-5 text-green-400 mr-2 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)),l("div",null,[e[8]||(e[8]=l("h3",{class:"text-sm font-medium text-green-800"},"Success!",-1)),l("p",E,x(V.value),1)])])])])):p("",!0)])}}}),[["__scopeId","data-v-1279af65"]]);export{N as default};
