function t(t){return"object"==typeof t&&null!==t&&"t"in t}function e(t,e,i,r,s,n){return be(this,void 0,void 0,function*(){return new Promise((o,a)=>{t(i,((t,e,i,r)=>{const s={method:t,headers:(null==e?void 0:e.headers)||{}};return"GET"===t?s:(s.headers=Object.assign({"Content-Type":"application/json"},null==e?void 0:e.headers),r&&(s.body=JSON.stringify(r)),Object.assign(Object.assign({},s),i))})(e,r,s,n)).then(t=>{if(!t.ok)throw t;return(null==r?void 0:r.noResolveJson)?t:t.json()}).then(t=>o(t)).catch(t=>((t,e,i)=>be(void 0,void 0,void 0,function*(){const r=yield ve(void 0,void 0,void 0,function*(){return"undefined"==typeof Response?(yield D(()=>Promise.resolve().then(()=>it),void 0)).Response:Response});t instanceof r&&!(null==i?void 0:i.noResolveJson)?t.json().then(i=>{e(new fe(ge(i),t.status||500))}).catch(t=>{e(new we(ge(t),t))}):e(new we(ge(t),t))}))(t,a,r))})})}function i(t,i,r,s){return be(this,void 0,void 0,function*(){return e(t,"GET",i,r,s)})}function r(t,i,r,s,n){return be(this,void 0,void 0,function*(){return e(t,"POST",i,s,n,r)})}function s(t,i,r,s,n){return be(this,void 0,void 0,function*(){return e(t,"DELETE",i,s,n,r)})}function n(t){return"object"==typeof t&&null!==t&&"i"in t}function o(t){return n(t)&&"AuthApiError"===t.name}function a(t){return n(t)&&"AuthSessionMissingError"===t.name}function h(t){return n(t)&&"AuthImplicitGrantRedirectError"===t.name}function l(t){return n(t)&&"AuthRetryableFetchError"===t.name}function c(t,e,i){if(null!==t)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const t=e.queue>>e.queuedBits-6&63;i(Qe[t]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const t=e.queue>>e.queuedBits-6&63;i(Qe[t]),e.queuedBits-=6}}function u(t,e,i){const r=ti[t];if(!(r>-1)){if(-2===r)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)i(e.queue>>e.queuedBits-8&255),e.queuedBits-=8}function d(t){const e=[],i=t=>{e.push(String.fromCodePoint(t))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},n=t=>{!function(t,e,i){if(0===e.utf8seq){if(t<=127)return void i(t);for(let i=1;i<6;i+=1)if(!(t>>7-i&1)){e.utf8seq=i;break}if(2===e.utf8seq)e.codepoint=31&t;else if(3===e.utf8seq)e.codepoint=15&t;else{if(4!==e.utf8seq)throw new Error("Invalid UTF-8 sequence");e.codepoint=7&t}e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|63&t,e.utf8seq-=1,0===e.utf8seq&&i(e.codepoint)}}(t,r,i)};for(let o=0;o<t.length;o+=1)u(t.charCodeAt(o),s,n);return e.join("")}function f(t,e){if(!(t<=127)){if(t<=2047)return e(192|t>>6),void e(128|63&t);if(t<=65535)return e(224|t>>12),e(128|t>>6&63),void e(128|63&t);if(t<=1114111)return e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),void e(128|63&t);throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}e(t)}function w(t){const e=[],i={queue:0,queuedBits:0},r=t=>{e.push(t)};for(let s=0;s<t.length;s+=1)u(t.charCodeAt(s),i,r);return new Uint8Array(e)}function v(t){const e=[],i={queue:0,queuedBits:0},r=t=>{e.push(t)};return t.forEach(t=>c(t,i,r)),c(null,i,r),e.join("")}function y(t){const e=t.split(".");if(3!==e.length)throw new Xe("Invalid JWT structure");for(let i=0;i<e.length;i++)if(!Fe.test(e[i]))throw new Xe("JWT not in base64url format");return{header:JSON.parse(d(e[0])),payload:JSON.parse(d(e[1])),signature:w(e[2]),raw:{header:e[0],payload:e[1]}}}function p(t){return("0"+t.toString(16)).substr(-2)}async function b(t,e,i=!1){const r=function(){const t=new Uint32Array(56);if("undefined"==typeof crypto){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",e=t.length;let i="";for(let r=0;r<56;r++)i+=t.charAt(Math.floor(Math.random()*e));return i}return crypto.getRandomValues(t),Array.from(t,p).join("")}();let s=r;i&&(s+="/PASSWORD_RECOVERY"),await ni(t,`${e}-code-verifier`,s);const n=await async function(t){if("undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder)return t;const e=await async function(t){const e=(new TextEncoder).encode(t),i=await crypto.subtle.digest("SHA-256",e),r=new Uint8Array(i);return Array.from(r).map(t=>String.fromCharCode(t)).join("")}(t);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(r);return[n,r===n?"plain":"s256"]}function g(t){if(!ci.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function m(){return new Proxy({},{get:(t,e)=>{if("__isUserNotAvailableProxy"===e)return!0;if("symbol"==typeof e){const t=e.toString();if("Symbol(Symbol.toPrimitive)"===t||"Symbol(Symbol.toStringTag)"===t||"Symbol(util.inspect.custom)"===t)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${e}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function _(t){return JSON.parse(JSON.stringify(t))}async function $(t){var e,i;if(!("object"==typeof(i=t)&&null!==i&&"status"in i&&"ok"in i&&"json"in i&&"function"==typeof i.json))throw new Ke(di(t),0);if(fi.includes(t.status))throw new Ke(di(t),t.status);let r,s;try{r=await t.json()}catch(o){throw new Ge(di(o),o)}const n=function(t){const e=t.headers.get(De);if(!e)return null;if(!e.match(li))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch(o){return null}}(t);if(n&&n.getTime()>=Le.timestamp&&"object"==typeof r&&r&&"string"==typeof r.code?s=r.code:"object"==typeof r&&r&&"string"==typeof r.error_code&&(s=r.error_code),s){if("weak_password"===s)throw new Ye(di(r),t.status,(null===(e=r.weak_password)||void 0===e?void 0:e.reasons)||[]);if("session_not_found"===s)throw new qe}else if("object"==typeof r&&r&&"object"==typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((t,e)=>t&&"string"==typeof e,!0))throw new Ye(di(r),t.status,r.weak_password.reasons);throw new Me(di(r),t.status||500,s)}async function j(t,e,i,r){var s;const n=Object.assign({},null==r?void 0:r.headers);n[De]||(n[De]=Le.name),(null==r?void 0:r.jwt)&&(n.Authorization=`Bearer ${r.jwt}`);const o=null!==(s=null==r?void 0:r.query)&&void 0!==s?s:{};(null==r?void 0:r.redirectTo)&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",h=await async function(t,e,i,r,s,n){const o=((t,e,i,r)=>{const s={method:t,headers:(null==e?void 0:e.headers)||{}};return"GET"===t?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==e?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),{}))})(e,r,0,n);let a;try{a=await t(i,Object.assign({},o))}catch(h){throw new Ke(di(h),0)}if(a.ok||await $(a),null==r?void 0:r.noResolveJson)return a;try{return await a.json()}catch(h){await $(h)}}(t,e,i+a,{headers:n,noResolveJson:null==r?void 0:r.noResolveJson},0,null==r?void 0:r.body);return(null==r?void 0:r.xform)?null==r?void 0:r.xform(h):{data:Object.assign({},h),error:null}}function E(t){var e;let i=null;var r;return function(t){return t.access_token&&t.refresh_token&&t.expires_in}(t)&&(i=Object.assign({},t),t.expires_at||(i.expires_at=(r=t.expires_in,Math.round(Date.now()/1e3)+r))),{data:{session:i,user:null!==(e=t.user)&&void 0!==e?e:t},error:null}}function k(t){const e=E(t);return!e.error&&t.weak_password&&"object"==typeof t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&"string"==typeof t.weak_password.message&&t.weak_password.reasons.reduce((t,e)=>t&&"string"==typeof e,!0)&&(e.data.weak_password=t.weak_password),e}function O(t){var e;return{data:{user:null!==(e=t.user)&&void 0!==e?e:t},error:null}}function S(t){return{data:t,error:null}}function T(t){const{action_link:e,email_otp:i,hashed_token:r,redirect_to:s,verification_type:n}=t,o=ui(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:e,email_otp:i,hashed_token:r,redirect_to:s,verification_type:n},user:Object.assign({},o)},error:null}}function A(t){return t}function x(t={}){return{getItem:e=>t[e]||null,setItem:(e,i)=>{t[e]=i},removeItem:e=>{delete t[e]}}}async function I(t,e,i){const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort()},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,0===e?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async r=>{if(!r){if(0===e)throw new bi(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(yi.debug)try{await globalThis.navigator.locks.query()}catch(s){}return await i()}try{return await i()}finally{}}))}async function P(t,e,i){return await i()}import{g as R,c as U}from"./yup-D02u5inE.js";const N=function(){const t="undefined"!=typeof document&&document.createElement("link").relList;return t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"}(),C={},D=function(t,e,i){function r(t){const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}let s=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),i=t?.nonce||t?.getAttribute("nonce");s=Promise.allSettled(e.map(t=>{if((t=function(t){return"/"+t}(t))in C)return;C[t]=!0;const e=t.endsWith(".css"),r=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${r}`))return;const s=document.createElement("link");return s.rel=e?"stylesheet":N,e||(s.as="script"),s.crossOrigin="",s.href=t,i&&s.setAttribute("nonce",i),document.head.appendChild(s),e?new Promise((e,i)=>{s.addEventListener("load",e),s.addEventListener("error",()=>i(new Error(`Unable to preload CSS for ${t}`)))}):void 0}))}return s.then(e=>{for(const t of e||[])"rejected"===t.status&&r(t.reason);return t().catch(r)})};class L extends Error{constructor(t,e="FunctionsError",i){super(t),this.name=e,this.context=i}}class F extends L{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class B extends L{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class M extends L{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var G;!function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"}(G||(G={}));class J{constructor(t,{headers:e={},customFetch:i,region:r=G.Any}={}){this.url=t,this.headers=e,this.region=r,this.fetch=(t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>D(async()=>{const{default:t}=await Promise.resolve().then(()=>it);return{default:t}},void 0).then(({default:e})=>e(...t)):fetch),(...t)=>e(...t)})(i)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,e={}){var i,r,s,n;return r=this,n=function*(){try{const{headers:r,method:s,body:n}=e;let o={},{region:a}=e;a||(a=this.region);const h=new URL(`${this.url}/${t}`);let l;a&&"any"!==a&&(o["x-region"]=a,h.searchParams.set("forceFunctionRegion",a)),n&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&("undefined"!=typeof Blob&&n instanceof Blob||n instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",l=n):"string"==typeof n?(o["Content-Type"]="text/plain",l=n):"undefined"!=typeof FormData&&n instanceof FormData?l=n:(o["Content-Type"]="application/json",l=JSON.stringify(n)));const c=yield this.fetch(h.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),r),body:l}).catch(t=>{throw new F(t)}),u=c.headers.get("x-relay-error");if(u&&"true"===u)throw new B(c);if(!c.ok)throw new M(c);let d,f=(null!==(i=c.headers.get("Content-Type"))&&void 0!==i?i:"text/plain").split(";")[0].trim();return d="application/json"===f?yield c.json():"application/octet-stream"===f?yield c.blob():"text/event-stream"===f?c:"multipart/form-data"===f?yield c.formData():yield c.text(),{data:d,error:null,response:c}}catch(r){return{data:null,error:r,response:r instanceof M||r instanceof B?r.context:void 0}}},new((s=void 0)||(s=Promise))(function(t,e){function i(t){try{a(n.next(t))}catch(i){e(i)}}function o(t){try{a(n.throw(t))}catch(i){e(i)}}function a(e){var r;e.done?t(e.value):(r=e.value,r instanceof s?r:new s(function(t){t(r)})).then(i,o)}a((n=n.apply(r,[])).next())})}}var q={},W={},z={},H={},V={},K={},Y=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const X=Y.fetch,Q=Y.fetch.bind(Y),Z=Y.Headers,tt=Y.Request,et=Y.Response,it=Object.freeze(Object.defineProperty({__proto__:null,Headers:Z,Request:tt,Response:et,default:Q,fetch:X},Symbol.toStringTag,{value:"Module"})),rt=R(it);var st={};Object.defineProperty(st,"o",{value:!0});let nt=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};st.default=nt;var ot=U&&U.h||function(t){return t&&t.o?t:{default:t}};Object.defineProperty(K,"o",{value:!0});const at=ot(rt),ht=ot(st);K.default=class{constructor(t){this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=t.headers,this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=t.shouldThrowOnError,this.signal=t.signal,this.isMaybeSingle=t.isMaybeSingle,t.fetch?this.fetch=t.fetch:"undefined"==typeof fetch?this.fetch=at.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=Object.assign({},this.headers),this.headers[t]=e,this}then(t,e){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let i=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async t=>{var e,i,r;let s=null,n=null,o=null,a=t.status,h=t.statusText;if(t.ok){if("HEAD"!==this.method){const e=await t.text();""===e||(n="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?e:JSON.parse(e))}const r=null===(e=this.headers.Prefer)||void 0===e?void 0:e.match(/count=(exact|planned|estimated)/),l=null===(i=t.headers.get("content-range"))||void 0===i?void 0:i.split("/");r&&l&&l.length>1&&(o=parseInt(l[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(n)&&(n.length>1?(s={code:"PGRST116",details:`Results contain ${n.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},n=null,o=null,a=406,h="Not Acceptable"):n=1===n.length?n[0]:null)}else{const e=await t.text();try{s=JSON.parse(e),Array.isArray(s)&&404===t.status&&(n=[],s=null,a=200,h="OK")}catch(l){404===t.status&&""===e?(a=204,h="No Content"):s={message:e}}if(s&&this.isMaybeSingle&&(null===(r=null==s?void 0:s.details)||void 0===r?void 0:r.includes("0 rows"))&&(s=null,a=200,h="OK"),s&&this.shouldThrowOnError)throw new ht.default(s)}return{error:s,data:n,count:o,status:a,statusText:h}});return this.shouldThrowOnError||(i=i.catch(t=>{var e,i,r;return{error:{message:`${null!==(e=null==t?void 0:t.name)&&void 0!==e?e:"FetchError"}: ${null==t?void 0:t.message}`,details:`${null!==(i=null==t?void 0:t.stack)&&void 0!==i?i:""}`,hint:"",code:`${null!==(r=null==t?void 0:t.code)&&void 0!==r?r:""}`},data:null,count:null,status:0,statusText:""}})),i.then(t,e)}returns(){return this}overrideTypes(){return this}};var lt=U&&U.h||function(t){return t&&t.o?t:{default:t}};Object.defineProperty(V,"o",{value:!0});const ct=lt(K);let ut=class extends ct.default{select(t){let e=!1;const i=(null!=t?t:"*").split("").map(t=>/\s/.test(t)&&!e?"":('"'===t&&(e=!e),t)).join("");return this.url.searchParams.set("select",i),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(t,{ascending:e=!0,nullsFirst:i,foreignTable:r,referencedTable:s=r}={}){const n=s?`${s}.order`:"order",o=this.url.searchParams.get(n);return this.url.searchParams.set(n,`${o?`${o},`:""}${t}.${e?"asc":"desc"}${void 0===i?"":i?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:i=e}={}){const r=void 0===i?"limit":`${i}.limit`;return this.url.searchParams.set(r,`${t}`),this}range(t,e,{foreignTable:i,referencedTable:r=i}={}){const s=void 0===r?"offset":`${r}.offset`,n=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${t}`),this.url.searchParams.set(n,""+(e-t+1)),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:t=!1,verbose:e=!1,settings:i=!1,buffers:r=!1,wal:s=!1,format:n="text"}={}){var o;const a=[t?"analyze":null,e?"verbose":null,i?"settings":null,r?"buffers":null,s?"wal":null].filter(Boolean).join("|"),h=null!==(o=this.headers.Accept)&&void 0!==o?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${n}; for="${h}"; options=${a};`,this}rollback(){var t;return(null!==(t=this.headers.Prefer)&&void 0!==t?t:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};V.default=ut;var dt=U&&U.h||function(t){return t&&t.o?t:{default:t}};Object.defineProperty(H,"o",{value:!0});const ft=dt(V);let wt=class extends ft.default{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}in(t,e){const i=Array.from(new Set(e)).map(t=>"string"==typeof t&&new RegExp("[,()]").test(t)?`"${t}"`:`${t}`).join(",");return this.url.searchParams.append(t,`in.(${i})`),this}contains(t,e){return"string"==typeof e?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return"string"==typeof e?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return"string"==typeof e?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:i,type:r}={}){let s="";"plain"===r?s="pl":"phrase"===r?s="ph":"websearch"===r&&(s="w");const n=void 0===i?"":`(${i})`;return this.url.searchParams.append(t,`${s}fts${n}.${e}`),this}match(t){return Object.entries(t).forEach(([t,e])=>{this.url.searchParams.append(t,`eq.${e}`)}),this}not(t,e,i){return this.url.searchParams.append(t,`not.${e}.${i}`),this}or(t,{foreignTable:e,referencedTable:i=e}={}){const r=i?`${i}.or`:"or";return this.url.searchParams.append(r,`(${t})`),this}filter(t,e,i){return this.url.searchParams.append(t,`${e}.${i}`),this}};H.default=wt;var vt=U&&U.h||function(t){return t&&t.o?t:{default:t}};Object.defineProperty(z,"o",{value:!0});const yt=vt(H);z.default=class{constructor(t,{headers:e={},schema:i,fetch:r}){this.url=t,this.headers=e,this.schema=i,this.fetch=r}select(t,{head:e=!1,count:i}={}){const r=e?"HEAD":"GET";let s=!1;const n=(null!=t?t:"*").split("").map(t=>/\s/.test(t)&&!s?"":('"'===t&&(s=!s),t)).join("");return this.url.searchParams.set("select",n),i&&(this.headers.Prefer=`count=${i}`),new yt.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(t,{count:e,defaultToNull:i=!0}={}){const r=[];if(this.headers.Prefer&&r.push(this.headers.Prefer),e&&r.push(`count=${e}`),i||r.push("missing=default"),this.headers.Prefer=r.join(","),Array.isArray(t)){const e=t.reduce((t,e)=>t.concat(Object.keys(e)),[]);if(e.length>0){const t=[...new Set(e)].map(t=>`"${t}"`);this.url.searchParams.set("columns",t.join(","))}}return new yt.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}upsert(t,{onConflict:e,ignoreDuplicates:i=!1,count:r,defaultToNull:s=!0}={}){const n=[`resolution=${i?"ignore":"merge"}-duplicates`];if(void 0!==e&&this.url.searchParams.set("on_conflict",e),this.headers.Prefer&&n.push(this.headers.Prefer),r&&n.push(`count=${r}`),s||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(t)){const e=t.reduce((t,e)=>t.concat(Object.keys(e)),[]);if(e.length>0){const t=[...new Set(e)].map(t=>`"${t}"`);this.url.searchParams.set("columns",t.join(","))}}return new yt.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}update(t,{count:e}={}){const i=[];return this.headers.Prefer&&i.push(this.headers.Prefer),e&&i.push(`count=${e}`),this.headers.Prefer=i.join(","),new yt.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}delete({count:t}={}){const e=[];return t&&e.push(`count=${t}`),this.headers.Prefer&&e.unshift(this.headers.Prefer),this.headers.Prefer=e.join(","),new yt.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};var pt={},bt={};Object.defineProperty(bt,"o",{value:!0}),bt.version=void 0,bt.version="0.0.0-automated",Object.defineProperty(pt,"o",{value:!0}),pt.DEFAULT_HEADERS=void 0;const gt=bt;pt.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${gt.version}`};var mt=U&&U.h||function(t){return t&&t.o?t:{default:t}};Object.defineProperty(W,"o",{value:!0});const _t=mt(z),$t=mt(H),jt=pt;W.default=class t{constructor(t,{headers:e={},schema:i,fetch:r}={}){this.url=t,this.headers=Object.assign(Object.assign({},jt.DEFAULT_HEADERS),e),this.schemaName=i,this.fetch=r}from(t){const e=new URL(`${this.url}/${t}`);return new _t.default(e,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new t(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(t,e={},{head:i=!1,get:r=!1,count:s}={}){let n;const o=new URL(`${this.url}/rpc/${t}`);let a;i||r?(n=i?"HEAD":"GET",Object.entries(e).filter(([t,e])=>void 0!==e).map(([t,e])=>[t,Array.isArray(e)?`{${e.join(",")}}`:`${e}`]).forEach(([t,e])=>{o.searchParams.append(t,e)})):(n="POST",a=e);const h=Object.assign({},this.headers);return s&&(h.Prefer=`count=${s}`),new $t.default({method:n,url:o,headers:h,schema:this.schemaName,body:a,fetch:this.fetch,allowEmpty:!1})}};var Et=U&&U.h||function(t){return t&&t.o?t:{default:t}};Object.defineProperty(q,"o",{value:!0}),q.PostgrestError=q.PostgrestBuilder=q.PostgrestTransformBuilder=q.PostgrestFilterBuilder=q.PostgrestQueryBuilder=q.PostgrestClient=void 0;const kt=Et(W);q.PostgrestClient=kt.default;const Ot=Et(z);q.PostgrestQueryBuilder=Ot.default;const St=Et(H);q.PostgrestFilterBuilder=St.default;const Tt=Et(V);q.PostgrestTransformBuilder=Tt.default;const At=Et(K);q.PostgrestBuilder=At.default;const xt=Et(st);q.PostgrestError=xt.default;var It=q.default={PostgrestClient:kt.default,PostgrestQueryBuilder:Ot.default,PostgrestFilterBuilder:St.default,PostgrestTransformBuilder:Tt.default,PostgrestBuilder:At.default,PostgrestError:xt.default};const{PostgrestClient:Pt,PostgrestQueryBuilder:Rt,PostgrestFilterBuilder:Ut,PostgrestTransformBuilder:Nt,PostgrestBuilder:Ct,PostgrestError:Dt}=It,Lt=function(){if("undefined"!=typeof WebSocket)return WebSocket;if(void 0!==global.WebSocket)return global.WebSocket;if(void 0!==window.WebSocket)return window.WebSocket;if(void 0!==self.WebSocket)return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}();var Ft,Bt,Mt,Gt,Jt,qt;!function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"}(Ft||(Ft={})),function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"}(Bt||(Bt={})),function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"}(Mt||(Mt={})),function(t){t.websocket="websocket"}(Gt||(Gt={})),function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"}(Jt||(Jt={}));class Wt{constructor(){this.HEADER_LENGTH=1}decode(t,e){return t.constructor===ArrayBuffer?e(this.l(t)):e("string"==typeof t?JSON.parse(t):{})}l(t){const e=new DataView(t),i=new TextDecoder;return this.u(t,e,i)}u(t,e,i){const r=e.getUint8(1),s=e.getUint8(2);let n=this.HEADER_LENGTH+2;const o=i.decode(t.slice(n,n+r));n+=r;const a=i.decode(t.slice(n,n+s));return n+=s,{ref:null,topic:o,event:a,payload:JSON.parse(i.decode(t.slice(n,t.byteLength)))}}}class zt{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}!function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"}(qt||(qt={}));const Ht=(t,e,i={})=>{var r;const s=null!==(r=i.skipTypes)&&void 0!==r?r:[];return Object.keys(e).reduce((i,r)=>(i[r]=Vt(r,t,e,s),i),{})},Vt=(t,e,i,r)=>{const s=e.find(e=>e.name===t),n=null==s?void 0:s.type,o=i[t];return n&&!r.includes(n)?Kt(n,o):Yt(o)},Kt=(t,e)=>{if("_"===t.charAt(0)){const i=t.slice(1,t.length);return te(e,i)}switch(t){case qt.bool:return Xt(e);case qt.float4:case qt.float8:case qt.int2:case qt.int4:case qt.int8:case qt.numeric:case qt.oid:return Qt(e);case qt.json:case qt.jsonb:return Zt(e);case qt.timestamp:return ee(e);case qt.abstime:case qt.date:case qt.daterange:case qt.int4range:case qt.int8range:case qt.money:case qt.reltime:case qt.text:case qt.time:case qt.timestamptz:case qt.timetz:case qt.tsrange:case qt.tstzrange:default:return Yt(e)}},Yt=t=>t,Xt=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},Qt=t=>{if("string"==typeof t){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},Zt=t=>{if("string"==typeof t)try{return JSON.parse(t)}catch(e){return t}return t},te=(t,e)=>{if("string"!=typeof t)return t;const i=t.length-1,r=t[i];if("{"===t[0]&&"}"===r){let r;const n=t.slice(1,i);try{r=JSON.parse("["+n+"]")}catch(s){r=n?n.split(","):[]}return r.map(t=>Kt(e,t))}return t},ee=t=>"string"==typeof t?t.replace(" ","T"):t,ie=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class re{constructor(t,e,i={},r=1e4){this.channel=t,this.event=e,this.payload=i,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this.v(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this.p("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel.m()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var i;return this.p(t)&&e(null===(i=this.receivedResp)||void 0===i?void 0:i.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._(),this.refEvent=this.channel.$(this.ref),this.channel.j(this.refEvent,{},t=>{this.v(),this.k(),this.receivedResp=t,this.O(t)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(t,e){this.refEvent&&this.channel.S(this.refEvent,{status:t,response:e})}destroy(){this.v(),this.k()}v(){this.refEvent&&this.channel.T(this.refEvent,{})}k(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}O({status:t,response:e}){this.recHooks.filter(e=>e.status===t).forEach(t=>t.callback(e))}p(t){return this.receivedResp&&this.receivedResp.status===t}}var se,ne,oe,ae;!function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"}(se||(se={}));class he{constructor(t,e){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const i=(null==e?void 0:e.events)||{state:"presence_state",diff:"presence_diff"};this.channel.j(i.state,{},t=>{const{onJoin:e,onLeave:i,onSync:r}=this.caller;this.joinRef=this.channel.m(),this.state=he.syncState(this.state,t,e,i),this.pendingDiffs.forEach(t=>{this.state=he.syncDiff(this.state,t,e,i)}),this.pendingDiffs=[],r()}),this.channel.j(i.diff,{},t=>{const{onJoin:e,onLeave:i,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(t):(this.state=he.syncDiff(this.state,t,e,i),r())}),this.onJoin((t,e,i)=>{this.channel.S("presence",{event:"join",key:t,currentPresences:e,newPresences:i})}),this.onLeave((t,e,i)=>{this.channel.S("presence",{event:"leave",key:t,currentPresences:e,leftPresences:i})}),this.onSync(()=>{this.channel.S("presence",{event:"sync"})})}static syncState(t,e,i,r){const s=this.cloneDeep(t),n=this.transformState(e),o={},a={};return this.map(s,(t,e)=>{n[t]||(a[t]=e)}),this.map(n,(t,e)=>{const i=s[t];if(i){const r=e.map(t=>t.presence_ref),s=i.map(t=>t.presence_ref),n=e.filter(t=>s.indexOf(t.presence_ref)<0),h=i.filter(t=>r.indexOf(t.presence_ref)<0);n.length>0&&(o[t]=n),h.length>0&&(a[t]=h)}else o[t]=e}),this.syncDiff(s,{joins:o,leaves:a},i,r)}static syncDiff(t,e,i,r){const{joins:s,leaves:n}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return i||(i=()=>{}),r||(r=()=>{}),this.map(s,(e,r)=>{var s;const n=null!==(s=t[e])&&void 0!==s?s:[];if(t[e]=this.cloneDeep(r),n.length>0){const i=t[e].map(t=>t.presence_ref),r=n.filter(t=>i.indexOf(t.presence_ref)<0);t[e].unshift(...r)}i(e,n,r)}),this.map(n,(e,i)=>{let s=t[e];if(!s)return;const n=i.map(t=>t.presence_ref);s=s.filter(t=>n.indexOf(t.presence_ref)<0),t[e]=s,r(e,s,i),0===s.length&&delete t[e]}),t}static map(t,e){return Object.getOwnPropertyNames(t).map(i=>e(i,t[i]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((e,i)=>{const r=t[i];return e[i]="metas"in r?r.metas.map(t=>(t.presence_ref=t.phx_ref,delete t.phx_ref,delete t.phx_ref_prev,t)):r,e},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel.m()}}!function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"}(ne||(ne={})),function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"}(oe||(oe={})),function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"}(ae||(ae={}));class le{constructor(t,e={config:{}},i){this.topic=t,this.params=e,this.socket=i,this.bindings={},this.state=Bt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new re(this,Mt.join,this.params,this.timeout),this.rejoinTimer=new zt(()=>this.A(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Bt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(t=>t.send()),this.pushBuffer=[]}),this.I(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this.m()}`),this.state=Bt.closed,this.socket.P(this)}),this.R(t=>{this.U()||this.N()||(this.socket.log("channel",`error ${this.topic}`,t),this.state=Bt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this.C()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Bt.errored,this.rejoinTimer.scheduleTimeout())}),this.j(Mt.reply,{},(t,e)=>{this.S(this.$(e),t)}),this.presence=new he(this),this.broadcastEndpointURL=ie(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(t,e=this.timeout){var i,r;if(this.socket.isConnected()||this.socket.connect(),this.state==Bt.closed){const{config:{broadcast:s,presence:n,private:o}}=this.params;this.R(e=>null==t?void 0:t(ae.CHANNEL_ERROR,e)),this.I(()=>null==t?void 0:t(ae.CLOSED));const a={},h={broadcast:s,presence:n,postgres_changes:null!==(r=null===(i=this.bindings.postgres_changes)||void 0===i?void 0:i.map(t=>t.filter))&&void 0!==r?r:[],private:o};this.socket.accessTokenValue&&(a.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:h},a)),this.joinedOnce=!0,this.D(e),this.joinPush.receive("ok",async({postgres_changes:e})=>{var i;if(this.socket.setAuth(),void 0!==e){const r=this.bindings.postgres_changes,s=null!==(i=null==r?void 0:r.length)&&void 0!==i?i:0,n=[];for(let i=0;i<s;i++){const s=r[i],{filter:{event:o,schema:a,table:h,filter:l}}=s,c=e&&e[i];if(!c||c.event!==o||c.schema!==a||c.table!==h||c.filter!==l)return this.unsubscribe(),this.state=Bt.errored,void(null==t||t(ae.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));n.push(Object.assign(Object.assign({},s),{id:c.id}))}return this.bindings.postgres_changes=n,void(t&&t(ae.SUBSCRIBED))}null==t||t(ae.SUBSCRIBED)}).receive("error",e=>{this.state=Bt.errored,null==t||t(ae.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(e).join(", ")||"error")))}).receive("timeout",()=>{null==t||t(ae.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,e={}){return await this.send({type:"presence",event:"track",payload:t},e.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,e,i){return this.j(t,e,i)}async send(t,e={}){var i,r;if(this.L()||"broadcast"!==t.type)return new Promise(i=>{var r,s,n;const o=this.F(t.type,t,e.timeout||this.timeout);"broadcast"!==t.type||(null===(n=null===(s=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===s?void 0:s.broadcast)||void 0===n?void 0:n.ack)||i("ok"),o.receive("ok",()=>i("ok")),o.receive("error",()=>i("error")),o.receive("timeout",()=>i("timed out"))});{const{event:n,payload:o}=t,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:o,private:this.private}]})};try{const t=await this.B(this.broadcastEndpointURL,a,null!==(i=e.timeout)&&void 0!==i?i:this.timeout);return await(null===(r=t.body)||void 0===r?void 0:r.cancel()),t.ok?"ok":"error"}catch(s){return"AbortError"===s.name?"timed out":"error"}}}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Bt.leaving;const e=()=>{this.socket.log("channel",`leave ${this.topic}`),this.S(Mt.close,"leave",this.m())};this.joinPush.destroy();let i=null;return new Promise(r=>{i=new re(this,Mt.leave,{},t),i.receive("ok",()=>{e(),r("ok")}).receive("timeout",()=>{e(),r("timed out")}).receive("error",()=>{r("error")}),i.send(),this.L()||i.trigger("ok",{})}).finally(()=>{null==i||i.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async B(t,e,i){const r=new AbortController,s=setTimeout(()=>r.abort(),i),n=await this.socket.fetch(t,Object.assign(Object.assign({},e),{signal:r.signal}));return clearTimeout(s),n}F(t,e,i=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new re(this,t,e,i);return this.L()?r.send():(r.startTimeout(),this.pushBuffer.push(r)),r}M(t,e,i){return e}G(t){return this.topic===t}m(){return this.joinPush.ref}S(t,e,i){var r,s;const n=t.toLocaleLowerCase(),{close:o,error:a,leave:h,join:l}=Mt;if(i&&[o,a,h,l].indexOf(n)>=0&&i!==this.m())return;let c=this.M(n,e,i);if(e&&!c)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(n)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter(t=>{var e,i,r;return"*"===(null===(e=t.filter)||void 0===e?void 0:e.event)||(null===(r=null===(i=t.filter)||void 0===i?void 0:i.event)||void 0===r?void 0:r.toLocaleLowerCase())===n}).map(t=>t.callback(c,i)):null===(s=this.bindings[n])||void 0===s||s.filter(t=>{var i,r,s,o,a,h;if(["broadcast","presence","postgres_changes"].includes(n)){if("id"in t){const n=t.id,o=null===(i=t.filter)||void 0===i?void 0:i.event;return n&&(null===(r=e.ids)||void 0===r?void 0:r.includes(n))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(s=e.data)||void 0===s?void 0:s.type.toLocaleLowerCase()))}{const i=null===(a=null===(o=null==t?void 0:t.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===i||i===(null===(h=null==e?void 0:e.event)||void 0===h?void 0:h.toLocaleLowerCase())}}return t.type.toLocaleLowerCase()===n}).map(t=>{if("object"==typeof c&&"ids"in c){const t=c.data,{schema:e,table:i,commit_timestamp:r,type:s,errors:n}=t,o={schema:e,table:i,commit_timestamp:r,eventType:s,new:{},old:{},errors:n};c=Object.assign(Object.assign({},o),this.J(t))}t.callback(c,i)})}N(){return this.state===Bt.closed}q(){return this.state===Bt.joined}C(){return this.state===Bt.joining}U(){return this.state===Bt.leaving}$(t){return`chan_reply_${t}`}j(t,e,i){const r=t.toLocaleLowerCase(),s={type:r,filter:e,callback:i};return this.bindings[r]?this.bindings[r].push(s):this.bindings[r]=[s],this}T(t,e){const i=t.toLocaleLowerCase();return this.bindings[i]=this.bindings[i].filter(t=>{var r;return!((null===(r=t.type)||void 0===r?void 0:r.toLocaleLowerCase())===i&&le.isEqual(t.filter,e))}),this}static isEqual(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(t[i]!==e[i])return!1;return!0}A(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.D()}I(t){this.j(Mt.close,{},t)}R(t){this.j(Mt.error,{},e=>t(e))}L(){return this.socket.isConnected()&&this.q()}D(t=this.timeout){this.U()||(this.socket.W(this.topic),this.state=Bt.joining,this.joinPush.resend(t))}J(t){const e={new:{},old:{}};return"INSERT"!==t.type&&"UPDATE"!==t.type||(e.new=Ht(t.columns,t.record)),"UPDATE"!==t.type&&"DELETE"!==t.type||(e.old=Ht(t.columns,t.old_record)),e}}const ce=()=>{};class ue{constructor(t,e){var i;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=ce,this.ref=0,this.logger=ce,this.conn=null,this.sendBuffer=[],this.serializer=new Wt,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this.H=t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>D(async()=>{const{default:t}=await Promise.resolve().then(()=>it);return{default:t}},void 0).then(({default:e})=>e(...t)):fetch),(...t)=>e(...t)},this.endPoint=`${t}/${Gt.websocket}`,this.httpEndpoint=ie(t),(null==e?void 0:e.transport)?this.transport=e.transport:this.transport=null,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.timeout)&&(this.timeout=e.timeout),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),(null==e?void 0:e.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=e.heartbeatIntervalMs);const r=null===(i=null==e?void 0:e.params)||void 0===i?void 0:i.apikey;if(r&&(this.accessTokenValue=r,this.apiKey=r),this.reconnectAfterMs=(null==e?void 0:e.reconnectAfterMs)?e.reconnectAfterMs:t=>[1e3,2e3,5e3,1e4][t-1]||1e4,this.encode=(null==e?void 0:e.encode)?e.encode:(t,e)=>e(JSON.stringify(t)),this.decode=(null==e?void 0:e.decode)?e.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new zt(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this.H(null==e?void 0:e.fetch),null==e?void 0:e.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(null==e?void 0:e.worker)||!1,this.workerUrl=null==e?void 0:e.workerUrl}this.accessToken=(null==e?void 0:e.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=Lt),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this.V(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(t,e){this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,null!=e?e:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(t=>t.teardown()))}getChannels(){return this.channels}async removeChannel(t){const e=await t.unsubscribe();return 0===this.channels.length&&this.disconnect(),e}async removeAllChannels(){const t=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,e,i){this.logger(t,e,i)}connectionState(){switch(this.conn&&this.conn.readyState){case Ft.connecting:return Jt.Connecting;case Ft.open:return Jt.Open;case Ft.closing:return Jt.Closing;default:return Jt.Closed}}isConnected(){return this.connectionState()===Jt.Open}channel(t,e={config:{}}){const i=`realtime:${t}`,r=this.getChannels().find(t=>t.topic===i);if(r)return r;{const i=new le(`realtime:${t}`,e,this);return this.channels.push(i),i}}push(t){const{topic:e,event:i,payload:r,ref:s}=t,n=()=>{this.encode(t,t=>{var e;null===(e=this.conn)||void 0===e||e.send(t)})};this.log("push",`${e} ${i} (${s})`,r),this.isConnected()?n():this.sendBuffer.push(n)}async setAuth(t=null){let e=t||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(t=>{const i={access_token:e,version:"realtime-js/2.11.15"};e&&t.updateJoinPayload(i),t.joinedOnce&&t.q()&&t.F(Mt.access_token,{access_token:e})}))}async sendHeartbeat(){var t;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),void(null===(t=this.conn)||void 0===t||t.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}else this.heartbeatCallback("disconnected")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}W(t){let e=this.channels.find(e=>e.topic===t&&(e.q()||e.C()));e&&(this.log("transport",`leaving duplicate topic "${t}"`),e.unsubscribe())}P(t){this.channels=this.channels.filter(e=>e.topic!==t.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this.K(),this.conn.onerror=t=>this.Y(t),this.conn.onmessage=t=>this.X(t),this.conn.onclose=t=>this.Z(t))}X(t){this.decode(t.data,t=>{let{topic:e,event:i,payload:r,ref:s}=t;"phoenix"===e&&"phx_reply"===i&&this.heartbeatCallback("ok"==t.payload.status?"ok":"error"),s&&s===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${r.status||""} ${e} ${i} ${s&&"("+s+")"||""}`,r),Array.from(this.channels).filter(t=>t.G(e)).forEach(t=>t.S(i,r,s)),this.stateChangeCallbacks.message.forEach(e=>e(t))})}K(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this.tt():this.et(),this.stateChangeCallbacks.open.forEach(t=>t())}et(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}tt(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this.it(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{"keepAlive"===t.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}Z(t){this.log("transport","close",t),this.rt(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(e=>e(t))}Y(t){this.log("transport",`${t}`),this.rt(),this.stateChangeCallbacks.error.forEach(e=>e(t))}rt(){this.channels.forEach(t=>t.S(Mt.error))}V(t,e){if(0===Object.keys(e).length)return t;const i=t.match(/\?/)?"&":"?";return`${t}${i}${new URLSearchParams(e)}`}it(t){let e;if(t)e=t;else{const t=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});e=URL.createObjectURL(t)}return e}}class de extends Error{constructor(t){super(t),this.t=!0,this.name="StorageError"}}class fe extends de{constructor(t,e){super(t),this.name="StorageApiError",this.status=e}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class we extends de{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}}var ve=function(t,e,i,r){return new(i||(i=Promise))(function(s,n){function o(t){try{h(r.next(t))}catch(e){n(e)}}function a(t){try{h(r.throw(t))}catch(e){n(e)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,a)}h((r=r.apply(t,e||[])).next())})};const ye=t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>D(async()=>{const{default:t}=await Promise.resolve().then(()=>it);return{default:t}},void 0).then(({default:e})=>e(...t)):fetch),(...t)=>e(...t)},pe=t=>{if(Array.isArray(t))return t.map(t=>pe(t));if("function"==typeof t||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([t,i])=>{const r=t.replace(/([-_][a-z])/gi,t=>t.toUpperCase().replace(/[-_]/g,""));e[r]=pe(i)}),e};var be=function(t,e,i,r){return new(i||(i=Promise))(function(s,n){function o(t){try{h(r.next(t))}catch(e){n(e)}}function a(t){try{h(r.throw(t))}catch(e){n(e)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,a)}h((r=r.apply(t,e||[])).next())})};const ge=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t);var me=function(t,e,i,r){return new(i||(i=Promise))(function(s,n){function o(t){try{h(r.next(t))}catch(e){n(e)}}function a(t){try{h(r.throw(t))}catch(e){n(e)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,a)}h((r=r.apply(t,e||[])).next())})};const _e={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},$e={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class je{constructor(t,e={},i,r){this.url=t,this.headers=e,this.bucketId=i,this.fetch=ye(r)}uploadOrUpdate(e,i,r,s){return me(this,void 0,void 0,function*(){try{let t;const n=Object.assign(Object.assign({},$e),s);let o=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(n.upsert)});const a=n.metadata;"undefined"!=typeof Blob&&r instanceof Blob?(t=new FormData,t.append("cacheControl",n.cacheControl),a&&t.append("metadata",this.encodeMetadata(a)),t.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(t=r,t.append("cacheControl",n.cacheControl),a&&t.append("metadata",this.encodeMetadata(a))):(t=r,o["cache-control"]=`max-age=${n.cacheControl}`,o["content-type"]=n.contentType,a&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),(null==s?void 0:s.headers)&&(o=Object.assign(Object.assign({},o),s.headers));const h=this.st(i),l=this.nt(h),c=yield this.fetch(`${this.url}/object/${l}`,Object.assign({method:e,body:t,headers:o},(null==n?void 0:n.duplex)?{duplex:n.duplex}:{})),u=yield c.json();return c.ok?{data:{path:h,id:u.Id,fullPath:u.Key},error:null}:{data:null,error:u}}catch(n){if(t(n))return{data:null,error:n};throw n}})}upload(t,e,i){return me(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,e,i)})}uploadToSignedUrl(e,i,r,s){return me(this,void 0,void 0,function*(){const n=this.st(e),o=this.nt(n),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",i);try{let t;const e=Object.assign({upsert:$e.upsert},s),i=Object.assign(Object.assign({},this.headers),{"x-upsert":String(e.upsert)});"undefined"!=typeof Blob&&r instanceof Blob?(t=new FormData,t.append("cacheControl",e.cacheControl),t.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(t=r,t.append("cacheControl",e.cacheControl)):(t=r,i["cache-control"]=`max-age=${e.cacheControl}`,i["content-type"]=e.contentType);const o=yield this.fetch(a.toString(),{method:"PUT",body:t,headers:i}),h=yield o.json();return o.ok?{data:{path:n,fullPath:h.Key},error:null}:{data:null,error:h}}catch(h){if(t(h))return{data:null,error:h};throw h}})}createSignedUploadUrl(e,i){return me(this,void 0,void 0,function*(){try{let t=this.nt(e);const s=Object.assign({},this.headers);(null==i?void 0:i.upsert)&&(s["x-upsert"]="true");const n=yield r(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:s}),o=new URL(this.url+n.url),a=o.searchParams.get("token");if(!a)throw new de("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(s){if(t(s))return{data:null,error:s};throw s}})}update(t,e,i){return me(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,e,i)})}move(e,i,s){return me(this,void 0,void 0,function*(){try{return{data:yield r(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:i,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(t(n))return{data:null,error:n};throw n}})}copy(e,i,s){return me(this,void 0,void 0,function*(){try{return{data:{path:(yield r(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:i,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(t(n))return{data:null,error:n};throw n}})}createSignedUrl(e,i,s){return me(this,void 0,void 0,function*(){try{let t=this.nt(e),n=yield r(this.fetch,`${this.url}/object/sign/${t}`,Object.assign({expiresIn:i},(null==s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers});const o=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${o}`)},{data:n,error:null}}catch(n){if(t(n))return{data:null,error:n};throw n}})}createSignedUrls(e,i,s){return me(this,void 0,void 0,function*(){try{const t=yield r(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:i,paths:e},{headers:this.headers}),n=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:t.map(t=>Object.assign(Object.assign({},t),{signedUrl:t.signedURL?encodeURI(`${this.url}${t.signedURL}${n}`):null})),error:null}}catch(n){if(t(n))return{data:null,error:n};throw n}})}download(e,r){return me(this,void 0,void 0,function*(){const s=void 0!==(null==r?void 0:r.transform)?"render/image/authenticated":"object",n=this.transformOptsToQueryString((null==r?void 0:r.transform)||{}),o=n?`?${n}`:"";try{const t=this.nt(e),r=yield i(this.fetch,`${this.url}/${s}/${t}${o}`,{headers:this.headers,noResolveJson:!0});return{data:yield r.blob(),error:null}}catch(a){if(t(a))return{data:null,error:a};throw a}})}info(e){return me(this,void 0,void 0,function*(){const r=this.nt(e);try{const t=yield i(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:pe(t),error:null}}catch(s){if(t(s))return{data:null,error:s};throw s}})}exists(i){return me(this,void 0,void 0,function*(){const r=this.nt(i);try{return yield function(t,i,r){return be(this,void 0,void 0,function*(){return e(t,"HEAD",i,Object.assign(Object.assign({},r),{noResolveJson:!0}),void 0)})}(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(t(s)&&s instanceof we){const t=s.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:s}}throw s}})}getPublicUrl(t,e){const i=this.nt(t),r=[],s=(null==e?void 0:e.download)?`download=${!0===e.download?"":e.download}`:"";""!==s&&r.push(s);const n=void 0!==(null==e?void 0:e.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==e?void 0:e.transform)||{});""!==o&&r.push(o);let a=r.join("&");return""!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${n}/public/${i}${a}`)}}}remove(e){return me(this,void 0,void 0,function*(){try{return{data:yield s(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(i){if(t(i))return{data:null,error:i};throw i}})}list(e,i,s){return me(this,void 0,void 0,function*(){try{const t=Object.assign(Object.assign(Object.assign({},_e),i),{prefix:e||""});return{data:yield r(this.fetch,`${this.url}/object/list/${this.bucketId}`,t,{headers:this.headers},s),error:null}}catch(n){if(t(n))return{data:null,error:n};throw n}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return"undefined"!=typeof Buffer?Buffer.from(t).toString("base64"):btoa(t)}nt(t){return`${this.bucketId}/${t}`}st(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}}const Ee={"X-Client-Info":"storage-js/2.7.1"};var ke=function(t,e,i,r){return new(i||(i=Promise))(function(s,n){function o(t){try{h(r.next(t))}catch(e){n(e)}}function a(t){try{h(r.throw(t))}catch(e){n(e)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,a)}h((r=r.apply(t,e||[])).next())})};class Oe{constructor(t,e={},i){this.url=t,this.headers=Object.assign(Object.assign({},Ee),e),this.fetch=ye(i)}listBuckets(){return ke(this,void 0,void 0,function*(){try{return{data:yield i(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(t(e))return{data:null,error:e};throw e}})}getBucket(e){return ke(this,void 0,void 0,function*(){try{return{data:yield i(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(r){if(t(r))return{data:null,error:r};throw r}})}createBucket(e,i={public:!1}){return ke(this,void 0,void 0,function*(){try{return{data:yield r(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(t(s))return{data:null,error:s};throw s}})}updateBucket(i,r){return ke(this,void 0,void 0,function*(){try{const t=yield function(t,i,r,s){return be(this,void 0,void 0,function*(){return e(t,"PUT",i,s,void 0,r)})}(this.fetch,`${this.url}/bucket/${i}`,{id:i,name:i,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers});return{data:t,error:null}}catch(s){if(t(s))return{data:null,error:s};throw s}})}emptyBucket(e){return ke(this,void 0,void 0,function*(){try{return{data:yield r(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(i){if(t(i))return{data:null,error:i};throw i}})}deleteBucket(e){return ke(this,void 0,void 0,function*(){try{return{data:yield s(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(i){if(t(i))return{data:null,error:i};throw i}})}}class Se extends Oe{constructor(t,e={},i){super(t,e,i)}from(t){return new je(this.url,this.headers,t,this.fetch)}}let Te="";Te="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const Ae={headers:{"X-Client-Info":`supabase-js-${Te}/2.52.1`}},xe={schema:"public"},Ie={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Pe={},Re=t=>{let e;return e=t||("undefined"==typeof fetch?Q:fetch),(...t)=>e(...t)},Ue="2.71.1",Ne=3e4,Ce={"X-Client-Info":`gotrue-js/${Ue}`},De="X-Supabase-Api-Version",Le={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},Fe=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class Be extends Error{constructor(t,e,i){super(t),this.i=!0,this.name="AuthError",this.status=e,this.code=i}}class Me extends Be{constructor(t,e,i){super(t,e,i),this.name="AuthApiError",this.status=e,this.code=i}}class Ge extends Be{constructor(t,e){super(t),this.name="AuthUnknownError",this.originalError=e}}class Je extends Be{constructor(t,e,i,r){super(t,i,r),this.name=e,this.status=i}}class qe extends Je{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class We extends Je{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ze extends Je{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class He extends Je{constructor(t,e=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ve extends Je{constructor(t,e=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ke extends Je{constructor(t,e){super(t,"AuthRetryableFetchError",e,void 0)}}class Ye extends Je{constructor(t,e,i){super(t,"AuthWeakPasswordError",e,"weak_password"),this.reasons=i}}class Xe extends Je{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Qe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ze=" \t\n\r=".split(""),ti=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Ze.length;e+=1)t[Ze[e].charCodeAt(0)]=-2;for(let e=0;e<Qe.length;e+=1)t[Qe[e].charCodeAt(0)]=e;return t})(),ei=()=>"undefined"!=typeof window&&"undefined"!=typeof document,ii={tested:!1,writable:!1},ri=()=>{if(!ei())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(ii.tested)return ii.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),ii.tested=!0,ii.writable=!0}catch(e){ii.tested=!0,ii.writable=!1}return ii.writable},si=t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>D(async()=>{const{default:t}=await Promise.resolve().then(()=>it);return{default:t}},void 0).then(({default:e})=>e(...t)):fetch),(...t)=>e(...t)},ni=async(t,e,i)=>{await t.setItem(e,JSON.stringify(i))},oi=async(t,e)=>{const i=await t.getItem(e);if(!i)return null;try{return JSON.parse(i)}catch(r){return i}},ai=async(t,e)=>{await t.removeItem(e)};class hi{constructor(){this.promise=new hi.promiseConstructor((t,e)=>{this.resolve=t,this.reject=e})}}hi.promiseConstructor=Promise;const li=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,ci=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;var ui=function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(i[r[s]]=t[r[s]])}return i};const di=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),fi=[502,503,504],wi=["global","local","others"];class vi{constructor({url:t="",headers:e={},fetch:i}){this.url=t,this.headers=e,this.fetch=si(i),this.mfa={listFactors:this.ot.bind(this),deleteFactor:this.ht.bind(this)}}async signOut(t,e=wi[0]){if(wi.indexOf(e)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${wi.join(", ")}`);try{return await j(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(i){if(n(i))return{data:null,error:i};throw i}}async inviteUserByEmail(t,e={}){try{return await j(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:O})}catch(i){if(n(i))return{data:{user:null},error:i};throw i}}async generateLink(t){try{const{options:e}=t,i=function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(i[r[s]]=t[r[s]])}return i}(t,["options"]),r=Object.assign(Object.assign({},i),e);return"newEmail"in i&&(r.new_email=null==i?void 0:i.newEmail,delete r.newEmail),await j(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:T,redirectTo:null==e?void 0:e.redirectTo})}catch(e){if(n(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(t){try{return await j(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:O})}catch(e){if(n(e))return{data:{user:null},error:e};throw e}}async listUsers(t){var e,i,r,s,o,a,h;try{const n={nextPage:null,lastPage:0,total:0},l=await j(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(i=null===(e=null==t?void 0:t.page)||void 0===e?void 0:e.toString())&&void 0!==i?i:"",per_page:null!==(s=null===(r=null==t?void 0:t.perPage)||void 0===r?void 0:r.toString())&&void 0!==s?s:""},xform:A});if(l.error)throw l.error;const c=await l.json(),u=null!==(o=l.headers.get("x-total-count"))&&void 0!==o?o:0,d=null!==(h=null===(a=l.headers.get("link"))||void 0===a?void 0:a.split(","))&&void 0!==h?h:[];return d.length>0&&(d.forEach(t=>{const e=parseInt(t.split(";")[0].split("=")[1].substring(0,1)),i=JSON.parse(t.split(";")[1].split("=")[1]);n[`${i}Page`]=e}),n.total=parseInt(u)),{data:Object.assign(Object.assign({},c),n),error:null}}catch(l){if(n(l))return{data:{users:[]},error:l};throw l}}async getUserById(t){g(t);try{return await j(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:O})}catch(e){if(n(e))return{data:{user:null},error:e};throw e}}async updateUserById(t,e){g(t);try{return await j(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:e,headers:this.headers,xform:O})}catch(i){if(n(i))return{data:{user:null},error:i};throw i}}async deleteUser(t,e=!1){g(t);try{return await j(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:e},xform:O})}catch(i){if(n(i))return{data:{user:null},error:i};throw i}}async ot(t){g(t.userId);try{const{data:e,error:i}=await j(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:t=>({data:{factors:t},error:null})});return{data:e,error:i}}catch(e){if(n(e))return{data:null,error:e};throw e}}async ht(t){g(t.userId),g(t.id);try{return{data:await j(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(e){if(n(e))return{data:null,error:e};throw e}}}const yi={debug:!!(globalThis&&ri()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"))};class pi extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class bi extends pi{}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"ct",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.ct}catch(t){"undefined"!=typeof self&&(self.globalThis=self)}}();const gi={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ce,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},mi={};class _i{constructor(t){var e,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=_i.nextInstanceID,_i.nextInstanceID+=1,this.instanceID>0&&ei();const r=Object.assign(Object.assign({},gi),t);if(this.logDebugMessages=!!r.debug,"function"==typeof r.debug&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new vi({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=si(r.fetch),this.lock=r.lock||P,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:ei()&&(null===(e=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===e?void 0:e.locks)?this.lock=I:this.lock=P,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this.ut.bind(this),enroll:this.dt.bind(this),unenroll:this.ft.bind(this),challenge:this.wt.bind(this),listFactors:this.ot.bind(this),challengeAndVerify:this.vt.bind(this),getAuthenticatorAssuranceLevel:this.yt.bind(this)},this.persistSession?(r.storage?this.storage=r.storage:ri()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=x(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=x(this.memoryStorage)),ei()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){}null===(i=this.broadcastChannel)||void 0===i||i.addEventListener("message",async t=>{this.bt("received broadcast notification from other tab or client",t),await this._t(t.data.event,t.data.session,!1)})}this.initialize()}get jwks(){var t,e;return null!==(e=null===(t=mi[this.storageKey])||void 0===t?void 0:t.jwks)&&void 0!==e?e:{keys:[]}}set jwks(t){mi[this.storageKey]=Object.assign(Object.assign({},mi[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,e;return null!==(e=null===(t=mi[this.storageKey])||void 0===t?void 0:t.cachedAt)&&void 0!==e?e:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){mi[this.storageKey]=Object.assign(Object.assign({},mi[this.storageKey]),{cachedAt:t})}bt(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Ue}) ${(new Date).toISOString()}`,...t),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this.$t(-1,async()=>await this.jt()))()),await this.initializePromise}async jt(){var t;try{const e=function(t){const e={},i=new URL(t);if(i.hash&&"#"===i.hash[0])try{new URLSearchParams(i.hash.substring(1)).forEach((t,i)=>{e[i]=t})}catch(r){}return i.searchParams.forEach((t,i)=>{e[i]=t}),e}(window.location.href);let i="none";if(this.Et(e)?i="implicit":await this.kt(e)&&(i="pkce"),ei()&&this.detectSessionInUrl&&"none"!==i){const{data:r,error:s}=await this.Ot(e,i);if(s){if(this.bt("#_initialize()","error detecting session from URL",s),h(s)){const e=null===(t=s.details)||void 0===t?void 0:t.code;if("identity_already_exists"===e||"identity_not_found"===e||"single_identity_not_deletable"===e)return{error:s}}return await this.St(),{error:s}}const{session:n,redirectType:o}=r;return this.bt("#_initialize()","detected session in URL",n,"redirect type",o),await this.Tt(n),setTimeout(async()=>{"recovery"===o?await this._t("PASSWORD_RECOVERY",n):await this._t("SIGNED_IN",n)},0),{error:null}}return await this.At(),{error:null}}catch(e){return n(e)?{error:e}:{error:new Ge("Unexpected error during initialization",e)}}finally{await this.xt(),this.bt("#_initialize()","end")}}async signInAnonymously(t){var e,i,r;try{const s=await j(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(i=null===(e=null==t?void 0:t.options)||void 0===e?void 0:e.data)&&void 0!==i?i:{},gotrue_meta_security:{captcha_token:null===(r=null==t?void 0:t.options)||void 0===r?void 0:r.captchaToken}},xform:E}),{data:n,error:o}=s;if(o||!n)return{data:{user:null,session:null},error:o};const a=n.session,h=n.user;return n.session&&(await this.Tt(n.session),await this._t("SIGNED_IN",a)),{data:{user:h,session:a},error:null}}catch(s){if(n(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(t){var e,i,r;try{let s;if("email"in t){const{email:i,password:r,options:n}=t;let o=null,a=null;"pkce"===this.flowType&&([o,a]=await b(this.storage,this.storageKey)),s=await j(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==n?void 0:n.emailRedirectTo,body:{email:i,password:r,data:null!==(e=null==n?void 0:n.data)&&void 0!==e?e:{},gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:o,code_challenge_method:a},xform:E})}else{if(!("phone"in t))throw new ze("You must provide either an email or phone number and a password");{const{phone:e,password:n,options:o}=t;s=await j(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:e,password:n,data:null!==(i=null==o?void 0:o.data)&&void 0!==i?i:{},channel:null!==(r=null==o?void 0:o.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:E})}}const{data:n,error:o}=s;if(o||!n)return{data:{user:null,session:null},error:o};const a=n.session,h=n.user;return n.session&&(await this.Tt(n.session),await this._t("SIGNED_IN",a)),{data:{user:h,session:a},error:null}}catch(s){if(n(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(t){try{let e;if("email"in t){const{email:i,password:r,options:s}=t;e=await j(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:r,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}},xform:k})}else{if(!("phone"in t))throw new ze("You must provide either an email or phone number and a password");{const{phone:i,password:r,options:s}=t;e=await j(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:r,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}},xform:k})}}const{data:i,error:r}=e;return r?{data:{user:null,session:null},error:r}:i&&i.session&&i.user?(i.session&&(await this.Tt(i.session),await this._t("SIGNED_IN",i.session)),{data:Object.assign({user:i.user,session:i.session},i.weak_password?{weakPassword:i.weak_password}:null),error:r}):{data:{user:null,session:null},error:new We}}catch(e){if(n(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOAuth(t){var e,i,r,s;return await this.It(t.provider,{redirectTo:null===(e=t.options)||void 0===e?void 0:e.redirectTo,scopes:null===(i=t.options)||void 0===i?void 0:i.scopes,queryParams:null===(r=t.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(s=t.options)||void 0===s?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this.$t(-1,async()=>this.Pt(t))}async signInWithWeb3(t){const{chain:e}=t;if("solana"===e)return await this.signInWithSolana(t);throw new Error(`@supabase/auth-js: Unsupported chain "${e}"`)}async signInWithSolana(t){var e,i,r,s,o,a,h,l,c,u,d,f;let w,y;if("message"in t)w=t.message,y=t.signature;else{const{chain:n,wallet:d,statement:f,options:v}=t;let p;if(ei())if("object"==typeof d)p=d;else{const t=window;if(!("solana"in t)||"object"!=typeof t.solana||!("signIn"in t.solana&&"function"==typeof t.solana.signIn||"signMessage"in t.solana&&"function"==typeof t.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");p=t.solana}else{if("object"!=typeof d||!(null==v?void 0:v.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");p=d}const b=new URL(null!==(e=null==v?void 0:v.url)&&void 0!==e?e:window.location.href);if("signIn"in p&&p.signIn){const t=await p.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==v?void 0:v.signInWithSolana),{version:"1",domain:b.host,uri:b.href}),f?{statement:f}:null));let e;if(Array.isArray(t)&&t[0]&&"object"==typeof t[0])e=t[0];else{if(!(t&&"object"==typeof t&&"signedMessage"in t&&"signature"in t))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");e=t}if(!("signedMessage"in e&&"signature"in e&&("string"==typeof e.signedMessage||e.signedMessage instanceof Uint8Array)&&e.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");w="string"==typeof e.signedMessage?e.signedMessage:(new TextDecoder).decode(e.signedMessage),y=e.signature}else{if(!("signMessage"in p&&"function"==typeof p.signMessage&&"publicKey"in p&&"object"==typeof p&&p.publicKey&&"toBase58"in p.publicKey&&"function"==typeof p.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");w=[`${b.host} wants you to sign in with your Solana account:`,p.publicKey.toBase58(),...f?["",f,""]:[""],"Version: 1",`URI: ${b.href}`,`Issued At: ${null!==(r=null===(i=null==v?void 0:v.signInWithSolana)||void 0===i?void 0:i.issuedAt)&&void 0!==r?r:(new Date).toISOString()}`,...(null===(s=null==v?void 0:v.signInWithSolana)||void 0===s?void 0:s.notBefore)?[`Not Before: ${v.signInWithSolana.notBefore}`]:[],...(null===(o=null==v?void 0:v.signInWithSolana)||void 0===o?void 0:o.expirationTime)?[`Expiration Time: ${v.signInWithSolana.expirationTime}`]:[],...(null===(a=null==v?void 0:v.signInWithSolana)||void 0===a?void 0:a.chainId)?[`Chain ID: ${v.signInWithSolana.chainId}`]:[],...(null===(h=null==v?void 0:v.signInWithSolana)||void 0===h?void 0:h.nonce)?[`Nonce: ${v.signInWithSolana.nonce}`]:[],...(null===(l=null==v?void 0:v.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${v.signInWithSolana.requestId}`]:[],...(null===(u=null===(c=null==v?void 0:v.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===u?void 0:u.length)?["Resources",...v.signInWithSolana.resources.map(t=>`- ${t}`)]:[]].join("\n");const t=await p.signMessage((new TextEncoder).encode(w),"utf8");if(!(t&&t instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=t}}try{const{data:e,error:i}=await j(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:w,signature:v(y)},(null===(d=t.options)||void 0===d?void 0:d.captchaToken)?{gotrue_meta_security:{captcha_token:null===(f=t.options)||void 0===f?void 0:f.captchaToken}}:null),xform:E});if(i)throw i;return e&&e.session&&e.user?(e.session&&(await this.Tt(e.session),await this._t("SIGNED_IN",e.session)),{data:Object.assign({},e),error:i}):{data:{user:null,session:null},error:new We}}catch(p){if(n(p))return{data:{user:null,session:null},error:p};throw p}}async Pt(t){const e=await oi(this.storage,`${this.storageKey}-code-verifier`),[i,r]=(null!=e?e:"").split("/");try{const{data:e,error:s}=await j(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:i},xform:E});if(await ai(this.storage,`${this.storageKey}-code-verifier`),s)throw s;return e&&e.session&&e.user?(e.session&&(await this.Tt(e.session),await this._t("SIGNED_IN",e.session)),{data:Object.assign(Object.assign({},e),{redirectType:null!=r?r:null}),error:s}):{data:{user:null,session:null,redirectType:null},error:new We}}catch(s){if(n(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(t){try{const{options:e,provider:i,token:r,access_token:s,nonce:n}=t,o=await j(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:i,id_token:r,access_token:s,nonce:n,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}},xform:E}),{data:a,error:h}=o;return h?{data:{user:null,session:null},error:h}:a&&a.session&&a.user?(a.session&&(await this.Tt(a.session),await this._t("SIGNED_IN",a.session)),{data:a,error:h}):{data:{user:null,session:null},error:new We}}catch(e){if(n(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOtp(t){var e,i,r,s,o;try{if("email"in t){const{email:r,options:s}=t;let n=null,o=null;"pkce"===this.flowType&&([n,o]=await b(this.storage,this.storageKey));const{error:a}=await j(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:null!==(e=null==s?void 0:s.data)&&void 0!==e?e:{},create_user:null===(i=null==s?void 0:s.shouldCreateUser)||void 0===i||i,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},code_challenge:n,code_challenge_method:o},redirectTo:null==s?void 0:s.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in t){const{phone:e,options:i}=t,{data:n,error:a}=await j(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:e,data:null!==(r=null==i?void 0:i.data)&&void 0!==r?r:{},create_user:null===(s=null==i?void 0:i.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},channel:null!==(o=null==i?void 0:i.channel)&&void 0!==o?o:"sms"}});return{data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:a}}throw new ze("You must provide either an email or phone number.")}catch(a){if(n(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(t){var e,i;try{let r,s;"options"in t&&(r=null===(e=t.options)||void 0===e?void 0:e.redirectTo,s=null===(i=t.options)||void 0===i?void 0:i.captchaToken);const{data:n,error:o}=await j(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:s}}),redirectTo:r,xform:E});if(o)throw o;if(!n)throw new Error("An error occurred on token verification.");const a=n.session,h=n.user;return(null==a?void 0:a.access_token)&&(await this.Tt(a),await this._t("recovery"==t.type?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:h,session:a},error:null}}catch(r){if(n(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithSSO(t){var e,i,r;try{let s=null,n=null;return"pkce"===this.flowType&&([s,n]=await b(this.storage,this.storageKey)),await j(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:null!==(i=null===(e=t.options)||void 0===e?void 0:e.redirectTo)&&void 0!==i?i:void 0}),(null===(r=null==t?void 0:t.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:n}),headers:this.headers,xform:S})}catch(s){if(n(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this.$t(-1,async()=>await this.Rt())}async Rt(){try{return await this.Ut(async t=>{const{data:{session:e},error:i}=t;if(i)throw i;if(!e)throw new qe;const{error:r}=await j(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:e.access_token});return{data:{user:null,session:null},error:r}})}catch(t){if(n(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const e=`${this.url}/resend`;if("email"in t){const{email:i,type:r,options:s}=t,{error:n}=await j(this.fetch,"POST",e,{headers:this.headers,body:{email:i,type:r,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}},redirectTo:null==s?void 0:s.emailRedirectTo});return{data:{user:null,session:null},error:n}}if("phone"in t){const{phone:i,type:r,options:s}=t,{data:n,error:o}=await j(this.fetch,"POST",e,{headers:this.headers,body:{phone:i,type:r,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}}});return{data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:o}}throw new ze("You must provide either an email or phone number and a type")}catch(e){if(n(e))return{data:{user:null,session:null},error:e};throw e}}async getSession(){return await this.initializePromise,await this.$t(-1,async()=>this.Ut(async t=>t))}async $t(t,e){this.bt("#_acquireLock","begin",t);try{if(this.lockAcquired){const t=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await t,await e()))();return this.pendingInLock.push((async()=>{try{await i}catch(t){}})()),i}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this.bt("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const t=e();for(this.pendingInLock.push((async()=>{try{await t}catch(e){}})()),await t;this.pendingInLock.length;){const t=[...this.pendingInLock];await Promise.all(t),this.pendingInLock.splice(0,t.length)}return await t}finally{this.bt("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this.bt("#_acquireLock","end")}}async Ut(t){this.bt("#_useSession","begin");try{const e=await this.Nt();return await t(e)}finally{this.bt("#_useSession","end")}}async Nt(){this.bt("#__loadSession()","begin"),this.lockAcquired||this.bt("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let t=null;const e=await oi(this.storage,this.storageKey);if(this.bt("#getSession()","session from storage",e),null!==e&&(this.Ct(e)?t=e:(this.bt("#getSession()","session from storage is not valid"),await this.St())),!t)return{data:{session:null},error:null};const i=!!t.expires_at&&1e3*t.expires_at-Date.now()<9e4;if(this.bt("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",t.expires_at),!i){if(this.userStorage){const e=await oi(this.userStorage,this.storageKey+"-user");(null==e?void 0:e.user)?t.user=e.user:t.user=m()}if(this.storage.isServer&&t.user){let e=this.suppressGetSessionWarning;t=new Proxy(t,{get:(t,i,r)=>(e||"user"!==i||(e=!0,this.suppressGetSessionWarning=!0),Reflect.get(t,i,r))})}return{data:{session:t},error:null}}const{session:r,error:s}=await this.Dt(t.refresh_token);return s?{data:{session:null},error:s}:{data:{session:r},error:null}}finally{this.bt("#__loadSession()","end")}}async getUser(t){return t?await this.Lt(t):(await this.initializePromise,await this.$t(-1,async()=>await this.Lt()))}async Lt(t){try{return t?await j(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:O}):await this.Ut(async t=>{var e,i,r;const{data:s,error:n}=t;if(n)throw n;return(null===(e=s.session)||void 0===e?void 0:e.access_token)||this.hasCustomAuthorizationHeader?await j(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(r=null===(i=s.session)||void 0===i?void 0:i.access_token)&&void 0!==r?r:void 0,xform:O}):{data:{user:null},error:new qe}})}catch(e){if(n(e))return a(e)&&(await this.St(),await ai(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:e};throw e}}async updateUser(t,e={}){return await this.initializePromise,await this.$t(-1,async()=>await this.Ft(t,e))}async Ft(t,e={}){try{return await this.Ut(async i=>{const{data:r,error:s}=i;if(s)throw s;if(!r.session)throw new qe;const n=r.session;let o=null,a=null;"pkce"===this.flowType&&null!=t.email&&([o,a]=await b(this.storage,this.storageKey));const{data:h,error:l}=await j(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==e?void 0:e.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:a}),jwt:n.access_token,xform:O});if(l)throw l;return n.user=h.user,await this.Tt(n),await this._t("USER_UPDATED",n),{data:{user:n.user},error:null}})}catch(i){if(n(i))return{data:{user:null},error:i};throw i}}async setSession(t){return await this.initializePromise,await this.$t(-1,async()=>await this.Bt(t))}async Bt(t){try{if(!t.access_token||!t.refresh_token)throw new qe;const e=Date.now()/1e3;let i=e,r=!0,s=null;const{payload:n}=y(t.access_token);if(n.exp&&(i=n.exp,r=i<=e),r){const{session:e,error:i}=await this.Dt(t.refresh_token);if(i)return{data:{user:null,session:null},error:i};if(!e)return{data:{user:null,session:null},error:null};s=e}else{const{data:r,error:n}=await this.Lt(t.access_token);if(n)throw n;s={access_token:t.access_token,refresh_token:t.refresh_token,user:r.user,token_type:"bearer",expires_in:i-e,expires_at:i},await this.Tt(s),await this._t("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(e){if(n(e))return{data:{session:null,user:null},error:e};throw e}}async refreshSession(t){return await this.initializePromise,await this.$t(-1,async()=>await this.Mt(t))}async Mt(t){try{return await this.Ut(async e=>{var i;if(!t){const{data:r,error:s}=e;if(s)throw s;t=null!==(i=r.session)&&void 0!==i?i:void 0}if(!(null==t?void 0:t.refresh_token))throw new qe;const{session:r,error:s}=await this.Dt(t.refresh_token);return s?{data:{user:null,session:null},error:s}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}})}catch(e){if(n(e))return{data:{user:null,session:null},error:e};throw e}}async Ot(t,e){try{if(!ei())throw new He("No browser detected.");if(t.error||t.error_description||t.error_code)throw new He(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(e){case"implicit":if("pkce"===this.flowType)throw new Ve("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new He("Not a valid implicit grant flow url.")}if("pkce"===e){if(this.bt("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new Ve("No code detected.");const{data:e,error:i}=await this.Pt(t.code);if(i)throw i;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:e.session,redirectType:null},error:null}}const{provider_token:i,provider_refresh_token:r,access_token:s,refresh_token:n,expires_in:o,expires_at:a,token_type:h}=t;if(!(s&&o&&n&&h))throw new He("No session defined in URL");const l=Math.round(Date.now()/1e3),c=parseInt(o);let u=l+c;a&&(u=parseInt(a));const{data:d,error:f}=await this.Lt(s);if(f)throw f;const w={provider_token:i,provider_refresh_token:r,access_token:s,expires_in:c,expires_at:u,refresh_token:n,token_type:h,user:d.user};return window.location.hash="",this.bt("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:w,redirectType:t.type},error:null}}catch(i){if(n(i))return{data:{session:null,redirectType:null},error:i};throw i}}Et(t){return Boolean(t.access_token||t.error_description)}async kt(t){const e=await oi(this.storage,`${this.storageKey}-code-verifier`);return!(!t.code||!e)}async signOut(t={scope:"global"}){return await this.initializePromise,await this.$t(-1,async()=>await this.Gt(t))}async Gt({scope:t}={scope:"global"}){return await this.Ut(async e=>{var i;const{data:r,error:s}=e;if(s)return{error:s};const n=null===(i=r.session)||void 0===i?void 0:i.access_token;if(n){const{error:e}=await this.admin.signOut(n,t);if(e&&(!o(e)||404!==e.status&&401!==e.status&&403!==e.status))return{error:e}}return"others"!==t&&(await this.St(),await ai(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(t){const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}),i={id:e,callback:t,unsubscribe:()=>{this.bt("#unsubscribe()","state change callback with id removed",e),this.stateChangeEmitters.delete(e)}};return this.bt("#onAuthStateChange()","registered callback with id",e),this.stateChangeEmitters.set(e,i),(async()=>{await this.initializePromise,await this.$t(-1,async()=>{this.Jt(e)})})(),{data:{subscription:i}}}async Jt(t){return await this.Ut(async e=>{var i,r;try{const{data:{session:r},error:s}=e;if(s)throw s;await(null===(i=this.stateChangeEmitters.get(t))||void 0===i?void 0:i.callback("INITIAL_SESSION",r)),this.bt("INITIAL_SESSION","callback id",t,"session",r)}catch(s){await(null===(r=this.stateChangeEmitters.get(t))||void 0===r?void 0:r.callback("INITIAL_SESSION",null)),this.bt("INITIAL_SESSION","callback id",t,"error",s)}})}async resetPasswordForEmail(t,e={}){let i=null,r=null;"pkce"===this.flowType&&([i,r]=await b(this.storage,this.storageKey,!0));try{return await j(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:i,code_challenge_method:r,gotrue_meta_security:{captcha_token:e.captchaToken}},headers:this.headers,redirectTo:e.redirectTo})}catch(s){if(n(s))return{data:null,error:s};throw s}}async getUserIdentities(){var t;try{const{data:e,error:i}=await this.getUser();if(i)throw i;return{data:{identities:null!==(t=e.user.identities)&&void 0!==t?t:[]},error:null}}catch(e){if(n(e))return{data:null,error:e};throw e}}async linkIdentity(t){var e;try{const{data:i,error:r}=await this.Ut(async e=>{var i,r,s,n,o;const{data:a,error:h}=e;if(h)throw h;const l=await this.qt(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:null===(i=t.options)||void 0===i?void 0:i.redirectTo,scopes:null===(r=t.options)||void 0===r?void 0:r.scopes,queryParams:null===(s=t.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:!0});return await j(this.fetch,"GET",l,{headers:this.headers,jwt:null!==(o=null===(n=a.session)||void 0===n?void 0:n.access_token)&&void 0!==o?o:void 0})});if(r)throw r;return ei()&&!(null===(e=t.options)||void 0===e?void 0:e.skipBrowserRedirect)&&window.location.assign(null==i?void 0:i.url),{data:{provider:t.provider,url:null==i?void 0:i.url},error:null}}catch(i){if(n(i))return{data:{provider:t.provider,url:null},error:i};throw i}}async unlinkIdentity(t){try{return await this.Ut(async e=>{var i,r;const{data:s,error:n}=e;if(n)throw n;return await j(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:null!==(r=null===(i=s.session)||void 0===i?void 0:i.access_token)&&void 0!==r?r:void 0})})}catch(e){if(n(e))return{data:null,error:e};throw e}}async Wt(t){const e=`#_refreshAccessToken(${t.substring(0,5)}...)`;this.bt(e,"begin");try{const s=Date.now();return await(i=async i=>(i>0&&await async function(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}(200*Math.pow(2,i-1)),this.bt(e,"refreshing attempt",i),await j(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:E})),r=(t,e)=>{const i=200*Math.pow(2,t);return e&&l(e)&&Date.now()+i-s<Ne},new Promise((t,e)=>{(async()=>{for(let n=0;n<1/0;n++)try{const e=await i(n);if(!r(n,null))return void t(e)}catch(s){if(!r(n,s))return void e(s)}})()}))}catch(s){if(this.bt(e,"error",s),n(s))return{data:{session:null,user:null},error:s};throw s}finally{this.bt(e,"end")}var i,r}Ct(t){return"object"==typeof t&&null!==t&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async It(t,e){const i=await this.qt(`${this.url}/authorize`,t,{redirectTo:e.redirectTo,scopes:e.scopes,queryParams:e.queryParams});return this.bt("#_handleProviderSignIn()","provider",t,"options",e,"url",i),ei()&&!e.skipBrowserRedirect&&window.location.assign(i),{data:{provider:t,url:i},error:null}}async At(){var t,e;const i="#_recoverAndRefresh()";this.bt(i,"begin");try{const s=await oi(this.storage,this.storageKey);if(s&&this.userStorage){let e=await oi(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||e||(e={user:s.user},await ni(this.userStorage,this.storageKey+"-user",e)),s.user=null!==(t=null==e?void 0:e.user)&&void 0!==t?t:m()}else if(s&&!s.user&&!s.user){const t=await oi(this.storage,this.storageKey+"-user");t&&(null==t?void 0:t.user)?(s.user=t.user,await ai(this.storage,this.storageKey+"-user"),await ni(this.storage,this.storageKey,s)):s.user=m()}if(this.bt(i,"session from storage",s),!this.Ct(s))return this.bt(i,"session is not valid"),void(null!==s&&await this.St());const n=1e3*(null!==(e=s.expires_at)&&void 0!==e?e:1/0)-Date.now()<9e4;if(this.bt(i,`session has${n?"":" not"} expired with margin of 90000s`),n){if(this.autoRefreshToken&&s.refresh_token){const{error:t}=await this.Dt(s.refresh_token);t&&(l(t)||(this.bt(i,"refresh failed with a non-retryable error, removing the session",t),await this.St()))}}else if(s.user&&!0===s.user.zt)try{const{data:t,error:e}=await this.Lt(s.access_token);!e&&(null==t?void 0:t.user)?(s.user=t.user,await this.Tt(s),await this._t("SIGNED_IN",s)):this.bt(i,"could not get user data, skipping SIGNED_IN notification")}catch(r){this.bt(i,"error getting user data, skipping SIGNED_IN notification",r)}else await this._t("SIGNED_IN",s)}catch(s){return void this.bt(i,"error",s)}finally{this.bt(i,"end")}}async Dt(t){var e,i;if(!t)throw new qe;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${t.substring(0,5)}...)`;this.bt(r,"begin");try{this.refreshingDeferred=new hi;const{data:e,error:i}=await this.Wt(t);if(i)throw i;if(!e.session)throw new qe;await this.Tt(e.session),await this._t("TOKEN_REFRESHED",e.session);const r={session:e.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(s){if(this.bt(r,"error",s),n(s)){const t={session:null,error:s};return l(s)||await this.St(),null===(e=this.refreshingDeferred)||void 0===e||e.resolve(t),t}throw null===(i=this.refreshingDeferred)||void 0===i||i.reject(s),s}finally{this.refreshingDeferred=null,this.bt(r,"end")}}async _t(t,e,i=!0){const r=`#_notifyAllSubscribers(${t})`;this.bt(r,"begin",e,`broadcast = ${i}`);try{this.broadcastChannel&&i&&this.broadcastChannel.postMessage({event:t,session:e});const r=[],s=Array.from(this.stateChangeEmitters.values()).map(async i=>{try{await i.callback(t,e)}catch(s){r.push(s)}});if(await Promise.all(s),r.length>0){for(let t=0;t<r.length;t+=1);throw r[0]}}finally{this.bt(r,"end")}}async Tt(t){this.bt("#_saveSession()",t),this.suppressGetSessionWarning=!0;const e=Object.assign({},t),i=e.user&&!0===e.user.zt;if(this.userStorage){!i&&e.user&&await ni(this.userStorage,this.storageKey+"-user",{user:e.user});const t=Object.assign({},e);delete t.user;const r=_(t);await ni(this.storage,this.storageKey,r)}else{const t=_(e);await ni(this.storage,this.storageKey,t)}}async St(){this.bt("#_removeSession()"),await ai(this.storage,this.storageKey),await ai(this.storage,this.storageKey+"-code-verifier"),await ai(this.storage,this.storageKey+"-user"),this.userStorage&&await ai(this.userStorage,this.storageKey+"-user"),await this._t("SIGNED_OUT",null)}Ht(){this.bt("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&ei()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(e){}}async Vt(){await this.Kt(),this.bt("#_startAutoRefresh()");const t=setInterval(()=>this.Yt(),Ne);this.autoRefreshTicker=t,t&&"object"==typeof t&&"function"==typeof t.unref?t.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this.Yt()},0)}async Kt(){this.bt("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this.Ht(),await this.Vt()}async stopAutoRefresh(){this.Ht(),await this.Kt()}async Yt(){this.bt("#_autoRefreshTokenTick()","begin");try{await this.$t(0,async()=>{try{const e=Date.now();try{return await this.Ut(async t=>{const{data:{session:i}}=t;if(!i||!i.refresh_token||!i.expires_at)return void this.bt("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*i.expires_at-e)/Ne);this.bt("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r<=3&&await this.Dt(i.refresh_token)})}catch(t){}}finally{this.bt("#_autoRefreshTokenTick()","end")}})}catch(t){if(!(t.isAcquireTimeout||t instanceof pi))throw t;this.bt("auto refresh token tick lock not available")}}async xt(){if(this.bt("#_handleVisibilityChange()"),!ei()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this.Xt(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this.Xt(!0)}catch(t){}}async Xt(t){const e=`#_onVisibilityChanged(${t})`;this.bt(e,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this.Vt(),t||(await this.initializePromise,await this.$t(-1,async()=>{"visible"===document.visibilityState?await this.At():this.bt(e,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this.Kt()}async qt(t,e,i){const r=[`provider=${encodeURIComponent(e)}`];if((null==i?void 0:i.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(i.redirectTo)}`),(null==i?void 0:i.scopes)&&r.push(`scopes=${encodeURIComponent(i.scopes)}`),"pkce"===this.flowType){const[t,e]=await b(this.storage,this.storageKey),i=new URLSearchParams({code_challenge:`${encodeURIComponent(t)}`,code_challenge_method:`${encodeURIComponent(e)}`});r.push(i.toString())}if(null==i?void 0:i.queryParams){const t=new URLSearchParams(i.queryParams);r.push(t.toString())}return(null==i?void 0:i.skipBrowserRedirect)&&r.push(`skip_http_redirect=${i.skipBrowserRedirect}`),`${t}?${r.join("&")}`}async ft(t){try{return await this.Ut(async e=>{var i;const{data:r,error:s}=e;return s?{data:null,error:s}:await j(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:null===(i=null==r?void 0:r.session)||void 0===i?void 0:i.access_token})})}catch(e){if(n(e))return{data:null,error:e};throw e}}async dt(t){try{return await this.Ut(async e=>{var i,r;const{data:s,error:n}=e;if(n)return{data:null,error:n};const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},"phone"===t.factorType?{phone:t.phone}:{issuer:t.issuer}),{data:a,error:h}=await j(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:null===(i=null==s?void 0:s.session)||void 0===i?void 0:i.access_token});return h?{data:null,error:h}:("totp"===t.factorType&&(null===(r=null==a?void 0:a.totp)||void 0===r?void 0:r.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})})}catch(e){if(n(e))return{data:null,error:e};throw e}}async ut(t){return this.$t(-1,async()=>{try{return await this.Ut(async e=>{var i;const{data:r,error:s}=e;if(s)return{data:null,error:s};const{data:n,error:o}=await j(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:null===(i=null==r?void 0:r.session)||void 0===i?void 0:i.access_token});return o?{data:null,error:o}:(await this.Tt(Object.assign({expires_at:Math.round(Date.now()/1e3)+n.expires_in},n)),await this._t("MFA_CHALLENGE_VERIFIED",n),{data:n,error:o})})}catch(e){if(n(e))return{data:null,error:e};throw e}})}async wt(t){return this.$t(-1,async()=>{try{return await this.Ut(async e=>{var i;const{data:r,error:s}=e;return s?{data:null,error:s}:await j(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:null===(i=null==r?void 0:r.session)||void 0===i?void 0:i.access_token})})}catch(e){if(n(e))return{data:null,error:e};throw e}})}async vt(t){const{data:e,error:i}=await this.wt({factorId:t.factorId});return i?{data:null,error:i}:await this.ut({factorId:t.factorId,challengeId:e.id,code:t.code})}async ot(){const{data:{user:t},error:e}=await this.getUser();if(e)return{data:null,error:e};const i=(null==t?void 0:t.factors)||[],r=i.filter(t=>"totp"===t.factor_type&&"verified"===t.status),s=i.filter(t=>"phone"===t.factor_type&&"verified"===t.status);return{data:{all:i,totp:r,phone:s},error:null}}async yt(){return this.$t(-1,async()=>await this.Ut(async t=>{var e,i;const{data:{session:r},error:s}=t;if(s)return{data:null,error:s};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:n}=y(r.access_token);let o=null;n.aal&&(o=n.aal);let a=o;return(null!==(i=null===(e=r.user.factors)||void 0===e?void 0:e.filter(t=>"verified"===t.status))&&void 0!==i?i:[]).length>0&&(a="aal2"),{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:n.amr||[]},error:null}}))}async fetchJwk(t,e={keys:[]}){let i=e.keys.find(e=>e.kid===t);if(i)return i;const r=Date.now();if(i=this.jwks.keys.find(e=>e.kid===t),i&&this.jwks_cached_at+6e5>r)return i;const{data:s,error:n}=await j(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(n)throw n;return s.keys&&0!==s.keys.length?(this.jwks=s,this.jwks_cached_at=r,i=s.keys.find(e=>e.kid===t),i||null):null}async getClaims(t,e={}){try{let i=t;if(!i){const{data:t,error:e}=await this.getSession();if(e||!t.session)return{data:null,error:e};i=t.session.access_token}const{header:r,payload:s,signature:n,raw:{header:o,payload:a}}=y(i);(null==e?void 0:e.allowExpired)||function(t){if(!t)throw new Error("Missing exp claim");if(t<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(s.exp);const h=r.alg&&!r.alg.startsWith("HS")&&r.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(r.kid,(null==e?void 0:e.keys)?{keys:e.keys}:null==e?void 0:e.jwks):null;if(!h){const{error:t}=await this.getUser(i);if(t)throw t;return{data:{claims:s,header:r,signature:n},error:null}}const l=function(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(r.alg),c=await crypto.subtle.importKey("jwk",h,l,!0,["verify"]);if(!(await crypto.subtle.verify(l,c,n,function(t){const e=[];return function(t,e){for(let i=0;i<t.length;i+=1){let r=t.charCodeAt(i);if(r>55295&&r<=56319){const e=1024*(r-55296)&65535;r=65536+(t.charCodeAt(i+1)-56320&65535|e),i+=1}f(r,e)}}(t,t=>e.push(t)),new Uint8Array(e)}(`${o}.${a}`))))throw new Xe("Invalid JWT signature");return{data:{claims:s,header:r,signature:n},error:null}}catch(i){if(n(i))return{data:null,error:i};throw i}}}_i.nextInstanceID=0;const $i=_i;class ji extends $i{constructor(t){super(t)}}class Ei{constructor(t,e,i){var r,s,n;if(this.supabaseUrl=t,this.supabaseKey=e,!t)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");const o=(a=t).endsWith("/")?a:a+"/";var a;const h=new URL(o);this.realtimeUrl=new URL("realtime/v1",h),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",h),this.storageUrl=new URL("storage/v1",h),this.functionsUrl=new URL("functions/v1",h);const l=`sb-${h.hostname.split(".")[0]}-auth-token`,c=function(t,e){var i,r;const{db:s,auth:n,realtime:o,global:a}=t,{db:h,auth:l,realtime:c,global:u}=e,d={db:Object.assign(Object.assign({},h),s),auth:Object.assign(Object.assign({},l),n),realtime:Object.assign(Object.assign({},c),o),global:Object.assign(Object.assign(Object.assign({},u),a),{headers:Object.assign(Object.assign({},null!==(i=null==u?void 0:u.headers)&&void 0!==i?i:{}),null!==(r=null==a?void 0:a.headers)&&void 0!==r?r:{})}),accessToken:()=>{return t=this,i=function*(){return""},new((e=void 0)||(e=Promise))(function(r,s){function n(t){try{a(i.next(t))}catch(e){s(e)}}function o(t){try{a(i.throw(t))}catch(e){s(e)}}function a(t){var i;t.done?r(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(n,o)}a((i=i.apply(t,[])).next())});var t,e,i}};return t.accessToken?d.accessToken=t.accessToken:delete d.accessToken,d}(null!=i?i:{},{db:xe,realtime:Pe,auth:Object.assign(Object.assign({},Ie),{storageKey:l}),global:Ae});this.storageKey=null!==(r=c.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(s=c.global.headers)&&void 0!==s?s:{},c.accessToken?(this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(t,e)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(e)} is not possible`)}})):this.auth=this.Qt(null!==(n=c.auth)&&void 0!==n?n:{},this.headers,c.global.fetch),this.fetch=((t,e,i)=>{const r=Re(i),s="undefined"==typeof Headers?Z:Headers;return(i,n)=>{return a=function*(){var o;const a=null!==(o=yield e())&&void 0!==o?o:t;let h=new s(null==n?void 0:n.headers);return h.has("apikey")||h.set("apikey",t),h.has("Authorization")||h.set("Authorization",`Bearer ${a}`),r(i,Object.assign(Object.assign({},n),{headers:h}))},new((o=void 0)||(o=Promise))(function(t,e){function i(t){try{s(a.next(t))}catch(i){e(i)}}function r(t){try{s(a.throw(t))}catch(i){e(i)}}function s(e){var s;e.done?t(e.value):(s=e.value,s instanceof o?s:new o(function(t){t(s)})).then(i,r)}s((a=a.apply(void 0,[])).next())});var o,a}})(e,this.Zt.bind(this),c.global.fetch),this.realtime=this.te(Object.assign({headers:this.headers,accessToken:this.Zt.bind(this)},c.realtime)),this.rest=new Pt(new URL("rest/v1",h).href,{headers:this.headers,schema:c.db.schema,fetch:this.fetch}),c.accessToken||this.ee()}get functions(){return new J(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Se(this.storageUrl.href,this.headers,this.fetch)}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},i={}){return this.rest.rpc(t,e,i)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}Zt(){var t,e,i,r,s;return i=this,s=function*(){if(this.accessToken)return yield this.accessToken();const{data:i}=yield this.auth.getSession();return null!==(e=null===(t=i.session)||void 0===t?void 0:t.access_token)&&void 0!==e?e:null},new((r=void 0)||(r=Promise))(function(t,e){function n(t){try{a(s.next(t))}catch(i){e(i)}}function o(t){try{a(s.throw(t))}catch(i){e(i)}}function a(e){var i;e.done?t(e.value):(i=e.value,i instanceof r?i:new r(function(t){t(i)})).then(n,o)}a((s=s.apply(i,[])).next())})}Qt({autoRefreshToken:t,persistSession:e,detectSessionInUrl:i,storage:r,storageKey:s,flowType:n,lock:o,debug:a},h,l){const c={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new ji({url:this.authUrl.href,headers:Object.assign(Object.assign({},c),h),storageKey:s,autoRefreshToken:t,persistSession:e,detectSessionInUrl:i,storage:r,flowType:n,lock:o,debug:a,fetch:l,hasCustomAuthorizationHeader:"Authorization"in this.headers})}te(t){return new ue(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},null==t?void 0:t.params)}))}ee(){return this.auth.onAuthStateChange((t,e)=>{this.ie(t,"CLIENT",null==e?void 0:e.access_token)})}ie(t,e,i){"TOKEN_REFRESHED"!==t&&"SIGNED_IN"!==t||this.changedAccessToken===i?"SIGNED_OUT"===t&&(this.realtime.setAuth(),"STORAGE"==e&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=i}}!function(){if("undefined"!=typeof window||"undefined"==typeof process||void 0===process.version||null===process.version)return!1;const t=process.version.match(/^v(\d+)\./);t&&parseInt(t[1],10)}();const ki=Object.freeze(Object.defineProperty({__proto__:null,AuthApiError:Me,AuthClient:$i,AuthError:Be,AuthImplicitGrantRedirectError:He,AuthInvalidCredentialsError:ze,AuthInvalidJwtError:Xe,AuthInvalidTokenResponseError:We,AuthPKCEGrantCodeExchangeError:Ve,AuthRetryableFetchError:Ke,AuthSessionMissingError:qe,AuthUnknownError:Ge,AuthWeakPasswordError:Ye,CustomAuthError:Je,get FunctionRegion(){return G},FunctionsError:L,FunctionsFetchError:F,FunctionsHttpError:M,FunctionsRelayError:B,GoTrueAdminApi:vi,GoTrueClient:_i,NavigatorLockAcquireTimeoutError:bi,PostgrestError:Dt,get REALTIME_LISTEN_TYPES(){return oe},get REALTIME_POSTGRES_CHANGES_LISTEN_EVENT(){return ne},get REALTIME_PRESENCE_LISTEN_EVENTS(){return se},get REALTIME_SUBSCRIBE_STATES(){return ae},RealtimeChannel:le,RealtimeClient:ue,RealtimePresence:he,SIGN_OUT_SCOPES:wi,SupabaseClient:Ei,createClient:(t,e,i)=>new Ei(t,e,i),isAuthApiError:o,isAuthError:n,isAuthImplicitGrantRedirectError:h,isAuthRetryableFetchError:l,isAuthSessionMissingError:a,lockInternals:yi,navigatorLock:I},Symbol.toStringTag,{value:"Module"}));export{D as _,ki as i};
