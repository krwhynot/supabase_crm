import{d as e,r as s,c as t,y as a,z as l,w as r,C as o,D as n,J as c,W as i,K as u,u as d,X as p,B as m,U as x,V as y,a3 as b,N as g,n as f,E as v,M as h,F as w,L as k,Z as C}from"./vue-runtime-Ds28nt_E.js";import{E,A,p as M}from"./EngagementScoreRing-BBhVgq6G.js";import{d as _,r as I,b as T,K as V,_ as L,S,f as j,R as O}from"./heroicons-QXV26b6T.js";import{_ as D}from"./_plugin-vue_export-helper-DYAABpgn.js";const z={class:"principal-selector"},W={class:"relative"},N={class:"relative"},R={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},$=["disabled"],B={key:0,class:"absolute inset-y-0 right-0 pr-3 flex items-center"},F={key:0,class:"mt-2 text-sm text-red-600 flex items-center"},K={class:"absolute z-10 mt-1 w-full bg-white shadow-lg max-h-96 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm"},U={class:"px-3 py-2 border-b border-gray-100"},P={class:"flex items-center space-x-4"},Y={class:"flex space-x-2"},H=["onClick"],J={class:"max-h-72 overflow-y-auto"},Q={key:0,class:"px-3 py-4 text-sm text-gray-500 text-center"},X=["onClick","onMouseenter"],Z={class:"flex items-center justify-between"},q={class:"flex-1 min-w-0"},G={class:"flex items-center space-x-2"},ee={class:"font-medium text-gray-900 truncate"},se={class:"text-sm text-gray-500 truncate"},te={class:"flex items-center space-x-4 mt-1 text-xs text-gray-600"},ae={class:"flex items-center"},le={class:"flex items-center"},re={class:"flex items-center"},oe={class:"ml-3 flex-shrink-0"},ne={key:0,class:"absolute inset-y-0 right-0 flex items-center pr-4"},ce={key:0,class:"border-t border-gray-100 px-3 py-2"},ie={class:"flex items-center justify-between text-xs text-gray-600"},ue={class:"flex space-x-2"},de={key:0,class:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"},pe={class:"flex items-center justify-between"},me={class:"flex items-center space-x-3"},xe={class:"flex-shrink-0"},ye={class:"text-sm font-medium text-gray-900"},be={class:"text-sm text-gray-600"},ge={class:"flex items-center space-x-3 mt-1"},fe={class:"text-xs text-gray-500"},ve=D(e({t:"PrincipalSelector",props:{modelValue:{default:""},loading:{type:Boolean,default:!1},error:{default:null},placeholder:{default:"Search principals..."},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","change","search","create-opportunity","log-interaction"],setup(e,{emit:D}){const ve=e,he=D,we=s(),ke=s(""),Ce=s(!1),Ee=s(-1),Ae=s([]),Me=s(!1),_e=s(["ACTIVE","MODERATE"]),Ie=[{value:"ACTIVE",label:"Active",colorClass:"bg-green-400"},{value:"MODERATE",label:"Moderate",colorClass:"bg-yellow-400"},{value:"LOW",label:"Low",colorClass:"bg-orange-400"},{value:"NO_ACTIVITY",label:"Inactive",colorClass:"bg-gray-400"}],Te=t(()=>ve.modelValue&&Ae.value.find(e=>e.principal_id===ve.modelValue)||null),Ve=t(()=>{let e=Ae.value;if(_e.value.length>0&&(e=e.filter(e=>_e.value.includes(e.activity_status))),ke.value){const s=ke.value.toLowerCase();e=e.filter(e=>e.principal_name.toLowerCase().includes(s)||(e.organization_type||"").toLowerCase().includes(s))}return e.sort((e,s)=>{const t=e.engagement_score||0,a=s.engagement_score||0;return t!==a?a-t:e.principal_name.localeCompare(s.principal_name)})}),Le=async e=>{const s=e.target;ke.value=s.value,he("search",ke.value),ke.value.length>=2?await Ne(ke.value):0===ke.value.length&&await We()},Se=e=>{if(Ce.value&&0!==Ve.value.length)switch(e.key){case"ArrowDown":e.preventDefault(),Ee.value=Math.min(Ee.value+1,Ve.value.length-1);break;case"ArrowUp":e.preventDefault(),Ee.value=Math.max(Ee.value-1,-1);break;case"Enter":e.preventDefault(),Ee.value>=0&&je(Ve.value[Ee.value]);break;case"Escape":e.preventDefault(),Ce.value=!1,Ee.value=-1}},je=e=>{he("update:modelValue",e.principal_id),he("change",e),ke.value=e.principal_name,Ce.value=!1,Ee.value=-1},Oe=()=>{he("update:modelValue",""),he("change",null),ke.value="",Ce.value=!1,Ee.value=-1,f(()=>{var e;null==(e=we.value)||e.focus()})},De=e=>{e.stopPropagation(),Te.value&&he("create-opportunity",Te.value),Ce.value=!1},ze=e=>{e.stopPropagation(),Te.value&&he("log-interaction",Te.value),Ce.value=!1},We=async()=>{Me.value=!0;try{const e=await M.getPrincipalActivitySummary();e.success&&(Ae.value=e.data||[])}catch(e){}finally{Me.value=!1}},Ne=async e=>{Me.value=!0;try{const s=await M.searchPrincipalsWithActivity(e,!1);s.success&&(Ae.value=s.data||[])}catch(s){}finally{Me.value=!1}},Re=e=>{if(!e)return"No activity";const s=new Date(e),t=new Date,a=Math.floor((t.getTime()-s.getTime())/864e5);return 0===a?"Today":1===a?"Yesterday":a<7?`${a} days ago`:a<30?`${Math.floor(a/7)} weeks ago`:a<365?`${Math.floor(a/30)} months ago`:`${Math.floor(a/365)} years ago`},$e=e=>{e.target.closest(".principal-selector")||(Ce.value=!1,Ee.value=-1)};return a(async()=>{if(document.addEventListener("click",$e),await We(),ve.modelValue){const e=Ae.value.find(e=>e.principal_id===ve.modelValue);e&&(ke.value=e.principal_name)}}),l(()=>{document.removeEventListener("click",$e)}),r(()=>ve.modelValue,e=>{if(e){const s=Ae.value.find(s=>s.principal_id===e);s&&(ke.value=s.principal_name)}else ke.value=""}),(e,s)=>(v(),o("div",z,[n("div",W,[n("div",N,[n("div",R,[i(d(_),{class:"h-5 w-5 text-gray-400"})]),u(n("input",{ref_key:"searchInput",ref:we,"onUpdate:modelValue":s[0]||(s[0]=e=>ke.value=e),type:"text",class:m(["block w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",[e.error?"border-red-300 focus:ring-red-500 focus:border-red-500":"",e.loading?"bg-gray-50":"bg-white"]]),placeholder:"Search principals by name or organization...",disabled:e.loading,onFocus:s[1]||(s[1]=e=>Ce.value=!0),onInput:Le,onKeydown:Se},null,42,$),[[p,ke.value]]),e.loading?(v(),o("div",B,s[2]||(s[2]=[n("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"},null,-1)]))):ke.value||Te.value?(v(),o("button",{key:1,onClick:Oe,class:"absolute inset-y-0 right-0 pr-3 flex items-center hover:text-gray-700"},[i(d(I),{class:"h-4 w-4 text-gray-400"})])):c("",!0)]),e.error?(v(),o("div",F,[i(d(T),{class:"h-4 w-4 mr-1"}),x(" "+y(e.error),1)])):c("",!0),i(b,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:g(()=>[u(n("div",K,[n("div",U,[n("div",P,[s[3]||(s[3]=n("label",{class:"text-xs font-medium text-gray-700"},"Filter:",-1)),n("div",Y,[(v(),o(w,null,k(Ie,e=>n("button",{key:e.value,onClick:s=>(e=>{const s=_e.value.indexOf(e);s>=0?_e.value.splice(s,1):_e.value.push(e)})(e.value),class:m(["inline-flex items-center px-2 py-1 rounded text-xs font-medium transition-colors",[_e.value.includes(e.value)?"bg-blue-100 text-blue-800 border border-blue-200":"bg-gray-100 text-gray-700 border border-gray-200 hover:bg-gray-200"]])},[n("span",{class:m(["w-2 h-2 rounded-full mr-1",e.colorClass])},null,2),x(" "+y(e.label),1)],10,H)),64))])])]),n("div",J,[0===Ve.value.length&&ke.value?(v(),o("div",Q,[i(d(V),{class:"mx-auto h-8 w-8 text-gray-300 mb-2"}),x(' No principals found matching "'+y(ke.value)+'" ',1)])):c("",!0),(v(!0),o(w,null,k(Ve.value,(e,s)=>{var t,a;return v(),o("div",{key:e.principal_id,onClick:s=>je(e),onMouseenter:e=>Ee.value=s,class:m(["relative cursor-pointer select-none py-3 px-3 hover:bg-gray-50 transition-colors",[Ee.value===s?"bg-blue-50":"",(null==(t=Te.value)?void 0:t.principal_id)===e.principal_id?"bg-blue-100":""]])},[n("div",Z,[n("div",q,[n("div",G,[n("span",ee,y(e.principal_name),1),i(A,{status:"STALE"===e.activity_status?"LOW":e.activity_status},null,8,["status"])]),n("div",se,y(e.organization_type),1),n("div",te,[n("span",ae,[i(d(L),{class:"h-3 w-3 mr-1"}),x(" Score: "+y(e.engagement_score||0),1)]),n("span",le,[i(d(S),{class:"h-3 w-3 mr-1"}),x(" "+y(Re(e.last_activity_date)),1)]),n("span",re,[i(d(j),{class:"h-3 w-3 mr-1"}),x(" "+y(e.total_opportunities||0)+" ops ",1)])])]),n("div",oe,[i(E,{score:e.engagement_score||0,size:"sm"},null,8,["score"])])]),(null==(a=Te.value)?void 0:a.principal_id)===e.principal_id?(v(),o("div",ne,[i(d(O),{class:"h-4 w-4 text-blue-600"})])):c("",!0)],42,X)}),128))]),Te.value?(v(),o("div",ce,[n("div",ie,[s[5]||(s[5]=n("span",null,"Quick Actions:",-1)),n("div",ue,[n("button",{onClick:C(De,["stop"]),class:"text-blue-600 hover:text-blue-800 font-medium"}," Create Opportunity "),s[4]||(s[4]=n("span",{class:"text-gray-300"},"•",-1)),n("button",{onClick:C(ze,["stop"]),class:"text-green-600 hover:text-green-800 font-medium"}," Log Interaction ")])])])):c("",!0)],512),[[h,Ce.value&&(Ve.value.length>0||ke.value)]])]),l:1})]),Te.value&&!Ce.value?(v(),o("div",de,[n("div",pe,[n("div",me,[n("div",xe,[i(E,{score:Te.value.engagement_score||0,size:"md"},null,8,["score"])]),n("div",null,[n("h3",ye,y(Te.value.principal_name),1),n("p",be,y(Te.value.organization_type),1),n("div",ge,[i(A,{status:"STALE"===Te.value.activity_status?"LOW":Te.value.activity_status},null,8,["status"]),n("span",fe,y(Te.value.total_opportunities||0)+" opportunities • "+y(Te.value.total_interactions||0)+" interactions ",1)])])]),n("button",{onClick:Oe,class:"text-gray-400 hover:text-gray-600"},[i(d(I),{class:"h-5 w-5"})])])])):c("",!0)]))}}),[["__scopeId","data-v-4b5cbcc8"]]);export{ve as P};
