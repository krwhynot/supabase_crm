import{d as e,r as t,c as r,w as a,C as o,D as l,J as s,B as n,U as i,V as d,F as c,L as u,n as p,E as m,y as g,z as b,K as x,X as y,Z as f,a1 as h,b as v,Y as k,O as w,u as C,W as B}from"./vue-runtime-Ds28nt_E.js";import{o as $,a as V,S,u as O,O as M}from"./opportunityStore-CiHSyBF9.js";import{u as z}from"./principalStore-CYUOJ8eV.js";import{u as j}from"./productStore-g1VeSLDp.js";import{_ as P}from"./_plugin-vue_export-helper-DYAABpgn.js";const _={class:"space-y-3"},N=["for"],q={key:0,class:"text-danger ml-1","aria-label":"required"},I=["id"],D={class:"flex items-center space-x-3"},U={class:"flex items-center space-x-2 cursor-pointer"},T=["checked"],E={key:1,class:"bg-blue-50 border border-blue-200 rounded-md p-3"},F={class:"flex items-start space-x-2"},A={class:"flex-1"},L={class:"text-sm text-blue-700 font-mono mt-1"},G={key:0,class:"text-xs text-blue-600 mt-1"},H={class:"font-mono"},R={key:2,class:"bg-green-50 border border-green-200 rounded-md p-3"},W={class:"flex items-start space-x-2"},J={class:"flex-1"},Y={class:"text-sm font-medium text-green-900"},K={class:"mt-2 space-y-1 max-h-32 overflow-y-auto"},X={key:0,class:"text-xs text-green-600 italic"},Z={key:3,class:"relative"},Q=["id","name","placeholder","disabled","required","maxlength","value","aria-describedby","aria-invalid","aria-required"],ee={key:0,class:"absolute inset-y-0 right-0 flex items-center pr-3"},te={key:4,class:"flex justify-start"},re={key:5,class:"space-y-2"},ae=["id","placeholder","value","maxlength"],oe=["id"],le=["id"],se=e({t:"OpportunityNameField",props:{name:{},label:{},modelValue:{},autoGenerate:{type:Boolean},organizationName:{},principalName:{},principalData:{},context:{},customContext:{},error:{},placeholder:{default:"Enter opportunity name..."},description:{},helpText:{default:"Auto-generated names help maintain consistency across opportunities"},required:{type:Boolean},disabled:{type:Boolean},maxlength:{default:255},showCharacterCount:{type:Boolean,default:!0},maxPreviewDisplay:{default:5},inputClass:{},labelClass:{}},emits:["update:modelValue","update:autoGenerate","update:nameTemplate","blur","focus","input","name-generated","batch-names-generated"],setup(e,{expose:g,emit:b}){const x=e,y=b,f=t(!1),h=t(!1),v=t(""),k=t(""),w=t(null),C=t([]),B=r(()=>`name-field-${x.name}`),V=r(()=>`error-${x.name}`),S=r(()=>`desc-${x.name}`),O=r(()=>`help-${x.name}`),M=r(()=>!!x.error),z=r(()=>{const e=[];return x.description&&e.push(S.value),x.error&&e.push(V.value),x.helpText&&!x.error&&e.push(O.value),e.length>0?e.join(" "):void 0}),j=r(()=>`block text-sm font-medium transition-colors duration-200 ${M.value?"text-red-700":f.value?"text-primary-600":"text-gray-700"} ${x.disabled?"opacity-60":""} ${x.labelClass||""}`.trim()),P=r(()=>`w-full px-3 py-2 border rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:border-transparent ${M.value?"border-red-500 bg-red-50 focus:ring-red-500 focus:bg-white":f.value?"border-primary-500 bg-white focus:ring-primary-500":"border-gray-300 bg-white hover:border-gray-400 focus:ring-primary-500"} ${x.disabled?"bg-gray-100 text-gray-500 cursor-not-allowed border-gray-200":""} ${x.showCharacterCount&&x.modelValue?"pr-16":""} ${x.inputClass||""}`.trim()),se=r(()=>"w-full px-3 py-2 border border-amber-300 bg-amber-50 rounded-md focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent text-amber-900 placeholder-amber-600"),ne=()=>{if(!x.autoGenerate||!x.organizationName)return k.value="",void(w.value=null);if(x.principalName){const e=$.generateOpportunityName({organization_name:x.organizationName,principal_name:x.principalName,context:x.context,custom_context:x.customContext}),t=$.generateNameTemplate({organization_name:x.organizationName,principal_name:x.principalName,context:x.context,custom_context:x.customContext});k.value=e,w.value=t,h.value||(y("update:modelValue",e),y("update:nameTemplate",t),y("name-generated",e,t))}else if(x.principalData&&x.principalData.length>0){const e=$.generateBatchNamePreviews({organization_name:x.organizationName,principal_data:x.principalData,context:x.context,custom_context:x.customContext});C.value=e,e.length>0&&(k.value=e[0].generated_name,w.value=e[0].name_template),y("batch-names-generated",e)}},ie=e=>{const t=e.target.checked;y("update:autoGenerate",t),t?(ne(),h.value=!1,v.value=""):(k.value="",w.value=null,C.value=[],y("update:nameTemplate",null))},de=e=>{const t=e.target;y("update:modelValue",t.value),y("input",e)},ce=e=>{const t=e.target;v.value=t.value,y("update:modelValue",t.value)},ue=e=>{f.value=!1,y("blur",e)},pe=e=>{f.value=!0,y("focus",e)},me=e=>{!v.value.trim()&&k.value&&y("update:modelValue",k.value)},ge=()=>{h.value=!0,v.value=x.modelValue,p(()=>{const e=document.getElementById(`${B.value}-override`);e?.focus()})},be=()=>{h.value=!1,v.value="",k.value&&y("update:modelValue",k.value)};return a([()=>x.autoGenerate,()=>x.organizationName,()=>x.principalName,()=>x.principalData,()=>x.context,()=>x.customContext],()=>{x.autoGenerate&&ne()},{immediate:!0}),g({focus:()=>{const e=document.getElementById(B.value);e?.focus()},generateName:ne,getPreviewNames:()=>C.value,getNameTemplate:()=>w.value}),(e,t)=>(m(),o("div",_,[l("label",{for:B.value,class:n(j.value)},[i(d(e.label)+" ",1),e.required?(m(),o("span",q,"*")):s("",!0)],10,N),e.description?(m(),o("p",{key:0,id:S.value,class:"text-sm text-gray-600"},d(e.description),9,I)):s("",!0),l("div",D,[l("label",U,[l("input",{type:"checkbox",checked:e.autoGenerate,onChange:ie,class:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"},null,40,T),t[0]||(t[0]=l("span",{class:"text-sm text-gray-700"},"Auto-generate opportunity name",-1))]),t[1]||(t[1]=l("div",{class:"relative group"},[l("svg",{class:"h-4 w-4 text-gray-400 cursor-help",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),l("div",{class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 text-xs text-white bg-gray-900 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap"}," Names follow pattern: Organization - Principal - Context - Month Year ")],-1))]),e.autoGenerate&&k.value?(m(),o("div",E,[l("div",F,[t[4]||(t[4]=l("svg",{class:"h-5 w-5 text-blue-500 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)),l("div",A,[t[3]||(t[3]=l("p",{class:"text-sm font-medium text-blue-900"},"Generated Name Preview:",-1)),l("p",L,d(k.value),1),w.value?(m(),o("p",G,[t[2]||(t[2]=i(" Template: ",-1)),l("span",H,d(w.value),1)])):s("",!0)])])])):s("",!0),e.autoGenerate&&C.value&&C.value.length>1?(m(),o("div",R,[l("div",W,[t[5]||(t[5]=l("svg",{class:"h-5 w-5 text-green-500 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),l("div",J,[l("p",Y," Batch Creation Preview ("+d(C.value.length)+" opportunities): ",1),l("div",K,[(m(!0),o(c,null,u(C.value.slice(0,e.maxPreviewDisplay),e=>(m(),o("div",{key:e.principal_id,class:"text-xs font-mono text-green-700 bg-white bg-opacity-50 rounded px-2 py-1"},d(e.generated_name),1))),128)),C.value.length>e.maxPreviewDisplay?(m(),o("p",X," ... and "+d(C.value.length-e.maxPreviewDisplay)+" more ",1)):s("",!0)])])])])):s("",!0),e.autoGenerate?s("",!0):(m(),o("div",Z,[l("input",{id:B.value,type:"text",name:e.name,placeholder:e.placeholder,disabled:e.disabled,required:e.required,maxlength:e.maxlength,value:e.modelValue,"aria-describedby":z.value,"aria-invalid":M.value,"aria-required":e.required,class:n(P.value),onInput:de,onBlur:ue,onFocus:pe},null,42,Q),e.showCharacterCount&&e.modelValue?(m(),o("div",ee,[l("span",{class:n(["text-xs text-gray-400",{"text-red-500":e.modelValue.length>(e.maxlength||255)}])},d(e.modelValue.length)+d(e.maxlength?`/${e.maxlength}`:""),3)])):s("",!0)])),e.autoGenerate&&!h.value?(m(),o("div",te,[l("button",{type:"button",onClick:ge,class:"text-sm text-primary-600 hover:text-primary-700 focus:outline-none focus:underline"}," Want to customize the name? Click to override ")])):s("",!0),e.autoGenerate&&h.value?(m(),o("div",re,[l("div",{class:"flex items-center justify-between"},[t[6]||(t[6]=l("label",{class:"text-sm font-medium text-gray-700"},"Custom Name Override:",-1)),l("button",{type:"button",onClick:be,class:"text-xs text-gray-500 hover:text-gray-700 focus:outline-none"}," Cancel override ")]),l("input",{id:`${B.value}-override`,type:"text",placeholder:k.value||"Enter custom opportunity name...",value:v.value,maxlength:e.maxlength,class:n(se.value),onInput:ce,onBlur:me},null,42,ae)])):s("",!0),e.error?(m(),o("p",{key:6,id:V.value,role:"alert",class:"text-sm text-danger flex items-center space-x-1"},[t[7]||(t[7]=l("svg",{class:"h-4 w-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),l("span",null,d(e.error),1)],8,oe)):s("",!0),e.helpText&&!e.error?(m(),o("p",{key:7,id:O.value,class:"text-sm text-gray-500"},d(e.helpText),9,le)):s("",!0)]))}}),ne={class:"space-y-1"},ie=["for"],de={key:0,class:"text-danger ml-1","aria-label":"required"},ce=["id"],ue={class:"relative"},pe={class:"flex flex-wrap gap-1 min-h-[2.5rem] items-center p-2"},me={class:"font-medium"},ge=["onClick","aria-label"],be={key:0,class:"text-gray-500 text-sm"},xe={class:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none","aria-hidden":"true"},ye=["aria-labelledby","aria-expanded"],fe={class:"p-2 border-b border-gray-200"},he={class:"max-h-48 overflow-y-auto"},ve=["aria-selected","onClick"],ke={class:"flex items-center"},we=["checked","disabled"],Ce={class:"ml-3 flex-1"},Be={class:"flex items-center justify-between"},$e={class:"font-medium text-gray-900"},Ve={class:"text-xs text-gray-500"},Se={class:"text-sm text-gray-600"},Oe={class:"text-xs text-gray-500"},Me={key:0,class:"px-4 py-6 text-center text-gray-500"},ze={class:"p-2 border-t border-gray-200 flex justify-between"},je={key:1,class:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-md"},Pe={class:"flex items-start space-x-2"},_e={class:"flex-1"},Ne={class:"text-sm text-blue-700 mt-1"},qe={class:"text-sm text-blue-700 mt-2 space-y-1"},Ie=["id"],De=["id"],Ue=e({t:"PrincipalMultiSelect",props:{name:{},label:{},modelValue:{},error:{},placeholder:{default:"Select principals..."},description:{},helpText:{},required:{type:Boolean},disabled:{type:Boolean},showBatchPreview:{type:Boolean,default:!0},baseOpportunityName:{default:"New Opportunity"},containerClass:{},labelClass:{}},emits:["update:modelValue","selection-changed","principal-added","principal-removed"],setup(e,{expose:p,emit:h}){const v=e,k=h,w=z(),C=t(!1),B=t(""),$=t(),V=r(()=>`principal-multiselect-${v.name}`),S=r(()=>`error-${v.name}`),O=r(()=>`desc-${v.name}`),M=r(()=>`help-${v.name}`),j=r(()=>!!v.error),P=r(()=>`block text-sm font-medium transition-colors duration-200 ${j.value?"text-red-700":"text-gray-700"} ${v.disabled?"opacity-60":""} ${v.labelClass||""}`.trim()),_=r(()=>{let e="";return e=j.value?"border-red-500 bg-red-50 focus-within:ring-red-500":C.value?"border-primary-500 bg-white ring-2 ring-primary-500":"border-gray-300 bg-white hover:border-gray-400 focus-within:ring-primary-500",`relative w-full border rounded-md transition-all duration-200 cursor-pointer focus-within:ring-2 focus-within:border-transparent ${e} ${v.disabled?"bg-gray-100 cursor-not-allowed border-gray-200":""} ${v.containerClass||""}`.trim()}),N=r(()=>"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg"),q=r(()=>{if(!B.value)return w.principalOptions;const e=B.value.toLowerCase();return w.principalOptions.filter(t=>t.name.toLowerCase().includes(e)||t.organization_name.toLowerCase().includes(e)||(t.organization_type||"").toLowerCase().includes(e))}),I=e=>v.modelValue.includes(e),D=e=>{const t=w.principalOptions.find(t=>t.id===e);return t?t.name:"Unknown Principal"},U=e=>{const t=w.principalOptions.find(t=>t.id===e);return t?`${v.baseOpportunityName} - ${t.organization_name}`:v.baseOpportunityName},T=()=>{v.disabled||(k("update:modelValue",[]),F([]))},E=()=>{if(v.disabled)return;const e=q.value.map(e=>e.id);k("update:modelValue",e),F(e)},F=e=>{const t=w.principalOptions.filter(t=>e.includes(t.id));k("selection-changed",e,t)},A=()=>{v.disabled||(C.value=!C.value,C.value&&setTimeout(()=>{$.value?.focus()},100))},L=()=>{C.value=!1,B.value=""},G=e=>{const t=e.target,r=document.getElementById(V.value);r&&!r.contains(t)&&L()};return g(async()=>{0===w.principalOptions.length&&await w.fetchPrincipalOptions(),document.addEventListener("click",G)}),b(()=>{document.removeEventListener("click",G)}),a(()=>v.modelValue,e=>{F(e)},{immediate:!0}),p({focus:()=>{const e=document.getElementById(V.value);e?.focus()},openDropdown:()=>{C.value=!0},closeDropdown:L,clearSelection:T,selectAll:E,getSelectedPrincipals:()=>w.principalOptions.filter(e=>v.modelValue.includes(e.id))}),(e,t)=>(m(),o("div",ne,[l("label",{for:V.value,class:n(P.value)},[i(d(e.label)+" ",1),e.required?(m(),o("span",de,"*")):s("",!0)],10,ie),e.description?(m(),o("p",{key:0,id:O.value,class:"text-sm text-gray-600"},d(e.description),9,ce)):s("",!0),l("div",ue,[l("div",{class:n(_.value),onClick:A},[l("div",pe,[(m(!0),o(c,null,u(e.modelValue,e=>(m(),o("div",{key:e,class:"inline-flex items-center gap-1 px-2 py-1 bg-primary-100 text-primary-800 text-sm rounded-md border border-primary-200"},[l("span",me,d(D(e)),1),l("button",{type:"button",onClick:f(t=>(e=>{if(v.disabled)return;const t=v.modelValue.filter(t=>t!==e),r=w.principalOptions.find(t=>t.id===e);k("update:modelValue",t),k("principal-removed",e,r),F(t)})(e),["stop"]),"aria-label":`Remove ${D(e)}`,class:"text-primary-600 hover:text-primary-800 focus:outline-none focus:ring-1 focus:ring-primary-500 rounded"},t[3]||(t[3]=[l("svg",{class:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,ge)]))),128)),0===e.modelValue.length&&e.placeholder?(m(),o("span",be,d(e.placeholder),1)):s("",!0)]),l("div",xe,[(m(),o("svg",{class:n(["h-4 w-4 transition-transform duration-200",C.value?"rotate-180":"",j.value?"text-red-500":"text-gray-400"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},t[4]||(t[4]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))])],2),C.value?(m(),o("div",{key:0,class:n(N.value),role:"listbox","aria-labelledby":V.value,"aria-expanded":C.value},[l("div",fe,[x(l("input",{ref_key:"searchInput",ref:$,"onUpdate:modelValue":t[0]||(t[0]=e=>B.value=e),type:"text",placeholder:"Search principals...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm",onClick:t[1]||(t[1]=f(()=>{},["stop"]))},null,512),[[y,B.value]])]),l("div",he,[(m(!0),o(c,null,u(q.value,r=>{return m(),o("div",{key:r.id,class:n((a=r.id,"px-4 py-2 cursor-pointer transition-colors duration-150 "+(I(a)?"bg-primary-50 text-primary-900":"hover:bg-gray-50 text-gray-900"))),role:"option","aria-selected":I(r.id),onClick:e=>(e=>{if(v.disabled)return;const t=[...v.modelValue],r=t.indexOf(e),a=w.principalOptions.find(t=>t.id===e);r>-1?(t.splice(r,1),k("principal-removed",e,a)):(t.push(e),a&&k("principal-added",e,a)),k("update:modelValue",t),F(t)})(r.id)},[l("div",ke,[l("input",{type:"checkbox",checked:I(r.id),disabled:e.disabled,class:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded",onClick:t[2]||(t[2]=f(()=>{},["stop"]))},null,8,we),l("div",Ce,[l("div",Be,[l("span",$e,d(r.name),1),l("span",Ve,d(r.organization_type||"Unknown"),1)]),l("p",Se,d(r.organization_name),1),l("p",Oe,d(r.available_products.length)+" product"+d(1!==r.available_products.length?"s":"")+" available ",1)])])],10,ve);var a}),128)),0===q.value.length?(m(),o("div",Me,[t[5]||(t[5]=l("svg",{class:"mx-auto h-8 w-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),l("p",null,d(B.value?"No principals found matching your search":"No principals available"),1)])):s("",!0)]),l("div",ze,[l("button",{type:"button",onClick:T,class:"text-sm text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded px-2 py-1"}," Clear All "),l("button",{type:"button",onClick:E,class:"text-sm text-primary-600 hover:text-primary-800 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded px-2 py-1"}," Select All ("+d(q.value.length)+") ",1)])],10,ye)):s("",!0)]),e.modelValue.length>0&&e.showBatchPreview?(m(),o("div",je,[l("div",Pe,[t[8]||(t[8]=l("svg",{class:"h-5 w-5 text-blue-500 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),l("div",_e,[t[7]||(t[7]=l("h4",{class:"text-sm font-medium text-blue-800"},"Batch Opportunity Creation",-1)),l("p",Ne,d(e.modelValue.length)+" opportunities will be created, one for each selected principal: ",1),l("ul",qe,[(m(!0),o(c,null,u(e.modelValue,e=>(m(),o("li",{key:e,class:"flex items-center space-x-2"},[t[6]||(t[6]=l("span",{class:"w-2 h-2 bg-blue-400 rounded-full flex-shrink-0"},null,-1)),l("span",null,d(U(e)),1)]))),128))])])])])):s("",!0),e.error?(m(),o("p",{key:2,id:S.value,role:"alert",class:"text-sm text-danger flex items-center space-x-1"},[t[9]||(t[9]=l("svg",{class:"h-4 w-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),l("span",null,d(e.error),1)],8,Ie)):s("",!0),e.helpText&&!e.error?(m(),o("p",{key:3,id:M.value,class:"text-sm text-gray-500"},d(e.helpText),9,De)):s("",!0)]))}}),Te={class:"space-y-1"},Ee=["for"],Fe={key:0,class:"text-danger ml-1","aria-label":"required"},Ae=["id"],Le={key:1,class:"flex items-center space-x-2 text-xs text-gray-600 bg-gray-50 px-2 py-1 rounded"},Ge={class:"relative"},He=["id","name","disabled","required","value","aria-describedby","aria-invalid","aria-required"],Re={key:0,value:"",disabled:""},We=["disabled"],Je={key:2,value:"",disabled:""},Ye=["label"],Ke=["value","disabled"],Xe=["value","disabled"],Ze={class:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none","aria-hidden":"true"},Qe={key:0,class:"animate-spin h-4 w-4 text-primary-500",fill:"none",viewBox:"0 0 24 24"},et={key:2,class:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded-md"},tt={class:"flex items-start space-x-3"},rt={class:"flex-1"},at={class:"text-sm font-medium text-blue-900"},ot={key:0,class:"text-sm text-blue-700"},lt={class:"text-sm text-blue-700"},st={key:1,class:"mt-1"},nt={class:"text-xs text-blue-600"},it={key:3,class:"mt-2 p-4 bg-gray-50 border border-gray-200 rounded-md text-center"},dt={key:4,class:"text-xs text-gray-500 mt-1"},ct=["id"],ut=["id"],pt=e({t:"ProductSelect",props:{name:{},label:{},modelValue:{},selectedPrincipals:{},error:{},placeholder:{default:"Select a product..."},description:{},helpText:{},required:{type:Boolean},disabled:{type:Boolean},showPrincipalContext:{type:Boolean,default:!0},showProductInfo:{type:Boolean,default:!0},showProductDetails:{type:Boolean,default:!1},showProductCount:{type:Boolean,default:!0},selectClass:{},labelClass:{}},emits:["update:modelValue","blur","focus","change","product-selected","products-filtered"],setup(e,{expose:p,emit:b}){const x=e,y=b,f=j(),h=t(!1),v=t(!1),k=r(()=>`product-select-${x.name}`),w=r(()=>`error-${x.name}`),C=r(()=>`desc-${x.name}`),B=r(()=>`help-${x.name}`),$=r(()=>!!x.error),V=r(()=>{const e=[];return x.description&&e.push(C.value),x.error&&e.push(w.value),x.helpText&&!x.error&&e.push(B.value),e.length>0?e.join(" "):void 0}),S=r(()=>`block text-sm font-medium transition-colors duration-200 ${$.value?"text-red-700":h.value?"text-primary":"text-gray-700"} ${x.disabled?"opacity-60":""} ${x.labelClass||""}`.trim()),O=r(()=>{let e="";return e=$.value?"border-red-500 bg-red-50 focus:ring-red-500 focus:bg-white":x.modelValue&&""!==x.modelValue?"border-green-400 bg-green-50 focus:ring-primary-500 focus:bg-white":h.value?"border-primary-500 bg-white focus:ring-primary-500":"border-gray-300 bg-white hover:border-gray-400 focus:ring-primary-500",`w-full px-3 py-2 pr-10 border rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:border-transparent ${e} ${x.disabled||v.value?"bg-gray-100 text-gray-500 cursor-not-allowed border-gray-200":"cursor-pointer"} ${x.selectClass||""}`.trim()}),M=r(()=>0===x.selectedPrincipals.length?[]:f.getProductsForPrincipals(x.selectedPrincipals)),z=r(()=>x.modelValue&&M.value.find(e=>e.id===x.modelValue)||null),P=r(()=>{const e=new Map;return M.value.forEach(t=>{const r=t.category||"Other";e.has(r)||e.set(r,[]),e.get(r).push(t)}),Array.from(e.entries()).map(([e,t])=>({name:e,label:e,products:t.sort((e,t)=>e.name.localeCompare(t.name))})).sort((e,t)=>"Other"===e.name&&"Other"!==t.name?1:"Other"===t.name&&"Other"!==e.name?-1:e.name.localeCompare(t.name))}),_=async()=>{if(0!==x.selectedPrincipals.length){v.value=!0;try{await f.fetchProductsForPrincipals(x.selectedPrincipals),y("products-filtered",M.value),x.modelValue&&!M.value.find(e=>e.id===x.modelValue)&&(y("update:modelValue",""),y("product-selected","",void 0))}catch(e){}finally{v.value=!1}}},N=e=>{const t=e.target.value;y("update:modelValue",t),y("change",e);const r=M.value.find(e=>e.id===t);y("product-selected",t,r)},q=e=>{h.value=!1,y("blur",e)},I=e=>{h.value=!0,y("focus",e)};return a(()=>x.selectedPrincipals,async(e,t)=>{JSON.stringify(e)!==JSON.stringify(t)&&await _()},{immediate:!0,deep:!0}),g(async()=>{x.selectedPrincipals.length>0&&await _()}),p({focus:()=>{const e=document.getElementById(k.value);e?.focus()},blur:()=>{const e=document.getElementById(k.value);e?.blur()},refresh:_,getSelectedProduct:()=>z.value,getAvailableProducts:()=>M.value,isFiltering:()=>v.value}),(e,t)=>(m(),o("div",Te,[l("label",{for:k.value,class:n(S.value)},[i(d(e.label)+" ",1),e.required?(m(),o("span",Fe,"*")):s("",!0)],10,Ee),e.description?(m(),o("p",{key:0,id:C.value,class:"text-sm text-gray-600"},d(e.description),9,Ae)):s("",!0),e.selectedPrincipals.length>0&&e.showPrincipalContext?(m(),o("div",Le,[t[0]||(t[0]=l("svg",{class:"h-3 w-3 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),l("span",null," Showing products available to "+d(e.selectedPrincipals.length)+" selected principal"+d(1!==e.selectedPrincipals.length?"s":""),1)])):s("",!0),l("div",Ge,[l("select",{id:k.value,name:e.name,disabled:e.disabled||v.value,required:e.required,value:e.modelValue,"aria-describedby":V.value,"aria-invalid":$.value,"aria-required":e.required,class:n(O.value),onChange:N,onBlur:q,onFocus:I},[v.value?(m(),o("option",Re," Loading products... ")):e.placeholder?(m(),o("option",{key:1,value:"",disabled:e.required},d(e.placeholder),9,We)):0===e.selectedPrincipals.length?(m(),o("option",Je," Please select principals first ")):s("",!0),!v.value&&M.value.length>0&&P.value.length>0?(m(!0),o(c,{key:3},u(P.value,t=>(m(),o("optgroup",{key:t.name,label:t.label},[(m(!0),o(c,null,u(t.products,t=>(m(),o("option",{key:t.id,value:t.id,disabled:!t.is_active},[i(d(t.name)+" ",1),e.showProductDetails?(m(),o(c,{key:0},[i(" - "+d(t.category)+" ("+d(t.available_principals.length)+" principal"+d(1!==t.available_principals.length?"s":"")+") ",1)],64)):s("",!0)],8,Ke))),128))],8,Ye))),128)):!v.value&&M.value.length>0?(m(!0),o(c,{key:4},u(M.value,t=>(m(),o("option",{key:t.id,value:t.id,disabled:!t.is_active},[i(d(t.name)+" ",1),e.showProductDetails?(m(),o(c,{key:0},[i(" ("+d(t.available_principals.length)+" principal"+d(1!==t.available_principals.length?"s":"")+") ",1)],64)):s("",!0)],8,Xe))),128)):s("",!0)],42,He),l("div",Ze,[v.value?(m(),o("svg",Qe,t[1]||(t[1]=[l("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),l("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(m(),o("svg",{key:1,class:n(["h-4 w-4 text-gray-400",{"text-red-500":$.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},t[2]||(t[2]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))])]),z.value&&e.showProductInfo?(m(),o("div",et,[l("div",tt,[t[3]||(t[3]=l("div",{class:"flex-shrink-0"},[l("div",{class:"w-2 h-2 bg-blue-400 rounded-full mt-2"})],-1)),l("div",rt,[l("h4",at,d(z.value.name),1),z.value.category?(m(),o("p",ot," Category: "+d(z.value.category),1)):s("",!0),l("p",lt," Available to "+d(z.value.available_principals.length)+" principal"+d(1!==z.value.available_principals.length?"s":""),1),z.value.description?(m(),o("div",st,[l("p",nt,d(z.value.description),1)])):s("",!0)])])])):s("",!0),!v.value&&e.selectedPrincipals.length>0&&0===M.value.length?(m(),o("div",it,t[4]||(t[4]=[l("svg",{class:"mx-auto h-8 w-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2 2v-5m16 0h-2M4 13h2m13-8l-1 1m0 0l-1 1m1-1v4M6 5l1 1v4"})],-1),l("p",{class:"text-sm text-gray-600"}," No products available for the selected principals. ",-1),l("p",{class:"text-xs text-gray-500 mt-1"}," Try selecting different principals or contact your administrator. ",-1)]))):s("",!0),!v.value&&M.value.length>0&&e.showProductCount?(m(),o("div",dt,[i(d(M.value.length)+" product"+d(1!==M.value.length?"s":"")+" available ",1),P.value.length>1?(m(),o(c,{key:0},[i(" across "+d(P.value.length)+" categories ",1)],64)):s("",!0)])):s("",!0),e.error?(m(),o("p",{key:5,id:w.value,role:"alert",class:"text-sm text-danger flex items-center space-x-1"},[t[5]||(t[5]=l("svg",{class:"h-4 w-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),l("span",null,d(e.error),1)],8,ct)):s("",!0),e.helpText&&!e.error?(m(),o("p",{key:6,id:B.value,class:"text-sm text-gray-500"},d(e.helpText),9,ut)):s("",!0)]))}}),mt={class:"space-y-1"},gt=["for"],bt={key:0,class:"text-danger ml-1","aria-label":"required"},xt=["id"],yt={class:"relative"},ft=["id","name","disabled","required","value","aria-describedby","aria-invalid","aria-required"],ht=["disabled"],vt=["value"],kt={class:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none","aria-hidden":"true"},wt={key:1,class:"flex items-center space-x-2 mt-2"},Ct={class:"text-xs text-gray-500"},Bt={key:2,class:"mt-2"},$t={class:"flex justify-between text-xs text-gray-600 mb-1"},Vt={class:"w-full bg-gray-200 rounded-full h-2"},St=["id"],Ot=["id"],Mt=e({t:"StageSelect",props:{name:{},label:{},modelValue:{},error:{},placeholder:{default:"Select opportunity stage..."},description:{},helpText:{},required:{type:Boolean},disabled:{type:Boolean},showStageIndicator:{type:Boolean,default:!0},showProgressBar:{type:Boolean,default:!0},selectClass:{},labelClass:{}},emits:["update:modelValue","blur","focus","change","stage-changed"],setup(e,{expose:a,emit:p}){const g=e,b=p,x=t(!1),y=r(()=>[{value:V.NEW_LEAD,label:"New Lead",progressIcon:"🔍"},{value:V.INITIAL_OUTREACH,label:"Initial Outreach",progressIcon:"📞"},{value:V.SAMPLE_VISIT_OFFERED,label:"Sample/Visit Offered",progressIcon:"📦"},{value:V.AWAITING_RESPONSE,label:"Awaiting Response",progressIcon:"⏳"},{value:V.FEEDBACK_LOGGED,label:"Feedback Logged",progressIcon:"📝"},{value:V.DEMO_SCHEDULED,label:"Demo Scheduled",progressIcon:"🗓️"},{value:V.CLOSED_WON,label:"Closed - Won",progressIcon:"✅"}]),f=r(()=>`stage-select-${g.name}`),v=r(()=>`error-${g.name}`),k=r(()=>`desc-${g.name}`),w=r(()=>`help-${g.name}`),C=r(()=>!!g.error),B=r(()=>{const e=[];return g.description&&e.push(k.value),g.error&&e.push(v.value),g.helpText&&!g.error&&e.push(w.value),e.length>0?e.join(" "):void 0}),$=r(()=>`block text-sm font-medium transition-colors duration-200 ${C.value?"text-red-700":x.value?"text-primary":"text-gray-700"} ${g.disabled?"opacity-60":""} ${g.labelClass||""}`.trim()),O=r(()=>{let e="";if(C.value)e="border-red-500 bg-red-50 focus:ring-red-500 focus:bg-white";else if(g.modelValue&&""!==g.modelValue){const t=z(g.modelValue);e=`border-${t.border} bg-${t.bgLight} focus:ring-${t.ring} focus:bg-white`}else e=x.value?"border-primary-500 bg-white focus:ring-primary-500":"border-gray-300 bg-white hover:border-gray-400 focus:ring-primary-500";return`w-full px-3 py-2 pr-10 border rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:border-transparent ${e} ${g.disabled?"bg-gray-100 text-gray-500 cursor-not-allowed border-gray-200":"cursor-pointer"} ${g.selectClass||""}`.trim()}),M=e=>{const t=y.value.find(t=>t.value===e);return t?t.label:e},z=e=>{const t={[V.NEW_LEAD]:{bg:"bg-gray-500",bgLight:"gray-50",text:"text-gray-700",border:"gray-400",ring:"gray-500"},[V.INITIAL_OUTREACH]:{bg:"bg-blue-500",bgLight:"blue-50",text:"text-blue-700",border:"blue-400",ring:"blue-500"},[V.SAMPLE_VISIT_OFFERED]:{bg:"bg-yellow-500",bgLight:"yellow-50",text:"text-yellow-700",border:"yellow-400",ring:"yellow-500"},[V.AWAITING_RESPONSE]:{bg:"bg-orange-500",bgLight:"orange-50",text:"text-orange-700",border:"orange-400",ring:"orange-500"},[V.FEEDBACK_LOGGED]:{bg:"bg-purple-500",bgLight:"purple-50",text:"text-purple-700",border:"purple-400",ring:"purple-500"},[V.DEMO_SCHEDULED]:{bg:"bg-green-500",bgLight:"green-50",text:"text-green-700",border:"green-400",ring:"green-500"},[V.CLOSED_WON]:{bg:"bg-emerald-500",bgLight:"emerald-50",text:"text-emerald-700",border:"emerald-400",ring:"emerald-500"}};return t[e]||t[V.NEW_LEAD]},j=e=>S[e]||0,P=e=>{const t=[V.NEW_LEAD,V.INITIAL_OUTREACH,V.SAMPLE_VISIT_OFFERED,V.AWAITING_RESPONSE,V.FEEDBACK_LOGGED,V.DEMO_SCHEDULED,V.CLOSED_WON],r=t.indexOf(e);return-1===r?0:Math.round((r+1)/t.length*100)},_=e=>{const t=e.target.value;if(b("update:modelValue",t),b("change",e),t&&""!==t){const e=j(t);b("stage-changed",t,e)}},N=e=>{x.value=!1,b("blur",e)},q=e=>{x.value=!0,b("focus",e)};return a({focus:()=>{const e=document.getElementById(f.value);e?.focus()},blur:()=>{const e=document.getElementById(f.value);e?.blur()},getStageInfo:e=>({label:M(e),colors:z(e),probability:j(e),progress:P(e)})}),(e,t)=>(m(),o("div",mt,[l("label",{for:f.value,class:n($.value)},[i(d(e.label)+" ",1),e.required?(m(),o("span",bt,"*")):s("",!0)],10,gt),e.description?(m(),o("p",{key:0,id:k.value,class:"text-sm text-gray-600"},d(e.description),9,xt)):s("",!0),l("div",yt,[l("select",{id:f.value,name:e.name,disabled:e.disabled,required:e.required,value:e.modelValue,"aria-describedby":B.value,"aria-invalid":C.value,"aria-required":e.required,class:n(O.value),onChange:_,onBlur:N,onFocus:q},[e.placeholder?(m(),o("option",{key:0,value:"",disabled:e.required},d(e.placeholder),9,ht)):s("",!0),(m(!0),o(c,null,u(y.value,e=>(m(),o("option",{key:e.value,value:e.value},d(e.label)+" "+d(e.progressIcon),9,vt))),128))],42,ft),l("div",kt,[(m(),o("svg",{class:n(["h-4 w-4 text-gray-400",{"text-red-500":C.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},t[0]||(t[0]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))])]),e.modelValue&&e.showStageIndicator?(m(),o("div",wt,[l("div",{class:n(["w-3 h-3 rounded-full",z(e.modelValue).bg])},null,2),l("span",{class:n(["text-sm font-medium",z(e.modelValue).text])},d(M(e.modelValue)),3),l("span",Ct," ("+d(j(e.modelValue))+"% typical probability) ",1)])):s("",!0),e.modelValue&&e.showProgressBar?(m(),o("div",Bt,[l("div",$t,[t[1]||(t[1]=l("span",null,"Pipeline Progress",-1)),l("span",null,d(P(e.modelValue))+"%",1)]),l("div",Vt,[l("div",{class:n(["h-2 rounded-full transition-all duration-300",z(e.modelValue).bg]),style:h({width:`${P(e.modelValue)}%`})},null,6)])])):s("",!0),e.error?(m(),o("p",{key:3,id:v.value,role:"alert",class:"text-sm text-danger flex items-center space-x-1"},[t[2]||(t[2]=l("svg",{class:"h-4 w-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),l("span",null,d(e.error),1)],8,St)):s("",!0),e.helpText&&!e.error?(m(),o("p",{key:4,id:w.value,class:"text-sm text-gray-500"},d(e.helpText),9,Ot)):s("",!0)]))}}),zt={class:"opportunity-form-wrapper"},jt={class:"mb-8"},Pt={class:"flex items-center justify-between"},_t={class:"flex items-center space-x-4"},Nt={class:"text-xl font-semibold text-gray-900"},qt={key:0,class:"text-sm text-gray-500"},It={key:0,class:"flex items-center space-x-2 bg-blue-50 px-3 py-1 rounded-full"},Dt={class:"text-sm font-medium text-blue-700"},Ut={key:0,class:"mt-4"},Tt={class:"flex items-center"},Et={key:0,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},Ft={key:1},At={class:"flex mt-2"},Lt={key:0,class:"step-section"},Gt={class:"bg-white rounded-lg border border-gray-200 shadow-sm p-6"},Ht={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Rt={class:"lg:col-span-2"},Wt=["aria-invalid","aria-describedby"],Jt={key:0,id:"org-name-error",class:"mt-1 text-sm text-red-600"},Yt={key:0},Kt={class:"lg:col-span-2"},Xt={key:1,class:"step-section"},Zt={class:"bg-white rounded-lg border border-gray-200 shadow-sm p-6"},Qt={class:"space-y-6"},er={key:2,class:"step-section"},tr={class:"bg-white rounded-lg border border-gray-200 shadow-sm p-6"},rr={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ar={class:"lg:col-span-2"},or={class:"relative"},lr=["min"],sr={class:"lg:col-span-2"},nr={key:3,class:"bg-red-50 border border-red-200 rounded-md p-4"},ir={class:"flex"},dr={class:"mt-1 text-sm text-red-700"},cr={class:"bg-gray-50 rounded-lg p-6"},ur={class:"flex items-center justify-between"},pr={class:"flex items-center space-x-3"},mr={class:"flex items-center space-x-3"},gr=["disabled"],br=["disabled"],xr=["disabled"],yr={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"},fr=P(e({t:"OpportunityFormWrapper",props:{isEditing:{type:Boolean,default:!1},initialData:{},autoSaveInterval:{default:3e4}},emits:["success","cancel","error","draftSaved","dataChanged"],setup(e,{expose:p,emit:h}){const $=e,V=h,S=O(),z=M,j=t(1),P=t(!1),_=t(!1),N=t(null),q=t([]),I=[{label:"Basic Info",key:"basic"},{label:"Principals",key:"principals"},{label:"Details",key:"details"}],D=v({organizationName:"",opportunityName:"",autoGenerateName:!0,context:null,customContext:"",selectedPrincipals:[],selectedProduct:"",stage:"",probabilityPercent:null,expectedCloseDate:null,dealOwner:"",notes:""}),U=t({}),T=r(()=>"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors duration-200"),E=r(()=>"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors duration-200"),F=r(()=>"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors duration-200 resize-vertical"),A=r(()=>(new Date).toISOString().split("T")[0]),L=r(()=>{switch(j.value){case 1:return!(!D.organizationName||!D.opportunityName);case 2:return D.selectedPrincipals.length>0;case 3:return!(!D.selectedProduct||!D.stage);default:return!1}}),G=r(()=>!!(D.organizationName&&D.opportunityName&&D.selectedPrincipals.length>0&&D.selectedProduct&&D.stage)),H=()=>({name:D.opportunityName,organization_id:"temp-id",stage:D.stage,principal_ids:D.selectedPrincipals,product_id:D.selectedProduct,context:D.context,probability_percent:D.probabilityPercent,expected_close_date:D.expectedCloseDate,deal_owner:D.dealOwner,notes:D.notes,auto_generate_name:D.autoGenerateName,name_template:null}),R=()=>{if(1===D.selectedPrincipals.length)return D.selectedPrincipals[0]},W=()=>{if(D.selectedPrincipals.length>1)return D.selectedPrincipals.map(e=>({id:e,name:e}))},J=()=>{const e={};return j.value>=1&&(D.organizationName.trim()||(e.organizationName="Organization name is required"),D.opportunityName.trim()||(e.opportunityName="Opportunity name is required")),j.value>=2&&0===D.selectedPrincipals.length&&(e.selectedPrincipals="At least one principal must be selected"),j.value>=3&&(D.selectedProduct||(e.selectedProduct="Product selection is required"),D.stage||(e.stage="Stage selection is required")),U.value=e,0===Object.keys(e).length},Y=()=>{const e=j.value;j.value=3;const t=J();return j.value=e,t},K=()=>{J()&&j.value<3&&j.value++},X=()=>{j.value>1&&j.value--},Z=(e,t)=>{},Q=e=>{q.value=e},ee=(e,t)=>{},te=(e,t)=>{},re=(e,t)=>{D.probabilityPercent=t},ae=async()=>{if(Y()){P.value=!0,N.value=null;try{if($.isEditing){const e=H();if(await S.updateOpportunity("",e))V("success",{opportunityId:"updated"});else{const e=S.error||"Failed to update opportunity";N.value=e,V("error",e)}}else if(D.selectedPrincipals.length>1){const e=H();if(await S.createBatchOpportunities(e)&&S.batchCreationResult)V("success",{opportunityIds:S.batchCreationResult.created_opportunities.map(e=>e.id),count:S.batchCreationResult.total_created});else{const e=S.error||"Failed to create opportunities";N.value=e,V("error",e)}}else{const e=H();if(await S.createOpportunity(e))V("success",{opportunityId:"created"});else{const e=S.error||"Failed to create opportunity";N.value=e,V("error",e)}}}catch(e){const t=e instanceof Error?e.message:"An unexpected error occurred";N.value=t,V("error",t)}finally{P.value=!1}}},oe=()=>{V("cancel")},le=async()=>{_.value=!0;try{V("draftSaved",{...D}),setTimeout(()=>{_.value=!1},500)}catch(e){_.value=!1}};let ne;return a(()=>({...D}),e=>{V("dataChanged",e)},{deep:!0}),g(()=>{$.initialData&&(Object.assign(D,$.initialData),$.initialData.organizationName&&D.autoGenerateName),$.isEditing&&(j.value=3),!$.isEditing&&$.autoSaveInterval>0&&(ne=setInterval(()=>{G.value&&le()},$.autoSaveInterval))}),b(()=>{ne&&clearInterval(ne)}),p({validateForm:Y,resetForm:()=>{Object.assign(D,{organizationName:"",opportunityName:"",autoGenerateName:!0,context:null,customContext:"",selectedPrincipals:[],selectedProduct:"",stage:"",probabilityPercent:null,expectedCloseDate:null,dealOwner:"",notes:""}),j.value=1,U.value={},N.value=null},goToStep:e=>{e>=1&&e<=3&&(j.value=e)},getFormData:()=>({...D})}),(e,t)=>(m(),o("div",zt,[l("div",jt,[l("div",Pt,[l("div",_t,[l("h2",Nt,d(e.isEditing?"Edit Opportunity":"Create New Opportunity"),1),e.isEditing?s("",!0):(m(),o("div",qt," Step "+d(j.value)+" of "+d(3),1))]),D.selectedPrincipals.length>1?(m(),o("div",It,[t[12]||(t[12]=l("svg",{class:"h-4 w-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),l("span",Dt," Batch Creation ("+d(D.selectedPrincipals.length)+" opportunities) ",1)])):s("",!0)]),e.isEditing?s("",!0):(m(),o("div",Ut,[l("div",Tt,[(m(),o(c,null,u(3,e=>l("div",{key:e,class:"flex items-center"},[l("div",{class:n(["flex items-center justify-center w-8 h-8 rounded-full border-2 text-sm font-medium",e<j.value?"bg-primary-600 border-primary-600 text-white":e===j.value?"bg-white border-primary-600 text-primary-600":"bg-white border-gray-300 text-gray-400"])},[e<j.value?(m(),o("svg",Et,t[13]||(t[13]=[l("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)]))):(m(),o("span",Ft,d(e),1))],2),e<3?(m(),o("div",{key:0,class:n(["w-16 h-0.5 mx-2",e<j.value?"bg-primary-600":"bg-gray-300"])},null,2)):s("",!0)])),64))]),l("div",At,[(m(),o(c,null,u(I,(e,t)=>l("div",{key:t,class:"flex-1 text-center"},[l("div",{class:n(["text-xs font-medium",t+1<=j.value?"text-primary-600":"text-gray-400"])},d(e.label),3)])),64))])]))]),l("form",{onSubmit:f(ae,["prevent"]),class:"space-y-8"},[1===j.value||e.isEditing?(m(),o("div",Lt,[l("div",Gt,[t[18]||(t[18]=l("h3",{class:"text-lg font-medium text-gray-900 mb-6"},[l("span",{class:"flex items-center space-x-2"},[l("span",{class:"w-2 h-2 bg-primary-500 rounded-full"}),l("span",null,"Basic Information")])],-1)),l("div",Ht,[l("div",Rt,[t[14]||(t[14]=l("label",{for:"organization-name",class:"block text-sm font-medium text-gray-700 mb-1"},[i(" Organization Name "),l("span",{class:"text-red-500 ml-1"},"*")],-1)),x(l("input",{id:"organization-name","onUpdate:modelValue":t[0]||(t[0]=e=>D.organizationName=e),type:"text",required:"",placeholder:"Enter organization name...",class:n(T.value),"aria-invalid":!!U.value.organizationName,"aria-describedby":U.value.organizationName?"org-name-error":void 0},null,10,Wt),[[y,D.organizationName]]),U.value.organizationName?(m(),o("p",Jt,d(U.value.organizationName),1)):s("",!0)]),l("div",null,[t[16]||(t[16]=l("label",{for:"context",class:"block text-sm font-medium text-gray-700 mb-1"}," Opportunity Context ",-1)),x(l("select",{id:"context","onUpdate:modelValue":t[1]||(t[1]=e=>D.context=e),class:n(E.value)},t[15]||(t[15]=[w('<option value="" data-v-01a97ad6>Select context...</option><option value="EVENT" data-v-01a97ad6>Event/Trade Show</option><option value="REFERRAL" data-v-01a97ad6>Referral</option><option value="WEBSITE" data-v-01a97ad6>Website Inquiry</option><option value="COLD_OUTREACH" data-v-01a97ad6>Cold Outreach</option><option value="FOLLOW_UP" data-v-01a97ad6>Follow-up</option><option value="CUSTOM" data-v-01a97ad6>Custom</option>',7)]),2),[[k,D.context]])]),D.context===C(z).CUSTOM?(m(),o("div",Yt,[t[17]||(t[17]=l("label",{for:"custom-context",class:"block text-sm font-medium text-gray-700 mb-1"}," Custom Context ",-1)),x(l("input",{id:"custom-context","onUpdate:modelValue":t[2]||(t[2]=e=>D.customContext=e),type:"text",placeholder:"Describe the context...",class:n(T.value)},null,2),[[y,D.customContext]])])):s("",!0),l("div",Kt,[B(se,{name:"opportunity-name",label:"Opportunity Name",modelValue:D.opportunityName,"onUpdate:modelValue":t[3]||(t[3]=e=>D.opportunityName=e),"auto-generate":D.autoGenerateName,"onUpdate:autoGenerate":t[4]||(t[4]=e=>D.autoGenerateName=e),"organization-name":D.organizationName,"principal-name":R(),"principal-data":W(),context:D.context,"custom-context":D.customContext,error:U.value.opportunityName,required:!0,onNameGenerated:Z,onBatchNamesGenerated:Q},null,8,["modelValue","auto-generate","organization-name","principal-name","principal-data","context","custom-context","error"])])])])])):s("",!0),2===j.value||e.isEditing?(m(),o("div",Xt,[l("div",Zt,[t[19]||(t[19]=l("h3",{class:"text-lg font-medium text-gray-900 mb-6"},[l("span",{class:"flex items-center space-x-2"},[l("span",{class:"w-2 h-2 bg-primary-500 rounded-full"}),l("span",null,"Principal Selection")])],-1)),l("div",Qt,[B(Ue,{name:"principals",label:"Select Principals",modelValue:D.selectedPrincipals,"onUpdate:modelValue":t[5]||(t[5]=e=>D.selectedPrincipals=e),error:U.value.selectedPrincipals,required:!0,"show-batch-preview":!0,"base-opportunity-name":D.opportunityName,description:"Choose one or more principals for this opportunity. Multiple selections will create separate opportunities for each principal.",onSelectionChanged:ee},null,8,["modelValue","error","base-opportunity-name"])])])])):s("",!0),3===j.value||e.isEditing?(m(),o("div",er,[l("div",tr,[t[26]||(t[26]=l("h3",{class:"text-lg font-medium text-gray-900 mb-6"},[l("span",{class:"flex items-center space-x-2"},[l("span",{class:"w-2 h-2 bg-primary-500 rounded-full"}),l("span",null,"Product & Details")])],-1)),l("div",rr,[l("div",ar,[B(pt,{name:"product",label:"Product",modelValue:D.selectedProduct,"onUpdate:modelValue":t[6]||(t[6]=e=>D.selectedProduct=e),"selected-principals":D.selectedPrincipals,error:U.value.selectedProduct,required:!0,onProductSelected:te},null,8,["modelValue","selected-principals","error"])]),l("div",null,[B(Mt,{name:"stage",label:"Opportunity Stage",modelValue:D.stage,"onUpdate:modelValue":t[7]||(t[7]=e=>D.stage=e),error:U.value.stage,required:!0,onStageChanged:re},null,8,["modelValue","error"])]),l("div",null,[t[21]||(t[21]=l("label",{for:"probability",class:"block text-sm font-medium text-gray-700 mb-1"}," Success Probability (%) ",-1)),l("div",or,[x(l("input",{id:"probability","onUpdate:modelValue":t[8]||(t[8]=e=>D.probabilityPercent=e),type:"number",min:"0",max:"100",step:"5",placeholder:"0",class:n(T.value)},null,2),[[y,D.probabilityPercent,void 0,{number:!0}]]),t[20]||(t[20]=l("div",{class:"absolute inset-y-0 right-0 flex items-center pr-3"},[l("span",{class:"text-gray-500 text-sm"},"%")],-1))]),t[22]||(t[22]=l("p",{class:"mt-1 text-xs text-gray-500"}," Auto-populated based on stage, but can be customized ",-1))]),l("div",null,[t[23]||(t[23]=l("label",{for:"close-date",class:"block text-sm font-medium text-gray-700 mb-1"}," Expected Close Date ",-1)),x(l("input",{id:"close-date","onUpdate:modelValue":t[9]||(t[9]=e=>D.expectedCloseDate=e),type:"date",min:A.value,class:n(T.value)},null,10,lr),[[y,D.expectedCloseDate]])]),l("div",null,[t[24]||(t[24]=l("label",{for:"deal-owner",class:"block text-sm font-medium text-gray-700 mb-1"}," Deal Owner ",-1)),x(l("input",{id:"deal-owner","onUpdate:modelValue":t[10]||(t[10]=e=>D.dealOwner=e),type:"text",placeholder:"Enter deal owner name...",class:n(T.value)},null,2),[[y,D.dealOwner]])]),l("div",sr,[t[25]||(t[25]=l("label",{for:"notes",class:"block text-sm font-medium text-gray-700 mb-1"}," Notes ",-1)),x(l("textarea",{id:"notes","onUpdate:modelValue":t[11]||(t[11]=e=>D.notes=e),rows:"4",placeholder:"Add any additional notes about this opportunity...",class:n(F.value)},null,2),[[y,D.notes]])])])])])):s("",!0),N.value?(m(),o("div",nr,[l("div",ir,[t[28]||(t[28]=l("svg",{class:"h-5 w-5 text-red-400 mr-3 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),l("div",null,[t[27]||(t[27]=l("h3",{class:"text-sm font-medium text-red-800"},"Error submitting form",-1)),l("p",dr,d(N.value),1)])])])):s("",!0),l("div",cr,[l("div",ur,[l("div",pr,[!e.isEditing&&j.value>1?(m(),o("button",{key:0,type:"button",onClick:X,class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"},t[29]||(t[29]=[l("svg",{class:"-ml-1 mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),i(" Previous ",-1)]))):s("",!0),l("button",{type:"button",onClick:oe,class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," Cancel ")]),l("div",mr,[e.isEditing?s("",!0):(m(),o("button",{key:0,type:"button",onClick:le,disabled:_.value,class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50"},[t[30]||(t[30]=l("svg",{class:"-ml-1 mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"})],-1)),i(" "+d(_.value?"Saving...":"Save Draft"),1)],8,gr)),!e.isEditing&&j.value<3?(m(),o("button",{key:1,type:"button",onClick:K,disabled:!L.value,class:"inline-flex items-center px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed"},t[31]||(t[31]=[i(" Next ",-1),l("svg",{class:"ml-2 -mr-1 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]),8,br)):(m(),o("button",{key:2,type:"submit",disabled:P.value||!G.value,class:"inline-flex items-center px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed"},[P.value?(m(),o("svg",yr,t[32]||(t[32]=[l("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),l("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):s("",!0),i(" "+d(P.value?"Creating...":e.isEditing?"Update Opportunity":D.selectedPrincipals.length>1?`Create ${D.selectedPrincipals.length} Opportunities`:"Create Opportunity"),1)],8,xr))])])])],32)]))}}),[["__scopeId","data-v-01a97ad6"]]);export{fr as O};
