import{d as t,r as e,c as a,w as s,y as r,G as i,N as l,E as o,D as n,C as c,J as d,K as p,W as u,U as m,u as _,Y as h,V as g,F as y,L as x,a1 as f}from"./vue-runtime-Ds28nt_E.js";import{b as v}from"./vue-router-BP51f1Hv.js";import{_ as b}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-XPoggSao.js";import{P as M}from"./PrincipalSelector-Dvq5o6fS.js";import{P as w,a as E}from"./ManagePrincipalProductsButton.vue_vue_type_style_index_0_scoped_f75a9cbf_lang-CSAufz2N.js";import{u as P}from"./principalStore-CYUOJ8eV.js";import"./PrincipalDashboard.vue_vue_type_style_index_0_scoped_daf2c332_lang-CIlJ5ebT.js";import"./supabaseClient-BTp2rsYU.js";/* empty css                                                                       *//* empty css                                                                          */import"./EngagementScoreRing-cnlpP7dh.js";import{E as A,A as L,O as D}from"./OpportunityPipelineChart-laHugPq7.js";/* empty css                                                                                     */import"./opportunityStore-CiHSyBF9.js";/* empty css                                                                       */import{y as S,_ as I,$ as j,u as C,E as k,Y as O,U as N,b as T}from"./heroicons-QXV26b6T.js";import{_ as V}from"./_plugin-vue_export-helper-DYAABpgn.js";import"./dashboardStore-DdRsDBrk.js";import"./pinia-CUC4VGP7.js";import"./productStore-g1VeSLDp.js";import"./organizationStore-BI5YngbF.js";import"./yup-D02u5inE.js";import"./organizationsApi-DhWeLOMq.js";import"./supabase-b_GQhF-l.js";const R={class:"principal-analytics-view"},$={class:"mb-6"},U={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between"},F={class:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3"},H=["disabled"],W={class:"mb-6"},B={key:0,class:"flex items-center justify-center py-12"},K={key:1,class:"text-center py-12"},G={key:2,class:"space-y-6"},z={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},J={class:"bg-white rounded-lg border border-gray-200 p-4"},Y={class:"flex items-center"},q={class:"flex-shrink-0"},X={class:"ml-3"},Q={class:"text-2xl font-bold text-gray-900"},Z={class:"bg-white rounded-lg border border-gray-200 p-4"},tt={class:"flex items-center"},et={class:"flex-shrink-0"},at={class:"ml-3"},st={class:"text-2xl font-bold text-gray-900"},rt={class:"bg-white rounded-lg border border-gray-200 p-4"},it={class:"flex items-center"},lt={class:"flex-shrink-0"},ot={class:"ml-3"},nt={class:"text-2xl font-bold text-gray-900"},ct={class:"bg-white rounded-lg border border-gray-200 p-4"},dt={class:"flex items-center"},pt={class:"flex-shrink-0"},ut={class:"ml-3"},mt={class:"text-2xl font-bold text-gray-900"},_t={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ht={class:"bg-white rounded-lg border border-gray-200 p-6"},gt={class:"h-64"},yt={class:"bg-white rounded-lg border border-gray-200 p-6"},xt={class:"h-64"},ft={class:"bg-white rounded-lg border border-gray-200 p-6"},vt={class:"h-64"},bt={class:"bg-white rounded-lg border border-gray-200 p-6"},Mt={class:"h-64"},wt={class:"bg-white rounded-lg border border-gray-200 p-6"},Et={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Pt={class:"space-y-2"},At={class:"flex-1 min-w-0"},Lt={class:"text-sm font-medium text-gray-900 truncate"},Dt={class:"text-xs text-gray-500"},St={class:"flex-shrink-0 ml-4"},It={key:0,class:"text-center py-4"},jt={class:"space-y-2"},Ct={class:"flex items-center"},kt={class:"text-sm font-medium text-gray-900"},Ot={class:"text-xs text-gray-500"},Nt={class:"text-sm font-semibold text-gray-900"},Tt={key:0,class:"text-center py-4"},Vt={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Rt={class:"flex items-start"},$t={class:"flex-1"},Ut={class:"text-sm text-blue-700 mt-1"},Ft={key:3,class:"bg-red-50 border border-red-200 rounded-lg p-4"},Ht={class:"flex"},Wt={class:"text-sm text-red-700 mt-1"},Bt=V(t({t:"PrincipalAnalyticsView",setup(t){const V=v(),Bt=P(),Kt=e(null),Gt=e("30d"),zt=e(!1),Jt=e(null),Yt=e(null),qt=e(null),Xt=a(()=>Bt.loading),Qt=a(()=>Bt.error),Zt=a(()=>Yt.value?.productPerformance?Yt.value.productPerformance.slice(0,5).sort((t,e)=>(e.product_performance_score||0)-(t.product_performance_score||0)):[]),te=a(()=>Yt.value?.activityBreakdown||[]),ee=a(()=>te.value.reduce((t,e)=>t+e.count,0)),ae=async()=>{if(Kt.value){zt.value=!0,Jt.value=null;try{await new Promise(t=>setTimeout(t,1500)),Yt.value={currentEngagementScore:Math.floor(40*Math.random())+60,totalActivities:Math.floor(200*Math.random())+50,totalPipelineValue:Math.floor(5e5*Math.random())+1e5,winRate:Math.floor(30*Math.random())+40,engagementTrend:se(),activityVolume:re(),productPerformance:ie(),opportunityPipeline:le(),activityBreakdown:[{type:"PHONE_CALL",count:Math.floor(20*Math.random())+10},{type:"EMAIL",count:Math.floor(30*Math.random())+15},{type:"IN_PERSON",count:Math.floor(15*Math.random())+5},{type:"VIDEO_CALL",count:Math.floor(10*Math.random())+3},{type:"SAMPLE_VISIT",count:Math.floor(8*Math.random())+2}]},qt.value={principalName:Kt.value.name,timeRange:Gt.value,totalDataPoints:Yt.value.engagementTrend.length+Yt.value.activityVolume.length+Yt.value.productPerformance.length+Yt.value.opportunityPipeline.length,generatedAt:(new Date).toISOString()}}catch(t){Jt.value=t instanceof Error?t.message:"Failed to load analytics data"}finally{zt.value=!1}}},se=()=>{const t=[];for(let e=("7d"===Gt.value?7:"30d"===Gt.value?30:"90d"===Gt.value?90:365)-1;e>=0;e--){const a=new Date;a.setDate(a.getDate()-e),t.push({date:a.toISOString().split("T")[0],engagement_score:Math.floor(30*Math.random())+55,activity_type:["PHONE_CALL","EMAIL","IN_PERSON","VIDEO_CALL"][Math.floor(4*Math.random())],principal_name:Kt.value?.name||"Principal"})}return t},re=()=>{const t=[];for(let e=("7d"===Gt.value?7:"30d"===Gt.value?30:"90d"===Gt.value?90:365)-1;e>=0;e--){const a=new Date;a.setDate(a.getDate()-e);const s=Math.floor(8*Math.random()),r=[];if(s>0){const t=["PHONE_CALL","EMAIL","IN_PERSON","VIDEO_CALL","SAMPLE_VISIT"],e=Math.min(s,Math.floor(3*Math.random())+1);for(let a=0;a<e;a++){const e=Math.floor(Math.random()*t.length);r.includes(t[e])||r.push(t[e])}}t.push({date:a.toISOString().split("T")[0],count:s,types:r})}return t},ie=()=>["Premium Widget","Standard Package","Enterprise Solution","Basic Service","Advanced Analytics","Custom Integration","Mobile App","Cloud Platform","Security Suite"].map((t,e)=>({principal_id:"mock_principal",principal_name:"Mock Principal",product_id:`prod_${e+1}`,product_name:t,product_category:null,product_sku:`SKU-${e+1}`,is_primary_principal:!0,exclusive_rights:!1,wholesale_price:Math.floor(1e3*Math.random())+100,minimum_order_quantity:Math.floor(100*Math.random())+10,lead_time_days:Math.floor(30*Math.random())+7,contract_start_date:new Date(Date.now()-365*Math.random()*24*60*60*1e3).toISOString(),contract_end_date:new Date(Date.now()+365*Math.random()*24*60*60*1e3).toISOString(),territory_restrictions:null,opportunities_for_product:Math.floor(15*Math.random())+3,won_opportunities_for_product:Math.floor(8*Math.random())+1,active_opportunities_for_product:Math.floor(10*Math.random())+2,latest_opportunity_date:new Date(Date.now()-30*Math.random()*24*60*60*1e3).toISOString(),avg_opportunity_probability:Math.floor(50*Math.random())+25,total_opportunities:Math.floor(15*Math.random())+3,win_rate:Math.floor(50*Math.random())+25,total_value:Math.floor(1e5*Math.random())+5e4,interactions_for_product:Math.floor(20*Math.random())+5,recent_interactions_for_product:Math.floor(5*Math.random())+1,last_interaction_date:new Date(Date.now()-30*Math.random()*24*60*60*1e3).toISOString(),product_is_active:!0,launch_date:new Date(Date.now()-365*Math.random()*24*60*60*1e3).toISOString(),discontinue_date:null,unit_cost:Math.floor(500*Math.random())+50,suggested_retail_price:Math.floor(1500*Math.random())+200,contract_status:"ACTIVE",product_performance_score:Math.floor(40*Math.random())+40,relationship_created_at:new Date(Date.now()-365*Math.random()*24*60*60*1e3).toISOString(),relationship_updated_at:new Date(Date.now()-30*Math.random()*24*60*60*1e3).toISOString()})).slice(0,6),le=()=>{let t=Math.floor(20*Math.random())+15;return["NEW_LEAD","INITIAL_OUTREACH","SAMPLE_VISIT_OFFERED","AWAITING_RESPONSE","FEEDBACK_LOGGED","DEMO_SCHEDULED","CLOSED_WON"].map(e=>{const a=Math.max(1,Math.floor(t*(.6+.3*Math.random()))),s=a*(Math.floor(25e3*Math.random())+15e3);return t=Math.floor(.8*a),{stage:e,count:a,value:s}})},oe=t=>t.toLowerCase().replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase()),ne=async()=>{if(Kt.value&&Yt.value)try{const t={principal:Kt.value,timeRange:Gt.value,analytics:Yt.value,exportedAt:(new Date).toISOString()},e=JSON.stringify(t,null,2),a="data:application/json;charset=utf-8,"+encodeURIComponent(e),s=`principal-analytics-${Kt.value.name.replace(/\s+/g,"-")}-${Gt.value}.json`,r=document.createElement("a");r.setAttribute("href",a),r.setAttribute("download",s),r.click()}catch(t){Jt.value="Failed to export analytics data"}};return s([Kt,Gt],()=>{Kt.value&&ae()},{immediate:!1}),r(async()=>{0===Bt.principals.length&&await Bt.fetchPrincipals();const t=V.params.principalId;if(t){const e=Bt.principals.find(e=>e.id===t);e&&(Kt.value=e)}}),(t,e)=>(o(),i(b,null,{default:l(()=>{return[n("div",R,[n("div",$,[n("div",U,[e[4]||(e[4]=n("div",{class:"mb-4 sm:mb-0"},[n("h1",{class:"text-2xl font-bold text-gray-900"},"Principal Analytics"),n("p",{class:"mt-1 text-sm text-gray-500"}," Comprehensive performance insights and trends ")],-1)),n("div",F,[n("button",{onClick:ne,disabled:zt.value||!Kt.value,class:"inline-flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed min-h-[44px]"},[u(_(S),{class:"h-4 w-4 mr-2"}),e[2]||(e[2]=m(" Export ",-1))],8,H),p(n("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>Gt.value=t),class:"block w-full sm:w-auto px-3 py-2 border border-gray-300 rounded-md shadow-sm text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-h-[44px]"},e[3]||(e[3]=[n("option",{value:"7d"},"Last 7 days",-1),n("option",{value:"30d"},"Last 30 days",-1),n("option",{value:"90d"},"Last 90 days",-1),n("option",{value:"1y"},"Last year",-1)]),512),[[h,Gt.value]])])])]),n("div",W,[u(M,{modelValue:Kt.value,"onUpdate:modelValue":e[1]||(e[1]=t=>Kt.value=t),loading:Xt.value,error:Qt.value,placeholder:"Select a principal to view analytics...",class:"w-full"},null,8,["modelValue","loading","error"])]),zt.value&&Kt.value?(o(),c("div",B,e[5]||(e[5]=[n("div",{class:"text-center"},[n("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),n("p",{class:"mt-4 text-sm text-gray-500"},"Loading analytics data...")],-1)]))):Kt.value?Kt.value?(o(),c("div",G,[n("div",z,[n("div",J,[n("div",Y,[n("div",q,[u(_(j),{class:"h-6 w-6 text-blue-500"})]),n("div",X,[e[8]||(e[8]=n("p",{class:"text-sm font-medium text-gray-500"},"Current Score",-1)),n("p",Q,g(Yt.value?.currentEngagementScore||0),1)])])]),n("div",Z,[n("div",tt,[n("div",et,[u(_(C),{class:"h-6 w-6 text-green-500"})]),n("div",at,[e[9]||(e[9]=n("p",{class:"text-sm font-medium text-gray-500"},"Total Activities",-1)),n("p",st,g(Yt.value?.totalActivities||0),1)])])]),n("div",rt,[n("div",it,[n("div",lt,[u(_(k),{class:"h-6 w-6 text-purple-500"})]),n("div",ot,[e[10]||(e[10]=n("p",{class:"text-sm font-medium text-gray-500"},"Pipeline Value",-1)),n("p",nt,g((t=Yt.value?.totalPipelineValue||0,t>=1e6?`$${(t/1e6).toFixed(1)}M`:t>=1e3?`$${(t/1e3).toFixed(0)}K`:`$${t.toFixed(0)}`)),1)])])]),n("div",ct,[n("div",dt,[n("div",pt,[u(_(O),{class:"h-6 w-6 text-yellow-500"})]),n("div",ut,[e[11]||(e[11]=n("p",{class:"text-sm font-medium text-gray-500"},"Win Rate",-1)),n("p",mt,g(Math.round(Yt.value?.winRate||0))+"% ",1)])])])]),n("div",_t,[n("div",ht,[n("div",gt,[u(_(A),{data:Yt.value?.engagementTrend||[],"time-range":Gt.value,"principal-name":Kt.value?.name,"show-trend-line":!0},null,8,["data","time-range","principal-name"])])]),n("div",yt,[n("div",xt,[u(_(L),{data:Yt.value?.activityVolume||[],"time-range":Gt.value,"principal-name":Kt.value?.name},null,8,["data","time-range","principal-name"])])]),n("div",ft,[n("div",vt,[u(_(w),{data:Yt.value?.productPerformance||[],"principal-name":Kt.value?.name},null,8,["data","principal-name"])])]),n("div",bt,[n("div",Mt,[u(_(D),{data:Yt.value?.opportunityPipeline||[],"principal-name":Kt.value?.name},null,8,["data","principal-name"])])])]),n("div",wt,[e[16]||(e[16]=n("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Key Insights",-1)),n("div",Et,[n("div",null,[e[13]||(e[13]=n("h4",{class:"text-sm font-medium text-gray-700 mb-3"},"Top Performing Products",-1)),n("div",Pt,[(o(!0),c(y,null,x(Zt.value,t=>(o(),c("div",{key:t.product_id,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[n("div",At,[n("p",Lt,g(t.product_name),1),n("p",Dt,g(t.total_opportunities)+" opportunities ",1)]),n("div",St,[u(E,{score:t.product_performance_score||0,size:"sm","show-label":!1},null,8,["score"])])]))),128)),0===Zt.value.length?(o(),c("div",It,e[12]||(e[12]=[n("p",{class:"text-sm text-gray-500"},"No product data available",-1)]))):d("",!0)])]),n("div",null,[e[15]||(e[15]=n("h4",{class:"text-sm font-medium text-gray-700 mb-3"},"Activity Distribution",-1)),n("div",jt,[(o(!0),c(y,null,x(te.value,t=>{return o(),c("div",{key:t.type,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[n("div",Ct,[n("div",{class:"w-3 h-3 rounded-full mr-3",style:f({backgroundColor:(e=t.type,{PHONE_CALL:"#3b82f6",EMAIL:"#10b981",IN_PERSON:"#f59e0b",VIDEO_CALL:"#8b5cf6",SAMPLE_VISIT:"#ef4444",FOLLOW_UP:"#6b7280",OTHER:"#9ca3af"}[e]||"#9ca3af")})},null,4),n("div",null,[n("p",kt,g(oe(t.type)),1),n("p",Ot,g(Math.round(t.count/ee.value*100))+"% of total ",1)])]),n("span",Nt,g(t.count),1)]);var e}),128)),0===te.value.length?(o(),c("div",Tt,e[14]||(e[14]=[n("p",{class:"text-sm text-gray-500"},"No activity data available",-1)]))):d("",!0)])])])]),qt.value?(o(),c("div",Vt,[n("div",Rt,[u(_(N),{class:"h-5 w-5 text-blue-400 mt-0.5 mr-3 flex-shrink-0"}),n("div",$t,[e[17]||(e[17]=n("h4",{class:"text-sm font-medium text-blue-900"},"Export Ready",-1)),n("p",Ut," Analytics data for "+g(Kt.value?.name)+" ("+g(Gt.value)+") is ready for export. Includes "+g(qt.value.totalDataPoints)+" data points across all metrics. ",1)])])])):d("",!0)])):d("",!0):(o(),c("div",K,[u(_(I),{class:"mx-auto h-16 w-16 text-gray-400"}),e[6]||(e[6]=n("h3",{class:"mt-4 text-lg font-medium text-gray-900"},"Principal Analytics",-1)),e[7]||(e[7]=n("p",{class:"mt-2 text-sm text-gray-500"}," Select a principal above to view comprehensive analytics and performance insights. ",-1))])),Jt.value?(o(),c("div",Ft,[n("div",Ht,[u(_(T),{class:"h-5 w-5 text-red-400 mr-3 flex-shrink-0"}),n("div",null,[e[18]||(e[18]=n("h3",{class:"text-sm font-medium text-red-800"},"Error Loading Analytics",-1)),n("p",Wt,g(Jt.value),1),n("button",{onClick:ae,class:"mt-2 text-sm font-medium text-red-800 hover:text-red-900"}," Try again ")])])])):d("",!0)])];var t}),i:1}))}}),[["__scopeId","data-v-9843ad2a"]]);export{Bt as default};
