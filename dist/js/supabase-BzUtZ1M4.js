function t(t){return"object"==typeof t&&null!==t&&"t"in t}function e(t,e,i,s,r,n){return Oe(this,void 0,void 0,function*(){return new Promise((o,a)=>{t(i,((t,e,i,s)=>{const r={method:t,headers:(null==e?void 0:e.headers)||{}};return"GET"===t?r:(r.headers=Object.assign({"Content-Type":"application/json"},null==e?void 0:e.headers),s&&(r.body=JSON.stringify(s)),Object.assign(Object.assign({},r),i))})(e,s,r,n)).then(t=>{if(!t.ok)throw t;return(null==s?void 0:s.noResolveJson)?t:t.json()}).then(t=>o(t)).catch(t=>((t,e,i)=>Oe(void 0,void 0,void 0,function*(){const s=yield(r=void 0,n=function*(){return"undefined"==typeof Response?(yield U(()=>Promise.resolve().then(()=>tt),void 0)).Response:Response},new(r||(r=Promise))(function(t,e){function i(t){try{o(n.next(t))}catch(i){e(i)}}function s(t){try{o(n.throw(t))}catch(i){e(i)}}function o(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r(function(t){t(n)})).then(i,s)}o((n=n.apply(void 0,[])).next())}));var r,n;t instanceof s&&!(null==i?void 0:i.noResolveJson)?t.json().then(i=>{e(new ge(ke(i),t.status||500))}).catch(t=>{e(new _e(ke(t),t))}):e(new _e(ke(t),t))}))(t,a,s))})})}function i(t,i,s,r){return Oe(this,void 0,void 0,function*(){return e(t,"GET",i,s,r)})}function s(t,i,s,r,n){return Oe(this,void 0,void 0,function*(){return e(t,"POST",i,r,n,s)})}function r(t,i,s,r,n){return Oe(this,void 0,void 0,function*(){return e(t,"DELETE",i,r,n,s)})}function n(t){return"object"==typeof t&&null!==t&&"i"in t}function o(t){return n(t)&&"AuthRetryableFetchError"===t.name}function a(t,e,i){if(null!==t)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const t=e.queue>>e.queuedBits-6&63;i(si[t]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const t=e.queue>>e.queuedBits-6&63;i(si[t]),e.queuedBits-=6}}function h(t,e,i){const s=ni[t];if(!(s>-1)){if(-2===s)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)i(e.queue>>e.queuedBits-8&255),e.queuedBits-=8}function l(t){const e=[],i=t=>{e.push(String.fromCodePoint(t))},s={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},n=t=>{!function(t,e,i){if(0===e.utf8seq){if(t<=127)return void i(t);for(let i=1;i<6;i+=1)if(!(t>>7-i&1)){e.utf8seq=i;break}if(2===e.utf8seq)e.codepoint=31&t;else if(3===e.utf8seq)e.codepoint=15&t;else{if(4!==e.utf8seq)throw new Error("Invalid UTF-8 sequence");e.codepoint=7&t}e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|63&t,e.utf8seq-=1,0===e.utf8seq&&i(e.codepoint)}}(t,s,i)};for(let o=0;o<t.length;o+=1)h(t.charCodeAt(o),r,n);return e.join("")}function c(t,e){if(!(t<=127)){if(t<=2047)return e(192|t>>6),void e(128|63&t);if(t<=65535)return e(224|t>>12),e(128|t>>6&63),void e(128|63&t);if(t<=1114111)return e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),void e(128|63&t);throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}e(t)}function u(t){const e=[],i={queue:0,queuedBits:0},s=t=>{e.push(t)};for(let r=0;r<t.length;r+=1)h(t.charCodeAt(r),i,s);return new Uint8Array(e)}function d(t){const e=[],i={queue:0,queuedBits:0},s=t=>{e.push(t)};return t.forEach(t=>a(t,i,s)),a(null,i,s),e.join("")}function f(t){const e=t.split(".");if(3!==e.length)throw new ii("Invalid JWT structure");for(let i=0;i<e.length;i++)if(!qe.test(e[i]))throw new ii("JWT not in base64url format");return{header:JSON.parse(l(e[0])),payload:JSON.parse(l(e[1])),signature:u(e[2]),raw:{header:e[0],payload:e[1]}}}function w(t){return("0"+t.toString(16)).substr(-2)}async function v(t,e,i=!1){const s=function(){const t=new Uint32Array(56);if("undefined"==typeof crypto){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",e=t.length;let i="";for(let s=0;s<56;s++)i+=t.charAt(Math.floor(Math.random()*e));return i}return crypto.getRandomValues(t),Array.from(t,w).join("")}();let r=s;i&&(r+="/PASSWORD_RECOVERY"),await ci(t,`${e}-code-verifier`,r);const n=await async function(t){if("undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder)return t;const e=await async function(t){const e=(new TextEncoder).encode(t),i=await crypto.subtle.digest("SHA-256",e),s=new Uint8Array(i);return Array.from(s).map(t=>String.fromCharCode(t)).join("")}(t);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(s);return[n,s===n?"plain":"s256"]}function y(t){if(!vi.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function p(){return new Proxy({},{get:(t,e)=>{if("__isUserNotAvailableProxy"===e)return!0;if("symbol"==typeof e){const t=e.toString();if("Symbol(Symbol.toPrimitive)"===t||"Symbol(Symbol.toStringTag)"===t||"Symbol(util.inspect.custom)"===t)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${e}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function b(t){return JSON.parse(JSON.stringify(t))}async function m(t){var e,i;if(!("object"==typeof(i=t)&&null!==i&&"status"in i&&"ok"in i&&"json"in i&&"function"==typeof i.json))throw new ti(yi(t),0);if(pi.includes(t.status))throw new ti(yi(t),t.status);let s,r;try{s=await t.json()}catch(o){throw new He(yi(o),o)}const n=function(t){const e=t.headers.get(Me);if(!e)return null;if(!e.match(wi))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch(o){return null}}(t);if(n&&n.getTime()>=Ge.timestamp&&"object"==typeof s&&s&&"string"==typeof s.code?r=s.code:"object"==typeof s&&s&&"string"==typeof s.error_code&&(r=s.error_code),r){if("weak_password"===r)throw new ei(yi(s),t.status,(null===(e=s.weak_password)||void 0===e?void 0:e.reasons)||[]);if("session_not_found"===r)throw new Ke}else if("object"==typeof s&&s&&"object"==typeof s.weak_password&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((t,e)=>t&&"string"==typeof e,!0))throw new ei(yi(s),t.status,s.weak_password.reasons);throw new We(yi(s),t.status||500,r)}async function g(t,e,i,s){var r;const n=Object.assign({},null==s?void 0:s.headers);n[Me]||(n[Me]=Ge.name),(null==s?void 0:s.jwt)&&(n.Authorization=`Bearer ${s.jwt}`);const o=null!==(r=null==s?void 0:s.query)&&void 0!==r?r:{};(null==s?void 0:s.redirectTo)&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",h=await async function(t,e,i,s,r,n){const o=((t,e,i,s)=>{const r={method:t,headers:(null==e?void 0:e.headers)||{}};return"GET"===t?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==e?void 0:e.headers),r.body=JSON.stringify(s),Object.assign(Object.assign({},r),{}))})(e,s,0,n);let a;try{a=await t(i,Object.assign({},o))}catch(h){throw new ti(yi(h),0)}if(a.ok||await m(a),null==s?void 0:s.noResolveJson)return a;try{return await a.json()}catch(h){await m(h)}}(t,e,i+a,{headers:n,noResolveJson:null==s?void 0:s.noResolveJson},0,null==s?void 0:s.body);return(null==s?void 0:s.xform)?null==s?void 0:s.xform(h):{data:Object.assign({},h),error:null}}function _(t){var e;let i=null;var s;return function(t){return t.access_token&&t.refresh_token&&t.expires_in}(t)&&(i=Object.assign({},t),t.expires_at||(i.expires_at=(s=t.expires_in,Math.round(Date.now()/1e3)+s))),{data:{session:i,user:null!==(e=t.user)&&void 0!==e?e:t},error:null}}function $(t){const e=_(t);return!e.error&&t.weak_password&&"object"==typeof t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&"string"==typeof t.weak_password.message&&t.weak_password.reasons.reduce((t,e)=>t&&"string"==typeof e,!0)&&(e.data.weak_password=t.weak_password),e}function j(t){var e;return{data:{user:null!==(e=t.user)&&void 0!==e?e:t},error:null}}function O(t){return{data:t,error:null}}function k(t){const{action_link:e,email_otp:i,hashed_token:s,redirect_to:r,verification_type:n}=t,o=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(t);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(t,s[r])&&(i[s[r]]=t[s[r]])}return i}(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:e,email_otp:i,hashed_token:s,redirect_to:r,verification_type:n},user:Object.assign({},o)},error:null}}function S(t){return t}function E(t={}){return{getItem:e=>t[e]||null,setItem:(e,i)=>{t[e]=i},removeItem:e=>{delete t[e]}}}async function T(t,e,i){const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort()},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,0===e?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async s=>{if(!s){if(0===e)throw new $i(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(gi)try{await globalThis.navigator.locks.query()}catch(r){}return await i()}try{return await i()}finally{}}))}async function x(t,e,i){return await i()}import{g as A,c as I}from"./yup-D02u5inE.js";const P=function(){const t="undefined"!=typeof document&&document.createElement("link").relList;return t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"}(),R={},U=function(t,e,i){function s(t){const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}let r=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),i=(null==t?void 0:t.nonce)||(null==t?void 0:t.getAttribute("nonce"));r=Promise.allSettled(e.map(t=>{if((t=function(t){return"/"+t}(t))in R)return;R[t]=!0;const e=t.endsWith(".css"),s=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${s}`))return;const r=document.createElement("link");return r.rel=e?"stylesheet":P,e||(r.as="script"),r.crossOrigin="",r.href=t,i&&r.setAttribute("nonce",i),document.head.appendChild(r),e?new Promise((e,i)=>{r.addEventListener("load",e),r.addEventListener("error",()=>i(new Error(`Unable to preload CSS for ${t}`)))}):void 0}))}return r.then(e=>{for(const t of e||[])"rejected"===t.status&&s(t.reason);return t().catch(s)})};class N extends Error{constructor(t,e="FunctionsError",i){super(t),this.name=e,this.context=i}}class D extends N{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class C extends N{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class L extends N{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var B,F;(F=B||(B={})).Any="any",F.ApNortheast1="ap-northeast-1",F.ApNortheast2="ap-northeast-2",F.ApSouth1="ap-south-1",F.ApSoutheast1="ap-southeast-1",F.ApSoutheast2="ap-southeast-2",F.CaCentral1="ca-central-1",F.EuCentral1="eu-central-1",F.EuWest1="eu-west-1",F.EuWest2="eu-west-2",F.EuWest3="eu-west-3",F.SaEast1="sa-east-1",F.UsEast1="us-east-1",F.UsWest1="us-west-1",F.UsWest2="us-west-2";class J{constructor(t,{headers:e={},customFetch:i,region:s=B.Any}={}){this.url=t,this.headers=e,this.region=s,this.fetch=(t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>U(async()=>{const{default:t}=await Promise.resolve().then(()=>tt);return{default:t}},void 0).then(({default:e})=>e(...t)):fetch),(...t)=>e(...t)})(i)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,e={}){var i,s,r,n;return s=this,n=function*(){try{const{headers:s,method:r,body:n}=e;let o={},{region:a}=e;a||(a=this.region);const h=new URL(`${this.url}/${t}`);let l;a&&"any"!==a&&(o["x-region"]=a,h.searchParams.set("forceFunctionRegion",a)),n&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&("undefined"!=typeof Blob&&n instanceof Blob||n instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",l=n):"string"==typeof n?(o["Content-Type"]="text/plain",l=n):"undefined"!=typeof FormData&&n instanceof FormData?l=n:(o["Content-Type"]="application/json",l=JSON.stringify(n)));const c=yield this.fetch(h.toString(),{method:r||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),s),body:l}).catch(t=>{throw new D(t)}),u=c.headers.get("x-relay-error");if(u&&"true"===u)throw new C(c);if(!c.ok)throw new L(c);let d,f=(null!==(i=c.headers.get("Content-Type"))&&void 0!==i?i:"text/plain").split(";")[0].trim();return d="application/json"===f?yield c.json():"application/octet-stream"===f?yield c.blob():"text/event-stream"===f?c:"multipart/form-data"===f?yield c.formData():yield c.text(),{data:d,error:null,response:c}}catch(s){return{data:null,error:s,response:s instanceof L||s instanceof C?s.context:void 0}}},new((r=void 0)||(r=Promise))(function(t,e){function i(t){try{a(n.next(t))}catch(i){e(i)}}function o(t){try{a(n.throw(t))}catch(i){e(i)}}function a(e){var s;e.done?t(e.value):(s=e.value,s instanceof r?s:new r(function(t){t(s)})).then(i,o)}a((n=n.apply(s,[])).next())})}}var M={},G={},q={},z={},W={},H={},V=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const K=V.fetch,Y=V.fetch.bind(V),X=V.Headers,Q=V.Request,Z=V.Response,tt=Object.freeze(Object.defineProperty({__proto__:null,Headers:X,Request:Q,Response:Z,default:Y,fetch:K},Symbol.toStringTag,{value:"Module"})),et=A(tt);var it={};Object.defineProperty(it,"o",{value:!0});let st=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};it.default=st;var rt=I&&I.h||function(t){return t&&t.o?t:{default:t}};Object.defineProperty(H,"o",{value:!0});const nt=rt(et),ot=rt(it);H.default=class{constructor(t){this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=t.headers,this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=t.shouldThrowOnError,this.signal=t.signal,this.isMaybeSingle=t.isMaybeSingle,t.fetch?this.fetch=t.fetch:"undefined"==typeof fetch?this.fetch=nt.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=Object.assign({},this.headers),this.headers[t]=e,this}then(t,e){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let i=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async t=>{var e,i,s;let r=null,n=null,o=null,a=t.status,h=t.statusText;if(t.ok){if("HEAD"!==this.method){const e=await t.text();""===e||(n="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?e:JSON.parse(e))}const s=null===(e=this.headers.Prefer)||void 0===e?void 0:e.match(/count=(exact|planned|estimated)/),l=null===(i=t.headers.get("content-range"))||void 0===i?void 0:i.split("/");s&&l&&l.length>1&&(o=parseInt(l[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(n)&&(n.length>1?(r={code:"PGRST116",details:`Results contain ${n.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},n=null,o=null,a=406,h="Not Acceptable"):n=1===n.length?n[0]:null)}else{const e=await t.text();try{r=JSON.parse(e),Array.isArray(r)&&404===t.status&&(n=[],r=null,a=200,h="OK")}catch(l){404===t.status&&""===e?(a=204,h="No Content"):r={message:e}}if(r&&this.isMaybeSingle&&(null===(s=null==r?void 0:r.details)||void 0===s?void 0:s.includes("0 rows"))&&(r=null,a=200,h="OK"),r&&this.shouldThrowOnError)throw new ot.default(r)}return{error:r,data:n,count:o,status:a,statusText:h}});return this.shouldThrowOnError||(i=i.catch(t=>{var e,i,s;return{error:{message:`${null!==(e=null==t?void 0:t.name)&&void 0!==e?e:"FetchError"}: ${null==t?void 0:t.message}`,details:`${null!==(i=null==t?void 0:t.stack)&&void 0!==i?i:""}`,hint:"",code:`${null!==(s=null==t?void 0:t.code)&&void 0!==s?s:""}`},data:null,count:null,status:0,statusText:""}})),i.then(t,e)}returns(){return this}overrideTypes(){return this}};var at=I&&I.h||function(t){return t&&t.o?t:{default:t}};Object.defineProperty(W,"o",{value:!0});const ht=at(H);let lt=class extends ht.default{select(t){let e=!1;const i=(null!=t?t:"*").split("").map(t=>/\s/.test(t)&&!e?"":('"'===t&&(e=!e),t)).join("");return this.url.searchParams.set("select",i),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(t,{ascending:e=!0,nullsFirst:i,foreignTable:s,referencedTable:r=s}={}){const n=r?`${r}.order`:"order",o=this.url.searchParams.get(n);return this.url.searchParams.set(n,`${o?`${o},`:""}${t}.${e?"asc":"desc"}${void 0===i?"":i?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:i=e}={}){const s=void 0===i?"limit":`${i}.limit`;return this.url.searchParams.set(s,`${t}`),this}range(t,e,{foreignTable:i,referencedTable:s=i}={}){const r=void 0===s?"offset":`${s}.offset`,n=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${t}`),this.url.searchParams.set(n,""+(e-t+1)),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:t=!1,verbose:e=!1,settings:i=!1,buffers:s=!1,wal:r=!1,format:n="text"}={}){var o;const a=[t?"analyze":null,e?"verbose":null,i?"settings":null,s?"buffers":null,r?"wal":null].filter(Boolean).join("|"),h=null!==(o=this.headers.Accept)&&void 0!==o?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${n}; for="${h}"; options=${a};`,this}rollback(){var t;return(null!==(t=this.headers.Prefer)&&void 0!==t?t:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};W.default=lt;var ct=I&&I.h||function(t){return t&&t.o?t:{default:t}};Object.defineProperty(z,"o",{value:!0});const ut=ct(W);let dt=class extends ut.default{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}in(t,e){const i=Array.from(new Set(e)).map(t=>"string"==typeof t&&new RegExp("[,()]").test(t)?`"${t}"`:`${t}`).join(",");return this.url.searchParams.append(t,`in.(${i})`),this}contains(t,e){return"string"==typeof e?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return"string"==typeof e?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return"string"==typeof e?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:i,type:s}={}){let r="";"plain"===s?r="pl":"phrase"===s?r="ph":"websearch"===s&&(r="w");const n=void 0===i?"":`(${i})`;return this.url.searchParams.append(t,`${r}fts${n}.${e}`),this}match(t){return Object.entries(t).forEach(([t,e])=>{this.url.searchParams.append(t,`eq.${e}`)}),this}not(t,e,i){return this.url.searchParams.append(t,`not.${e}.${i}`),this}or(t,{foreignTable:e,referencedTable:i=e}={}){const s=i?`${i}.or`:"or";return this.url.searchParams.append(s,`(${t})`),this}filter(t,e,i){return this.url.searchParams.append(t,`${e}.${i}`),this}};z.default=dt;var ft=I&&I.h||function(t){return t&&t.o?t:{default:t}};Object.defineProperty(q,"o",{value:!0});const wt=ft(z);q.default=class{constructor(t,{headers:e={},schema:i,fetch:s}){this.url=t,this.headers=e,this.schema=i,this.fetch=s}select(t,{head:e=!1,count:i}={}){const s=e?"HEAD":"GET";let r=!1;const n=(null!=t?t:"*").split("").map(t=>/\s/.test(t)&&!r?"":('"'===t&&(r=!r),t)).join("");return this.url.searchParams.set("select",n),i&&(this.headers.Prefer=`count=${i}`),new wt.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(t,{count:e,defaultToNull:i=!0}={}){const s=[];if(this.headers.Prefer&&s.push(this.headers.Prefer),e&&s.push(`count=${e}`),i||s.push("missing=default"),this.headers.Prefer=s.join(","),Array.isArray(t)){const e=t.reduce((t,e)=>t.concat(Object.keys(e)),[]);if(e.length>0){const t=[...new Set(e)].map(t=>`"${t}"`);this.url.searchParams.set("columns",t.join(","))}}return new wt.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}upsert(t,{onConflict:e,ignoreDuplicates:i=!1,count:s,defaultToNull:r=!0}={}){const n=[`resolution=${i?"ignore":"merge"}-duplicates`];if(void 0!==e&&this.url.searchParams.set("on_conflict",e),this.headers.Prefer&&n.push(this.headers.Prefer),s&&n.push(`count=${s}`),r||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(t)){const e=t.reduce((t,e)=>t.concat(Object.keys(e)),[]);if(e.length>0){const t=[...new Set(e)].map(t=>`"${t}"`);this.url.searchParams.set("columns",t.join(","))}}return new wt.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}update(t,{count:e}={}){const i=[];return this.headers.Prefer&&i.push(this.headers.Prefer),e&&i.push(`count=${e}`),this.headers.Prefer=i.join(","),new wt.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}delete({count:t}={}){const e=[];return t&&e.push(`count=${t}`),this.headers.Prefer&&e.unshift(this.headers.Prefer),this.headers.Prefer=e.join(","),new wt.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};var vt={},yt={};Object.defineProperty(yt,"o",{value:!0}),yt.version=void 0,yt.version="0.0.0-automated",Object.defineProperty(vt,"o",{value:!0}),vt.DEFAULT_HEADERS=void 0;const pt=yt;vt.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${pt.version}`};var bt=I&&I.h||function(t){return t&&t.o?t:{default:t}};Object.defineProperty(G,"o",{value:!0});const mt=bt(q),gt=bt(z),_t=vt;G.default=class t{constructor(t,{headers:e={},schema:i,fetch:s}={}){this.url=t,this.headers=Object.assign(Object.assign({},_t.DEFAULT_HEADERS),e),this.schemaName=i,this.fetch=s}from(t){const e=new URL(`${this.url}/${t}`);return new mt.default(e,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new t(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(t,e={},{head:i=!1,get:s=!1,count:r}={}){let n;const o=new URL(`${this.url}/rpc/${t}`);let a;i||s?(n=i?"HEAD":"GET",Object.entries(e).filter(([t,e])=>void 0!==e).map(([t,e])=>[t,Array.isArray(e)?`{${e.join(",")}}`:`${e}`]).forEach(([t,e])=>{o.searchParams.append(t,e)})):(n="POST",a=e);const h=Object.assign({},this.headers);return r&&(h.Prefer=`count=${r}`),new gt.default({method:n,url:o,headers:h,schema:this.schemaName,body:a,fetch:this.fetch,allowEmpty:!1})}};var $t=I&&I.h||function(t){return t&&t.o?t:{default:t}};Object.defineProperty(M,"o",{value:!0}),M.PostgrestError=M.PostgrestBuilder=M.PostgrestTransformBuilder=M.PostgrestFilterBuilder=M.PostgrestQueryBuilder=M.PostgrestClient=void 0;const jt=$t(G);M.PostgrestClient=jt.default;const Ot=$t(q);M.PostgrestQueryBuilder=Ot.default;const kt=$t(z);M.PostgrestFilterBuilder=kt.default;const St=$t(W);M.PostgrestTransformBuilder=St.default;const Et=$t(H);M.PostgrestBuilder=Et.default;const Tt=$t(it);M.PostgrestError=Tt.default;var xt=M.default={PostgrestClient:jt.default,PostgrestQueryBuilder:Ot.default,PostgrestFilterBuilder:kt.default,PostgrestTransformBuilder:St.default,PostgrestBuilder:Et.default,PostgrestError:Tt.default};const{PostgrestClient:At,PostgrestQueryBuilder:It,PostgrestFilterBuilder:Pt,PostgrestTransformBuilder:Rt,PostgrestBuilder:Ut,PostgrestError:Nt}=xt,Dt=function(){if("undefined"!=typeof WebSocket)return WebSocket;if(void 0!==global.WebSocket)return global.WebSocket;if(void 0!==window.WebSocket)return window.WebSocket;if(void 0!==self.WebSocket)return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}();var Ct,Lt,Bt,Ft,Jt,Mt,Gt,qt,zt,Wt,Ht;(Lt=Ct||(Ct={}))[Lt.connecting=0]="connecting",Lt[Lt.open=1]="open",Lt[Lt.closing=2]="closing",Lt[Lt.closed=3]="closed",(Ft=Bt||(Bt={})).closed="closed",Ft.errored="errored",Ft.joined="joined",Ft.joining="joining",Ft.leaving="leaving",(Mt=Jt||(Jt={})).close="phx_close",Mt.error="phx_error",Mt.join="phx_join",Mt.reply="phx_reply",Mt.leave="phx_leave",Mt.access_token="access_token",(Gt||(Gt={})).websocket="websocket",(zt=qt||(qt={})).Connecting="connecting",zt.Open="open",zt.Closing="closing",zt.Closed="closed";class Vt{constructor(){this.HEADER_LENGTH=1}decode(t,e){return t.constructor===ArrayBuffer?e(this.l(t)):e("string"==typeof t?JSON.parse(t):{})}l(t){const e=new DataView(t),i=new TextDecoder;return this.u(t,e,i)}u(t,e,i){const s=e.getUint8(1),r=e.getUint8(2);let n=this.HEADER_LENGTH+2;const o=i.decode(t.slice(n,n+s));n+=s;const a=i.decode(t.slice(n,n+r));return n+=r,{ref:null,topic:o,event:a,payload:JSON.parse(i.decode(t.slice(n,t.byteLength)))}}}class Kt{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(Ht=Wt||(Wt={})).abstime="abstime",Ht.bool="bool",Ht.date="date",Ht.daterange="daterange",Ht.float4="float4",Ht.float8="float8",Ht.int2="int2",Ht.int4="int4",Ht.int4range="int4range",Ht.int8="int8",Ht.int8range="int8range",Ht.json="json",Ht.jsonb="jsonb",Ht.money="money",Ht.numeric="numeric",Ht.oid="oid",Ht.reltime="reltime",Ht.text="text",Ht.time="time",Ht.timestamp="timestamp",Ht.timestamptz="timestamptz",Ht.timetz="timetz",Ht.tsrange="tsrange",Ht.tstzrange="tstzrange";const Yt=(t,e,i={})=>{var s;const r=null!==(s=i.skipTypes)&&void 0!==s?s:[];return Object.keys(e).reduce((i,s)=>(i[s]=Xt(s,t,e,r),i),{})},Xt=(t,e,i,s)=>{const r=e.find(e=>e.name===t),n=null==r?void 0:r.type,o=i[t];return n&&!s.includes(n)?Qt(n,o):Zt(o)},Qt=(t,e)=>{if("_"===t.charAt(0)){const i=t.slice(1,t.length);return se(e,i)}switch(t){case Wt.bool:return te(e);case Wt.float4:case Wt.float8:case Wt.int2:case Wt.int4:case Wt.int8:case Wt.numeric:case Wt.oid:return ee(e);case Wt.json:case Wt.jsonb:return ie(e);case Wt.timestamp:return re(e);case Wt.abstime:case Wt.date:case Wt.daterange:case Wt.int4range:case Wt.int8range:case Wt.money:case Wt.reltime:case Wt.text:case Wt.time:case Wt.timestamptz:case Wt.timetz:case Wt.tsrange:case Wt.tstzrange:default:return Zt(e)}},Zt=t=>t,te=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},ee=t=>{if("string"==typeof t){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},ie=t=>{if("string"==typeof t)try{return JSON.parse(t)}catch(e){return t}return t},se=(t,e)=>{if("string"!=typeof t)return t;const i=t.length-1,s=t[i];if("{"===t[0]&&"}"===s){let s;const n=t.slice(1,i);try{s=JSON.parse("["+n+"]")}catch(r){s=n?n.split(","):[]}return s.map(t=>Qt(e,t))}return t},re=t=>"string"==typeof t?t.replace(" ","T"):t,ne=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class oe{constructor(t,e,i={},s=1e4){this.channel=t,this.event=e,this.payload=i,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this.v(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this.p("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel.m()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var i;return this.p(t)&&e(null===(i=this.receivedResp)||void 0===i?void 0:i.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._(),this.refEvent=this.channel.$(this.ref),this.channel.j(this.refEvent,{},t=>{this.v(),this.O(),this.receivedResp=t,this.k(t)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(t,e){this.refEvent&&this.channel.S(this.refEvent,{status:t,response:e})}destroy(){this.v(),this.O()}v(){this.refEvent&&this.channel.T(this.refEvent,{})}O(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}k({status:t,response:e}){this.recHooks.filter(e=>e.status===t).forEach(t=>t.callback(e))}p(t){return this.receivedResp&&this.receivedResp.status===t}}var ae,he,le,ce,ue,de,fe,we;(he=ae||(ae={})).SYNC="sync",he.JOIN="join",he.LEAVE="leave";class ve{constructor(t,e){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const i=(null==e?void 0:e.events)||{state:"presence_state",diff:"presence_diff"};this.channel.j(i.state,{},t=>{const{onJoin:e,onLeave:i,onSync:s}=this.caller;this.joinRef=this.channel.m(),this.state=ve.syncState(this.state,t,e,i),this.pendingDiffs.forEach(t=>{this.state=ve.syncDiff(this.state,t,e,i)}),this.pendingDiffs=[],s()}),this.channel.j(i.diff,{},t=>{const{onJoin:e,onLeave:i,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(t):(this.state=ve.syncDiff(this.state,t,e,i),s())}),this.onJoin((t,e,i)=>{this.channel.S("presence",{event:"join",key:t,currentPresences:e,newPresences:i})}),this.onLeave((t,e,i)=>{this.channel.S("presence",{event:"leave",key:t,currentPresences:e,leftPresences:i})}),this.onSync(()=>{this.channel.S("presence",{event:"sync"})})}static syncState(t,e,i,s){const r=this.cloneDeep(t),n=this.transformState(e),o={},a={};return this.map(r,(t,e)=>{n[t]||(a[t]=e)}),this.map(n,(t,e)=>{const i=r[t];if(i){const s=e.map(t=>t.presence_ref),r=i.map(t=>t.presence_ref),n=e.filter(t=>r.indexOf(t.presence_ref)<0),h=i.filter(t=>s.indexOf(t.presence_ref)<0);n.length>0&&(o[t]=n),h.length>0&&(a[t]=h)}else o[t]=e}),this.syncDiff(r,{joins:o,leaves:a},i,s)}static syncDiff(t,e,i,s){const{joins:r,leaves:n}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return i||(i=()=>{}),s||(s=()=>{}),this.map(r,(e,s)=>{var r;const n=null!==(r=t[e])&&void 0!==r?r:[];if(t[e]=this.cloneDeep(s),n.length>0){const i=t[e].map(t=>t.presence_ref),s=n.filter(t=>i.indexOf(t.presence_ref)<0);t[e].unshift(...s)}i(e,n,s)}),this.map(n,(e,i)=>{let r=t[e];if(!r)return;const n=i.map(t=>t.presence_ref);r=r.filter(t=>n.indexOf(t.presence_ref)<0),t[e]=r,s(e,r,i),0===r.length&&delete t[e]}),t}static map(t,e){return Object.getOwnPropertyNames(t).map(i=>e(i,t[i]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((e,i)=>{const s=t[i];return e[i]="metas"in s?s.metas.map(t=>(t.presence_ref=t.phx_ref,delete t.phx_ref,delete t.phx_ref_prev,t)):s,e},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel.m()}}(ce=le||(le={})).ALL="*",ce.INSERT="INSERT",ce.UPDATE="UPDATE",ce.DELETE="DELETE",(de=ue||(ue={})).BROADCAST="broadcast",de.PRESENCE="presence",de.POSTGRES_CHANGES="postgres_changes",de.SYSTEM="system",(we=fe||(fe={})).SUBSCRIBED="SUBSCRIBED",we.TIMED_OUT="TIMED_OUT",we.CLOSED="CLOSED",we.CHANNEL_ERROR="CHANNEL_ERROR";class ye{constructor(t,e={config:{}},i){this.topic=t,this.params=e,this.socket=i,this.bindings={},this.state=Bt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new oe(this,Jt.join,this.params,this.timeout),this.rejoinTimer=new Kt(()=>this.A(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Bt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(t=>t.send()),this.pushBuffer=[]}),this.I(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this.m()}`),this.state=Bt.closed,this.socket.P(this)}),this.R(t=>{this.U()||this.N()||(this.socket.log("channel",`error ${this.topic}`,t),this.state=Bt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this.D()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Bt.errored,this.rejoinTimer.scheduleTimeout())}),this.j(Jt.reply,{},(t,e)=>{this.S(this.$(e),t)}),this.presence=new ve(this),this.broadcastEndpointURL=ne(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(t,e=this.timeout){var i,s;if(this.socket.isConnected()||this.socket.connect(),this.state==Bt.closed){const{config:{broadcast:r,presence:n,private:o}}=this.params;this.R(e=>null==t?void 0:t(fe.CHANNEL_ERROR,e)),this.I(()=>null==t?void 0:t(fe.CLOSED));const a={},h={broadcast:r,presence:n,postgres_changes:null!==(s=null===(i=this.bindings.postgres_changes)||void 0===i?void 0:i.map(t=>t.filter))&&void 0!==s?s:[],private:o};this.socket.accessTokenValue&&(a.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:h},a)),this.joinedOnce=!0,this.C(e),this.joinPush.receive("ok",async({postgres_changes:e})=>{var i;if(this.socket.setAuth(),void 0!==e){const s=this.bindings.postgres_changes,r=null!==(i=null==s?void 0:s.length)&&void 0!==i?i:0,n=[];for(let i=0;i<r;i++){const r=s[i],{filter:{event:o,schema:a,table:h,filter:l}}=r,c=e&&e[i];if(!c||c.event!==o||c.schema!==a||c.table!==h||c.filter!==l)return this.unsubscribe(),this.state=Bt.errored,void(null==t||t(fe.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));n.push(Object.assign(Object.assign({},r),{id:c.id}))}return this.bindings.postgres_changes=n,void(t&&t(fe.SUBSCRIBED))}null==t||t(fe.SUBSCRIBED)}).receive("error",e=>{this.state=Bt.errored,null==t||t(fe.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(e).join(", ")||"error")))}).receive("timeout",()=>{null==t||t(fe.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,e={}){return await this.send({type:"presence",event:"track",payload:t},e.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,e,i){return this.j(t,e,i)}async send(t,e={}){var i,s;if(this.L()||"broadcast"!==t.type)return new Promise(i=>{var s,r,n;const o=this.B(t.type,t,e.timeout||this.timeout);"broadcast"!==t.type||(null===(n=null===(r=null===(s=this.params)||void 0===s?void 0:s.config)||void 0===r?void 0:r.broadcast)||void 0===n?void 0:n.ack)||i("ok"),o.receive("ok",()=>i("ok")),o.receive("error",()=>i("error")),o.receive("timeout",()=>i("timed out"))});{const{event:n,payload:o}=t,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:o,private:this.private}]})};try{const t=await this.F(this.broadcastEndpointURL,a,null!==(i=e.timeout)&&void 0!==i?i:this.timeout);return await(null===(s=t.body)||void 0===s?void 0:s.cancel()),t.ok?"ok":"error"}catch(r){return"AbortError"===r.name?"timed out":"error"}}}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Bt.leaving;const e=()=>{this.socket.log("channel",`leave ${this.topic}`),this.S(Jt.close,"leave",this.m())};this.joinPush.destroy();let i=null;return new Promise(s=>{i=new oe(this,Jt.leave,{},t),i.receive("ok",()=>{e(),s("ok")}).receive("timeout",()=>{e(),s("timed out")}).receive("error",()=>{s("error")}),i.send(),this.L()||i.trigger("ok",{})}).finally(()=>{null==i||i.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async F(t,e,i){const s=new AbortController,r=setTimeout(()=>s.abort(),i),n=await this.socket.fetch(t,Object.assign(Object.assign({},e),{signal:s.signal}));return clearTimeout(r),n}B(t,e,i=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new oe(this,t,e,i);return this.L()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}J(t,e,i){return e}M(t){return this.topic===t}m(){return this.joinPush.ref}S(t,e,i){var s,r;const n=t.toLocaleLowerCase(),{close:o,error:a,leave:h,join:l}=Jt;if(i&&[o,a,h,l].indexOf(n)>=0&&i!==this.m())return;let c=this.J(n,e,i);if(e&&!c)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(n)?null===(s=this.bindings.postgres_changes)||void 0===s||s.filter(t=>{var e,i,s;return"*"===(null===(e=t.filter)||void 0===e?void 0:e.event)||(null===(s=null===(i=t.filter)||void 0===i?void 0:i.event)||void 0===s?void 0:s.toLocaleLowerCase())===n}).map(t=>t.callback(c,i)):null===(r=this.bindings[n])||void 0===r||r.filter(t=>{var i,s,r,o,a,h;if(["broadcast","presence","postgres_changes"].includes(n)){if("id"in t){const n=t.id,o=null===(i=t.filter)||void 0===i?void 0:i.event;return n&&(null===(s=e.ids)||void 0===s?void 0:s.includes(n))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(r=e.data)||void 0===r?void 0:r.type.toLocaleLowerCase()))}{const i=null===(a=null===(o=null==t?void 0:t.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===i||i===(null===(h=null==e?void 0:e.event)||void 0===h?void 0:h.toLocaleLowerCase())}}return t.type.toLocaleLowerCase()===n}).map(t=>{if("object"==typeof c&&"ids"in c){const t=c.data,{schema:e,table:i,commit_timestamp:s,type:r,errors:n}=t,o={schema:e,table:i,commit_timestamp:s,eventType:r,new:{},old:{},errors:n};c=Object.assign(Object.assign({},o),this.G(t))}t.callback(c,i)})}N(){return this.state===Bt.closed}q(){return this.state===Bt.joined}D(){return this.state===Bt.joining}U(){return this.state===Bt.leaving}$(t){return`chan_reply_${t}`}j(t,e,i){const s=t.toLocaleLowerCase(),r={type:s,filter:e,callback:i};return this.bindings[s]?this.bindings[s].push(r):this.bindings[s]=[r],this}T(t,e){const i=t.toLocaleLowerCase();return this.bindings[i]=this.bindings[i].filter(t=>{var s;return!((null===(s=t.type)||void 0===s?void 0:s.toLocaleLowerCase())===i&&ye.isEqual(t.filter,e))}),this}static isEqual(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(t[i]!==e[i])return!1;return!0}A(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.C()}I(t){this.j(Jt.close,{},t)}R(t){this.j(Jt.error,{},e=>t(e))}L(){return this.socket.isConnected()&&this.q()}C(t=this.timeout){this.U()||(this.socket.W(this.topic),this.state=Bt.joining,this.joinPush.resend(t))}G(t){const e={new:{},old:{}};return"INSERT"!==t.type&&"UPDATE"!==t.type||(e.new=Yt(t.columns,t.record)),"UPDATE"!==t.type&&"DELETE"!==t.type||(e.old=Yt(t.columns,t.old_record)),e}}const pe=()=>{};class be{constructor(t,e){var i;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=pe,this.ref=0,this.logger=pe,this.conn=null,this.sendBuffer=[],this.serializer=new Vt,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this.H=t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>U(async()=>{const{default:t}=await Promise.resolve().then(()=>tt);return{default:t}},void 0).then(({default:e})=>e(...t)):fetch),(...t)=>e(...t)},this.endPoint=`${t}/${Gt.websocket}`,this.httpEndpoint=ne(t),(null==e?void 0:e.transport)?this.transport=e.transport:this.transport=null,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.timeout)&&(this.timeout=e.timeout),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),(null==e?void 0:e.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=e.heartbeatIntervalMs);const s=null===(i=null==e?void 0:e.params)||void 0===i?void 0:i.apikey;if(s&&(this.accessTokenValue=s,this.apiKey=s),this.reconnectAfterMs=(null==e?void 0:e.reconnectAfterMs)?e.reconnectAfterMs:t=>[1e3,2e3,5e3,1e4][t-1]||1e4,this.encode=(null==e?void 0:e.encode)?e.encode:(t,e)=>e(JSON.stringify(t)),this.decode=(null==e?void 0:e.decode)?e.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Kt(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this.H(null==e?void 0:e.fetch),null==e?void 0:e.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(null==e?void 0:e.worker)||!1,this.workerUrl=null==e?void 0:e.workerUrl}this.accessToken=(null==e?void 0:e.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=Dt),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this.V(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(t,e){this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,null!=e?e:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(t=>t.teardown()))}getChannels(){return this.channels}async removeChannel(t){const e=await t.unsubscribe();return 0===this.channels.length&&this.disconnect(),e}async removeAllChannels(){const t=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,e,i){this.logger(t,e,i)}connectionState(){switch(this.conn&&this.conn.readyState){case Ct.connecting:return qt.Connecting;case Ct.open:return qt.Open;case Ct.closing:return qt.Closing;default:return qt.Closed}}isConnected(){return this.connectionState()===qt.Open}channel(t,e={config:{}}){const i=`realtime:${t}`,s=this.getChannels().find(t=>t.topic===i);if(s)return s;{const i=new ye(`realtime:${t}`,e,this);return this.channels.push(i),i}}push(t){const{topic:e,event:i,payload:s,ref:r}=t,n=()=>{this.encode(t,t=>{var e;null===(e=this.conn)||void 0===e||e.send(t)})};this.log("push",`${e} ${i} (${r})`,s),this.isConnected()?n():this.sendBuffer.push(n)}async setAuth(t=null){let e=t||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(t=>{const i={access_token:e,version:"realtime-js/2.11.15"};e&&t.updateJoinPayload(i),t.joinedOnce&&t.q()&&t.B(Jt.access_token,{access_token:e})}))}async sendHeartbeat(){var t;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),void(null===(t=this.conn)||void 0===t||t.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}else this.heartbeatCallback("disconnected")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}W(t){let e=this.channels.find(e=>e.topic===t&&(e.q()||e.D()));e&&(this.log("transport",`leaving duplicate topic "${t}"`),e.unsubscribe())}P(t){this.channels=this.channels.filter(e=>e.topic!==t.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this.K(),this.conn.onerror=t=>this.Y(t),this.conn.onmessage=t=>this.X(t),this.conn.onclose=t=>this.Z(t))}X(t){this.decode(t.data,t=>{let{topic:e,event:i,payload:s,ref:r}=t;"phoenix"===e&&"phx_reply"===i&&this.heartbeatCallback("ok"==t.payload.status?"ok":"error"),r&&r===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${e} ${i} ${r&&"("+r+")"||""}`,s),Array.from(this.channels).filter(t=>t.M(e)).forEach(t=>t.S(i,s,r)),this.stateChangeCallbacks.message.forEach(e=>e(t))})}K(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this.tt():this.et(),this.stateChangeCallbacks.open.forEach(t=>t())}et(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}tt(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this.it(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{"keepAlive"===t.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}Z(t){this.log("transport","close",t),this.st(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(e=>e(t))}Y(t){this.log("transport",`${t}`),this.st(),this.stateChangeCallbacks.error.forEach(e=>e(t))}st(){this.channels.forEach(t=>t.S(Jt.error))}V(t,e){if(0===Object.keys(e).length)return t;const i=t.match(/\?/)?"&":"?";return`${t}${i}${new URLSearchParams(e)}`}it(t){let e;if(t)e=t;else{const t=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});e=URL.createObjectURL(t)}return e}}class me extends Error{constructor(t){super(t),this.t=!0,this.name="StorageError"}}class ge extends me{constructor(t,e){super(t),this.name="StorageApiError",this.status=e}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class _e extends me{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}}const $e=t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>U(async()=>{const{default:t}=await Promise.resolve().then(()=>tt);return{default:t}},void 0).then(({default:e})=>e(...t)):fetch),(...t)=>e(...t)},je=t=>{if(Array.isArray(t))return t.map(t=>je(t));if("function"==typeof t||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([t,i])=>{const s=t.replace(/([-_][a-z])/gi,t=>t.toUpperCase().replace(/[-_]/g,""));e[s]=je(i)}),e};var Oe=function(t,e,i,s){return new(i||(i=Promise))(function(r,n){function o(t){try{h(s.next(t))}catch(e){n(e)}}function a(t){try{h(s.throw(t))}catch(e){n(e)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,a)}h((s=s.apply(t,e||[])).next())})};const ke=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t);var Se=function(t,e,i,s){return new(i||(i=Promise))(function(r,n){function o(t){try{h(s.next(t))}catch(e){n(e)}}function a(t){try{h(s.throw(t))}catch(e){n(e)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,a)}h((s=s.apply(t,e||[])).next())})};const Ee={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Te={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class xe{constructor(t,e={},i,s){this.url=t,this.headers=e,this.bucketId=i,this.fetch=$e(s)}uploadOrUpdate(e,i,s,r){return Se(this,void 0,void 0,function*(){try{let t;const n=Object.assign(Object.assign({},Te),r);let o=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(n.upsert)});const a=n.metadata;"undefined"!=typeof Blob&&s instanceof Blob?(t=new FormData,t.append("cacheControl",n.cacheControl),a&&t.append("metadata",this.encodeMetadata(a)),t.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(t=s,t.append("cacheControl",n.cacheControl),a&&t.append("metadata",this.encodeMetadata(a))):(t=s,o["cache-control"]=`max-age=${n.cacheControl}`,o["content-type"]=n.contentType,a&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),(null==r?void 0:r.headers)&&(o=Object.assign(Object.assign({},o),r.headers));const h=this.rt(i),l=this.nt(h),c=yield this.fetch(`${this.url}/object/${l}`,Object.assign({method:e,body:t,headers:o},(null==n?void 0:n.duplex)?{duplex:n.duplex}:{})),u=yield c.json();return c.ok?{data:{path:h,id:u.Id,fullPath:u.Key},error:null}:{data:null,error:u}}catch(n){if(t(n))return{data:null,error:n};throw n}})}upload(t,e,i){return Se(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,e,i)})}uploadToSignedUrl(e,i,s,r){return Se(this,void 0,void 0,function*(){const n=this.rt(e),o=this.nt(n),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",i);try{let t;const e=Object.assign({upsert:Te.upsert},r),i=Object.assign(Object.assign({},this.headers),{"x-upsert":String(e.upsert)});"undefined"!=typeof Blob&&s instanceof Blob?(t=new FormData,t.append("cacheControl",e.cacheControl),t.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(t=s,t.append("cacheControl",e.cacheControl)):(t=s,i["cache-control"]=`max-age=${e.cacheControl}`,i["content-type"]=e.contentType);const o=yield this.fetch(a.toString(),{method:"PUT",body:t,headers:i}),h=yield o.json();return o.ok?{data:{path:n,fullPath:h.Key},error:null}:{data:null,error:h}}catch(h){if(t(h))return{data:null,error:h};throw h}})}createSignedUploadUrl(e,i){return Se(this,void 0,void 0,function*(){try{let t=this.nt(e);const r=Object.assign({},this.headers);(null==i?void 0:i.upsert)&&(r["x-upsert"]="true");const n=yield s(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:r}),o=new URL(this.url+n.url),a=o.searchParams.get("token");if(!a)throw new me("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(r){if(t(r))return{data:null,error:r};throw r}})}update(t,e,i){return Se(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,e,i)})}move(e,i,r){return Se(this,void 0,void 0,function*(){try{return{data:yield s(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:i,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(t(n))return{data:null,error:n};throw n}})}copy(e,i,r){return Se(this,void 0,void 0,function*(){try{return{data:{path:(yield s(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:i,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(t(n))return{data:null,error:n};throw n}})}createSignedUrl(e,i,r){return Se(this,void 0,void 0,function*(){try{let t=this.nt(e),n=yield s(this.fetch,`${this.url}/object/sign/${t}`,Object.assign({expiresIn:i},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:this.headers});const o=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${o}`)},{data:n,error:null}}catch(n){if(t(n))return{data:null,error:n};throw n}})}createSignedUrls(e,i,r){return Se(this,void 0,void 0,function*(){try{const t=yield s(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:i,paths:e},{headers:this.headers}),n=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{data:t.map(t=>Object.assign(Object.assign({},t),{signedUrl:t.signedURL?encodeURI(`${this.url}${t.signedURL}${n}`):null})),error:null}}catch(n){if(t(n))return{data:null,error:n};throw n}})}download(e,s){return Se(this,void 0,void 0,function*(){const r=void 0!==(null==s?void 0:s.transform)?"render/image/authenticated":"object",n=this.transformOptsToQueryString((null==s?void 0:s.transform)||{}),o=n?`?${n}`:"";try{const t=this.nt(e),s=yield i(this.fetch,`${this.url}/${r}/${t}${o}`,{headers:this.headers,noResolveJson:!0});return{data:yield s.blob(),error:null}}catch(a){if(t(a))return{data:null,error:a};throw a}})}info(e){return Se(this,void 0,void 0,function*(){const s=this.nt(e);try{const t=yield i(this.fetch,`${this.url}/object/info/${s}`,{headers:this.headers});return{data:je(t),error:null}}catch(r){if(t(r))return{data:null,error:r};throw r}})}exists(i){return Se(this,void 0,void 0,function*(){const s=this.nt(i);try{return yield function(t,i,s){return Oe(this,void 0,void 0,function*(){return e(t,"HEAD",i,Object.assign(Object.assign({},s),{noResolveJson:!0}),void 0)})}(this.fetch,`${this.url}/object/${s}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(t(r)&&r instanceof _e){const t=r.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:r}}throw r}})}getPublicUrl(t,e){const i=this.nt(t),s=[],r=(null==e?void 0:e.download)?`download=${!0===e.download?"":e.download}`:"";""!==r&&s.push(r);const n=void 0!==(null==e?void 0:e.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==e?void 0:e.transform)||{});""!==o&&s.push(o);let a=s.join("&");return""!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${n}/public/${i}${a}`)}}}remove(e){return Se(this,void 0,void 0,function*(){try{return{data:yield r(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(i){if(t(i))return{data:null,error:i};throw i}})}list(e,i,r){return Se(this,void 0,void 0,function*(){try{const t=Object.assign(Object.assign(Object.assign({},Ee),i),{prefix:e||""});return{data:yield s(this.fetch,`${this.url}/object/list/${this.bucketId}`,t,{headers:this.headers},r),error:null}}catch(n){if(t(n))return{data:null,error:n};throw n}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return"undefined"!=typeof Buffer?Buffer.from(t).toString("base64"):btoa(t)}nt(t){return`${this.bucketId}/${t}`}rt(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}}const Ae={"X-Client-Info":"storage-js/2.7.1"};var Ie=function(t,e,i,s){return new(i||(i=Promise))(function(r,n){function o(t){try{h(s.next(t))}catch(e){n(e)}}function a(t){try{h(s.throw(t))}catch(e){n(e)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,a)}h((s=s.apply(t,e||[])).next())})};class Pe{constructor(t,e={},i){this.url=t,this.headers=Object.assign(Object.assign({},Ae),e),this.fetch=$e(i)}listBuckets(){return Ie(this,void 0,void 0,function*(){try{return{data:yield i(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(t(e))return{data:null,error:e};throw e}})}getBucket(e){return Ie(this,void 0,void 0,function*(){try{return{data:yield i(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(s){if(t(s))return{data:null,error:s};throw s}})}createBucket(e,i={public:!1}){return Ie(this,void 0,void 0,function*(){try{return{data:yield s(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(t(r))return{data:null,error:r};throw r}})}updateBucket(i,s){return Ie(this,void 0,void 0,function*(){try{const t=yield function(t,i,s,r){return Oe(this,void 0,void 0,function*(){return e(t,"PUT",i,r,void 0,s)})}(this.fetch,`${this.url}/bucket/${i}`,{id:i,name:i,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers});return{data:t,error:null}}catch(r){if(t(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Ie(this,void 0,void 0,function*(){try{return{data:yield s(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(i){if(t(i))return{data:null,error:i};throw i}})}deleteBucket(e){return Ie(this,void 0,void 0,function*(){try{return{data:yield r(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(i){if(t(i))return{data:null,error:i};throw i}})}}class Re extends Pe{constructor(t,e={},i){super(t,e,i)}from(t){return new xe(this.url,this.headers,t,this.fetch)}}let Ue="";Ue="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const Ne={headers:{"X-Client-Info":`supabase-js-${Ue}/2.52.1`}},De={schema:"public"},Ce={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Le={},Be="2.71.1",Fe=3e4,Je={"X-Client-Info":`gotrue-js/${Be}`},Me="X-Supabase-Api-Version",Ge={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},qe=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class ze extends Error{constructor(t,e,i){super(t),this.i=!0,this.name="AuthError",this.status=e,this.code=i}}class We extends ze{constructor(t,e,i){super(t,e,i),this.name="AuthApiError",this.status=e,this.code=i}}class He extends ze{constructor(t,e){super(t),this.name="AuthUnknownError",this.originalError=e}}class Ve extends ze{constructor(t,e,i,s){super(t,i,s),this.name=e,this.status=i}}class Ke extends Ve{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Ye extends Ve{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Xe extends Ve{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class Qe extends Ve{constructor(t,e=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ze extends Ve{constructor(t,e=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ti extends Ve{constructor(t,e){super(t,"AuthRetryableFetchError",e,void 0)}}class ei extends Ve{constructor(t,e,i){super(t,"AuthWeakPasswordError",e,"weak_password"),this.reasons=i}}class ii extends Ve{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const si="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ri=" \t\n\r=".split(""),ni=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<ri.length;e+=1)t[ri[e].charCodeAt(0)]=-2;for(let e=0;e<si.length;e+=1)t[si[e].charCodeAt(0)]=e;return t})(),oi=()=>"undefined"!=typeof window&&"undefined"!=typeof document,ai={tested:!1,writable:!1},hi=()=>{if(!oi())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(ai.tested)return ai.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),ai.tested=!0,ai.writable=!0}catch(e){ai.tested=!0,ai.writable=!1}return ai.writable},li=t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>U(async()=>{const{default:t}=await Promise.resolve().then(()=>tt);return{default:t}},void 0).then(({default:e})=>e(...t)):fetch),(...t)=>e(...t)},ci=async(t,e,i)=>{await t.setItem(e,JSON.stringify(i))},ui=async(t,e)=>{const i=await t.getItem(e);if(!i)return null;try{return JSON.parse(i)}catch(s){return i}},di=async(t,e)=>{await t.removeItem(e)};class fi{constructor(){this.promise=new fi.promiseConstructor((t,e)=>{this.resolve=t,this.reject=e})}}fi.promiseConstructor=Promise;const wi=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,vi=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/,yi=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),pi=[502,503,504],bi=["global","local","others"];class mi{constructor({url:t="",headers:e={},fetch:i}){this.url=t,this.headers=e,this.fetch=li(i),this.mfa={listFactors:this.ot.bind(this),deleteFactor:this.ht.bind(this)}}async signOut(t,e=bi[0]){if(bi.indexOf(e)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${bi.join(", ")}`);try{return await g(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(i){if(n(i))return{data:null,error:i};throw i}}async inviteUserByEmail(t,e={}){try{return await g(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:j})}catch(i){if(n(i))return{data:{user:null},error:i};throw i}}async generateLink(t){try{const{options:e}=t,i=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(t);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(t,s[r])&&(i[s[r]]=t[s[r]])}return i}(t,["options"]),s=Object.assign(Object.assign({},i),e);return"newEmail"in i&&(s.new_email=null==i?void 0:i.newEmail,delete s.newEmail),await g(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:k,redirectTo:null==e?void 0:e.redirectTo})}catch(e){if(n(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(t){try{return await g(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:j})}catch(e){if(n(e))return{data:{user:null},error:e};throw e}}async listUsers(t){var e,i,s,r,o,a,h;try{const n={nextPage:null,lastPage:0,total:0},l=await g(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(i=null===(e=null==t?void 0:t.page)||void 0===e?void 0:e.toString())&&void 0!==i?i:"",per_page:null!==(r=null===(s=null==t?void 0:t.perPage)||void 0===s?void 0:s.toString())&&void 0!==r?r:""},xform:S});if(l.error)throw l.error;const c=await l.json(),u=null!==(o=l.headers.get("x-total-count"))&&void 0!==o?o:0,d=null!==(h=null===(a=l.headers.get("link"))||void 0===a?void 0:a.split(","))&&void 0!==h?h:[];return d.length>0&&(d.forEach(t=>{const e=parseInt(t.split(";")[0].split("=")[1].substring(0,1)),i=JSON.parse(t.split(";")[1].split("=")[1]);n[`${i}Page`]=e}),n.total=parseInt(u)),{data:Object.assign(Object.assign({},c),n),error:null}}catch(l){if(n(l))return{data:{users:[]},error:l};throw l}}async getUserById(t){y(t);try{return await g(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:j})}catch(e){if(n(e))return{data:{user:null},error:e};throw e}}async updateUserById(t,e){y(t);try{return await g(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:e,headers:this.headers,xform:j})}catch(i){if(n(i))return{data:{user:null},error:i};throw i}}async deleteUser(t,e=!1){y(t);try{return await g(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:e},xform:j})}catch(i){if(n(i))return{data:{user:null},error:i};throw i}}async ot(t){y(t.userId);try{const{data:e,error:i}=await g(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:t=>({data:{factors:t},error:null})});return{data:e,error:i}}catch(e){if(n(e))return{data:null,error:e};throw e}}async ht(t){y(t.userId),y(t.id);try{return{data:await g(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(e){if(n(e))return{data:null,error:e};throw e}}}const gi=!!(globalThis&&hi()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class _i extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class $i extends _i{}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"ct",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.ct}catch(t){"undefined"!=typeof self&&(self.globalThis=self)}}();const ji={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Je,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},Oi={};class ki{constructor(t){var e,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ki.nextInstanceID,ki.nextInstanceID+=1,this.instanceID>0&&oi();const s=Object.assign(Object.assign({},ji),t);if(this.logDebugMessages=!!s.debug,"function"==typeof s.debug&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new mi({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=li(s.fetch),this.lock=s.lock||x,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:oi()&&(null===(e=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===e?void 0:e.locks)?this.lock=T:this.lock=x,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this.ut.bind(this),enroll:this.dt.bind(this),unenroll:this.ft.bind(this),challenge:this.wt.bind(this),listFactors:this.ot.bind(this),challengeAndVerify:this.vt.bind(this),getAuthenticatorAssuranceLevel:this.yt.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:hi()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=E(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=E(this.memoryStorage)),oi()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(r){}null===(i=this.broadcastChannel)||void 0===i||i.addEventListener("message",async t=>{this.bt("received broadcast notification from other tab or client",t),await this._t(t.data.event,t.data.session,!1)})}this.initialize()}get jwks(){var t,e;return null!==(e=null===(t=Oi[this.storageKey])||void 0===t?void 0:t.jwks)&&void 0!==e?e:{keys:[]}}set jwks(t){Oi[this.storageKey]=Object.assign(Object.assign({},Oi[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,e;return null!==(e=null===(t=Oi[this.storageKey])||void 0===t?void 0:t.cachedAt)&&void 0!==e?e:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){Oi[this.storageKey]=Object.assign(Object.assign({},Oi[this.storageKey]),{cachedAt:t})}bt(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Be}) ${(new Date).toISOString()}`,...t),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this.$t(-1,async()=>await this.jt()))()),await this.initializePromise}async jt(){var t;try{const e=function(t){const e={},i=new URL(t);if(i.hash&&"#"===i.hash[0])try{new URLSearchParams(i.hash.substring(1)).forEach((t,i)=>{e[i]=t})}catch(s){}return i.searchParams.forEach((t,i)=>{e[i]=t}),e}(window.location.href);let i="none";if(this.Ot(e)?i="implicit":await this.kt(e)&&(i="pkce"),oi()&&this.detectSessionInUrl&&"none"!==i){const{data:s,error:r}=await this.St(e,i);if(r){if(this.bt("#_initialize()","error detecting session from URL",r),function(t){return n(t)&&"AuthImplicitGrantRedirectError"===t.name}(r)){const e=null===(t=r.details)||void 0===t?void 0:t.code;if("identity_already_exists"===e||"identity_not_found"===e||"single_identity_not_deletable"===e)return{error:r}}return await this.Et(),{error:r}}const{session:o,redirectType:a}=s;return this.bt("#_initialize()","detected session in URL",o,"redirect type",a),await this.Tt(o),setTimeout(async()=>{"recovery"===a?await this._t("PASSWORD_RECOVERY",o):await this._t("SIGNED_IN",o)},0),{error:null}}return await this.xt(),{error:null}}catch(e){return n(e)?{error:e}:{error:new He("Unexpected error during initialization",e)}}finally{await this.At(),this.bt("#_initialize()","end")}}async signInAnonymously(t){var e,i,s;try{const r=await g(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(i=null===(e=null==t?void 0:t.options)||void 0===e?void 0:e.data)&&void 0!==i?i:{},gotrue_meta_security:{captcha_token:null===(s=null==t?void 0:t.options)||void 0===s?void 0:s.captchaToken}},xform:_}),{data:n,error:o}=r;if(o||!n)return{data:{user:null,session:null},error:o};const a=n.session,h=n.user;return n.session&&(await this.Tt(n.session),await this._t("SIGNED_IN",a)),{data:{user:h,session:a},error:null}}catch(r){if(n(r))return{data:{user:null,session:null},error:r};throw r}}async signUp(t){var e,i,s;try{let r;if("email"in t){const{email:i,password:s,options:n}=t;let o=null,a=null;"pkce"===this.flowType&&([o,a]=await v(this.storage,this.storageKey)),r=await g(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==n?void 0:n.emailRedirectTo,body:{email:i,password:s,data:null!==(e=null==n?void 0:n.data)&&void 0!==e?e:{},gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:o,code_challenge_method:a},xform:_})}else{if(!("phone"in t))throw new Xe("You must provide either an email or phone number and a password");{const{phone:e,password:n,options:o}=t;r=await g(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:e,password:n,data:null!==(i=null==o?void 0:o.data)&&void 0!==i?i:{},channel:null!==(s=null==o?void 0:o.channel)&&void 0!==s?s:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:_})}}const{data:n,error:o}=r;if(o||!n)return{data:{user:null,session:null},error:o};const a=n.session,h=n.user;return n.session&&(await this.Tt(n.session),await this._t("SIGNED_IN",a)),{data:{user:h,session:a},error:null}}catch(r){if(n(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithPassword(t){try{let e;if("email"in t){const{email:i,password:s,options:r}=t;e=await g(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:s,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}},xform:$})}else{if(!("phone"in t))throw new Xe("You must provide either an email or phone number and a password");{const{phone:i,password:s,options:r}=t;e=await g(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:s,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}},xform:$})}}const{data:i,error:s}=e;return s?{data:{user:null,session:null},error:s}:i&&i.session&&i.user?(i.session&&(await this.Tt(i.session),await this._t("SIGNED_IN",i.session)),{data:Object.assign({user:i.user,session:i.session},i.weak_password?{weakPassword:i.weak_password}:null),error:s}):{data:{user:null,session:null},error:new Ye}}catch(e){if(n(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOAuth(t){var e,i,s,r;return await this.It(t.provider,{redirectTo:null===(e=t.options)||void 0===e?void 0:e.redirectTo,scopes:null===(i=t.options)||void 0===i?void 0:i.scopes,queryParams:null===(s=t.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:null===(r=t.options)||void 0===r?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this.$t(-1,async()=>this.Pt(t))}async signInWithWeb3(t){const{chain:e}=t;if("solana"===e)return await this.signInWithSolana(t);throw new Error(`@supabase/auth-js: Unsupported chain "${e}"`)}async signInWithSolana(t){var e,i,s,r,o,a,h,l,c,u,f,w;let v,y;if("message"in t)v=t.message,y=t.signature;else{const{chain:n,wallet:d,statement:f,options:w}=t;let p;if(oi())if("object"==typeof d)p=d;else{const t=window;if(!("solana"in t)||"object"!=typeof t.solana||!("signIn"in t.solana&&"function"==typeof t.solana.signIn||"signMessage"in t.solana&&"function"==typeof t.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");p=t.solana}else{if("object"!=typeof d||!(null==w?void 0:w.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");p=d}const b=new URL(null!==(e=null==w?void 0:w.url)&&void 0!==e?e:window.location.href);if("signIn"in p&&p.signIn){const t=await p.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==w?void 0:w.signInWithSolana),{version:"1",domain:b.host,uri:b.href}),f?{statement:f}:null));let e;if(Array.isArray(t)&&t[0]&&"object"==typeof t[0])e=t[0];else{if(!(t&&"object"==typeof t&&"signedMessage"in t&&"signature"in t))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");e=t}if(!("signedMessage"in e&&"signature"in e&&("string"==typeof e.signedMessage||e.signedMessage instanceof Uint8Array)&&e.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");v="string"==typeof e.signedMessage?e.signedMessage:(new TextDecoder).decode(e.signedMessage),y=e.signature}else{if(!("signMessage"in p&&"function"==typeof p.signMessage&&"publicKey"in p&&"object"==typeof p&&p.publicKey&&"toBase58"in p.publicKey&&"function"==typeof p.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");v=[`${b.host} wants you to sign in with your Solana account:`,p.publicKey.toBase58(),...f?["",f,""]:[""],"Version: 1",`URI: ${b.href}`,`Issued At: ${null!==(s=null===(i=null==w?void 0:w.signInWithSolana)||void 0===i?void 0:i.issuedAt)&&void 0!==s?s:(new Date).toISOString()}`,...(null===(r=null==w?void 0:w.signInWithSolana)||void 0===r?void 0:r.notBefore)?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...(null===(o=null==w?void 0:w.signInWithSolana)||void 0===o?void 0:o.expirationTime)?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...(null===(a=null==w?void 0:w.signInWithSolana)||void 0===a?void 0:a.chainId)?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...(null===(h=null==w?void 0:w.signInWithSolana)||void 0===h?void 0:h.nonce)?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...(null===(l=null==w?void 0:w.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...(null===(u=null===(c=null==w?void 0:w.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===u?void 0:u.length)?["Resources",...w.signInWithSolana.resources.map(t=>`- ${t}`)]:[]].join("\n");const t=await p.signMessage((new TextEncoder).encode(v),"utf8");if(!(t&&t instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=t}}try{const{data:e,error:i}=await g(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:v,signature:d(y)},(null===(f=t.options)||void 0===f?void 0:f.captchaToken)?{gotrue_meta_security:{captcha_token:null===(w=t.options)||void 0===w?void 0:w.captchaToken}}:null),xform:_});if(i)throw i;return e&&e.session&&e.user?(e.session&&(await this.Tt(e.session),await this._t("SIGNED_IN",e.session)),{data:Object.assign({},e),error:i}):{data:{user:null,session:null},error:new Ye}}catch(p){if(n(p))return{data:{user:null,session:null},error:p};throw p}}async Pt(t){const e=await ui(this.storage,`${this.storageKey}-code-verifier`),[i,s]=(null!=e?e:"").split("/");try{const{data:e,error:r}=await g(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:i},xform:_});if(await di(this.storage,`${this.storageKey}-code-verifier`),r)throw r;return e&&e.session&&e.user?(e.session&&(await this.Tt(e.session),await this._t("SIGNED_IN",e.session)),{data:Object.assign(Object.assign({},e),{redirectType:null!=s?s:null}),error:r}):{data:{user:null,session:null,redirectType:null},error:new Ye}}catch(r){if(n(r))return{data:{user:null,session:null,redirectType:null},error:r};throw r}}async signInWithIdToken(t){try{const{options:e,provider:i,token:s,access_token:r,nonce:n}=t,o=await g(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:i,id_token:s,access_token:r,nonce:n,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}},xform:_}),{data:a,error:h}=o;return h?{data:{user:null,session:null},error:h}:a&&a.session&&a.user?(a.session&&(await this.Tt(a.session),await this._t("SIGNED_IN",a.session)),{data:a,error:h}):{data:{user:null,session:null},error:new Ye}}catch(e){if(n(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOtp(t){var e,i,s,r,o;try{if("email"in t){const{email:s,options:r}=t;let n=null,o=null;"pkce"===this.flowType&&([n,o]=await v(this.storage,this.storageKey));const{error:a}=await g(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:null!==(e=null==r?void 0:r.data)&&void 0!==e?e:{},create_user:null===(i=null==r?void 0:r.shouldCreateUser)||void 0===i||i,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},code_challenge:n,code_challenge_method:o},redirectTo:null==r?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in t){const{phone:e,options:i}=t,{data:n,error:a}=await g(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:e,data:null!==(s=null==i?void 0:i.data)&&void 0!==s?s:{},create_user:null===(r=null==i?void 0:i.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},channel:null!==(o=null==i?void 0:i.channel)&&void 0!==o?o:"sms"}});return{data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:a}}throw new Xe("You must provide either an email or phone number.")}catch(a){if(n(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(t){var e,i;try{let s,r;"options"in t&&(s=null===(e=t.options)||void 0===e?void 0:e.redirectTo,r=null===(i=t.options)||void 0===i?void 0:i.captchaToken);const{data:n,error:o}=await g(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:r}}),redirectTo:s,xform:_});if(o)throw o;if(!n)throw new Error("An error occurred on token verification.");const a=n.session,h=n.user;return(null==a?void 0:a.access_token)&&(await this.Tt(a),await this._t("recovery"==t.type?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:h,session:a},error:null}}catch(s){if(n(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(t){var e,i,s;try{let r=null,n=null;return"pkce"===this.flowType&&([r,n]=await v(this.storage,this.storageKey)),await g(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:null!==(i=null===(e=t.options)||void 0===e?void 0:e.redirectTo)&&void 0!==i?i:void 0}),(null===(s=null==t?void 0:t.options)||void 0===s?void 0:s.captchaToken)?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:r,code_challenge_method:n}),headers:this.headers,xform:O})}catch(r){if(n(r))return{data:null,error:r};throw r}}async reauthenticate(){return await this.initializePromise,await this.$t(-1,async()=>await this.Rt())}async Rt(){try{return await this.Ut(async t=>{const{data:{session:e},error:i}=t;if(i)throw i;if(!e)throw new Ke;const{error:s}=await g(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:e.access_token});return{data:{user:null,session:null},error:s}})}catch(t){if(n(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const e=`${this.url}/resend`;if("email"in t){const{email:i,type:s,options:r}=t,{error:n}=await g(this.fetch,"POST",e,{headers:this.headers,body:{email:i,type:s,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}},redirectTo:null==r?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:n}}if("phone"in t){const{phone:i,type:s,options:r}=t,{data:n,error:o}=await g(this.fetch,"POST",e,{headers:this.headers,body:{phone:i,type:s,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}}});return{data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:o}}throw new Xe("You must provide either an email or phone number and a type")}catch(e){if(n(e))return{data:{user:null,session:null},error:e};throw e}}async getSession(){return await this.initializePromise,await this.$t(-1,async()=>this.Ut(async t=>t))}async $t(t,e){this.bt("#_acquireLock","begin",t);try{if(this.lockAcquired){const t=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await t,await e()))();return this.pendingInLock.push((async()=>{try{await i}catch(t){}})()),i}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this.bt("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const t=e();for(this.pendingInLock.push((async()=>{try{await t}catch(e){}})()),await t;this.pendingInLock.length;){const t=[...this.pendingInLock];await Promise.all(t),this.pendingInLock.splice(0,t.length)}return await t}finally{this.bt("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this.bt("#_acquireLock","end")}}async Ut(t){this.bt("#_useSession","begin");try{const e=await this.Nt();return await t(e)}finally{this.bt("#_useSession","end")}}async Nt(){this.bt("#__loadSession()","begin"),this.lockAcquired||this.bt("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let t=null;const e=await ui(this.storage,this.storageKey);if(this.bt("#getSession()","session from storage",e),null!==e&&(this.Dt(e)?t=e:(this.bt("#getSession()","session from storage is not valid"),await this.Et())),!t)return{data:{session:null},error:null};const i=!!t.expires_at&&1e3*t.expires_at-Date.now()<9e4;if(this.bt("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",t.expires_at),!i){if(this.userStorage){const e=await ui(this.userStorage,this.storageKey+"-user");(null==e?void 0:e.user)?t.user=e.user:t.user=p()}if(this.storage.isServer&&t.user){let e=this.suppressGetSessionWarning;t=new Proxy(t,{get:(t,i,s)=>(e||"user"!==i||(e=!0,this.suppressGetSessionWarning=!0),Reflect.get(t,i,s))})}return{data:{session:t},error:null}}const{session:s,error:r}=await this.Ct(t.refresh_token);return r?{data:{session:null},error:r}:{data:{session:s},error:null}}finally{this.bt("#__loadSession()","end")}}async getUser(t){return t?await this.Lt(t):(await this.initializePromise,await this.$t(-1,async()=>await this.Lt()))}async Lt(t){try{return t?await g(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:j}):await this.Ut(async t=>{var e,i,s;const{data:r,error:n}=t;if(n)throw n;return(null===(e=r.session)||void 0===e?void 0:e.access_token)||this.hasCustomAuthorizationHeader?await g(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(s=null===(i=r.session)||void 0===i?void 0:i.access_token)&&void 0!==s?s:void 0,xform:j}):{data:{user:null},error:new Ke}})}catch(e){if(n(e))return function(t){return n(t)&&"AuthSessionMissingError"===t.name}(e)&&(await this.Et(),await di(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:e};throw e}}async updateUser(t,e={}){return await this.initializePromise,await this.$t(-1,async()=>await this.Bt(t,e))}async Bt(t,e={}){try{return await this.Ut(async i=>{const{data:s,error:r}=i;if(r)throw r;if(!s.session)throw new Ke;const n=s.session;let o=null,a=null;"pkce"===this.flowType&&null!=t.email&&([o,a]=await v(this.storage,this.storageKey));const{data:h,error:l}=await g(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==e?void 0:e.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:a}),jwt:n.access_token,xform:j});if(l)throw l;return n.user=h.user,await this.Tt(n),await this._t("USER_UPDATED",n),{data:{user:n.user},error:null}})}catch(i){if(n(i))return{data:{user:null},error:i};throw i}}async setSession(t){return await this.initializePromise,await this.$t(-1,async()=>await this.Ft(t))}async Ft(t){try{if(!t.access_token||!t.refresh_token)throw new Ke;const e=Date.now()/1e3;let i=e,s=!0,r=null;const{payload:n}=f(t.access_token);if(n.exp&&(i=n.exp,s=i<=e),s){const{session:e,error:i}=await this.Ct(t.refresh_token);if(i)return{data:{user:null,session:null},error:i};if(!e)return{data:{user:null,session:null},error:null};r=e}else{const{data:s,error:n}=await this.Lt(t.access_token);if(n)throw n;r={access_token:t.access_token,refresh_token:t.refresh_token,user:s.user,token_type:"bearer",expires_in:i-e,expires_at:i},await this.Tt(r),await this._t("SIGNED_IN",r)}return{data:{user:r.user,session:r},error:null}}catch(e){if(n(e))return{data:{session:null,user:null},error:e};throw e}}async refreshSession(t){return await this.initializePromise,await this.$t(-1,async()=>await this.Jt(t))}async Jt(t){try{return await this.Ut(async e=>{var i;if(!t){const{data:s,error:r}=e;if(r)throw r;t=null!==(i=s.session)&&void 0!==i?i:void 0}if(!(null==t?void 0:t.refresh_token))throw new Ke;const{session:s,error:r}=await this.Ct(t.refresh_token);return r?{data:{user:null,session:null},error:r}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(e){if(n(e))return{data:{user:null,session:null},error:e};throw e}}async St(t,e){try{if(!oi())throw new Qe("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Qe(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(e){case"implicit":if("pkce"===this.flowType)throw new Ze("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Qe("Not a valid implicit grant flow url.")}if("pkce"===e){if(this.bt("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new Ze("No code detected.");const{data:e,error:i}=await this.Pt(t.code);if(i)throw i;const s=new URL(window.location.href);return s.searchParams.delete("code"),window.history.replaceState(window.history.state,"",s.toString()),{data:{session:e.session,redirectType:null},error:null}}const{provider_token:i,provider_refresh_token:s,access_token:r,refresh_token:n,expires_in:o,expires_at:a,token_type:h}=t;if(!(r&&o&&n&&h))throw new Qe("No session defined in URL");const l=Math.round(Date.now()/1e3),c=parseInt(o);let u=l+c;a&&(u=parseInt(a));const{data:d,error:f}=await this.Lt(r);if(f)throw f;const w={provider_token:i,provider_refresh_token:s,access_token:r,expires_in:c,expires_at:u,refresh_token:n,token_type:h,user:d.user};return window.location.hash="",this.bt("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:w,redirectType:t.type},error:null}}catch(i){if(n(i))return{data:{session:null,redirectType:null},error:i};throw i}}Ot(t){return Boolean(t.access_token||t.error_description)}async kt(t){const e=await ui(this.storage,`${this.storageKey}-code-verifier`);return!(!t.code||!e)}async signOut(t={scope:"global"}){return await this.initializePromise,await this.$t(-1,async()=>await this.Mt(t))}async Mt({scope:t}={scope:"global"}){return await this.Ut(async e=>{var i;const{data:s,error:r}=e;if(r)return{error:r};const o=null===(i=s.session)||void 0===i?void 0:i.access_token;if(o){const{error:e}=await this.admin.signOut(o,t);if(e&&(!function(t){return n(t)&&"AuthApiError"===t.name}(e)||404!==e.status&&401!==e.status&&403!==e.status))return{error:e}}return"others"!==t&&(await this.Et(),await di(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(t){const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}),i={id:e,callback:t,unsubscribe:()=>{this.bt("#unsubscribe()","state change callback with id removed",e),this.stateChangeEmitters.delete(e)}};return this.bt("#onAuthStateChange()","registered callback with id",e),this.stateChangeEmitters.set(e,i),(async()=>{await this.initializePromise,await this.$t(-1,async()=>{this.Gt(e)})})(),{data:{subscription:i}}}async Gt(t){return await this.Ut(async e=>{var i,s;try{const{data:{session:s},error:r}=e;if(r)throw r;await(null===(i=this.stateChangeEmitters.get(t))||void 0===i?void 0:i.callback("INITIAL_SESSION",s)),this.bt("INITIAL_SESSION","callback id",t,"session",s)}catch(r){await(null===(s=this.stateChangeEmitters.get(t))||void 0===s?void 0:s.callback("INITIAL_SESSION",null)),this.bt("INITIAL_SESSION","callback id",t,"error",r)}})}async resetPasswordForEmail(t,e={}){let i=null,s=null;"pkce"===this.flowType&&([i,s]=await v(this.storage,this.storageKey,!0));try{return await g(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:i,code_challenge_method:s,gotrue_meta_security:{captcha_token:e.captchaToken}},headers:this.headers,redirectTo:e.redirectTo})}catch(r){if(n(r))return{data:null,error:r};throw r}}async getUserIdentities(){var t;try{const{data:e,error:i}=await this.getUser();if(i)throw i;return{data:{identities:null!==(t=e.user.identities)&&void 0!==t?t:[]},error:null}}catch(e){if(n(e))return{data:null,error:e};throw e}}async linkIdentity(t){var e;try{const{data:i,error:s}=await this.Ut(async e=>{var i,s,r,n,o;const{data:a,error:h}=e;if(h)throw h;const l=await this.qt(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:null===(i=t.options)||void 0===i?void 0:i.redirectTo,scopes:null===(s=t.options)||void 0===s?void 0:s.scopes,queryParams:null===(r=t.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:!0});return await g(this.fetch,"GET",l,{headers:this.headers,jwt:null!==(o=null===(n=a.session)||void 0===n?void 0:n.access_token)&&void 0!==o?o:void 0})});if(s)throw s;return oi()&&!(null===(e=t.options)||void 0===e?void 0:e.skipBrowserRedirect)&&window.location.assign(null==i?void 0:i.url),{data:{provider:t.provider,url:null==i?void 0:i.url},error:null}}catch(i){if(n(i))return{data:{provider:t.provider,url:null},error:i};throw i}}async unlinkIdentity(t){try{return await this.Ut(async e=>{var i,s;const{data:r,error:n}=e;if(n)throw n;return await g(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:null!==(s=null===(i=r.session)||void 0===i?void 0:i.access_token)&&void 0!==s?s:void 0})})}catch(e){if(n(e))return{data:null,error:e};throw e}}async zt(t){const e=`#_refreshAccessToken(${t.substring(0,5)}...)`;this.bt(e,"begin");try{const r=Date.now();return await(i=async i=>(i>0&&await async function(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}(200*Math.pow(2,i-1)),this.bt(e,"refreshing attempt",i),await g(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:_})),s=(t,e)=>{const i=200*Math.pow(2,t);return e&&o(e)&&Date.now()+i-r<Fe},new Promise((t,e)=>{(async()=>{for(let n=0;n<1/0;n++)try{const e=await i(n);if(!s(n,null))return void t(e)}catch(r){if(!s(n,r))return void e(r)}})()}))}catch(r){if(this.bt(e,"error",r),n(r))return{data:{session:null,user:null},error:r};throw r}finally{this.bt(e,"end")}var i,s}Dt(t){return"object"==typeof t&&null!==t&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async It(t,e){const i=await this.qt(`${this.url}/authorize`,t,{redirectTo:e.redirectTo,scopes:e.scopes,queryParams:e.queryParams});return this.bt("#_handleProviderSignIn()","provider",t,"options",e,"url",i),oi()&&!e.skipBrowserRedirect&&window.location.assign(i),{data:{provider:t,url:i},error:null}}async xt(){var t,e;const i="#_recoverAndRefresh()";this.bt(i,"begin");try{const r=await ui(this.storage,this.storageKey);if(r&&this.userStorage){let e=await ui(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||e||(e={user:r.user},await ci(this.userStorage,this.storageKey+"-user",e)),r.user=null!==(t=null==e?void 0:e.user)&&void 0!==t?t:p()}else if(r&&!r.user&&!r.user){const t=await ui(this.storage,this.storageKey+"-user");t&&(null==t?void 0:t.user)?(r.user=t.user,await di(this.storage,this.storageKey+"-user"),await ci(this.storage,this.storageKey,r)):r.user=p()}if(this.bt(i,"session from storage",r),!this.Dt(r))return this.bt(i,"session is not valid"),void(null!==r&&await this.Et());const n=1e3*(null!==(e=r.expires_at)&&void 0!==e?e:1/0)-Date.now()<9e4;if(this.bt(i,`session has${n?"":" not"} expired with margin of 90000s`),n){if(this.autoRefreshToken&&r.refresh_token){const{error:t}=await this.Ct(r.refresh_token);t&&(o(t)||(this.bt(i,"refresh failed with a non-retryable error, removing the session",t),await this.Et()))}}else if(r.user&&!0===r.user.Wt)try{const{data:t,error:e}=await this.Lt(r.access_token);!e&&(null==t?void 0:t.user)?(r.user=t.user,await this.Tt(r),await this._t("SIGNED_IN",r)):this.bt(i,"could not get user data, skipping SIGNED_IN notification")}catch(s){this.bt(i,"error getting user data, skipping SIGNED_IN notification",s)}else await this._t("SIGNED_IN",r)}catch(r){return void this.bt(i,"error",r)}finally{this.bt(i,"end")}}async Ct(t){var e,i;if(!t)throw new Ke;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${t.substring(0,5)}...)`;this.bt(s,"begin");try{this.refreshingDeferred=new fi;const{data:e,error:i}=await this.zt(t);if(i)throw i;if(!e.session)throw new Ke;await this.Tt(e.session),await this._t("TOKEN_REFRESHED",e.session);const s={session:e.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(r){if(this.bt(s,"error",r),n(r)){const t={session:null,error:r};return o(r)||await this.Et(),null===(e=this.refreshingDeferred)||void 0===e||e.resolve(t),t}throw null===(i=this.refreshingDeferred)||void 0===i||i.reject(r),r}finally{this.refreshingDeferred=null,this.bt(s,"end")}}async _t(t,e,i=!0){const s=`#_notifyAllSubscribers(${t})`;this.bt(s,"begin",e,`broadcast = ${i}`);try{this.broadcastChannel&&i&&this.broadcastChannel.postMessage({event:t,session:e});const s=[],r=Array.from(this.stateChangeEmitters.values()).map(async i=>{try{await i.callback(t,e)}catch(r){s.push(r)}});if(await Promise.all(r),s.length>0){for(let t=0;t<s.length;t+=1);throw s[0]}}finally{this.bt(s,"end")}}async Tt(t){this.bt("#_saveSession()",t),this.suppressGetSessionWarning=!0;const e=Object.assign({},t),i=e.user&&!0===e.user.Wt;if(this.userStorage){!i&&e.user&&await ci(this.userStorage,this.storageKey+"-user",{user:e.user});const t=Object.assign({},e);delete t.user;const s=b(t);await ci(this.storage,this.storageKey,s)}else{const t=b(e);await ci(this.storage,this.storageKey,t)}}async Et(){this.bt("#_removeSession()"),await di(this.storage,this.storageKey),await di(this.storage,this.storageKey+"-code-verifier"),await di(this.storage,this.storageKey+"-user"),this.userStorage&&await di(this.userStorage,this.storageKey+"-user"),await this._t("SIGNED_OUT",null)}Ht(){this.bt("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&oi()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(e){}}async Vt(){await this.Kt(),this.bt("#_startAutoRefresh()");const t=setInterval(()=>this.Yt(),Fe);this.autoRefreshTicker=t,t&&"object"==typeof t&&"function"==typeof t.unref?t.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this.Yt()},0)}async Kt(){this.bt("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this.Ht(),await this.Vt()}async stopAutoRefresh(){this.Ht(),await this.Kt()}async Yt(){this.bt("#_autoRefreshTokenTick()","begin");try{await this.$t(0,async()=>{try{const e=Date.now();try{return await this.Ut(async t=>{const{data:{session:i}}=t;if(!i||!i.refresh_token||!i.expires_at)return void this.bt("#_autoRefreshTokenTick()","no session");const s=Math.floor((1e3*i.expires_at-e)/Fe);this.bt("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),s<=3&&await this.Ct(i.refresh_token)})}catch(t){}}finally{this.bt("#_autoRefreshTokenTick()","end")}})}catch(t){if(!(t.isAcquireTimeout||t instanceof _i))throw t;this.bt("auto refresh token tick lock not available")}}async At(){if(this.bt("#_handleVisibilityChange()"),!oi()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this.Xt(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this.Xt(!0)}catch(t){}}async Xt(t){const e=`#_onVisibilityChanged(${t})`;this.bt(e,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this.Vt(),t||(await this.initializePromise,await this.$t(-1,async()=>{"visible"===document.visibilityState?await this.xt():this.bt(e,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this.Kt()}async qt(t,e,i){const s=[`provider=${encodeURIComponent(e)}`];if((null==i?void 0:i.redirectTo)&&s.push(`redirect_to=${encodeURIComponent(i.redirectTo)}`),(null==i?void 0:i.scopes)&&s.push(`scopes=${encodeURIComponent(i.scopes)}`),"pkce"===this.flowType){const[t,e]=await v(this.storage,this.storageKey),i=new URLSearchParams({code_challenge:`${encodeURIComponent(t)}`,code_challenge_method:`${encodeURIComponent(e)}`});s.push(i.toString())}if(null==i?void 0:i.queryParams){const t=new URLSearchParams(i.queryParams);s.push(t.toString())}return(null==i?void 0:i.skipBrowserRedirect)&&s.push(`skip_http_redirect=${i.skipBrowserRedirect}`),`${t}?${s.join("&")}`}async ft(t){try{return await this.Ut(async e=>{var i;const{data:s,error:r}=e;return r?{data:null,error:r}:await g(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:null===(i=null==s?void 0:s.session)||void 0===i?void 0:i.access_token})})}catch(e){if(n(e))return{data:null,error:e};throw e}}async dt(t){try{return await this.Ut(async e=>{var i,s;const{data:r,error:n}=e;if(n)return{data:null,error:n};const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},"phone"===t.factorType?{phone:t.phone}:{issuer:t.issuer}),{data:a,error:h}=await g(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:null===(i=null==r?void 0:r.session)||void 0===i?void 0:i.access_token});return h?{data:null,error:h}:("totp"===t.factorType&&(null===(s=null==a?void 0:a.totp)||void 0===s?void 0:s.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})})}catch(e){if(n(e))return{data:null,error:e};throw e}}async ut(t){return this.$t(-1,async()=>{try{return await this.Ut(async e=>{var i;const{data:s,error:r}=e;if(r)return{data:null,error:r};const{data:n,error:o}=await g(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:null===(i=null==s?void 0:s.session)||void 0===i?void 0:i.access_token});return o?{data:null,error:o}:(await this.Tt(Object.assign({expires_at:Math.round(Date.now()/1e3)+n.expires_in},n)),await this._t("MFA_CHALLENGE_VERIFIED",n),{data:n,error:o})})}catch(e){if(n(e))return{data:null,error:e};throw e}})}async wt(t){return this.$t(-1,async()=>{try{return await this.Ut(async e=>{var i;const{data:s,error:r}=e;return r?{data:null,error:r}:await g(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:null===(i=null==s?void 0:s.session)||void 0===i?void 0:i.access_token})})}catch(e){if(n(e))return{data:null,error:e};throw e}})}async vt(t){const{data:e,error:i}=await this.wt({factorId:t.factorId});return i?{data:null,error:i}:await this.ut({factorId:t.factorId,challengeId:e.id,code:t.code})}async ot(){const{data:{user:t},error:e}=await this.getUser();if(e)return{data:null,error:e};const i=(null==t?void 0:t.factors)||[],s=i.filter(t=>"totp"===t.factor_type&&"verified"===t.status),r=i.filter(t=>"phone"===t.factor_type&&"verified"===t.status);return{data:{all:i,totp:s,phone:r},error:null}}async yt(){return this.$t(-1,async()=>await this.Ut(async t=>{var e,i;const{data:{session:s},error:r}=t;if(r)return{data:null,error:r};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:n}=f(s.access_token);let o=null;n.aal&&(o=n.aal);let a=o;return(null!==(i=null===(e=s.user.factors)||void 0===e?void 0:e.filter(t=>"verified"===t.status))&&void 0!==i?i:[]).length>0&&(a="aal2"),{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:n.amr||[]},error:null}}))}async fetchJwk(t,e={keys:[]}){let i=e.keys.find(e=>e.kid===t);if(i)return i;const s=Date.now();if(i=this.jwks.keys.find(e=>e.kid===t),i&&this.jwks_cached_at+6e5>s)return i;const{data:r,error:n}=await g(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(n)throw n;return r.keys&&0!==r.keys.length?(this.jwks=r,this.jwks_cached_at=s,i=r.keys.find(e=>e.kid===t),i||null):null}async getClaims(t,e={}){try{let i=t;if(!i){const{data:t,error:e}=await this.getSession();if(e||!t.session)return{data:null,error:e};i=t.session.access_token}const{header:s,payload:r,signature:n,raw:{header:o,payload:a}}=f(i);(null==e?void 0:e.allowExpired)||function(t){if(!t)throw new Error("Missing exp claim");if(t<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(r.exp);const h=s.alg&&!s.alg.startsWith("HS")&&s.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(s.kid,(null==e?void 0:e.keys)?{keys:e.keys}:null==e?void 0:e.jwks):null;if(!h){const{error:t}=await this.getUser(i);if(t)throw t;return{data:{claims:r,header:s,signature:n},error:null}}const l=function(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(s.alg),u=await crypto.subtle.importKey("jwk",h,l,!0,["verify"]);if(!(await crypto.subtle.verify(l,u,n,function(t){const e=[];return function(t,e){for(let i=0;i<t.length;i+=1){let s=t.charCodeAt(i);if(s>55295&&s<=56319){const e=1024*(s-55296)&65535;s=65536+(t.charCodeAt(i+1)-56320&65535|e),i+=1}c(s,e)}}(t,t=>e.push(t)),new Uint8Array(e)}(`${o}.${a}`))))throw new ii("Invalid JWT signature");return{data:{claims:r,header:s,signature:n},error:null}}catch(i){if(n(i))return{data:null,error:i};throw i}}}ki.nextInstanceID=0;const Si=ki;class Ei extends Si{constructor(t){super(t)}}class Ti{constructor(t,e,i){var s,r,n;if(this.supabaseUrl=t,this.supabaseKey=e,!t)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");const o=(a=t).endsWith("/")?a:a+"/";var a;const h=new URL(o);this.realtimeUrl=new URL("realtime/v1",h),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",h),this.storageUrl=new URL("storage/v1",h),this.functionsUrl=new URL("functions/v1",h);const l=`sb-${h.hostname.split(".")[0]}-auth-token`,c=function(t,e){var i,s;const{db:r,auth:n,realtime:o,global:a}=t,{db:h,auth:l,realtime:c,global:u}=e,d={db:Object.assign(Object.assign({},h),r),auth:Object.assign(Object.assign({},l),n),realtime:Object.assign(Object.assign({},c),o),global:Object.assign(Object.assign(Object.assign({},u),a),{headers:Object.assign(Object.assign({},null!==(i=null==u?void 0:u.headers)&&void 0!==i?i:{}),null!==(s=null==a?void 0:a.headers)&&void 0!==s?s:{})}),accessToken:()=>{return t=this,i=function*(){return""},new((e=void 0)||(e=Promise))(function(s,r){function n(t){try{a(i.next(t))}catch(e){r(e)}}function o(t){try{a(i.throw(t))}catch(e){r(e)}}function a(t){var i;t.done?s(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(n,o)}a((i=i.apply(t,[])).next())});var t,e,i}};return t.accessToken?d.accessToken=t.accessToken:delete d.accessToken,d}(null!=i?i:{},{db:De,realtime:Le,auth:Object.assign(Object.assign({},Ce),{storageKey:l}),global:Ne});this.storageKey=null!==(s=c.auth.storageKey)&&void 0!==s?s:"",this.headers=null!==(r=c.global.headers)&&void 0!==r?r:{},c.accessToken?(this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(t,e)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(e)} is not possible`)}})):this.auth=this.Qt(null!==(n=c.auth)&&void 0!==n?n:{},this.headers,c.global.fetch),this.fetch=((t,e,i)=>{const s=(t=>{let e;return e=t||("undefined"==typeof fetch?Y:fetch),(...t)=>e(...t)})(i),r="undefined"==typeof Headers?X:Headers;return(i,n)=>{return a=function*(){var o;const a=null!==(o=yield e())&&void 0!==o?o:t;let h=new r(null==n?void 0:n.headers);return h.has("apikey")||h.set("apikey",t),h.has("Authorization")||h.set("Authorization",`Bearer ${a}`),s(i,Object.assign(Object.assign({},n),{headers:h}))},new((o=void 0)||(o=Promise))(function(t,e){function i(t){try{r(a.next(t))}catch(i){e(i)}}function s(t){try{r(a.throw(t))}catch(i){e(i)}}function r(e){var r;e.done?t(e.value):(r=e.value,r instanceof o?r:new o(function(t){t(r)})).then(i,s)}r((a=a.apply(void 0,[])).next())});var o,a}})(e,this.Zt.bind(this),c.global.fetch),this.realtime=this.te(Object.assign({headers:this.headers,accessToken:this.Zt.bind(this)},c.realtime)),this.rest=new At(new URL("rest/v1",h).href,{headers:this.headers,schema:c.db.schema,fetch:this.fetch}),c.accessToken||this.ee()}get functions(){return new J(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Re(this.storageUrl.href,this.headers,this.fetch)}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},i={}){return this.rest.rpc(t,e,i)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}Zt(){var t,e,i,s,r;return i=this,r=function*(){if(this.accessToken)return yield this.accessToken();const{data:i}=yield this.auth.getSession();return null!==(e=null===(t=i.session)||void 0===t?void 0:t.access_token)&&void 0!==e?e:null},new((s=void 0)||(s=Promise))(function(t,e){function n(t){try{a(r.next(t))}catch(i){e(i)}}function o(t){try{a(r.throw(t))}catch(i){e(i)}}function a(e){var i;e.done?t(e.value):(i=e.value,i instanceof s?i:new s(function(t){t(i)})).then(n,o)}a((r=r.apply(i,[])).next())})}Qt({autoRefreshToken:t,persistSession:e,detectSessionInUrl:i,storage:s,storageKey:r,flowType:n,lock:o,debug:a},h,l){const c={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ei({url:this.authUrl.href,headers:Object.assign(Object.assign({},c),h),storageKey:r,autoRefreshToken:t,persistSession:e,detectSessionInUrl:i,storage:s,flowType:n,lock:o,debug:a,fetch:l,hasCustomAuthorizationHeader:"Authorization"in this.headers})}te(t){return new be(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},null==t?void 0:t.params)}))}ee(){return this.auth.onAuthStateChange((t,e)=>{this.ie(t,"CLIENT",null==e?void 0:e.access_token)})}ie(t,e,i){"TOKEN_REFRESHED"!==t&&"SIGNED_IN"!==t||this.changedAccessToken===i?"SIGNED_OUT"===t&&(this.realtime.setAuth(),"STORAGE"==e&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=i}}const xi=(t,e,i)=>new Ti(t,e,i);!function(){if("undefined"!=typeof window||"undefined"==typeof process||void 0===process.version||null===process.version)return!1;const t=process.version.match(/^v(\d+)\./);t&&parseInt(t[1],10)}();export{U as _,xi as c};
