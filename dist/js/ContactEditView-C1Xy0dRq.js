import{d as r,c as e,C as a,J as o,D as t,U as d,V as i,a0 as n,E as s,r as l,b as u,y as c,W as p,N as m,H as f,Z as b,K as g,X as y,B as v}from"./vue-runtime-Ds28nt_E.js";import{b as x,u as h}from"./vue-router-BP51f1Hv.js";import{c as _}from"./contactsApi-BzU-Ytgk.js";import{C as w}from"./contacts-C4llTsRs.js";import{_ as k}from"./Button.vue_vue_type_script_setup_true_lang-CAoJdBXI.js";import"./supabaseClient-BTp2rsYU.js";import"./supabase-b_GQhF-l.js";import"./yup-D02u5inE.js";const E={class:"space-y-1"},C=["for"],j={key:0,class:"text-danger"},I={class:"relative"},U=["id"],V=r({o:"FormGroup",props:{name:{},label:{},error:{},required:{type:Boolean}},setup(r){const l=r,u=e(()=>`field-${l.name}`),c=e(()=>`error-${l.name}`);return(r,e)=>(s(),a("div",E,[r.label?(s(),a("label",{key:0,for:u.value,class:"block text-sm font-medium text-gray-700"},[d(i(r.label)+" ",1),r.required?(s(),a("span",j,"*")):o("",!0)],8,C)):o("",!0),t("div",I,[n(r.$slots,"default",{fieldId:u.value,hasError:!!r.error,errorId:c.value})]),r.error?(s(),a("p",{key:1,id:c.value,role:"alert",class:"text-sm text-danger"},i(r.error),9,U)):o("",!0)]))}}),q={class:"min-h-screen bg-gray-50 py-8"},z={class:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8"},B={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-8"},A={key:1,class:"bg-white rounded-lg shadow-sm border border-danger p-6"},N={class:"flex items-center mb-4"},M={class:"text-red-700"},$={class:"flex space-x-3"},F={key:2},H={class:"mb-8"},J={class:"flex items-center space-x-3 mb-4"},K={class:"bg-white rounded-lg shadow-lg border-2 border-gray-300 ring-1 ring-gray-100 p-6"},L={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},O=["id","aria-describedby","aria-invalid"],T=["id","aria-describedby","aria-invalid"],D=["id","aria-describedby","aria-invalid"],G=["id","aria-describedby","aria-invalid"],P={class:"md:col-span-2"},S=["id","aria-describedby","aria-invalid"],W={class:"md:col-span-2"},X=["id","aria-describedby","aria-invalid"],Z={class:"md:col-span-2"},Q=["id","aria-describedby","aria-invalid"],R={key:0,class:"mt-6 p-4 border border-danger rounded-md bg-red-50"},Y={class:"flex"},rr={class:"mt-1 text-sm font-medium text-red-700"},er={class:"mt-8 flex justify-end space-x-3"},ar={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"},or=r({o:"ContactEditView",setup(r){const e=x(),n=h(),E=e.params.id,C=l(null),j=l(!0),I=l(null),U=u({first_name:"",last_name:"",organization_id:"",position:"",phone:null,email:null,address:null,city:null,state:null,zip_code:null,website:null,account_manager:null,notes:null,is_primary:!1,advocacy_status:"Neutral",is_key_contact:!1}),or=l({}),tr=l(null),dr=l(!1),ir=async()=>{try{j.value=!0,I.value=null;const r=await _.getContact(E);if(r.success&&r.data){C.value=r.data;const e=w.contactToForm(r.data);Object.assign(U,e)}else I.value=r.error||"Contact not found"}catch(r){I.value="An unexpected error occurred"}finally{j.value=!1}},nr=async()=>{if(C.value&&C.value.id)try{if(dr.value=!0,tr.value=null,!(await(async()=>{try{const r=await w.validateCreate(U);if(r.isValid)return or.value={},!0;{const e={};return r.errors.forEach(r=>{e[r.field]=r.message}),or.value=e,!1}}catch(r){return tr.value="Form validation failed",!1}})()))return;const r=w.formToUpdate(U),e=await _.updateContact(C.value.id,r);e.success&&e.data?n.push(`/contacts/${e.data.id}`):tr.value=e.error||"Failed to update contact"}catch(r){tr.value="An unexpected error occurred"}finally{dr.value=!1}};return c(()=>{ir()}),(r,e)=>{const n=f("router-link");return s(),a("div",q,[t("div",z,[j.value?(s(),a("div",B,e[7]||(e[7]=[t("div",{class:"flex justify-center"},[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})],-1)]))):I.value?(s(),a("div",A,[t("div",N,[e[8]||(e[8]=t("svg",{class:"h-5 w-5 text-danger mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t("span",M,i(I.value),1)]),t("div",$,[p(n,{to:"/",class:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"},{default:m(()=>e[9]||(e[9]=[d(" Back to Contacts ",-1)])),t:1,i:[9]}),p(k,{onClick:ir,variant:"primary"},{default:m(()=>e[10]||(e[10]=[d(" Try Again ",-1)])),t:1,i:[10]})])])):C.value?(s(),a("div",F,[t("div",H,[t("div",J,[p(n,{to:`/contacts/${C.value.id}`,class:"text-gray-500 hover:text-gray-700"},{default:m(()=>e[11]||(e[11]=[t("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),t:1,i:[11]},8,["to"]),e[12]||(e[12]=t("h1",{class:"text-3xl font-bold text-gray-900"},"Edit Contact",-1))]),e[13]||(e[13]=t("p",{class:"text-lg font-medium text-gray-700"},"Update contact information",-1))]),t("div",K,[t("form",{onSubmit:b(nr,["prevent"])},[t("div",L,[p(V,{name:"first_name",label:"First Name",error:or.value.first_name,required:""},{default:m(({fieldId:r,hasError:a,errorId:o})=>[g(t("input",{id:r,"onUpdate:modelValue":e[0]||(e[0]=r=>U.first_name=r),type:"text",required:"",placeholder:"Enter first name","aria-describedby":a?o:void 0,"aria-invalid":a?"true":"false",class:v(["w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:border-transparent transition duration-200 border-gray-300 focus:ring-primary",{"border-danger focus:ring-danger":a}])},null,10,O),[[y,U.first_name]])]),t:1},8,["error"]),p(V,{name:"last_name",label:"Last Name",error:or.value.last_name,required:""},{default:m(({fieldId:r,hasError:a,errorId:o})=>[g(t("input",{id:r,"onUpdate:modelValue":e[1]||(e[1]=r=>U.last_name=r),type:"text",required:"",placeholder:"Enter last name","aria-describedby":a?o:void 0,"aria-invalid":a?"true":"false",class:v(["w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:border-transparent transition duration-200 border-gray-300 focus:ring-primary",{"border-danger focus:ring-danger":a}])},null,10,T),[[y,U.last_name]])]),t:1},8,["error"]),p(V,{name:"email",label:"Email Address",error:or.value.email,required:""},{default:m(({fieldId:r,hasError:a,errorId:o})=>[g(t("input",{id:r,"onUpdate:modelValue":e[2]||(e[2]=r=>U.email=r),type:"email",required:"",placeholder:"Enter email address","aria-describedby":a?o:void 0,"aria-invalid":a?"true":"false",class:v(["w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:border-transparent transition duration-200 border-gray-300 focus:ring-primary",{"border-danger focus:ring-danger":a}])},null,10,D),[[y,U.email]])]),t:1},8,["error"]),p(V,{name:"phone",label:"Phone Number",error:or.value.phone},{default:m(({fieldId:r,hasError:a,errorId:o})=>[g(t("input",{id:r,"onUpdate:modelValue":e[3]||(e[3]=r=>U.phone=r),type:"tel",placeholder:"Enter phone number","aria-describedby":a?o:void 0,"aria-invalid":a?"true":"false",class:v(["w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:border-transparent transition duration-200 border-gray-300 focus:ring-primary",{"border-danger focus:ring-danger":a}])},null,10,G),[[y,U.phone]])]),t:1},8,["error"]),t("div",P,[p(V,{name:"organization",label:"Organization",error:or.value.organization,required:""},{default:m(({fieldId:r,hasError:a,errorId:o})=>[g(t("input",{id:r,"onUpdate:modelValue":e[4]||(e[4]=r=>U.organization_id=r),type:"text",required:"",placeholder:"Enter organization or company name","aria-describedby":a?o:void 0,"aria-invalid":a?"true":"false",class:v(["w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:border-transparent transition duration-200 border-gray-300 focus:ring-primary",{"border-danger focus:ring-danger":a}])},null,10,S),[[y,U.organization_id]])]),t:1},8,["error"])]),t("div",W,[p(V,{name:"title",label:"Job Title",error:or.value.title},{default:m(({fieldId:r,hasError:a,errorId:o})=>[g(t("input",{id:r,"onUpdate:modelValue":e[5]||(e[5]=r=>U.position=r),type:"text",placeholder:"Enter job title","aria-describedby":a?o:void 0,"aria-invalid":a?"true":"false",class:v(["w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:border-transparent transition duration-200 border-gray-300 focus:ring-primary",{"border-danger focus:ring-danger":a}])},null,10,X),[[y,U.position]])]),t:1},8,["error"])]),t("div",Z,[p(V,{name:"notes",label:"Notes",error:or.value.notes},{default:m(({fieldId:r,hasError:a,errorId:o})=>[g(t("textarea",{id:r,"onUpdate:modelValue":e[6]||(e[6]=r=>U.notes=r),rows:"4",placeholder:"Add any additional notes about this contact...","aria-describedby":a?o:void 0,"aria-invalid":a?"true":"false",class:v(["w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:border-transparent transition duration-200 border-gray-300 focus:ring-primary",{"border-danger focus:ring-danger":a}])},null,10,Q),[[y,U.notes]])]),t:1},8,["error"])])]),tr.value?(s(),a("div",R,[t("div",Y,[e[15]||(e[15]=t("svg",{class:"h-5 w-5 text-danger mr-2 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t("div",null,[e[14]||(e[14]=t("h3",{class:"text-base font-semibold text-red-800"},"Error updating contact",-1)),t("p",rr,i(tr.value),1)])])])):o("",!0),t("div",er,[p(n,{to:`/contacts/${C.value.id}`,class:"inline-flex items-center justify-center px-4 py-2 border text-sm font-semibold rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-primary"},{default:m(()=>e[16]||(e[16]=[d(" Cancel ",-1)])),t:1,i:[16]},8,["to"]),p(k,{type:"submit",variant:"primary",disabled:dr.value},{default:m(()=>[dr.value?(s(),a("svg",ar,e[17]||(e[17]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):o("",!0),d(" "+i(dr.value?"Updating...":"Update Contact"),1)]),t:1},8,["disabled"])])],32)])])):o("",!0)])])}}});export{or as default};
