import{u as e}from"./vue-router-BP51f1Hv.js";import{o as t,u as a}from"./organizationStore-B4O_H-mo.js";import{_ as r}from"./Button.vue_vue_type_script_setup_true_lang-CAoJdBXI.js";import{d as o,r as l,c as n,y as s,z as i,w as d,C as c,D as u,J as p,U as m,V as v,B as g,F as b,L as y,E as x,W as f,K as h,M as k,G as w,N as _,O as C,b as B,_ as M,n as V,H as z,u as S}from"./vue-runtime-Ds28nt_E.js";import{_ as j,a as $,u as P}from"./SelectField.vue_vue_type_script_setup_true_lang-Cct1kw6b.js";import{h as A,r as F}from"./heroicons-QXV26b6T.js";import"./pinia-CUC4VGP7.js";import"./supabaseClient-5bv4QPtU.js";import"./supabase-BzUtZ1M4.js";import"./yup-D02u5inE.js";import"./contactsApi-DllDKbAq.js";const E={class:"space-y-1"},O=["for"],N={key:0,class:"text-danger ml-1","aria-label":"required"},T=["id"],U={class:"relative"},I=["id","name","placeholder","disabled","required","value","aria-describedby","aria-invalid","aria-required","aria-expanded","aria-owns"],R=["disabled"],D={key:0,class:"absolute inset-y-0 right-8 flex items-center pr-3","aria-hidden":"true"},q=["id","aria-label"],H={key:0,class:"px-3 py-2 text-sm text-gray-500",role:"option","aria-selected":"false"},L=["aria-selected","onClick","onMouseenter"],J={class:"flex items-center justify-between"},G={key:0,class:"h-4 w-4 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},K={key:0,class:"text-xs text-gray-500 mt-1"},W={key:1,class:"border-t border-gray-200"},Q={class:"flex items-center"},X={key:2,class:"border-t border-gray-200"},Y=["aria-selected","onClick"],Z={class:"flex items-center justify-between"},ee={class:"text-xs text-gray-400"},te=["id"],ae=["id"],re=o({t:"SegmentSelector",props:{name:{},label:{},modelValue:{},options:{default:()=>[]},error:{},placeholder:{default:"Select or type a segment..."},description:{},helpText:{},required:{type:Boolean},disabled:{type:Boolean},loading:{type:Boolean},allowAddNew:{type:Boolean,default:!0},popularSegments:{default:()=>[]},minSearchLength:{default:1},inputClass:{},labelClass:{}},emits:["update:modelValue","add-new","search","focus","blur","validate"],setup(e,{emit:t}){const a=e,r=t,o=l(),f=l(!1),h=l(""),k=l(-1),w=l(!1),_=[{value:"Technology",label:"Technology",description:"Software, hardware, and tech services"},{value:"Healthcare",label:"Healthcare",description:"Medical, pharmaceutical, and health services"},{value:"Finance",label:"Finance",description:"Banking, insurance, and financial services"},{value:"Manufacturing",label:"Manufacturing",description:"Production and industrial companies"},{value:"Retail",label:"Retail",description:"Consumer goods and retail services"},{value:"Education",label:"Education",description:"Schools, universities, and educational services"},{value:"Real Estate",label:"Real Estate",description:"Property development and real estate services"},{value:"Energy",label:"Energy",description:"Oil, gas, renewable energy, and utilities"},{value:"Transportation",label:"Transportation",description:"Logistics, shipping, and transportation"},{value:"Media",label:"Media",description:"Publishing, broadcasting, and entertainment"},{value:"Agriculture",label:"Agriculture",description:"Farming, food production, and agribusiness"},{value:"Construction",label:"Construction",description:"Building and construction services"},{value:"Consulting",label:"Consulting",description:"Business and professional consulting"},{value:"Government",label:"Government",description:"Public sector and government agencies"},{value:"Non-Profit",label:"Non-Profit",description:"Charitable organizations and NGOs"}],C=n(()=>`segment-${a.name}`),B=n(()=>`segment-dropdown-${a.name}`),M=n(()=>`error-${a.name}`),V=n(()=>`desc-${a.name}`),z=n(()=>`help-${a.name}`),S=n(()=>!!a.error),j=n(()=>{const e=[];return a.description&&e.push(V.value),a.error&&e.push(M.value),a.helpText&&!a.error&&e.push(z.value),e.length>0?e.join(" "):void 0}),$=n(()=>{const e=[...a.options||[]];return _.forEach(t=>{e.some(e=>e.value.toLowerCase()===t.value.toLowerCase())||e.push(t)}),e.sort((e,t)=>e.label.localeCompare(t.label))}),P=n(()=>f.value&&""!==h.value?h.value:a.modelValue||""),A=n(()=>{if(!h.value||h.value.length<a.minSearchLength)return $.value.slice(0,10);const e=h.value.toLowerCase();return $.value.filter(t=>{var a;return t.label.toLowerCase().includes(e)||(null==(a=t.description)?void 0:a.toLowerCase().includes(e))}).slice(0,20)}),F=n(()=>!(!a.allowAddNew||!h.value||h.value.length<a.minSearchLength||$.value.some(e=>e.label.toLowerCase()===h.value.toLowerCase()))),re=n(()=>!h.value&&a.popularSegments.length>0),oe=n(()=>`block text-sm font-medium transition-colors duration-200 ${S.value?"text-red-700":w.value?"text-primary-600":"text-gray-700"} ${a.disabled?"opacity-60":""} ${a.labelClass||""}`.trim()),le=n(()=>`w-full px-3 py-2 pr-10 border rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:border-transparent ${S.value?"border-red-500 bg-red-50 focus:ring-red-500 focus:bg-white":w.value?"border-primary-500 bg-white focus:ring-primary-500":"border-gray-300 bg-white hover:border-gray-400 focus:ring-primary-500"} ${a.disabled?"bg-gray-100 text-gray-500 cursor-not-allowed":"cursor-text"} ${a.loading?"pr-16":""} ${a.inputClass||""}`.trim()),ne=n(()=>["absolute z-50 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg","max-h-60 overflow-auto focus:outline-none"].join(" ")),se=e=>{const t=e.target;h.value=t.value,!f.value&&t.value.length>=a.minSearchLength&&pe(),k.value=-1,t.value.length>=a.minSearchLength&&r("search",t.value)},ie=e=>{w.value=!0,r("focus",e),h.value=a.modelValue||"",setTimeout(()=>{pe()},100)},de=e=>{setTimeout(()=>{if(w.value=!1,me(),h.value&&!a.modelValue){const e=$.value.find(e=>e.label.toLowerCase()===h.value.toLowerCase());e?ve(e):a.allowAddNew&&ge()}h.value="",r("blur",e),r("validate",a.modelValue)},200)},ce=e=>{var t;switch(e.key){case"ArrowDown":if(e.preventDefault(),f.value){const e=F.value?A.value.length:A.value.length-1;k.value=Math.min(k.value+1,e)}else pe();break;case"ArrowUp":e.preventDefault(),k.value=Math.max(k.value-1,-1);break;case"Enter":e.preventDefault(),f.value&&(k.value===A.value.length&&F.value?ge():k.value>=0&&k.value<A.value.length&&ve(A.value[k.value]));break;case"Escape":e.preventDefault(),me(),null==(t=o.value)||t.blur();break;case"Tab":me()}},ue=()=>{var e;f.value?me():(pe(),null==(e=o.value)||e.focus())},pe=()=>{a.disabled||(f.value=!0,k.value=-1)},me=()=>{f.value=!1,k.value=-1},ve=e=>{var t;r("update:modelValue",e.value),h.value="",me(),null==(t=o.value)||t.blur()},ge=()=>{var e;if(h.value.trim()){const t=h.value.trim();r("add-new",t),r("update:modelValue",t),h.value="",me(),null==(e=o.value)||e.blur()}},be=e=>{const t=e.target,a=document.getElementById(B.value),r=o.value;a&&r&&!a.contains(t)&&!r.contains(t)&&me()};return s(()=>{document.addEventListener("click",be)}),i(()=>{document.removeEventListener("click",be)}),d(()=>a.modelValue,e=>{w.value||(h.value=e||"")}),(e,t)=>(x(),c("div",E,[u("label",{for:C.value,class:g(oe.value)},[m(v(e.label)+" ",1),e.required?(x(),c("span",N,"*")):p("",!0)],10,O),e.description?(x(),c("p",{key:0,id:V.value,class:"text-sm text-gray-600"},v(e.description),9,T)):p("",!0),u("div",U,[u("input",{id:C.value,ref_key:"inputRef",ref:o,name:e.name,type:"text",placeholder:e.placeholder,disabled:e.disabled,required:e.required,value:P.value,"aria-describedby":j.value,"aria-invalid":S.value,"aria-required":e.required,"aria-expanded":f.value,"aria-haspopup":!0,"aria-owns":B.value,class:g(le.value),autocomplete:"off",onInput:se,onFocus:ie,onBlur:de,onKeydown:ce},null,42,I),u("button",{type:"button",disabled:e.disabled,class:"absolute inset-y-0 right-0 flex items-center pr-2","aria-label":"Toggle dropdown",onClick:ue},[(x(),c("svg",{class:g(["h-4 w-4 transition-transform duration-200",f.value?"rotate-180":"",S.value?"text-red-500":"text-gray-400"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},t[1]||(t[1]=[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))],8,R),e.loading?(x(),c("div",D,t[2]||(t[2]=[u("svg",{class:"h-4 w-4 animate-spin text-gray-400",fill:"none",viewBox:"0 0 24 24"},[u("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),u("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):p("",!0),f.value?(x(),c("div",{key:1,id:B.value,class:g(ne.value),role:"listbox","aria-label":`${e.label} options`},[0!==A.value.length||F.value?p("",!0):(x(),c("div",H," No segments found ")),(x(!0),c(b,null,y(A.value,(a,r)=>(x(),c("button",{key:a.value,type:"button",class:g(["w-full text-left px-3 py-2 text-sm hover:bg-gray-100 focus:bg-gray-100 focus:outline-none",r===k.value?"bg-primary-50 text-primary-900":"text-gray-900"]),role:"option","aria-selected":a.value===e.modelValue,onClick:e=>ve(a),onMouseenter:e=>k.value=r},[u("div",J,[u("span",null,v(a.label),1),a.value===e.modelValue?(x(),c("svg",G,t[3]||(t[3]=[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):p("",!0)]),a.description?(x(),c("p",K,v(a.description),1)):p("",!0)],42,L))),128)),F.value?(x(),c("div",W,[u("button",{type:"button",class:g(["w-full text-left px-3 py-2 text-sm hover:bg-blue-50 focus:bg-blue-50 focus:outline-none",k.value===A.value.length?"bg-blue-50 text-blue-900":"text-blue-700"]),role:"option","aria-selected":"false",onClick:ge,onMouseenter:t[0]||(t[0]=e=>k.value=A.value.length)},[u("div",Q,[t[4]||(t[4]=u("svg",{class:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1)),m(' Add new segment: "'+v(h.value)+'" ',1)])],34)])):p("",!0),re.value&&e.popularSegments.length>0?(x(),c("div",X,[t[5]||(t[5]=u("div",{class:"px-3 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wide"}," Popular Segments ",-1)),(x(!0),c(b,null,y(e.popularSegments,t=>(x(),c("button",{key:`popular-${t.value}`,type:"button",class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 focus:bg-gray-100 focus:outline-none",role:"option","aria-selected":t.value===e.modelValue,onClick:e=>ve(t)},[u("div",Z,[u("span",null,v(t.label),1),u("span",ee,v(t.count)+" orgs",1)])],8,Y))),128))])):p("",!0)],10,q)):p("",!0)]),e.error?(x(),c("p",{key:1,id:M.value,role:"alert",class:"text-sm text-danger flex items-center space-x-1"},[t[6]||(t[6]=u("svg",{class:"h-4 w-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),u("span",null,v(e.error),1)],8,te)):p("",!0),e.helpText&&!e.error?(x(),c("p",{key:2,id:z.value,class:"text-sm text-gray-500"},v(e.helpText),9,ae)):p("",!0)]))}}),oe={class:"space-y-4 md:space-y-6"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6"},ne={class:"md:col-span-2"},se={class:"space-y-4"},ie=["aria-expanded"],de={class:"flex items-center"},ce={class:"text-xs text-gray-500"},ue={id:"advanced-options",class:"space-y-4 pl-6 border-l-2 border-gray-200 animate-in slide-in-from-top-2 duration-200"},pe={class:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6"},me={class:"space-y-3"},ve={class:"space-y-2"},ge={class:"flex items-center"},be=["checked"],ye={class:"flex items-center"},xe=["checked"],fe=o({t:"OrganizationStepOne",props:{modelValue:{},errors:{},loading:{type:Boolean,default:!1}},emits:["update:modelValue","validate"],setup(e,{emit:a}){const r=e,o=a,i=l(!1),b=[{value:90,label:"A",description:"Highest priority - Strategic accounts and major opportunities"},{value:70,label:"B",description:"High priority - Important prospects and qualified leads"},{value:50,label:"C",description:"Medium priority - Regular prospects and opportunities"},{value:30,label:"D",description:"Low priority - New prospects and informational contacts"}],y=[{value:"Prospect",label:"Prospect",description:"Potential customer or client"},{value:"Active",label:"Active",description:"Currently engaged organization"},{value:"Customer",label:"Customer",description:"Paying customer or client"},{value:"Partner",label:"Partner",description:"Business partner or alliance"},{value:"Vendor",label:"Vendor",description:"Service or product provider"},{value:"Inactive",label:"Inactive",description:"No longer active relationship"}],_=[{value:"Food & Beverage - Manufacturing",label:"Food & Beverage - Manufacturing",description:"Food and beverage production companies"},{value:"Food & Beverage - Distribution",label:"Food & Beverage - Distribution",description:"Food and beverage distribution companies"},{value:"Food & Beverage - Retail",label:"Food & Beverage - Retail",description:"Food and beverage retail outlets"},{value:"Food & Beverage - Restaurant",label:"Food & Beverage - Restaurant",description:"Restaurants and food service establishments"},{value:"Technology",label:"Technology",description:"Software, hardware, and tech services"},{value:"Healthcare",label:"Healthcare",description:"Medical and health services"},{value:"Finance",label:"Finance",description:"Banking and financial services"},{value:"Manufacturing",label:"Manufacturing",description:"Production and industrial"},{value:"Retail",label:"Retail",description:"Consumer goods and services"},{value:"Professional Services",label:"Professional Services",description:"Consulting and professional services"}],C=[{value:"Food & Beverage - Manufacturing",label:"Food & Beverage - Manufacturing",count:312},{value:"Food & Beverage - Distribution",label:"Food & Beverage - Distribution",count:287},{value:"Food & Beverage - Restaurant",label:"Food & Beverage - Restaurant",count:245},{value:"Technology",label:"Technology",count:189},{value:"Manufacturing",label:"Manufacturing",count:156}],B=[{value:"dist-1",label:"ABC Distribution Corp",description:"National food distributor"},{value:"dist-2",label:"XYZ Supply Chain",description:"Regional beverage distributor"},{value:"dist-3",label:"Global Foods Distribution",description:"International food distributor"}],M=[{value:"am-1",label:"John Smith",description:"Senior Account Manager"},{value:"am-2",label:"Sarah Johnson",description:"Account Manager - Food & Beverage"},{value:"am-3",label:"Mike Davis",description:"Regional Account Manager"}],V=n(()=>{const e=r.modelValue.lead_score;return null==e?"":e>=90?90:e>=70?70:e>=50?50:30}),z=n(()=>!0===r.modelValue.is_principal),S=n(()=>!0===r.modelValue.is_distributor),P=(e,t)=>{const a={...r.modelValue,[e]:t};o("update:modelValue",a)},A=e=>{const t=Array.isArray(e)?e[0]:e,a="string"==typeof t?parseInt(t):t;P("lead_score",a)},F=(e,t)=>{"principal"===e?t?(P("is_principal",!0),P("is_distributor",!1),P("distributor_id","")):P("is_principal",!1):"distributor"===e&&(t?(P("is_distributor",!0),P("is_principal",!1),P("distributor_id","")):P("is_distributor",!1))},E=async(e,t)=>{await O()},O=async()=>{const e={};let a=!0;try{const e={name:r.modelValue.name,industry:r.modelValue.industry,lead_score:r.modelValue.lead_score,status:r.modelValue.status,is_principal:r.modelValue.is_principal,is_distributor:r.modelValue.is_distributor,distributor_id:r.modelValue.distributor_id,account_manager_id:r.modelValue.account_manager_id},a=t.pick(["name","industry","lead_score","status"]);await a.validate(e,{abortEarly:!1})}catch(l){a=!1,l.inner&&l.inner.forEach(t=>{if(t.path){const a="industry"===t.path?"segment":"lead_score"===t.path?"priority":t.path;e[a]=t.message}})}o("validate",1,a,e)},N=e=>{P("industry",e)},T=e=>{};return d(()=>[r.modelValue.name,r.modelValue.industry,r.modelValue.lead_score,r.modelValue.status,r.modelValue.is_principal,r.modelValue.is_distributor,r.modelValue.distributor_id,r.modelValue.account_manager_id],async()=>{await O()},{immediate:!0}),s(async()=>{await O()}),(e,t)=>(x(),c("div",oe,[u("div",le,[u("div",ne,[f(j,{name:"name",label:"Organization Name",type:"text","model-value":e.modelValue.name||"",error:e.errors.name,placeholder:"Enter the organization name",required:"",autocomplete:"organization","onUpdate:modelValue":t[0]||(t[0]=e=>P("name",e)),onValidate:t[1]||(t[1]=e=>E())},null,8,["model-value","error"])]),f($,{name:"priority",label:"Priority","model-value":V.value,options:b,error:e.errors.priority||e.errors.lead_score,placeholder:"Select organization priority",required:"","onUpdate:modelValue":A,onValidate:t[2]||(t[2]=e=>E())},null,8,["model-value","error"]),f($,{name:"status",label:"Organization Status","model-value":e.modelValue.status||"Prospect",options:y,error:e.errors.status,placeholder:"Select organization status","onUpdate:modelValue":t[3]||(t[3]=e=>P("status",e)),onValidate:t[4]||(t[4]=e=>E())},null,8,["model-value","error"])]),f(re,{name:"segment",label:"Segment","model-value":e.modelValue.industry||"",error:e.errors.segment||e.errors.industry,options:_,"popular-segments":C,placeholder:"Select or type an industry segment...",required:"","allow-add-new":"","onUpdate:modelValue":t[5]||(t[5]=e=>P("industry",e)),onAddNew:N,onSearch:T,onValidate:t[6]||(t[6]=e=>E())},null,8,["model-value","error"]),u("div",se,[u("button",{type:"button",onClick:t[7]||(t[7]=e=>i.value=!i.value),class:"flex items-center justify-between w-full p-3 text-left text-sm font-medium text-gray-700 bg-gray-50 hover:bg-gray-100 rounded-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2","aria-expanded":i.value,"aria-controls":"advanced-options"},[u("span",de,[(x(),c("svg",{class:g(["h-4 w-4 mr-2 transition-transform duration-200",i.value?"rotate-90":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},t[14]||(t[14]=[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)]),2)),t[15]||(t[15]=m(" Advanced Options ",-1))]),u("span",ce,v(i.value?"Hide":"Show")+" additional fields ",1)],8,ie),h(u("div",ue,[u("div",pe,[u("div",me,[t[18]||(t[18]=u("label",{class:"block text-sm font-medium text-gray-700"}," Business Type ",-1)),u("div",ve,[u("div",ge,[u("input",{id:"principal",name:"business-type",type:"checkbox",checked:z.value,onChange:t[8]||(t[8]=e=>F("principal",e.target.checked)),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,40,be),t[16]||(t[16]=u("label",{for:"principal",class:"ml-2 block text-sm text-gray-900"}," Principal ",-1))]),u("div",ye,[u("input",{id:"distributor",name:"business-type",type:"checkbox",checked:S.value,onChange:t[9]||(t[9]=e=>F("distributor",e.target.checked)),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,40,xe),t[17]||(t[17]=u("label",{for:"distributor",class:"ml-2 block text-sm text-gray-900"}," Distributor ",-1))])])]),f($,{name:"account_manager_id",label:"Account Manager","model-value":e.modelValue.account_manager_id||"",options:M,error:e.errors.account_manager_id,placeholder:"Select an account manager","onUpdate:modelValue":t[10]||(t[10]=e=>P("account_manager_id",e)),onValidate:t[11]||(t[11]=e=>E())},null,8,["model-value","error"])]),S.value?p("",!0):(x(),w($,{key:0,name:"distributor_id",label:"Distributor","model-value":e.modelValue.distributor_id||"",options:B,error:e.errors.distributor_id,placeholder:"Select a distributor","onUpdate:modelValue":t[12]||(t[12]=e=>P("distributor_id",e)),onValidate:t[13]||(t[13]=e=>E())},null,8,["model-value","error"]))],512),[[k,i.value]])])]))}}),he={class:"space-y-4 md:space-y-6"},ke={class:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6"},we={class:"md:col-span-2"},_e={class:"md:col-span-2"},Ce={class:"space-y-4"},Be={class:"space-y-2"},Me=["value"],Ve={key:0,class:"text-sm text-red-600"},ze=o({t:"OrganizationStepTwo",props:{modelValue:{},errors:{},loading:{type:Boolean,default:!1}},emits:["update:modelValue","validate"],setup(e,{emit:t}){const a=e,r=t,o=(e,t)=>{const o={...a.modelValue,[e]:t};r("update:modelValue",o)},l=(e,t)=>{n()},n=()=>{r("validate",2,!0,{})};return d(()=>[a.modelValue.address_line_1,a.modelValue.address_line_2,a.modelValue.city,a.modelValue.state_province,a.modelValue.postal_code,a.modelValue.primary_phone,a.modelValue.description],()=>{n()},{immediate:!0}),s(()=>{n()}),(e,t)=>(x(),c("div",he,[t[16]||(t[16]=u("div",null,[u("h3",{class:"text-base font-medium text-gray-900 mb-1"},"Address Information"),u("p",{class:"text-sm text-gray-600 mb-4"}," Provide the organization's address and contact details ")],-1)),u("div",ke,[u("div",we,[f(j,{name:"address_line_1",label:"Address Line 1",type:"text","model-value":e.modelValue.address_line_1||"",error:e.errors.address_line_1,placeholder:"Enter street address","onUpdate:modelValue":t[0]||(t[0]=e=>o("address_line_1",e)),onValidate:t[1]||(t[1]=e=>l())},null,8,["model-value","error"])]),u("div",_e,[f(j,{name:"address_line_2",label:"Address Line 2",type:"text","model-value":e.modelValue.address_line_2||"",error:e.errors.address_line_2,placeholder:"Apt, suite, unit, etc. (optional)","onUpdate:modelValue":t[2]||(t[2]=e=>o("address_line_2",e)),onValidate:t[3]||(t[3]=e=>l())},null,8,["model-value","error"])]),f(j,{name:"city",label:"City",type:"text","model-value":e.modelValue.city||"",error:e.errors.city,placeholder:"Enter city","onUpdate:modelValue":t[4]||(t[4]=e=>o("city",e)),onValidate:t[5]||(t[5]=e=>l())},null,8,["model-value","error"]),f(j,{name:"state_province",label:"State",type:"text","model-value":e.modelValue.state_province||"",error:e.errors.state_province,placeholder:"Enter state","onUpdate:modelValue":t[6]||(t[6]=e=>o("state_province",e)),onValidate:t[7]||(t[7]=e=>l())},null,8,["model-value","error"]),f(j,{name:"postal_code",label:"Postal Code",type:"text","model-value":e.modelValue.postal_code||"",error:e.errors.postal_code,placeholder:"Enter postal/zip code","onUpdate:modelValue":t[8]||(t[8]=e=>o("postal_code",e)),onValidate:t[9]||(t[9]=e=>l())},null,8,["model-value","error"]),f(j,{name:"primary_phone",label:"Office Phone",type:"tel","model-value":e.modelValue.primary_phone||"",error:e.errors.primary_phone,placeholder:"Enter office phone number","onUpdate:modelValue":t[10]||(t[10]=e=>o("primary_phone",e)),onValidate:t[11]||(t[11]=e=>l())},null,8,["model-value","error"])]),u("div",Ce,[t[15]||(t[15]=u("div",null,[u("h4",{class:"text-md font-medium text-gray-900 mb-2"},"Notes & Description"),u("p",{class:"text-sm text-gray-600"}," Additional information about the organization ")],-1)),u("div",Be,[t[14]||(t[14]=u("label",{for:"description",class:"block text-sm font-medium text-gray-700"}," Notes & Description ",-1)),u("textarea",{id:"description",name:"description",rows:"4",value:e.modelValue.description||"",class:g(["w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2",e.errors.description?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-blue-500"]),placeholder:"Enter any additional notes or description about the organization...",onInput:t[12]||(t[12]=e=>o("description",e.target.value)),onBlur:t[13]||(t[13]=e=>l(0,e.target.value))},null,42,Me),e.errors.description?(x(),c("p",Ve,v(e.errors.description),1)):p("",!0)])])]))}}),Se={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},je={class:"flex items-center justify-between mb-4"},$e={class:"flex items-center space-x-3"},Pe={class:"text-md font-medium text-gray-900"},Ae={key:1,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Fe=["aria-label"],Ee={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Oe={key:0,class:"mt-4 p-3 bg-white border border-gray-200 rounded-md"},Ne={class:"flex items-start space-x-3"},Te={class:"flex-1 min-w-0"},Ue={class:"text-sm font-medium text-gray-900"},Ie={key:0,class:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800"},Re={class:"text-sm text-gray-500"},De={key:0,class:"text-xs text-gray-400"},qe={key:0},He={key:1,class:"text-xs text-gray-400"},Le={key:1,class:"mt-3"},Je={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},Ge={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},Ke=o({t:"QuickContactForm",props:{modelValue:{},errors:{},contactNumber:{},showRemove:{type:Boolean,default:!0},isPrimary:{type:Boolean,default:!1},showSetPrimary:{type:Boolean,default:!0}},emits:["update:modelValue","remove","set-primary"],setup(e,{emit:t}){const a=e,r=t,o=n(()=>{var e,t,r;return(null==(e=a.modelValue.first_name)?void 0:e.trim())&&(null==(t=a.modelValue.last_name)?void 0:t.trim())&&(null==(r=a.modelValue.email)?void 0:r.trim())}),l=n(()=>{const e=Object.keys(a.errors).length,t=["first_name","last_name","email"],r=t.filter(e=>{var t;return null==(t=a.modelValue[e])?void 0:t.trim()}).length;return e>0?{isValid:!1,message:`${e} validation error${e>1?"s":""} found`}:r===t.length?{isValid:!0,message:"Contact information is complete"}:{isValid:!1,message:`${t.length-r} required field${t.length-r>1?"s":""} remaining`}}),s=(e,t)=>{var o;const l=Array.isArray(t)?(null==(o=t[0])?void 0:o.toString())||"":(null==t?void 0:t.toString())||"",n={...a.modelValue,[e]:l};r("update:modelValue",n)};return(e,t)=>(x(),c("div",Se,[u("div",je,[u("div",$e,[u("h4",Pe," Contact "+v(e.contactNumber),1),!e.isPrimary&&e.showSetPrimary?(x(),c("button",{key:0,type:"button",onClick:t[0]||(t[0]=t=>e.$emit("set-primary")),class:"inline-flex items-center px-2 py-1 text-xs font-medium rounded border border-gray-300 text-gray-700 bg-white hover:bg-blue-50 hover:text-blue-700 hover:border-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors"}," Set as Primary ")):e.isPrimary?(x(),c("span",Ae,t[12]||(t[12]=[u("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),m(" Primary Contact ",-1)]))):p("",!0)]),e.showRemove?(x(),c("button",{key:0,type:"button",onClick:t[1]||(t[1]=t=>e.$emit("remove")),class:"text-red-600 hover:text-red-800 transition-colors","aria-label":`Remove contact ${e.contactNumber}`},t[13]||(t[13]=[u("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,Fe)):p("",!0)]),u("div",Ee,[f(j,{name:`contact_${e.contactNumber}_first_name`,label:"First Name",type:"text","model-value":e.modelValue.first_name,error:e.errors.first_name,placeholder:"Enter first name",required:"","onUpdate:modelValue":t[2]||(t[2]=e=>s("first_name",e)),onBlur:t[3]||(t[3]=e=>{})},null,8,["name","model-value","error"]),f(j,{name:`contact_${e.contactNumber}_last_name`,label:"Last Name",type:"text","model-value":e.modelValue.last_name,error:e.errors.last_name,placeholder:"Enter last name",required:"","onUpdate:modelValue":t[4]||(t[4]=e=>s("last_name",e)),onBlur:t[5]||(t[5]=e=>{})},null,8,["name","model-value","error"]),f(j,{name:`contact_${e.contactNumber}_email`,label:"Email Address",type:"email","model-value":e.modelValue.email,error:e.errors.email,placeholder:"Enter email address",required:"",autocomplete:"email","onUpdate:modelValue":t[6]||(t[6]=e=>s("email",e)),onBlur:t[7]||(t[7]=e=>{})},null,8,["name","model-value","error"]),f(j,{name:`contact_${e.contactNumber}_phone`,label:"Phone Number",type:"tel","model-value":e.modelValue.phone,error:e.errors.phone,placeholder:"Enter phone number",autocomplete:"tel","onUpdate:modelValue":t[8]||(t[8]=e=>s("phone",e)),onBlur:t[9]||(t[9]=e=>{})},null,8,["name","model-value","error"]),f(j,{name:`contact_${e.contactNumber}_position`,label:"Job Title",type:"text","model-value":e.modelValue.position,error:e.errors.position,placeholder:"Enter job title",autocomplete:"organization","onUpdate:modelValue":t[10]||(t[10]=e=>s("position",e))},null,8,["name","model-value","error"]),f(j,{name:`contact_${e.contactNumber}_department`,label:"Department",type:"text","model-value":e.modelValue.department,error:e.errors.department,placeholder:"Enter department","onUpdate:modelValue":t[11]||(t[11]=e=>s("department",e))},null,8,["name","model-value","error"])]),o.value?(x(),c("div",Oe,[u("div",Ne,[t[14]||(t[14]=u("div",{class:"flex-shrink-0"},[u("div",{class:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center"},[u("svg",{class:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})])])],-1)),u("div",Te,[u("p",Ue,[m(v(e.modelValue.first_name)+" "+v(e.modelValue.last_name)+" ",1),e.isPrimary?(x(),c("span",Ie," Primary ")):p("",!0)]),u("p",Re,v(e.modelValue.email),1),e.modelValue.position?(x(),c("p",De,[m(v(e.modelValue.position)+" ",1),e.modelValue.department?(x(),c("span",qe," â€¢ "+v(e.modelValue.department),1)):p("",!0)])):p("",!0),e.modelValue.phone?(x(),c("p",He,v(e.modelValue.phone),1)):p("",!0)])])])):p("",!0),l.value?(x(),c("div",Le,[u("div",{class:g(["flex items-center text-xs px-2 py-1 rounded",l.value.isValid?"bg-green-50 text-green-700":"bg-red-50 text-red-700"])},[(x(),c("svg",{class:g(["w-4 h-4 mr-1",l.value.isValid?"text-green-400":"text-red-400"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l.value.isValid?(x(),c("path",Je)):(x(),c("path",Ge))],2)),m(" "+v(l.value.message),1)],2)])):p("",!0)]))}}),We={class:"space-y-6"},Qe={class:"flex items-center justify-center space-x-4"},Xe={key:0,class:"space-y-4"},Ye={class:"relative"},Ze={key:0,class:"space-y-2"},et={class:"flex items-center justify-between"},tt={class:"text-xs text-gray-500"},at={class:"max-h-64 overflow-y-auto border border-gray-200 rounded-md bg-white"},rt={class:"flex items-center space-x-3"},ot=["id","checked","onChange"],lt={class:"flex-1"},nt=["for"],st={class:"text-xs text-gray-500"},it={key:0,class:"text-xs text-gray-400"},dt={class:"flex items-center space-x-2"},ct={key:0,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},ut=["onClick","disabled"],pt={key:1,class:"text-center py-8"},mt={class:"mt-2 text-sm text-gray-500"},vt={key:2,class:"text-center py-4"},gt={key:3,class:"mt-6"},bt={class:"flex items-center justify-between mb-3"},yt={class:"text-sm font-medium text-gray-700"},xt={class:"space-y-2"},ft={class:"flex items-center space-x-3"},ht={class:"flex-1"},kt={class:"text-sm font-medium text-gray-900"},wt={key:0,class:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800"},_t=["onClick","aria-label"],Ct={key:1,class:"space-y-4"},Bt={key:0,class:"space-y-6"},Mt={key:1,class:"text-center py-8"},Vt={key:2,class:"p-3 bg-red-50 border border-red-200 rounded-md",role:"alert"},zt={class:"flex items-start"},St={class:"text-sm text-red-700"},jt=o({t:"ContactMultiSelector",props:{modelValue:{},error:{},loading:{type:Boolean,default:!1}},emits:["update:modelValue","validate"],setup(e,{emit:t}){var a;const r=e,o=t,i=P(),h=l(r.modelValue.mode||"select"),k=l(""),B=l(r.modelValue.selectedContactIds||[]),M=l(r.modelValue.newContacts||[]),V=l(null!=(a=r.modelValue.primaryContactIndex)?a:-1),z=l({}),S=l(!1),$=n(()=>{if(!k.value)return i.contacts.slice(0,20);const e=k.value.toLowerCase();return i.contacts.filter(t=>{var a,r,o,l;return(null==(a=t.first_name)?void 0:a.toLowerCase().includes(e))||(null==(r=t.last_name)?void 0:r.toLowerCase().includes(e))||(null==(o=t.email)?void 0:o.toLowerCase().includes(e))||(null==(l=t.position)?void 0:l.toLowerCase().includes(e))}).slice(0,50)}),A=e=>{h.value=e,"select"===e?(M.value=[],V.value=-1,z.value={}):(B.value=[],k.value=""),U()},F=()=>{B.value=[],U()},E=e=>{U({primaryContactId:e})},O=()=>r.modelValue.primaryContactId||B.value[0],N=e=>{const t=i.contacts.find(t=>t.id===e);return t&&`${t.first_name||""} ${t.last_name||""}`.trim()||"Unknown Contact"},T=()=>{const e={tempId:`temp_${Date.now()}_${Math.random()}`,first_name:"",last_name:"",email:"",phone:"",position:"",department:""};M.value.push(e),1===M.value.length&&(V.value=0),U()},U=(e={})=>{const t={mode:h.value,selectedContactIds:[...B.value],newContacts:[...M.value],primaryContactId:O(),primaryContactIndex:V.value,...e};o("update:modelValue",t);const a=I();o("validate",a,{})},I=()=>{let e=!0;return"select"===h.value?0===B.value.length&&(e=!1):"create"===h.value&&(0===M.value.length?e=!1:M.value.forEach(t=>{const a={};t.first_name.trim()||(a.first_name="First name is required",e=!1),t.last_name.trim()||(a.last_name="Last name is required",e=!1),t.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email)||(a.email="Please enter a valid email address",e=!1):(a.email="Email is required",e=!1),Object.keys(a).length>0&&(z.value[t.tempId]=a)})),e},R=()=>{var e;h.value=r.modelValue.mode||"select",B.value=[...r.modelValue.selectedContactIds||[]],M.value=[...r.modelValue.newContacts||[]],V.value=null!=(e=r.modelValue.primaryContactIndex)?e:-1};return d(()=>r.modelValue,R,{deep:!0}),s(async()=>{await i.fetchContacts(),R();const e=I();o("validate",e,{})}),(e,t)=>(x(),c("div",We,[u("div",Qe,[u("button",{type:"button",class:g(["px-4 py-2 rounded-md font-medium text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors","select"===h.value?"bg-blue-100 text-blue-800 border border-blue-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"]),onClick:t[0]||(t[0]=e=>A("select"))},t[4]||(t[4]=[u("svg",{class:"w-4 h-4 mr-2 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1),m(" Select Existing Contacts ",-1)]),2),u("button",{type:"button",class:g(["px-4 py-2 rounded-md font-medium text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors","create"===h.value?"bg-blue-100 text-blue-800 border border-blue-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"]),onClick:t[1]||(t[1]=e=>A("create"))},t[5]||(t[5]=[u("svg",{class:"w-4 h-4 mr-2 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),m(" Create New Contacts ",-1)]),2)]),"select"===h.value?(x(),c("div",Xe,[u("div",Ye,[f(j,{name:"contact_search",label:"Search Contacts",type:"text","model-value":k.value,placeholder:"Type to search for existing contacts...","onUpdate:modelValue":t[2]||(t[2]=e=>(async e=>{if(k.value=e,e.length>=2){S.value=!0;try{await i.searchContacts(e)}finally{S.value=!1}}})(String(e)))},{icon:_(()=>t[6]||(t[6]=[u("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)])),o:1},8,["model-value"])]),$.value.length>0?(x(),c("div",Ze,[u("div",et,[t[7]||(t[7]=u("h4",{class:"text-sm font-medium text-gray-700"},"Available Contacts",-1)),u("span",tt,v($.value.length)+" found",1)]),u("div",at,[(x(!0),c(b,null,y($.value,e=>(x(),c("div",{key:e.id||e.email||`contact-${Math.random()}`,class:"flex items-center justify-between p-3 hover:bg-gray-50 border-b border-gray-100 last:border-b-0 transition-colors"},[u("div",rt,[u("input",{id:`contact-${e.id||"unknown"}`,type:"checkbox",checked:!!e.id&&B.value.includes(e.id),onChange:t=>{return e.id&&(a=e.id,t.target.checked?B.value.includes(a)||(B.value.push(a),1===B.value.length&&E(a)):(B.value=B.value.filter(e=>e!==a),O()===a&&B.value.length>0&&E(B.value[0])),void U());var a},class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,40,ot),u("div",lt,[u("label",{for:`contact-${e.id||"unknown"}`,class:"text-sm font-medium text-gray-900 cursor-pointer block"},v(e.first_name)+" "+v(e.last_name),9,nt),u("p",st,v(e.email),1),e.position?(x(),c("p",it,v(e.position),1)):p("",!0)])]),u("div",dt,[e.id&&O()===e.id?(x(),c("span",ct," Primary ")):p("",!0),e.id&&B.value.includes(e.id)?(x(),c("button",{key:1,type:"button",onClick:t=>e.id&&E(e.id),class:g(["text-xs px-2 py-1 rounded border transition-colors",O()===e.id?"bg-blue-50 text-blue-600 border-blue-200 cursor-default":"bg-gray-50 text-gray-600 border-gray-200 hover:bg-blue-50 hover:text-blue-600"]),disabled:!e.id||O()===e.id},v(O()===e.id?"Primary":"Set Primary"),11,ut)):p("",!0)])]))),128))])])):k.value&&!S.value?(x(),c("div",pt,[t[8]||(t[8]=u("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),u("p",mt,'No contacts found matching "'+v(k.value)+'"',1),u("button",{type:"button",onClick:t[3]||(t[3]=e=>A("create")),class:"mt-2 text-sm text-blue-600 hover:text-blue-500"}," Create a new contact instead ")])):p("",!0),S.value?(x(),c("div",vt,t[9]||(t[9]=[C('<div class="inline-flex items-center"><svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-blue-600" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span class="text-sm text-gray-600">Searching contacts...</span></div>',1)]))):p("",!0),B.value.length>0?(x(),c("div",gt,[u("div",bt,[u("h4",yt," Selected Contacts ("+v(B.value.length)+") ",1),u("button",{type:"button",onClick:F,class:"text-xs text-gray-500 hover:text-gray-700"}," Clear all ")]),u("div",xt,[(x(!0),c(b,null,y(B.value,e=>(x(),c("div",{key:e,class:"flex items-center justify-between bg-blue-50 border border-blue-200 p-3 rounded-md"},[u("div",ft,[u("div",ht,[u("span",kt,v(N(e)),1),O()===e?(x(),c("span",wt," Primary Contact ")):p("",!0)])]),u("button",{type:"button",onClick:t=>(e=>{B.value=B.value.filter(t=>t!==e),O()===e&&B.value.length>0&&E(B.value[0]),U()})(e),class:"text-red-600 hover:text-red-800 transition-colors","aria-label":`Remove ${N(e)}`},t[10]||(t[10]=[u("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,_t)]))),128))])])):p("",!0)])):"create"===h.value?(x(),c("div",Ct,[u("div",{class:"text-center"},[u("button",{type:"button",onClick:T,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"},t[11]||(t[11]=[u("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),m(" Add New Contact ",-1)]))]),M.value.length>0?(x(),c("div",Bt,[(x(!0),c(b,null,y(M.value,(e,t)=>(x(),w(Ke,{key:e.tempId,"model-value":e,errors:z.value[e.tempId]||{},"contact-number":t+1,"show-remove":M.value.length>1,"is-primary":V.value===t,"onUpdate:modelValue":e=>((e,t)=>{M.value[e]&&(M.value[e]={...t},z.value[t.tempId]&&(z.value[t.tempId]={}),U())})(t,e),onRemove:e=>(e=>{const t=M.value[e];M.value.splice(e,1),z.value[t.tempId]&&delete z.value[t.tempId],V.value===e?V.value=M.value.length>0?0:-1:V.value>e&&V.value--,U()})(t),onSetPrimary:e=>(e=>{V.value=e,U()})(t)},null,8,["model-value","errors","contact-number","show-remove","is-primary","onUpdate:modelValue","onRemove","onSetPrimary"]))),128))])):(x(),c("div",Mt,t[12]||(t[12]=[u("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1),u("p",{class:"mt-2 text-sm text-gray-500"},"No contacts added yet",-1),u("p",{class:"text-xs text-gray-400"},'Click "Add New Contact" to get started',-1)])))])):p("",!0),e.error?(x(),c("div",Vt,[u("div",zt,[t[13]||(t[13]=u("svg",{class:"w-5 h-5 text-red-400 mr-2 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),u("p",St,v(e.error),1)])])):p("",!0)]))}}),$t={class:"space-y-6"},Pt={class:"space-y-4"},At={key:0,class:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-md"},Ft={class:"flex items-start"},Et={class:"flex-1"},Ot={class:"mt-2 text-sm text-blue-700"},Nt={key:0},Tt={key:1},Ut={key:2,class:"mt-1"},It=o({t:"OrganizationStepThree",props:{modelValue:{},errors:{},loading:{type:Boolean,default:!1}},emits:["update:modelValue","validate"],setup(e,{emit:t}){const a=e,r=t,o=P(),i=l({mode:"select",selectedContactIds:[],newContacts:[],primaryContactId:void 0,primaryContactIndex:-1}),g=l(""),b=l(!1),y=n(()=>"select"===i.value.mode?i.value.selectedContactIds.length>0:i.value.newContacts.length>0),h=n(()=>{if("select"===i.value.mode&&i.value.primaryContactId){const e=o.contacts.find(e=>e.id===i.value.primaryContactId);return e?`${e.first_name} ${e.last_name}`:void 0}if("create"===i.value.mode&&void 0!==i.value.primaryContactIndex&&i.value.primaryContactIndex>=0){const e=i.value.newContacts[i.value.primaryContactIndex];return e?`${e.first_name} ${e.last_name}`:void 0}}),k=e=>{i.value={...e},_()},w=(e,t)=>{b.value=e,g.value=t.contacts||"",r("validate",3,e,t)},_=()=>{const e={...a.modelValue};e.custom_fields={...e.custom_fields,contact_mode:i.value.mode,selected_contact_ids:i.value.selectedContactIds,new_contacts:i.value.newContacts,primary_contact_id:i.value.primaryContactId,primary_contact_index:i.value.primaryContactIndex},r("update:modelValue",e)},C=()=>{var e;const t=a.modelValue.custom_fields;t&&(i.value={mode:t.contact_mode||"select",selectedContactIds:t.selected_contact_ids||[],newContacts:t.new_contacts||[],primaryContactId:t.primary_contact_id,primaryContactIndex:null!=(e=t.primary_contact_index)?e:-1})};return d(()=>a.modelValue.custom_fields,()=>{C()},{deep:!0}),s(async()=>{await o.fetchContacts(),C()}),(e,t)=>(x(),c("div",$t,[u("div",Pt,[t[3]||(t[3]=u("div",{class:"text-center"},[u("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Contact Information"),u("p",{class:"text-sm text-gray-600 mb-6"}," Select existing contacts or create new contacts for this organization ")],-1)),f(jt,{"model-value":i.value,error:g.value,loading:e.loading,"onUpdate:modelValue":k,onValidate:w},null,8,["model-value","error","loading"]),y.value?(x(),c("div",At,[u("div",Ft,[t[2]||(t[2]=u("svg",{class:"w-5 h-5 text-blue-400 mr-3 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),u("div",Et,[t[1]||(t[1]=u("h4",{class:"text-sm font-medium text-blue-800"},"Contact Assignment",-1)),u("div",Ot,["select"===i.value.mode?(x(),c("p",Nt,v(i.value.selectedContactIds.length)+" existing contact"+v(1!==i.value.selectedContactIds.length?"s":"")+" will be linked to this organization. ",1)):(x(),c("p",Tt,v(i.value.newContacts.length)+" new contact"+v(1!==i.value.newContacts.length?"s":"")+" will be created and linked to this organization. ",1)),h.value?(x(),c("p",Ut,[u("strong",null,v(h.value),1),t[0]||(t[0]=m(" will be set as the primary contact. ",-1))])):p("",!0)])])])])):p("",!0)])]))}}),Rt={class:"max-w-4xl mx-auto"},Dt={class:"mb-3"},qt={class:"flex items-center justify-center space-x-2 mb-2"},Ht=["aria-label"],Lt={class:"text-center"},Jt={class:"text-base font-medium text-gray-900"},Gt={class:"text-xs text-gray-600 mt-0.5"},Kt={key:0,class:"mb-3 flex items-center justify-center text-xs"},Wt={key:0,class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"},Qt={key:1,class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Xt={key:2,class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Yt={key:1,class:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",role:"alert"},Zt={class:"flex items-start"},ea={class:"mt-1 text-sm text-red-700"},ta={class:"bg-white shadow-sm rounded-lg border border-gray-200"},aa={class:"p-3 md:p-4"},ra={class:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg md:relative md:bg-gray-50 md:border-0 md:shadow-none md:mt-3 md:rounded-lg"},oa={class:"max-w-4xl mx-auto px-3 py-2 md:px-4 md:py-3"},la={class:"flex items-center justify-between"},na={key:1},sa={class:"flex items-center space-x-3"},ia={class:"text-xs text-gray-500"},da={key:0,class:"h-4 w-4 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ca=o({t:"OrganizationFormWrapper",props:{initialData:{},isEditing:{type:Boolean,default:!1},organizationId:{}},emits:["success","cancel","draft-saved"],setup(o,{emit:d}){const h=o,k=d,C=e(),z=a(),S=l(1),j=l(!1),$=l(!1),P=l(""),A=l(null),F=B({1:!1,2:!0,3:!0}),E=B({name:"",industry:"",lead_score:null,type:null,status:"Prospect",address_line_1:"",city:"",state_province:"",postal_code:"",primary_phone:"",website:"",assigned_user_id:null,description:"",...h.initialData}),O=B({1:{},2:{},3:{}}),N=[{id:1,title:"Basic Info",description:"Enter organization name, priority, segment, and business type",component:"OrganizationStepOne",requiredFields:["name","industry","lead_score"]},{id:2,title:"Organization Info",description:"Add address, phone, and additional notes",component:"OrganizationStepTwo",requiredFields:[]},{id:3,title:"Contact Info",description:"Select existing contacts or create new contacts",component:"OrganizationStepThree",requiredFields:[]}],T=n(()=>N[S.value-1]),U=n(()=>({OrganizationStepOne:fe,OrganizationStepTwo:ze,OrganizationStepThree:It}[T.value.component])),I=n(()=>3===S.value),R=n(()=>O[S.value]||{}),D=n(()=>F[S.value]),q=e=>{Object.assign(E,e),Q()},H=async(e,t,a={})=>{F[e]=t,O[e]=a,t&&P.value&&(P.value="")},L=async()=>{$.value=!0;try{const e=T.value.requiredFields,a={};if(e.forEach(e=>{a[e]=E[e]}),e.length>0){const r=t.pick(e);await r.validate(a,{abortEarly:!1})}return await H(S.value,!0,{}),!0}catch(e){const t={};return e.inner?e.inner.forEach(e=>{e.path&&(t[e.path]=e.message)}):t.general=e.message||"Validation failed",await H(S.value,!1,t),!1}finally{$.value=!1}},J=()=>{S.value>1&&(S.value--,V(()=>{Z()}))},G=async()=>{I.value?await K():await(async()=>{S.value<3&&await L()&&(S.value++,await V(),Z())})()},K=async()=>{var e;try{j.value=!0,P.value="";for(let e=1;e<=3;e++)if(S.value=e,!(await L()))return void(P.value=`Please fix errors in Step ${e}`);const t=E.custom_fields,a={mode:(null==t?void 0:t.contact_mode)||"select",selectedContactIds:(null==t?void 0:t.selected_contact_ids)||[],newContacts:(null==t?void 0:t.new_contacts)||[]},r={...E,name:E.name||"",industry:E.industry||null,lead_score:E.lead_score||null,tags:(null==(e=E.tags)?void 0:e.filter(e=>void 0!==e))||null,custom_fields:t?{...t,contact_mode:void 0,selected_contact_ids:void 0,new_contacts:void 0}:{}};let o;o=h.isEditing&&h.organizationId?await z.updateOrganizationWithContacts(h.organizationId,r,a):await z.createOrganizationWithContacts(r,a),o?(Y(),k("success",o.id),C.push(`/organizations/${o.id}`)):P.value="Failed to save organization. Please try again."}catch(t){P.value=t.message||"An unexpected error occurred"}finally{j.value=!1}};let W=null;const Q=()=>{W&&clearTimeout(W),W=setTimeout(async()=>{await X()},2e3)},X=async()=>{try{A.value="saving";const e=h.isEditing?`org-edit-draft-${h.organizationId}`:"org-create-draft";localStorage.setItem(e,JSON.stringify({formData:{...E},currentStep:S.value,timestamp:Date.now()})),A.value="saved",k("draft-saved",{...E}),setTimeout(()=>{A.value=null},3e3)}catch(e){A.value="error",setTimeout(()=>{A.value=null},3e3)}},Y=()=>{try{const e=h.isEditing?`org-edit-draft-${h.organizationId}`:"org-create-draft";localStorage.removeItem(e)}catch(e){}},Z=()=>{V(()=>{const e=document.querySelector("input, select, textarea");null==e||e.focus()})};s(()=>{(()=>{try{const e=h.isEditing?`org-edit-draft-${h.organizationId}`:"org-create-draft",t=localStorage.getItem(e);if(t){const e=JSON.parse(t);(Date.now()-e.timestamp)/6e4<60&&!h.initialData&&(Object.assign(E,e.formData),S.value=e.currentStep||1)}}catch(e){}})(),Z()});const ee=e=>{"Escape"===e.key&&k("cancel")};return s(()=>{document.addEventListener("keydown",ee)}),i(()=>{document.removeEventListener("keydown",ee),W&&clearTimeout(W)}),(e,t)=>(x(),c("div",Rt,[u("div",Dt,[u("div",qt,[(x(),c(b,null,y(N,(e,t)=>u("div",{key:e.id,class:g(["h-1.5 w-6 rounded-full transition-colors duration-200",t+1<=S.value?"bg-primary-600":"bg-gray-200"]),"aria-label":`Step ${t+1}: ${e.title}`},null,10,Ht)),64))]),u("div",Lt,[u("h2",Jt,v(T.value.title),1),u("p",Gt,v(T.value.description),1)])]),A.value?(x(),c("div",Kt,[u("div",{class:g(["flex items-center space-x-2 px-3 py-1 rounded-full","saving"===A.value?"bg-blue-50 text-blue-700":"saved"===A.value?"bg-green-50 text-green-700":"bg-red-50 text-red-700"])},["saving"===A.value?(x(),c("svg",Wt,t[0]||(t[0]=[u("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),u("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):"saved"===A.value?(x(),c("svg",Qt,t[1]||(t[1]=[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(x(),c("svg",Xt,t[2]||(t[2]=[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]))),u("span",null,v("saving"===A.value?"Saving draft...":"saved"===A.value?"Draft saved":"Failed to save draft"),1)],2)])):p("",!0),P.value?(x(),c("div",Yt,[u("div",Zt,[t[4]||(t[4]=u("svg",{class:"h-5 w-5 text-red-400 mr-3 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),u("div",null,[t[3]||(t[3]=u("h3",{class:"text-sm font-medium text-red-800"},"Error",-1)),u("p",ea,v(P.value),1)])])])):p("",!0),u("div",ta,[u("div",aa,[(x(),w(M(U.value),{"model-value":E,errors:R.value,loading:$.value,onValidate:H,"onUpdate:modelValue":q},null,40,["model-value","errors","loading"]))])]),u("div",ra,[u("div",oa,[u("div",la,[S.value>1?(x(),w(r,{key:0,variant:"secondary",size:"sm",disabled:j.value,onClick:J},{default:_(()=>t[5]||(t[5]=[u("svg",{class:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),m(" Back ",-1)])),o:1,l:[5]},8,["disabled"])):(x(),c("div",na)),u("div",sa,[u("div",ia," Step "+v(S.value)+" of "+v(3),1),f(r,{variant:I.value?"success":"primary",size:"sm",loading:j.value||$.value,disabled:!D.value||j.value,onClick:G},{default:_(()=>[m(v(I.value?"Create Organization":"Next")+" ",1),I.value?p("",!0):(x(),c("svg",da,t[6]||(t[6]=[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])))]),o:1},8,["variant","loading","disabled"])])])])])]))}}),ua={class:"max-w-4xl mx-auto space-y-6"},pa={class:"flex items-center justify-between"},ma={class:"flex items-center space-x-2 text-sm text-gray-500 mb-2"},va=o({t:"OrganizationCreateView",setup(t){const a=e(),r=e=>{a.push(`/organizations/${e}`)},o=()=>{a.push("/organizations")},l=e=>{};return(e,t)=>{const a=z("router-link");return x(),c("div",ua,[u("div",pa,[u("div",null,[u("nav",ma,[f(a,{to:"/organizations",class:"hover:text-gray-700"},{default:_(()=>t[0]||(t[0]=[m("Organizations",-1)])),o:1,l:[0]}),f(S(A),{class:"h-4 w-4"}),t[1]||(t[1]=u("span",{class:"text-gray-900"},"New Organization",-1))]),t[2]||(t[2]=u("h1",{class:"text-2xl font-bold text-gray-900"},"Create New Organization",-1)),t[3]||(t[3]=u("p",{class:"mt-1 text-sm text-gray-500"}," Add a new organization to your CRM system ",-1))]),f(a,{to:"/organizations",class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},{default:_(()=>[f(S(F),{class:"h-4 w-4 mr-2"}),t[4]||(t[4]=m(" Cancel ",-1))]),o:1,l:[4]})]),f(ca,{onSuccess:r,onCancel:o,onDraftSaved:l})])}}});export{va as default};
